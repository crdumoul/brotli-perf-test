rb.registerNamespace("rb.widget");rb.widget.productviewrollup=rb.widget.base.extend({AltNameType:{Movies:1,Games:2,MovieComingSoon:3,GameComingSoon:4},get_productType:function(){return this._productType},set_productType:function(a){this._productType=a},get_maxNewReleaseDays:function(){return this._maxNewReleaseDays},set_maxNewReleaseDays:function(a){this._maxNewReleaseDays=a},get_rollupHeading:function(){return this._rollupHeading},set_rollupHeading:function(a){this._rollupHeading=a},get_useDaysFiltering:function(){return this._useDaysFiltering},set_useDaysFiltering:function(a){this._useDaysFiltering=a},get_fromDays:function(){return this._fromDays},set_fromDays:function(a){this._fromDays=a},get_toDays:function(){return this._toDays},set_toDays:function(a){this._toDays=a},get_useTitleFiltering:function(){return this._useTitleFiltering},set_useTitleFiltering:function(a){this._useTitleFiltering=a},get_titleIds:function(){return this._titleIds},set_titleIds:function(a){this._titleIds=a},get_showHero:function(){return this._showHero},set_showHero:function(a){this._showHero=a},get_heroTitleId:function(){return this._heroTitleId},set_heroTitleId:function(a){this._heroTitleId=a},get_altNameType:function(){return this._altNameType},set_altNameType:function(a){this._altNameType=a},get_clientSideAltPiece:function(){return this._clientSideAltPiece},set_clientSideAltPiece:function(a){this._clientSideAltPiece=a},get_enableLazyLoad:function(){return this._enableLazyLoad},set_enableLazyLoad:function(a){this._enableLazyLoad=a},get_showIndividualTitles:function(){return this._showIndividualTitles},set_showIndividualTitles:function(a){this._showIndividualTitles=a},init:function(){this._super();this._itemList=null;this._titleTip=null;this._widget=null;this._template=null;this._enableLazyLoad=false;this._toolTipControls=null;this._delegates={onItemRendering:rb.createDelegate(this,this._onItemRendering),onWindowMouseMove:rb.createDelegate(this,this._onWindowMouseMove)}},bind:function(a){var c=this;if(this._defer(function(){c.bind(a)})){return}this.lock();this.hideNotification();var b=this._getFilteredRollupProducts(a);rb.parseTemplate(this._template,this._itemList,b,this._delegates.onItemRendering);this._onInitialDisplay();rb.UI.lazyLoad(this._itemList.find("img"),0,rb.createDelegate(this,this._onLazyDisplay));if(a.length==0){this.showNotification(this.getText("NoResults"))}this.raiseItemsRendered();this.unlock()},_onLoad:function(b,a){this._super(b,a);this._template=this.getControl("Template");this._itemList=this.getControl("ItemList");this._titleTip=this.getWidget("TitleTipRollup");this._widget=this.getControl("Widget");this._onInitialDisplay();rb.UI.lazyLoad(this._itemList.find("img"),0,rb.createDelegate(this,this._onLazyDisplay))},_getProduct:function(a){var b=rb.api.product.getProductsById(a);if(b&&b.data){return b.data}else{return null}},_onInitialDisplay:function(){var a=[];var c=this._enableLazyLoad?this._itemList.find(".box-preloaded"):this._itemList.find(".box-wrapper");for(var b=0;b<c.length;b++){a.push(this._registerTitleCtr($(c[b])))}this._toolTipControls=a;$(window).on("mousemove",this._delegates.onWindowMouseMove)},_onItemRendering:function(a,b){var c="";var d="";if(b.productType==1){c=b.fmt=="1"?"DVD":"Blu-ray";d="Movie"}if(b.productType==5){if(b.fmt==6){c="PS2"}if(b.fmt==7){c="Xbox 360"}if(b.fmt==8){c="PS3"}if(b.fmt==10){c="Wii"}if(b.fmt==14){c="Xbox ONE"}if(b.fmt==15){c="PS4"}if(b.fmt==16){c="Wii U"}d="Game"}a.find(".product-format").text(c);this._updateAltName(a,b,c,d)},_updateAltName:function(b,c,d,g){var e='[id="'+c.ID+'"]';var a=b.find(e);if(typeof a!="undefined"&&a!=null){var f=a.attr("alt");var i=f;if(this._altNameType==this.AltNameType.GameComingSoon){i=f+this._createComingSoonAltText(g,d,this._clientSideAltPiece)}else{if(this._altNameType==this.AltNameType.MovieComingSoon){i=f+this._createComingSoonAltText(g,d,this._clientSideAltPiece)}else{if(this._altNameType==this.AltNameType.Games){i=f+this._createRollupAltText(g,d,this._clientSideAltPiece)}else{if(this._altNameType==this.AltNameType.Movies){var h=a.parents(".product-container").children("div.heading").children("h1,h2").text();i=f+this._createRollupAltText(g,d,h)}}}}a.attr("alt",i)}},_createRollupAltText:function(c,a,b){return String.format(this.getText("RollupAltTextMask"),this.getText(String.format("RollupAltText{0}Type",c),c),b.toLowerCase(),a)},_createComingSoonAltText:function(c,a,b){return String.format(this.getText("ComingSoonAltTextMask"),c,b.toLowerCase(),a)},_onLazyDisplay:function(b){var c=[];var a=b.closest(".box-wrapper");c.push(this._registerTitleCtr(a));this._titleTip.register(c)},_registerTitleCtr:function(a){a.find(".rb-cap").hide();return{id:a.attr("key"),ctl:a.find(".box-hover")[0]}},_getFilteredRollupProducts:function(c){var f=(this._showIndividualTitles)?c:rb.api.product.getRolledUpProducts(c);var d=[];var a=true;var b=this._showHero;var e=this;$.each(f,function(h,j){var g=true;if(e._useDaysFiltering&&(e._fromDays>j.releaseDays||(e._toDays!=-1&&j.releaseDays>e._toDays))){g=false}else{if(e._useTitleFiltering&&($.inArray(j.ID,e._titleIds)==-1)){g=false}}if(g){j.showHeader=a;j.showHero=b;j.imgPath=e._rollupImageName(j);d.push(j);a=false;b=false}});return d},_rollupImageName:function(c){if(c==null){return String.empty}var b=c;if(!this._showIndividualTitles&&b.fmt==2){var a=rb.api.product.getProductsById(c.sib).data;if(a!=null){b=a}}return b.imgPath.replace("Thumb150",this._showHero?"Kiosk":"Detail370")},_onWindowMouseMove:function(){if(this._toolTipControls==null){return}this._titleTip.register(this._toolTipControls);$(window).off("mousemove");this._toolTipControls=null},addItemsRendered:function(a){this.addHandler("onItemsRendered",a)},removeItemsRendered:function(a){this.removeHandler("onItemsRendered",a)},raiseItemsRendered:function(a){return this.raiseEvent("onItemsRendered",a)}});