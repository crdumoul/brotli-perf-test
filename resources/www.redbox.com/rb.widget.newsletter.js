rb.registerNamespace("rb.widget");rb.widget.newsletter=rb.widget.base.extend({get_profileUrl:function(){return this._profileUrl},set_profileUrl:function(a){this._profileUrl=a},init:function(){this._super();this._validator=null;this._form=null;this._profileUrl=null;this._email=null;this._signUpButton=null;this._continueProfile=null;this._continueProfileButton=null;this._description=null;this._description2=null;this._toggle=null;this._mainBody=null;this._delegates={onSignUpResponse:rb.createDelegate(this,this._onSignUpResponse),onToggleClick:rb.createDelegate(this,this._onToggleClick)}},lock:function(){this._super();this._signUpButton.hide()},unlock:function(){this._super();this._signUpButton.show()},signUp:function(){if(!this.locked&&this._form.valid()){this.lock();rb.api.account.signupNewsletter(this._email.val(),this._delegates.onSignUpResponse,this._baseDelegates.onAjaxFailDelegate)}},_onLoad:function(b,a){this._super(b,a);this._form=this.getControl("Form");this._description=this.getControl("Description");this._description2=this.getControl("Description2");this._continueProfile=this.getControl("ContinueProfile");this._email=this.getControl("Email");this._email.attr("title",this.getText("EmailAddressInstructions")).simpleWaterMark("watermark");this._signUpButton=this.getControl("SignUp");this._signUpButton.click(rb.createDelegate(this,this._onSignUpClicked));this._continueProfileButton=this.getControl("ContinueProfileButton");this._continueProfileButton.click(rb.createDelegate(this,this._onContinueProfileClicked));this._toggle=$(".email-widget .heading-container");this._toggle.on("click",this._delegates.onToggleClick);this._mainBody=$(".email-widget .body-block");this._validator=rb.validation.registerControls(this._form,[{ctl:this._email,required:true,type:"email"}],this.getControl("Error"),[{ctl:this._email,message:this.getText("SignupNewsletterInvalidEmail","Please enter a valid email address")}]);this._showDefaultReg()},_onContinueProfileClicked:function(a){if(this._profileUrl){var b=this._profileUrl+"?email="+this._email.val();this.navigate(b)}},_onSignUpClicked:function(a){this.signUp()},_onKeyEnter:function(a){this.signUp();return false},_onSignUpResponse:function(a){this.unlock();if(a.data!=null&&a.data==0){this.showNotification(this.getText("ConfirmationMessage","Thanks! A confirmation email is on its way."));this.hideError();this._hideSignUp();this._description.html(this.getText("ContinueProfileMessage","Continue your registration by clicking the button below."));this._showContinueProfile();rb.api.account.signupNewsletterAdobeTag(function(b){$("body").append($("<div>").html(b.data))},function(b){});rb.rec.Omn.RecordAction("Signed Up For Email",null,["event16"])}else{this.showError(a.msg)}},_hideSignUp:function(){this._email.hide();this._signUpButton.hide();this._description2.hide()},_showSignUp:function(){this._email.show();this._signUpButton.show();this._description2.show()},_hideContinueProfile:function(){this._continueProfile.hide()},_onKeyEnter:function(a){this._signUpButton.click();return false},_showContinueProfile:function(){this._continueProfile.show()},_showDefaultReg:function(){this.hideNotification();this._description.show();this._showSignUp();this.hideError();this._hideContinueProfile()},_onToggleClick:function(){if(this._toggle.hasClass("block-expanded")){this._toggle.removeClass("block-expanded").addClass("block-collapsed");this._mainBody.removeClass("body-show").addClass("body-hide")}else{this._toggle.removeClass("block-collapsed").addClass("block-expanded");this._mainBody.removeClass("body-hide").addClass("body-show")}}});