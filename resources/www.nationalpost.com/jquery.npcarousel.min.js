(function(a){a.fn.npCarousel=function(k){var g=false,h,b={ajaxUrl:"",animSpeed:"default",btnDisabledClass:"disabled",btnNext:null,btnPrev:null,index:0,indexAttribute:null,item:"li",itemWidth:null,loadIndicator:null,loop:false,step:1,truncate:null,visible:0},o=this;if(k){a.extend(b,k)}b.carousel=a(b.container,this);b.container=this;b.visible=b.visible||b.step;function l(){return b.container.find(b.item)}function m(u){var t=b.container.innerHeight(),s=u.find(b.truncate),r=a.trim(s.text()),q,p=20;while(u.outerHeight()>t){q=r.replace(/(^|\s)\S+$/,"");if(q.length===r.length||p<=0){break}r=q;s.text(r+"...");p-=1}}function e(q){var p=l().length;if(b.loadIndicator){b.loadIndicator.fadeOut()}b.carousel.append(q);if(a(b.truncate).length){b.container.find("li:gt("+p+")").each(function(){m(a(this))})}if(typeof h==="function"){h()}}function j(p,r){var q=b.index+(r?0:b.visible);r=!!r;if(b.indexAttribute){q=l().eq(q).attr(b.indexAttribute)}if(b.loadIndicator){b.loadIndicator.show()}if(r){b.loadPrev(q,p,e)}else{b.loadNext(q,p,e)}}function d(p){p.slice(b.index+b.visible).hide();p.slice(Math.max(0,b.index+b.visible-p.length),b.index).hide()}function c(s){var q=[],w=[],t,v,z=0,p,y,A,x,u;if(g){return false}function r(){g=false;d(u)}u=l();b.itemWidth=l().eq(b.index).outerWidth();b.container.find(b.btnNext).removeClass(b.btnDisabledClass);b.container.find(b.btnPrev).removeClass(b.btnDisabledClass);q=u.slice(b.index,b.index+b.visible).get();if(s>0){w=u.slice(b.index+b.visible,b.index+b.visible+s).get();if(b.loop&&u.length>=b.visible){A=Math.max(b.visible-q.length,0);if(q.length<b.visible){p=0;q=q.concat(u.slice(p,A).get())}if(w.length<s&&A<b.index){p=A;A=p+(s-w.length);w=w.concat(u.slice(p,A).get())}}y=Math.min(w.length+(b.visible-b.step),s);if(!b.loadNext&&(s>y||(!b.loop&&u.length<=b.index+s*2)||(b.loop&&(w.length<s||u.length<b.step+b.visible)))){b.container.find(b.btnNext).addClass(b.btnDisabledClass)}}else{p=b.index+s;A=p-s;p=Math.max(0,p);w=u.slice(p,A).get();if(b.loop&&u.length>=b.visible){if(q.length<b.visible&&p>0){A=Math.min(b.visible-q.length,p);p=0;q=q.concat(u.slice(p,A).get())}if(w.length<-s&&q.length>=b.visible){p=-(-s-w.length);w=w.reverse().concat(u.slice(p).get().reverse()).reverse()}}y=Math.max(-w.length,s);if(!b.loadPrev&&(s<y||(!b.loop&&b.index+s===0)||(b.loop&&(w.length<-s||u.length<b.step+b.visible)))){b.container.find(b.btnPrev).addClass(b.btnDisabledClass)}}for(t=0;t<w.length;t+=1){x=a(w[t]);x.css({left:y>0?b.visible*b.itemWidth+t*b.itemWidth:(y+t)*b.itemWidth}).show()}s=y;q=q.concat(w);for(t=0;t<q.length;t+=1){v="-="+(s*b.itemWidth);x=a(q[t]);if(t===0){x.animate({left:v},b.animSpeed,r)}else{x.animate({left:v},b.animSpeed)}z+=1}if(z){g=true;b.index+=s;if(b.loop){if(b.index>=u.length){b.index-=u.length}else{if(b.index<0){b.index+=u.length}}}}}function i(){var p,q=l();if(!b.loop&&b.loadNext&&b.index+b.visible+b.step>q.length){p=q.length-(b.index+1+b.step)+b.step;h=i;j(p)}else{h=null;c(b.step)}}function f(){var p,q=l();if(!b.loop&&b.loadPrev&&b.index+b.visible+b.step>q.length){p=q.length-(b.index+1+b.step)+b.step;h=i;j(p)}else{h=null;c(-b.step)}}function n(){var p=l();p.each(function(q){var r=a(this);if(!b.itemWidth){b.itemWidth=r.outerWidth()}if(a(b.truncate).length){m(r)}r.css({position:"absolute",left:q*b.itemWidth+"px"})});o.find(b.btnNext).bind("click",function(q){q.preventDefault();if(a(this).hasClass(b.btnDisabledClass)){return}i()});o.find(b.btnPrev).bind("click",function(q){q.preventDefault();if(a(this).hasClass(b.btnDisabledClass)){return}f()});if(p.length===b.index+b.step&&!b.loadNext){b.container.find(b.btnNext).addClass(b.btnDisabledClass)}if(b.index===0&&((!b.loadPrev&&!b.loop)||(b.loop&&p.length<b.step+b.visible))){b.container.find(b.btnPrev).addClass(b.btnDisabledClass)}d(p);if(b.loadIndicator){b.loadIndicator=a(b.loadIndicator)}else{b.loadIndicator=a('<span style="color:#fff;font:bold 24px/80px sans-serif;text-align:center;display:none;position:absolute;top:50%;left:50%;width:200px;height:80px;margin-top:-40px;margin-left:-100px;background:rgba(0,0,0,.75);border:rgba(255,255,255,0.75) 3px solid;border-radius:1em">Loading...</span>').appendTo(o)}}n();return this.each(function(){})}}(jQuery));