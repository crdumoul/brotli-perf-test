var npIDMSquote;function IDMSAutocompleteCache(c){var a=100,b=[];this.symbols=[];this.names=[];this.exchanges=[];this.ids=[];if(c){a=c}this.lookup=function(d){return b.indexOf(d.trim().toUpperCase())};this.save=function(h,f,i,d,g){var e=this.lookup(h.trim());if(e===-1){e=b.push(h)-1;if(e===a){b.shift();this.symbols.shift();this.names.shift();this.exchanges.shift();this.ids.shift();e-=1}}this.symbols[e]=f;this.names[e]=i;this.exchanges[e]=d;this.ids[e]=g}}function IDMSquote(){this.settings={cache:100,searchURL:"http://idms.financialpost.com/www/search_data.idms",resultsURL:"http://www.financialpost.com/markets/results/index.html",lookupURL:"http://www.financialpost.com/markets/company/index.html",lookupFundURL:"http://www.financialpost.com/markets/funds/profile/index.html",exchanges:"NYSE,NASDAQ,AMEX,TOR,FUND",form:"#npTabSearchQuote",input:"#npTabSearchQuote .npInTxt",results:"#npTabSearchQuote .idcSearchResults",highlight:"npHilite"};this.cache=false;this.init=function(){var a=this;if(this.settings.cache){this.cache=new IDMSAutocompleteCache(this.settings.cache)}this.settings.form=npJ(this.settings.form);this.settings.input=npJ(this.settings.input);this.settings.results=npJ(this.settings.results);this.settings.form.bind("submit",function(){a.performSearch();return false});this.settings.input.bind("blur",function(){a.settings.results.fadeOut()});this.settings.input.bind("focus",function(){if(a.settings.input.val()!==""){a.settings.results.fadeIn()}});this.settings.input.bind("keyup",function(c){var b=c.keyCode||c.which;if(b===9||b===13||(b>=37&&b<=40)){return false}a.fetch(a.settings.input.val());return true});this.settings.input.bind("keydown",function(g){var f=g.keyCode||g.which,c,d,b=npJ("a."+a.settings.highlight,a.settings.results);if(f===9||f===13){if(b.size()){a.select(b)}else{return true}}else{if(f===38){if(b.size()){b.removeClass(a.settings.highlight);d=b.prev();if(!d){d=npJ("a:last",a.settings.results)}}else{d=npJ("a:last",a.settings.results)}d.addClass(a.settings.highlight)}else{if(f===40){if(b.size()){b.removeClass(a.settings.highlight);c=b.next();if(!c){c=npJ("a:first",a.settings.results)}}else{c=npJ("a:first",a.settings.results)}c.addClass(a.settings.highlight)}else{return true}}}return false});return this};this.setSearchURL=function(a){this.settings.searchURL=a;return this};this.setLookupURL=function(a){this.settings.lookupURL=a;return this};this.setLookupFundURL=function(a){this.settings.lookupFundURL=a;return this};this.setExchanges=function(a){this.settings.exchanges=a;return this};this.select=function(b){var a=npJ(".url",b).val();if(a){window.location.href=a}};this.performSearch=function(){var b=npJ(".url",this.settings.results),a;if(b.size()>0){a=this.settings.resultsURL+"?blocksize=20&exch="+this.settings.exchanges+"&offset=0&sym="+this.settings.input.val();window.location.href=a}else{alert("No results found.")}};this.process=function(f,g,e,b,j){var d,h,k=this,c,a;if(!f){this.settings.results.html("").hide();return}h="";for(d=0;d<g.length;d+=1){c=g[d].replace(/<STRONG>/i,"");c=c.replace(/<\/STRONG>/i,"");if(b[d]==="FUND"){a=this.settings.lookupFundURL+"?fund="+j[d]}else{a=this.settings.lookupURL+"?symbol="+c+"&id="+j[d]}h+='<a href="'+a+'" class="npGroup'+(d===0?" npTop":"")+'"><span class="npSymbol">'+g[d]+'</span><span class="npName">'+e[d]+'</span><span class="npExch">'+b[d]+"</span></a>"}if(g.length>0){a=this.settings.resultsURL+"?showresults=1&blocksize=20&exch="+this.settings.exchanges+"&offset=0&sym="+f;h+='<a href="'+a+'" class="npTxtCentre">Show all matching results</a>'}else{h+='<p class="npTxtCentre">No results found</p>'}this.settings.results.html(h);npJ("a",this.settings.results).bind("click",function(){k.select(this)});npJ("a",this.settings.results).bind("mouseenter",function(){npJ("a",k.settings.results).removeClass(k.settings.highlight);npJ(this).addClass(k.settings.highlight)});npJ("a",this.settings.results).bind("mouseleave",function(){npJ(this).removeClass(k.settings.highlight)});this.settings.results.show();this.settings.form.find(".npIconLoad").fadeOut()};this.keyup=function(c,a){var b=c.keyCode||c.which;if(b===9||b===13||(b>=37&&b<=40)){return false}a.fetch(a.settings.input.val());return true};this.fetch=function(a){var c,d,b;a=a.trim().replace(/[\\']/g,"");if(!a){return this.process()}if(this.cache){c=this.cache.lookup(a);if(c!==-1){this.process(a,this.cache.symbols[c],this.cache.names[c],this.cache.exchanges[c],this.cache.ids[c]);return this}}this.settings.form.find(".npIconLoad").fadeIn();b=this.settings.searchURL+"?exch="+this.settings.exchanges+"&sym="+a;d=document.createElement("script");d.type="text/javascript";d.src=b;document.getElementsByTagName("head")[0].appendChild(d);return this};return this}function showQueryDiv(d,e,a,c,b){npIDMSquote.cache.save(d,e,a,c,b);npIDMSquote.process(d,e,a,c,b)}if(!Array.prototype.indexOf){Array.prototype.indexOf=function(b){var a=this.length>>>0,c=Number(arguments[1])||0;c=c<0?Math.ceil(c):Math.floor(c);if(c<0){c+=a}for(;c<a;c+=1){if(c in this&&this[c]===b){return c}}return -1}}npJ(document).ready(function(){npIDMSquote=new IDMSquote();npIDMSquote.init()});