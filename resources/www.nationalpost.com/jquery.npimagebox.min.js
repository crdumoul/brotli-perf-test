(function(a){a.fn.npImageBox=function(e){var d,b=0.5,c,f={"abstract":null,btnNext:null,btnPrev:null,container:null,image:null,items:"li",itemAbstract:null,itemTitle:null,title:null};return this.each(function(){var k,l,h,p=a(this);function m(){return p.find(f.items)}function n(s,r){var t=r.offset().top+r.innerHeight(),u=s.offset().top-parseInt(s.css("marginTop"),10),q=100;while(u+s.outerHeight(true)-(npLib.bIE?3:0)>t){q-=1;if(q<=0){break}s.text(s.text().replace(/^([\s\S]*) [\s\S]+$/,"$1..."))}}function j(t,s){var r,q;function u(){q=t.find(f.itemTitle).text();if(r){r.attr("title",q)}if(l.length&&f.itemTitle){l.text(q)}if(c.length&&f.itemAbstract){c.text(t.find(f.itemAbstract).text());n(p.find(f["abstract"]),p.find(f["abstract"]).parent())}h=t.find("a:first").attr("href");m().filter(".npCurrent").removeClass("npCurrent");t.addClass("npCurrent");if(r){k.remove();k=r}}if(k.attr("src")!==t.attr("data-src-fullsize")){if(d){clearTimeout(d)}d=setTimeout(function(){p.find(f.container).addClass("npLoading")},b*1000);r=a('<img class="npHide" />').insertAfter(k).attr("src",t.attr("data-src-fullsize")).load(function(){clearTimeout(d);p.find(f.container).removeClass("npLoading");a(this).fadeIn("default",u)})}else{if(!!s){u()}}}function i(){var r=m(),q=r.filter(".npCurrent").next();j(q.length?q:r.eq(0))}function g(){var r=m(),q=r.filter(".npCurrent").prev();j(q.length?q:r.eq(-1))}function o(){if(e){a.extend(f,e)}c=p.find(f["abstract"]);k=p.find(f.image+":first");l=p.find(f.title);p.find(f.container).bind("click",function(q){q.preventDefault();window.location=h});p.find(f.items).live("click",function(q){q.preventDefault();j(a(this))});p.find(f.btnNext).bind("click",function(q){q.preventDefault();i()});p.find(f.btnPrev).bind("click",function(q){q.preventDefault();g()});j(m().eq(0),true)}o()})}}(jQuery));