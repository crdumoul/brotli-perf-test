!function(e){e.fn.redraw=function(){return e(this).each(function(){var t=document.createTextNode(" ");e(this).append(t),setTimeout(function(){t.parentNode.removeChild(t)},0)})}}(jQuery),/*
 * Lazy Load - jQuery plugin for lazy loading images
 *
 * Copyright (c) 2007-2012 Mika Tuupola
 *
 * Licensed under the MIT license:
 *   http://www.opensource.org/licenses/mit-license.php
 *
 * Project home:
 *   http://www.appelsiini.net/projects/lazyload
 *
 * Version:  1.8.0.sbn
 * - Hacked so that it lazy loads non-IMG tags
 * - Hacked so that the scroll event that ends up firing lazyload:appear is debounced
 * - Hacked so resize event is debounced
 * - Hacked so data attributes are not cached via jQuery (neccesary for optimization)
 *
 */
function(e,t){var n=e(t);e.fn.lazyload=function(o){function i(e,t){return"undefined"!=typeof _?_.debounce(e,t):e}function r(){var t=0;a.each(function(){var n=e(this);if(!l.skip_invisible||n.is(":visible"))if(e.abovethetop(this,l)||e.leftofbegin(this,l));else if(e.belowthefold(this,l)||e.rightoffold(this,l)){if(++t>l.failure_limit)return!1}else n.trigger("lazyload:appear")})}var s,a=this,l={threshold:0,failure_limit:0,event:"scroll",effect:"show",container:t,data_attribute:"original",skip_invisible:!0,appear:null,load:null,scrollInterval:200,resizeInterval:250};if(o&&(void 0!==o.failurelimit&&(o.failure_limit=o.failurelimit,delete o.failurelimit),void 0!==o.effectspeed&&(o.effect_speed=o.effectspeed,delete o.effectspeed),e.extend(l,o)),s=void 0===l.container||l.container===t?n:e(l.container),0===l.event.indexOf("scroll")){var c=function(e){return r()};s.bind(l.event,i(c,l.scrollInterval))}this.each(function(){var n=this,o=e(n);n.loaded=!1,n.error_event_set=!1;var r=4e3,s=4,c=0,u=function(){if(!this.loaded){if(l.appear){var i=a.length;l.appear.call(n,i,l)}if("IMG"===this.tagName)e("<img />").bind("load",function(){o.hide().attr("src",o.attr("data-"+l.data_attribute))[l.effect](l.effect_speed),n.loaded=!0;var t=e.grep(a,function(e){return!e.loaded});if(a=e(t),l.load){var i=a.length;l.load.call(n,i,l)}}).bind("error",function(){n.error_event_set||t.setTimeout(e.proxy(d,this),r),n.error_event_set=!0}).attr("src",o.attr("data-"+l.data_attribute));else{o.css("background-image","url('"+o.attr("data-"+l.data_attribute)+"')")[l.effect](l.effect_speed),n.loaded=!0;var s=e.grep(a,function(e){return!e.loaded});if(a=e(s),l.load){var i=a.length;l.load.call(n,i,l)}}}},d=function(){if(c+=1,s>=c){e(this).bind("error",function(){t.setTimeout(e.proxy(d,this),r)});var n=this.src.split("?")[0];this.src=n+"?"+(new Date).getTime()}};if(o.one("lazyload:appear",u),0!==l.event.indexOf("scroll")){var h=function(e){n.loaded||o.trigger("lazyload:appear")};o.bind(l.event,i(h,l.scrollInterval))}});var u=function(e){r()};return n.bind("resize",i(u,l.resizeInterval)),r(),this},e.belowthefold=function(o,i){var r;return r=void 0===i.container||i.container===t?n.height()+n.scrollTop():e(i.container).offset().top+e(i.container).height(),r<=e(o).offset().top-i.threshold},e.rightoffold=function(o,i){var r;return r=void 0===i.container||i.container===t?n.width()+n.scrollLeft():e(i.container).offset().left+e(i.container).width(),r<=e(o).offset().left-i.threshold},e.abovethetop=function(o,i){var r;return r=void 0===i.container||i.container===t?n.scrollTop():e(i.container).offset().top,r>=e(o).offset().top+i.threshold+e(o).height()},e.leftofbegin=function(o,i){var r;return r=void 0===i.container||i.container===t?n.scrollLeft():e(i.container).offset().left,r>=e(o).offset().left+i.threshold+e(o).width()},e.inviewport=function(t,n){return!(e.rightofscreen(t,n)||e.leftofscreen(t,n)||e.belowthefold(t,n)||e.abovethetop(t,n))},e.extend(e.expr[":"],{"below-the-fold":function(t){return e.belowthefold(t,{threshold:0})},"above-the-top":function(t){return!e.belowthefold(t,{threshold:0})},"right-of-screen":function(t){return e.rightoffold(t,{threshold:0})},"left-of-screen":function(t){return!e.rightoffold(t,{threshold:0})},"in-viewport":function(t){return!e.inviewport(t,{threshold:0})},"above-the-fold":function(t){return!e.belowthefold(t,{threshold:0})},"right-of-fold":function(t){return e.rightoffold(t,{threshold:0})},"left-of-fold":function(t){return!e.rightoffold(t,{threshold:0})}})}(jQuery,window),/*!
 * jQuery Cookie Plugin v1.4.0
 * https://github.com/carhartl/jquery-cookie
 *
 * Copyright 2013 Klaus Hartl
 * Released under the MIT license
 */
function(e){function t(e){return a.raw?e:encodeURIComponent(e)}function n(e){return a.raw?e:decodeURIComponent(e)}function o(e){return t(a.json?JSON.stringify(e):String(e))}function i(e){0===e.indexOf('"')&&(e=e.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{return e=decodeURIComponent(e.replace(s," ")),a.json?JSON.parse(e):e}catch(t){}}function r(t,n){var o=a.raw?t:i(t);return e.isFunction(n)?n(o):o}var s=/\+/g,a=e.cookie=function(i,s,l){if(void 0!==s&&!e.isFunction(s)){if(l=e.extend({},a.defaults,l),"number"==typeof l.expires){var c=l.expires,u=l.expires=new Date;u.setDate(u.getDate()+c)}return document.cookie=[t(i),"=",o(s),l.expires?"; expires="+l.expires.toUTCString():"",l.path?"; path="+l.path:"",l.domain?"; domain="+l.domain:"",l.secure?"; secure":""].join("")}for(var d=i?void 0:{},h=document.cookie?document.cookie.split("; "):[],m=0,p=h.length;p>m;m++){var f=h[m].split("="),g=n(f.shift()),v=f.join("=");if(i&&i===g){d=r(v,s);break}i||void 0===(v=r(v))||(d[g]=v)}return d};a.defaults={},e.removeCookie=function(t,n){return void 0===e.cookie(t)?!1:(e.cookie(t,"",e.extend({},n,{expires:-1})),!e.cookie(t))}}(jQuery),function(e,t){e.rails!==t&&e.error("jquery-ujs has already been loaded!");var n,o=e(document);e.rails=n={linkClickSelector:"a[data-confirm], a[data-method], a[data-remote], a[data-disable-with], a[data-disable]",buttonClickSelector:"button[data-remote]:not(form button), button[data-confirm]:not(form button)",inputChangeSelector:"select[data-remote], input[data-remote], textarea[data-remote]",formSubmitSelector:"form",formInputClickSelector:"form input[type=submit], form input[type=image], form button[type=submit], form button:not([type]), input[type=submit][form], input[type=image][form], button[type=submit][form], button[form]:not([type])",disableSelector:"input[data-disable-with]:enabled, button[data-disable-with]:enabled, textarea[data-disable-with]:enabled, input[data-disable]:enabled, button[data-disable]:enabled, textarea[data-disable]:enabled",enableSelector:"input[data-disable-with]:disabled, button[data-disable-with]:disabled, textarea[data-disable-with]:disabled, input[data-disable]:disabled, button[data-disable]:disabled, textarea[data-disable]:disabled",requiredInputSelector:"input[name][required]:not([disabled]),textarea[name][required]:not([disabled])",fileInputSelector:"input[type=file]",linkDisableSelector:"a[data-disable-with], a[data-disable]",buttonDisableSelector:"button[data-remote][data-disable-with], button[data-remote][data-disable]",CSRFProtection:function(t){var n=e('meta[name="csrf-token"]').attr("content");n&&t.setRequestHeader("X-CSRF-Token",n)},refreshCSRFTokens:function(){var t=e("meta[name=csrf-token]").attr("content"),n=e("meta[name=csrf-param]").attr("content");e('form input[name="'+n+'"]').val(t)},fire:function(t,n,o){var i=e.Event(n);return t.trigger(i,o),i.result!==!1},confirm:function(e){return confirm(e)},ajax:function(t){return e.ajax(t)},href:function(e){return e[0].href},handleRemote:function(o){var i,r,s,a,l,c;if(n.fire(o,"ajax:before")){if(a=o.data("with-credentials")||null,l=o.data("type")||e.ajaxSettings&&e.ajaxSettings.dataType,o.is("form")){i=o.attr("method"),r=o.attr("action"),s=o.serializeArray();var u=o.data("ujs:submit-button");u&&(s.push(u),o.data("ujs:submit-button",null))}else o.is(n.inputChangeSelector)?(i=o.data("method"),r=o.data("url"),s=o.serialize(),o.data("params")&&(s=s+"&"+o.data("params"))):o.is(n.buttonClickSelector)?(i=o.data("method")||"get",r=o.data("url"),s=o.serialize(),o.data("params")&&(s=s+"&"+o.data("params"))):(i=o.data("method"),r=n.href(o),s=o.data("params")||null);return c={type:i||"GET",data:s,dataType:l,beforeSend:function(e,i){return i.dataType===t&&e.setRequestHeader("accept","*/*;q=0.5, "+i.accepts.script),n.fire(o,"ajax:beforeSend",[e,i])?void o.trigger("ajax:send",e):!1},success:function(e,t,n){o.trigger("ajax:success",[e,t,n])},complete:function(e,t){o.trigger("ajax:complete",[e,t])},error:function(e,t,n){o.trigger("ajax:error",[e,t,n])},crossDomain:n.isCrossDomain(r)},a&&(c.xhrFields={withCredentials:a}),r&&(c.url=r),n.ajax(c)}return!1},isCrossDomain:function(e){var t=document.createElement("a");t.href=location.href;var n=document.createElement("a");try{return n.href=e,n.href=n.href,!n.protocol||!n.host||t.protocol+"//"+t.host!=n.protocol+"//"+n.host}catch(o){return!0}},handleMethod:function(o){var i=n.href(o),r=o.data("method"),s=o.attr("target"),a=e("meta[name=csrf-token]").attr("content"),l=e("meta[name=csrf-param]").attr("content"),c=e('<form method="post" action="'+i+'"></form>'),u='<input name="_method" value="'+r+'" type="hidden" />';l===t||a===t||n.isCrossDomain(i)||(u+='<input name="'+l+'" value="'+a+'" type="hidden" />'),s&&c.attr("target",s),c.hide().append(u).appendTo("body"),c.submit()},formElements:function(t,n){return t.is("form")?e(t[0].elements).filter(n):t.find(n)},disableFormElements:function(t){n.formElements(t,n.disableSelector).each(function(){n.disableFormElement(e(this))})},disableFormElement:function(e){var n,o;n=e.is("button")?"html":"val",o=e.data("disable-with"),e.data("ujs:enable-with",e[n]()),o!==t&&e[n](o),e.prop("disabled",!0)},enableFormElements:function(t){n.formElements(t,n.enableSelector).each(function(){n.enableFormElement(e(this))})},enableFormElement:function(e){var t=e.is("button")?"html":"val";e.data("ujs:enable-with")&&e[t](e.data("ujs:enable-with")),e.prop("disabled",!1)},allowAction:function(e){var t,o=e.data("confirm"),i=!1;return o?(n.fire(e,"confirm")&&(i=n.confirm(o),t=n.fire(e,"confirm:complete",[i])),i&&t):!0},blankInputs:function(t,n,o){var i,r,s=e(),a=n||"input,textarea",l=t.find(a);return l.each(function(){if(i=e(this),r=i.is("input[type=checkbox],input[type=radio]")?i.is(":checked"):i.val(),!r==!o){if(i.is("input[type=radio]")&&l.filter('input[type=radio]:checked[name="'+i.attr("name")+'"]').length)return!0;s=s.add(i)}}),s.length?s:!1},nonBlankInputs:function(e,t){return n.blankInputs(e,t,!0)},stopEverything:function(t){return e(t.target).trigger("ujs:everythingStopped"),t.stopImmediatePropagation(),!1},disableElement:function(e){var o=e.data("disable-with");e.data("ujs:enable-with",e.html()),o!==t&&e.html(o),e.bind("click.railsDisable",function(e){return n.stopEverything(e)})},enableElement:function(e){e.data("ujs:enable-with")!==t&&(e.html(e.data("ujs:enable-with")),e.removeData("ujs:enable-with")),e.unbind("click.railsDisable")}},n.fire(o,"rails:attachBindings")&&(e.ajaxPrefilter(function(e,t,o){e.crossDomain||n.CSRFProtection(o)}),e(window).on("pageshow.rails",function(){e(e.rails.enableSelector).each(function(){var t=e(this);t.data("ujs:enable-with")&&e.rails.enableFormElement(t)}),e(e.rails.linkDisableSelector).each(function(){var t=e(this);t.data("ujs:enable-with")&&e.rails.enableElement(t)})}),o.delegate(n.linkDisableSelector,"ajax:complete",function(){n.enableElement(e(this))}),o.delegate(n.buttonDisableSelector,"ajax:complete",function(){n.enableFormElement(e(this))}),o.delegate(n.linkClickSelector,"click.rails",function(o){var i=e(this),r=i.data("method"),s=i.data("params"),a=o.metaKey||o.ctrlKey;if(!n.allowAction(i))return n.stopEverything(o);if(!a&&i.is(n.linkDisableSelector)&&n.disableElement(i),i.data("remote")!==t){if(a&&(!r||"GET"===r)&&!s)return!0;var l=n.handleRemote(i);return l===!1?n.enableElement(i):l.fail(function(){n.enableElement(i)}),!1}return r?(n.handleMethod(i),!1):void 0}),o.delegate(n.buttonClickSelector,"click.rails",function(t){var o=e(this);if(!n.allowAction(o))return n.stopEverything(t);o.is(n.buttonDisableSelector)&&n.disableFormElement(o);var i=n.handleRemote(o);return i===!1?n.enableFormElement(o):i.fail(function(){n.enableFormElement(o)}),!1}),o.delegate(n.inputChangeSelector,"change.rails",function(t){var o=e(this);return n.allowAction(o)?(n.handleRemote(o),!1):n.stopEverything(t)}),o.delegate(n.formSubmitSelector,"submit.rails",function(o){var i,r,s=e(this),a=s.data("remote")!==t;if(!n.allowAction(s))return n.stopEverything(o);if(s.attr("novalidate")==t&&(i=n.blankInputs(s,n.requiredInputSelector),i&&n.fire(s,"ajax:aborted:required",[i])))return n.stopEverything(o);if(a){if(r=n.nonBlankInputs(s,n.fileInputSelector)){setTimeout(function(){n.disableFormElements(s)},13);var l=n.fire(s,"ajax:aborted:file",[r]);return l||setTimeout(function(){n.enableFormElements(s)},13),l}return n.handleRemote(s),!1}setTimeout(function(){n.disableFormElements(s)},13)}),o.delegate(n.formInputClickSelector,"click.rails",function(t){var o=e(this);if(!n.allowAction(o))return n.stopEverything(t);var i=o.attr("name"),r=i?{name:i,value:o.val()}:null;o.closest("form").data("ujs:submit-button",r)}),o.delegate(n.formSubmitSelector,"ajax:send.rails",function(t){this==t.target&&n.disableFormElements(e(this))}),o.delegate(n.formSubmitSelector,"ajax:complete.rails",function(t){this==t.target&&n.enableFormElements(e(this))}),e(function(){n.refreshCSRFTokens()}))}(jQuery);var Chorus=Chorus||{};Chorus.DynamicSizedImages=function(e){function t(t,n){var a={failure_limit:20,load:function(){var t=e(this),n=t.parent(".image-window");if(t.is("img")&&(n.length>0?(t.css({position:"absolute",top:Math.round((n.outerHeight()-t.outerHeight())/2),left:Math.round((n.outerWidth()-t.outerWidth())/2)}),"undefined"==typeof t.attr("height")&&t.css("height","auto")):"undefined"==typeof t.attr("height")&&t.css("height","auto")),t.addClass(r),t.removeClass(s),t.removeClass("m-chorus-asset__in-entry-body"),e.fn.playGIF){var o=Chorus.Context.gif_opts||{},i={on:"touchstart",off:"touchstart"};if(Chorus.Context&&Chorus.Context.main_link_color&&(o.circleBackgroundColor=Chorus.Context.main_link_color,o.circleTextColor="FFFFFF"),"undefined"==typeof PLAYGIF_DISABLE_FLAG){var a=e('.m-entry__body img[src*=".gif"], .m-entry__body img[data-original*=".gif"], .m-block__fanshot-media img[src*=".gif"]'),l=e('.m-entry__top-hero .m-entry__photo img[data-original*=".gif"]');a.length+l.length===1?PLAYGIF_DISABLE_FLAG=!0:a&&a.length>0&&(PLAYGIF_DISABLE_FLAG=!1,Modernizr.touch?a.playGIF(i):a.playGIF(o))}Modernizr.touch?t.playGIF(i):t.playGIF(o)}},threshold:800};n&&e.extend(a,n),t=e("undefined"!=typeof t&&null!==t?t:"body");var l=t.find(i+":visible").not("."+s,"."+r),c=[],u=[];l.each(function(){var t,n,i,r,l,d=e(this),h=d.attr("data-imgkey"),m=d.data("chorus-asset-id");if("undefined"!=typeof h){if(a.parentDimensionSlc){var p=d.closest(a.parentDimensionSlc);t=p.outerWidth(),n=p.outerHeight()}t||(t=d.outerWidth()),n||(n=d.outerHeight()),0==n&&(i=d.data("ratio"),n="undefined"!=typeof i&&i>0?Math.ceil(t/i):t),d.is("img")&&(i=d.data("ratio"),r=d.parent(".image-window"),"undefined"!=typeof i&&i>0&&(n=Math.ceil(t/i)),r.length>0&&(t=Math.ceil(r.outerWidth()),n=Math.ceil(r.outerHeight())),n>0&&d.css("height",n)),"undefined"!=typeof window.devicePixelRatio&&(t=Math.ceil(t*window.devicePixelRatio),n=Math.ceil(n*window.devicePixelRatio)),Chorus.Context&&"racked"===Chorus.Context.network_slug&&(t=Math.ceil(1.3*t),n=Math.ceil(1.3*n)),/\.(png|jpg|jpeg)$/i.test(d.attr("data-original"))&&o.webp&&!Chorus.Modernizr.touch&&(l="webp");var f=h+":"+t+"x"+n+(l?":"+l:"");c.push(f),d.attr("data-dim",t+"x"+n),d.addClass(s)}else if("undefined"!=typeof m){t=d.outerWidth(),n=d.outerHeight(),d.is("img")&&(i=d.data("ratio"),r=d.parent(".image-window"),"undefined"!=typeof i&&i>0&&(n=Math.ceil(t/i)),r.length>0&&(t=Math.ceil(r.outerWidth()),n=Math.ceil(r.outerHeight())),n>0&&d.css("height",n)),"undefined"!=typeof window.devicePixelRatio&&(t=Math.ceil(t*window.devicePixelRatio),n=Math.ceil(n*window.devicePixelRatio)),"racked"===Chorus.Context.network_slug&&(t=Math.ceil(1.3*t),n=Math.ceil(1.3*n));var g=m+":"+t+":"+n;u.push(g),d.data("asset-key",g),d.addClass(s)}else d.lazyload(a)}),(0!==c.length||0!==u.length)&&(e.each([u,c],function(e,t){t.sort(function(e,t){return+e.split(":")[0]-+t.split(":")[0]})}),e.ajax({type:"GET",url:"/chorus_page/optimally_sized_images",dataType:"json",contentType:"application/json",timeout:1e4,data:{imgkeys:c.join(","),asset_keys:u.join(",")},success:function(t){var n=t.urls,o={};_.forEach(n,function(e,t){var n=t.replace(/\:webp|\:jp2/,"");o[n]=e}),n=o,l.each(function(){var t,o=e(this);t=o.attr("data-imgkey")?o.attr("data-imgkey")+":"+o.attr("data-dim"):o.data("asset-key");var i=n[t];"undefined"!=typeof i&&(o.attr("data-original",i),o.lazyload(a))})}}))}e(document).ready(function(){Chorus.DynamicSizedImages.init(),Chorus.EventDispatcher&&Chorus.EventDispatcher.publish("dynamic-images-available",{},!0)});var n={},o={webp:!1,jp2:!1},i=".vox-lazy-load",r="lazy-loaded",s="lazy-loading";return n.init=function(){function e(){if(Chorus.Modernizr.localstorage&&window.localStorage.getItem("supportsWebp"))o.webp="true"===window.localStorage.getItem("supportsWebp")?!0:!1,i();else{var e=new Image;e.onload=function(){o.webp=!!(e.height>0&&e.width>0),Chorus.Modernizr.localstorage&&window.localStorage.setItem("supportsWebp",o.webp),i()},e.onerror=function(){o.webp=!1,Chorus.Modernizr.localstorage&&window.localStorage.setItem("supportsWebp",o.webp),i()},e.src="data:image/webp;base64,UklGRiYAAABXRUJQVlA4IBoAAAAwAQCdASoBAAEAAIAOJaQAA3AA/v89WAAAAA=="}}function i(){Chorus&&Chorus.Context&&Chorus.Context.defer_image_loading?Chorus.Context.defer_image_loading=!1:n.initUI(),Chorus.EventDispatcher&&Chorus.EventDispatcher.subscribe("moduleInserted",function(e){t(e.modules)})}e()},n.initUI=function(e,n){t(e,n)},n.applyTo=function(e,n){t(e,n)},n}(jQuery);var Chorus=Chorus||{};Chorus.EventDispatcher=function(){function e(e){return _?_.clone(e):JSON.parse(JSON.stringify(jsonObject))}function t(e,t,n){e[t]||(e[t]=[]),e[t].push(n)}function n(n,o,i){var o=o||{},l=r[n];if(a&&console.log("Chorus.EventDispatcher is publishing the following event",n,o),i&&(a&&console.log("Chorus.EventDispatcher event "+n+" should be applied to all subsequent events",n,o),t(s,n,o)),r[n]){o.eventType=n;for(var c=0,u=l.length;u>c;c++)l[c](e(o))}}function o(e,n){t(r,e,n),a&&!l&&console.log("Chorus.EventDispatcher is subscribing to the following event",e),a&&l&&console.log("Chorus.EventDispatcher is subscribing to the following event",e,n);var o=s[e];if(o)for(var i=0,c=o.length;c>i;i++)a&&console.log("Chorus.EventDispatcher has found an event of the type "+e+" that should be applied to any subsequent subscriber",e,o[i]),n(o[i])}function i(e,t){if(r[e])for(var n=r[e],o=n.length-1;o>-1;o--)n[o]==t&&n.splice(o,1)}var r={},s={},a=1==Util.getUrlVars().debugEventDispatcher,l=1==Util.getUrlVars().debugVerbose;return{publish:function(e,t,o){var o=o||!1;n(e,t,o)},subscribe:function(e,t){o(e,t)},unsubscribe:function(e,t){i(e,t)},debug:function(e){a=!0,e===!0&&(l=!0)}}}(),jQuery(document).ready(function(e){var t=e(".m-ad-survey__form"),n=!0;setTimeout(function(){n&&t.addClass("show_survey").removeClass("hidden_survey")},1e3),Chorus.EventDispatcher.subscribe("first_ad_rendered",function(){n=!1,t.addClass("hidden_survey").removeClass("show_survey")})});var Chorus=Chorus||{};Chorus.EditoriallyManagedCell=function(e,t){"use strict";function n(e){for(var t={},n=e.serializeArray(),o=n.length-1;o>-1;o--){var i=n[o].name,r=n[o].value;t[i]?t[i]=_.flatten([t[i],r]):t[i]=r}return t}function o(e){alert("There was an error updating this cell. Please check your URL and/or that all fields are completed.")}function i(t){t.preventDefault();var n=e(t.currentTarget);s(n.closest(".chorus-emc__admin"),n.data("emc-action"),n.data("emc-data"))}function r(t){t.preventDefault();var o=e(t.currentTarget),i=o.closest("form");s(e('.chorus-emc__admin[data-emc-slug="'+i.data("emc-slug")+'"]'),"update",_.extend(n(i),{button_action:o.data("emc-action")}))}function s(t,n,i){var i=_.extend({slug:t.data("emc-slug"),bucket:t.data("emc-bucket")},i),r=c[n];if("edit"===n||"help"===n)Chorus.EventDispatcher.publish("modal_open",{method:s,url:r,data:i});else{var s="update"==n?"POST":"GET";a(t),e.ajax({method:s,url:r,data:i,success:function(n){Chorus.EventDispatcher.publish("modal_close");var o=e('.chorus-emc__content[data-emc-slug="'+t.data("emc-slug")+'"]');o.length>0&&o.replaceWith(n)},error:o})}}function a(t){e(t).find(".chorus-emc__content").html("Loading...")}function l(){e(t).on("click",".chorus-emc__admin *[data-emc-action]",i),e(t).on("click",".chorus-emc__form *[data-emc-action]",r)}var c={edit:"/editorially_managed_cells/handle_edit",update:"/editorially_managed_cells/handle_update",preview:"/editorially_managed_cells/preview",show_live:"/editorially_managed_cells/refresh",help:"/editorially_managed_cells/help"};return{init:l,urls:c}}(jQuery,document),jQuery(function(){Chorus.EditoriallyManagedCell.init()});var Chorus=Chorus||{};Chorus.Tooltip=function(e){var t="tooltip-text",n="tooltip-class",o=function(t){return t.preventDefault(),e(this).data("tooltip-shown")||i(e(this)),!1},i=function(o){var i=o.data(t),s=o.data(n)||"tooltip",a="tool-tip-"+Math.round(1e3*Math.random());o.data("tooltip-shown",a);var l=o.offset().top+o.height(),c=o.offset().left,u=e("<span id='"+a+"' data-is-tooltip class='"+s+"'>"+i+"</span>");u.on("click",r),u.css({top:l,left:c,position:"absolute"}),Util.UserAgentProfiler.isMobile()&&u.css({left:0}),"undefined"!=typeof i&&""!==i&&(e(document.body).prepend(u),setTimeout(function(){u.addClass("shown")},200))},r=function(t){var n=e(this).data("tooltip-shown")||e(this).filter("is-tooltip").attr("id");if(n){var o=e("#"+n);e(this).removeData("tooltip-shown"),o.removeClass("shown"),setTimeout(function(){o.remove()},1e3)}},s=function(t){e(t).not("[data-tooltip-shown]").on("click",o),e(t).not("[data-tooltip-shown]").on("mouseover",o),e(t).on("mouseout",r)};return{attachTo:s,init:s}}(jQuery),jQuery(function(){Chorus.Tooltip.attachTo("[data-tooltip-text]"),jQuery(document).on("hymnal:render",function(e,t){var n=jQuery(t.ad.getElement()).find("[data-tooltip-text]");Chorus.Tooltip.attachTo(n)})}),function(e){function t(e){var t={};e=(e||"").replace(/^(\?|\&)/,"").split("&");for(var n=0;n<e.length;n++){var o=e[n].split("=");o.length>1&&(t[o[0]]=o[1])}return t}function n(n,o){var r=n.attr("href"),s=n.attr("data-url");if(s&&i[o]&&(r=i[o]+encodeURIComponent(s)),r&&"#"!==r[0]){var a=r.match(/(.*(?:\?|\&)(?:url|u)=)([^&]+)(.*)/),l=n.closest("[data-analytics-placement]").attr("data-analytics-placement"),c=decodeURIComponent(a[2]).split("?"),u=c[0].split("#"),d=u[0]||c[0],h=u[1]||"",m=e.extend({utm_campaign:location.hostname.replace(/(www\.)?(.+)\.com/,"$2"),utm_content:Chorus.Analytics.contentType()+(l?":"+l:""),utm_medium:"social",utm_source:o},t(c[1]),t(n.attr("data-params")));r=""==h.trim()?a[1]+encodeURIComponent(d+"?"+e.param(m))+a[3]:a[1]+encodeURIComponent(d+"?"+e.param(m)+"#"+h)+a[3],n.attr("href",r)}return r}var o,i={facebook:"http://www.facebook.com/share.php?u=",twitter:"https://twitter.com/intent/tweet?url=",pinterest:"https://www.pinterest.com/pin/create/button/?url="};e("[data-analytics-social]").on("click",function(t){var i,r,s=e(this),a=s.attr("data-analytics-social"),l=n(s,a),c=570,u=570;if(Chorus.Context.is_preview)return t.stopPropagation(),alert("Social buttons cannot be used during preview.");switch(a){case"facebook":u=279;break;case"twitter":u=279;break;case"linkedin":u=520;break;case"pinterest":c=u=750}if("#"!==l[0]&&"_blank"!==s.attr("target")&&"whatsapp"!==a){o&&o.close&&o.close(),r=screen.width/2-c/2,i=screen.height/2-u/2,o=window.open(l,"","width="+c+", height="+u+", top="+i+", left="+r),t.preventDefault();var d=window.open;window.open=function(){},setTimeout(function(){window.open=d},0)}}),function(e,t,n){function o(){var e,o=t.getElementsByTagName(n)[0],i=function(i,r){t.getElementById(r)||(e=t.createElement(n),e.src=i,e.id=r,o.parentNode.insertBefore(e,o))};Util.UserAgentProfiler.isAndroidLt3()||(i("//connect.facebook.net/en_US/all.js#xfbml=1","fbjs"),i("//platform.twitter.com/widgets.js","tweetjs"))}e.addEventListener?e.addEventListener("load",o,!1):e.attachEvent&&e.attachEvent("onload",o)}(window,document,"script"),function(){function t(){u();var e=c,t=o.scrollTop(),i=t>=s,r=!a||a>=t;c=i&&r&&!l,c!==e&&(Chorus.EventDispatcher.publish("fixedSocial",{isFixed:c,position:n.position()}),n.toggleClass("fixed",c))}var n=e("#chorus-social-fixed");if(n.length){n.appendTo("body");var o=e(window),i=e("#chorus-social-fixed-threshold"),r=e("#comments"),s=0,a=0,l=!1,c=!1,u=_.throttle(function(){Chorus.Environment.touch()&&(l=screen.width>window.innerWidth),i.length&&(s=i.offset().top),r.length&&(a=r.offset().top)},1500);e(document).on("scroll",_.throttle(t,150)),t()}}(),e("[data-shareable-content]").each(function(){var t=e(this),n=t.attr("data-original")||t.attr("src");if(!n){var o=this.currentStyle||window.getComputedStyle(this,!1);n=o&&o.backgroundImage.slice(4,-1)}if(n){var r="m-shareable-content",s=r+"__wrap",a=i.pinterest+encodeURIComponent(location.href)+"&media="+encodeURIComponent(n),l=Chorus.Environment.touch()?" touch":"";if(t.is("img")){var c=t.closest("."+s);t=c.length?c:t.wrap('<div class="'+s+'"></div>').parent()}else t.toggleClass(s,!0);t.prepend('<a href="'+a+'" class="'+r+"__pinterest"+l+'" data-analytics-social="pinterest"></a>')}})}(jQuery),jQuery(function(e){e("#newsletter-subscribe").submit(function(t){var n=e("#newsletter-subscribe #email").val(),o=/(.)?@(.)*\./,i=!1,r="";return n&&o.test(n)||(i=!0,r="The email you entered was invalid. Please try again.",n||(r="Please enter your email address in order to subscribe.")),i?(e("#newsletter_error").text(r).show(),!1):(e("#newsletter_error").hide(),!0)})});var Chorus=Chorus||{};Chorus.MobileAdandSocialMediator=function(e){"use strict";function t(){e(s).css("display","none")}function n(){e(a).css("display","none")}function o(e){var o=e&&e.isFixed,i=e&&e.position&&e.position.top>100;!r&&o&&i&&(r=!0,t(),n())}function i(){Chorus.EventDispatcher.subscribe("fixedSocial",o,!0)}var r=!1,s=".krg-hov-wrapper",a=".crisp_Css_Ad_Cradle, .crispTopAdCradle";return{init:i}}(jQuery),jQuery(function(){Chorus.MobileAdandSocialMediator.init()}),/*! Hammer.JS - v1.1.3 - 2014-05-20
 * http://eightmedia.github.io/hammer.js
 *
 * Copyright (c) 2014 Jorik Tangelder <j.tangelder@gmail.com>;
 * Licensed under the MIT license */
function(e,t){"use strict";function n(){o.READY||(C.determineEventTypes(),v.each(o.gestures,function(e){b.register(e)}),C.onTouch(o.DOCUMENT,m,b.detect),C.onTouch(o.DOCUMENT,p,b.detect),o.READY=!0)}var o=function w(e,t){return new w.Instance(e,t||{})};o.VERSION="1.1.3",o.defaults={behavior:{userSelect:"none",touchAction:"pan-y",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}},o.DOCUMENT=document,o.HAS_POINTEREVENTS=navigator.pointerEnabled||navigator.msPointerEnabled,o.HAS_TOUCHEVENTS="ontouchstart"in e,o.IS_MOBILE=/mobile|tablet|ip(ad|hone|od)|android|silk/i.test(navigator.userAgent),o.NO_MOUSEEVENTS=o.HAS_TOUCHEVENTS&&o.IS_MOBILE||o.HAS_POINTEREVENTS,o.CALCULATE_INTERVAL=25;var i={},r=o.DIRECTION_DOWN="down",s=o.DIRECTION_LEFT="left",a=o.DIRECTION_UP="up",l=o.DIRECTION_RIGHT="right",c=o.POINTER_MOUSE="mouse",u=o.POINTER_TOUCH="touch",d=o.POINTER_PEN="pen",h=o.EVENT_START="start",m=o.EVENT_MOVE="move",p=o.EVENT_END="end",f=o.EVENT_RELEASE="release",g=o.EVENT_TOUCH="touch";o.READY=!1,o.plugins=o.plugins||{},o.gestures=o.gestures||{};var v=o.utils={extend:function(e,n,o){for(var i in n)!n.hasOwnProperty(i)||e[i]!==t&&o||(e[i]=n[i]);return e},on:function(e,t,n){e.addEventListener(t,n,!1)},off:function(e,t,n){e.removeEventListener(t,n,!1)},each:function(e,n,o){var i,r;if("forEach"in e)e.forEach(n,o);else if(e.length!==t){for(i=0,r=e.length;r>i;i++)if(n.call(o,e[i],i,e)===!1)return}else for(i in e)if(e.hasOwnProperty(i)&&n.call(o,e[i],i,e)===!1)return},inStr:function(e,t){return e.indexOf(t)>-1},inArray:function(e,t){if(e.indexOf){var n=e.indexOf(t);return-1===n?!1:n}for(var o=0,i=e.length;i>o;o++)if(e[o]===t)return o;return!1},toArray:function(e){return Array.prototype.slice.call(e,0)},hasParent:function(e,t){for(;e;){if(e==t)return!0;e=e.parentNode}return!1},getCenter:function(e){var t=[],n=[],o=[],i=[],r=Math.min,s=Math.max;return 1===e.length?{pageX:e[0].pageX,pageY:e[0].pageY,clientX:e[0].clientX,clientY:e[0].clientY}:(v.each(e,function(e){t.push(e.pageX),n.push(e.pageY),o.push(e.clientX),i.push(e.clientY)}),{pageX:(r.apply(Math,t)+s.apply(Math,t))/2,pageY:(r.apply(Math,n)+s.apply(Math,n))/2,clientX:(r.apply(Math,o)+s.apply(Math,o))/2,clientY:(r.apply(Math,i)+s.apply(Math,i))/2})},getVelocity:function(e,t,n){return{x:Math.abs(t/e)||0,y:Math.abs(n/e)||0}},getAngle:function(e,t){var n=t.clientX-e.clientX,o=t.clientY-e.clientY;return 180*Math.atan2(o,n)/Math.PI},getDirection:function(e,t){var n=Math.abs(e.clientX-t.clientX),o=Math.abs(e.clientY-t.clientY);return n>=o?e.clientX-t.clientX>0?s:l:e.clientY-t.clientY>0?a:r},getDistance:function(e,t){var n=t.clientX-e.clientX,o=t.clientY-e.clientY;return Math.sqrt(n*n+o*o)},getScale:function(e,t){return e.length>=2&&t.length>=2?this.getDistance(t[0],t[1])/this.getDistance(e[0],e[1]):1},getRotation:function(e,t){return e.length>=2&&t.length>=2?this.getAngle(t[1],t[0])-this.getAngle(e[1],e[0]):0},isVertical:function(e){return e==a||e==r},setPrefixedCss:function(e,t,n,o){var i=["","Webkit","Moz","O","ms"];t=v.toCamelCase(t);for(var r=0;r<i.length;r++){var s=t;if(i[r]&&(s=i[r]+s.slice(0,1).toUpperCase()+s.slice(1)),s in e.style){e.style[s]=(null==o||o)&&n||"";break}}},toggleBehavior:function(e,t,n){if(t&&e&&e.style){v.each(t,function(t,o){v.setPrefixedCss(e,o,t,n)});var o=n&&function(){return!1};"none"==t.userSelect&&(e.onselectstart=o),"none"==t.userDrag&&(e.ondragstart=o)}},toCamelCase:function(e){return e.replace(/[_-]([a-z])/g,function(e){return e[1].toUpperCase()})}},C=o.event={preventMouseEvents:!1,started:!1,shouldDetect:!1,on:function(e,t,n,o){var i=t.split(" ");v.each(i,function(t){v.on(e,t,n),o&&o(t)})},off:function(e,t,n,o){var i=t.split(" ");v.each(i,function(t){v.off(e,t,n),o&&o(t)})},onTouch:function(e,t,n){var r=this,s=function(i){var s,a=i.type.toLowerCase(),l=o.HAS_POINTEREVENTS,c=v.inStr(a,"mouse");c&&r.preventMouseEvents||(c&&t==h&&0===i.button?(r.preventMouseEvents=!1,r.shouldDetect=!0):l&&t==h?r.shouldDetect=1===i.buttons||_.matchType(u,i):c||t!=h||(r.preventMouseEvents=!0,r.shouldDetect=!0),l&&t!=p&&_.updatePointer(t,i),r.shouldDetect&&(s=r.doDetect.call(r,i,t,e,n)),s==p&&(r.preventMouseEvents=!1,r.shouldDetect=!1,_.reset()),l&&t==p&&_.updatePointer(t,i))};return this.on(e,i[t],s),s},doDetect:function(e,t,n,o){var i=this.getTouchList(e,t),r=i.length,s=t,a=i.trigger,l=r;t==h?a=g:t==p&&(a=f,l=i.length-(e.changedTouches?e.changedTouches.length:1)),l>0&&this.started&&(s=m),this.started=!0;var c=this.collectEventData(n,s,i,e);return t!=p&&o.call(b,c),a&&(c.changedLength=l,c.eventType=a,o.call(b,c),c.eventType=s,delete c.changedLength),s==p&&(o.call(b,c),this.started=!1),s},determineEventTypes:function(){var t;return t=o.HAS_POINTEREVENTS?e.PointerEvent?["pointerdown","pointermove","pointerup pointercancel lostpointercapture"]:["MSPointerDown","MSPointerMove","MSPointerUp MSPointerCancel MSLostPointerCapture"]:o.NO_MOUSEEVENTS?["touchstart","touchmove","touchend touchcancel"]:["touchstart mousedown","touchmove mousemove","touchend touchcancel mouseup"],i[h]=t[0],i[m]=t[1],i[p]=t[2],i},getTouchList:function(e,t){if(o.HAS_POINTEREVENTS)return _.getTouchList();if(e.touches){if(t==m)return e.touches;var n=[],i=[].concat(v.toArray(e.touches),v.toArray(e.changedTouches)),r=[];return v.each(i,function(e){v.inArray(n,e.identifier)===!1&&r.push(e),n.push(e.identifier)}),r}return e.identifier=1,[e]},collectEventData:function(e,t,n,o){var i=u;return v.inStr(o.type,"mouse")||_.matchType(c,o)?i=c:_.matchType(d,o)&&(i=d),{center:v.getCenter(n),timeStamp:Date.now(),target:o.target,touches:n,eventType:t,pointerType:i,srcEvent:o,preventDefault:function(){var e=this.srcEvent;e.preventManipulation&&e.preventManipulation(),e.preventDefault&&e.preventDefault()},stopPropagation:function(){this.srcEvent.stopPropagation()},stopDetect:function(){return b.stopDetect()}}}},_=o.PointerEvent={pointers:{},getTouchList:function(){var e=[];return v.each(this.pointers,function(t){e.push(t)}),e},updatePointer:function(e,t){e==p||e!=p&&1!==t.buttons?delete this.pointers[t.pointerId]:(t.identifier=t.pointerId,this.pointers[t.pointerId]=t)},matchType:function(e,t){if(!t.pointerType)return!1;var n=t.pointerType,o={};return o[c]=n===(t.MSPOINTER_TYPE_MOUSE||c),o[u]=n===(t.MSPOINTER_TYPE_TOUCH||u),o[d]=n===(t.MSPOINTER_TYPE_PEN||d),o[e]},reset:function(){this.pointers={}}},b=o.detection={gestures:[],current:null,previous:null,stopped:!1,startDetect:function(e,t){this.current||(this.stopped=!1,this.current={inst:e,startEvent:v.extend({},t),lastEvent:!1,lastCalcEvent:!1,futureCalcEvent:!1,lastCalcData:{},name:""},this.detect(t))},detect:function(e){if(this.current&&!this.stopped){e=this.extendEventData(e);var t=this.current.inst,n=t.options;return v.each(this.gestures,function(o){!this.stopped&&t.enabled&&n[o.name]&&o.handler.call(o,e,t)},this),this.current&&(this.current.lastEvent=e),e.eventType==p&&this.stopDetect(),e}},stopDetect:function(){this.previous=v.extend({},this.current),this.current=null,this.stopped=!0},getCalculatedData:function(e,t,n,i,r){var s=this.current,a=!1,l=s.lastCalcEvent,c=s.lastCalcData;l&&e.timeStamp-l.timeStamp>o.CALCULATE_INTERVAL&&(t=l.center,n=e.timeStamp-l.timeStamp,i=e.center.clientX-l.center.clientX,r=e.center.clientY-l.center.clientY,a=!0),(e.eventType==g||e.eventType==f)&&(s.futureCalcEvent=e),(!s.lastCalcEvent||a)&&(c.velocity=v.getVelocity(n,i,r),c.angle=v.getAngle(t,e.center),c.direction=v.getDirection(t,e.center),s.lastCalcEvent=s.futureCalcEvent||e,s.futureCalcEvent=e),e.velocityX=c.velocity.x,e.velocityY=c.velocity.y,e.interimAngle=c.angle,e.interimDirection=c.direction},extendEventData:function(e){var t=this.current,n=t.startEvent,o=t.lastEvent||n;(e.eventType==g||e.eventType==f)&&(n.touches=[],v.each(e.touches,function(e){n.touches.push({clientX:e.clientX,clientY:e.clientY})}));var i=e.timeStamp-n.timeStamp,r=e.center.clientX-n.center.clientX,s=e.center.clientY-n.center.clientY;return this.getCalculatedData(e,o.center,i,r,s),v.extend(e,{startEvent:n,deltaTime:i,deltaX:r,deltaY:s,distance:v.getDistance(n.center,e.center),angle:v.getAngle(n.center,e.center),direction:v.getDirection(n.center,e.center),scale:v.getScale(n.touches,e.touches),rotation:v.getRotation(n.touches,e.touches)}),e},register:function(e){var n=e.defaults||{};return n[e.name]===t&&(n[e.name]=!0),v.extend(o.defaults,n,!0),e.index=e.index||1e3,this.gestures.push(e),this.gestures.sort(function(e,t){return e.index<t.index?-1:e.index>t.index?1:0}),this.gestures}};o.Instance=function(e,t){var i=this;n(),this.element=e,this.enabled=!0,v.each(t,function(e,n){delete t[n],t[v.toCamelCase(n)]=e}),this.options=v.extend(v.extend({},o.defaults),t||{}),this.options.behavior&&v.toggleBehavior(this.element,this.options.behavior,!0),this.eventStartHandler=C.onTouch(e,h,function(e){i.enabled&&e.eventType==h?b.startDetect(i,e):e.eventType==g&&b.detect(e)}),this.eventHandlers=[]},o.Instance.prototype={on:function(e,t){var n=this;return C.on(n.element,e,t,function(e){n.eventHandlers.push({gesture:e,handler:t})}),n},off:function(e,t){var n=this;return C.off(n.element,e,t,function(e){var o=v.inArray({gesture:e,handler:t});o!==!1&&n.eventHandlers.splice(o,1)}),n},trigger:function(e,t){t||(t={});var n=o.DOCUMENT.createEvent("Event");n.initEvent(e,!0,!0),n.gesture=t;var i=this.element;return v.hasParent(t.target,i)&&(i=t.target),i.dispatchEvent(n),this},enable:function(e){return this.enabled=e,this},dispose:function(){var e,t;for(v.toggleBehavior(this.element,this.options.behavior,!1),e=-1;t=this.eventHandlers[++e];)v.off(this.element,t.gesture,t.handler);return this.eventHandlers=[],C.off(this.element,i[h],this.eventStartHandler),null}},function(e){function t(t,o){var i=b.current;if(!(o.options.dragMaxTouches>0&&t.touches.length>o.options.dragMaxTouches))switch(t.eventType){case h:n=!1;break;case m:if(t.distance<o.options.dragMinDistance&&i.name!=e)return;var c=i.startEvent.center;if(i.name!=e&&(i.name=e,o.options.dragDistanceCorrection&&t.distance>0)){var u=Math.abs(o.options.dragMinDistance/t.distance);c.pageX+=t.deltaX*u,c.pageY+=t.deltaY*u,c.clientX+=t.deltaX*u,c.clientY+=t.deltaY*u,t=b.extendEventData(t)}(i.lastEvent.dragLockToAxis||o.options.dragLockToAxis&&o.options.dragLockMinDistance<=t.distance)&&(t.dragLockToAxis=!0);var d=i.lastEvent.direction;t.dragLockToAxis&&d!==t.direction&&(v.isVertical(d)?t.direction=t.deltaY<0?a:r:t.direction=t.deltaX<0?s:l),n||(o.trigger(e+"start",t),n=!0),o.trigger(e,t),o.trigger(e+t.direction,t);var g=v.isVertical(t.direction);(o.options.dragBlockVertical&&g||o.options.dragBlockHorizontal&&!g)&&t.preventDefault();break;case f:n&&t.changedLength<=o.options.dragMaxTouches&&(o.trigger(e+"end",t),n=!1);break;case p:n=!1}}var n=!1;o.gestures.Drag={name:e,index:50,handler:t,defaults:{dragMinDistance:10,dragDistanceCorrection:!0,dragMaxTouches:1,dragBlockHorizontal:!1,dragBlockVertical:!1,dragLockToAxis:!1,dragLockMinDistance:25}}}("drag"),o.gestures.Gesture={name:"gesture",index:1337,handler:function(e,t){t.trigger(this.name,e)}},function(e){function t(t,o){var i=o.options,r=b.current;switch(t.eventType){case h:clearTimeout(n),r.name=e,n=setTimeout(function(){r&&r.name==e&&o.trigger(e,t)},i.holdTimeout);break;case m:t.distance>i.holdThreshold&&clearTimeout(n);break;case f:clearTimeout(n)}}var n;o.gestures.Hold={name:e,index:10,defaults:{holdTimeout:500,holdThreshold:2},handler:t}}("hold"),o.gestures.Release={name:"release",index:1/0,handler:function(e,t){e.eventType==f&&t.trigger(this.name,e)}},o.gestures.Swipe={name:"swipe",index:40,defaults:{swipeMinTouches:1,swipeMaxTouches:1,swipeVelocityX:.6,swipeVelocityY:.6},handler:function(e,t){if(e.eventType==f){var n=e.touches.length,o=t.options;if(n<o.swipeMinTouches||n>o.swipeMaxTouches)return;(e.velocityX>o.swipeVelocityX||e.velocityY>o.swipeVelocityY)&&(t.trigger(this.name,e),t.trigger(this.name+e.direction,e))}}},function(e){function t(t,o){var i,r,s=o.options,a=b.current,l=b.previous;switch(t.eventType){case h:n=!1;break;case m:n=n||t.distance>s.tapMaxDistance;break;case p:!v.inStr(t.srcEvent.type,"cancel")&&t.deltaTime<s.tapMaxTime&&!n&&(i=l&&l.lastEvent&&t.timeStamp-l.lastEvent.timeStamp,r=!1,l&&l.name==e&&i&&i<s.doubleTapInterval&&t.distance<s.doubleTapDistance&&(o.trigger("doubletap",t),r=!0),(!r||s.tapAlways)&&(a.name=e,o.trigger(a.name,t)))}}var n=!1;o.gestures.Tap={name:e,index:100,handler:t,defaults:{tapMaxTime:250,tapMaxDistance:10,tapAlways:!0,doubleTapDistance:20,doubleTapInterval:300}}}("tap"),o.gestures.Touch={name:"touch",index:-(1/0),defaults:{preventDefault:!1,preventMouse:!1},handler:function(e,t){return t.options.preventMouse&&e.pointerType==c?void e.stopDetect():(t.options.preventDefault&&e.preventDefault(),void(e.eventType==g&&t.trigger("touch",e)))}},function(e){function t(t,o){switch(t.eventType){case h:n=!1;break;case m:if(t.touches.length<2)return;var i=Math.abs(1-t.scale),r=Math.abs(t.rotation);if(i<o.options.transformMinScale&&r<o.options.transformMinRotation)return;b.current.name=e,n||(o.trigger(e+"start",t),n=!0),o.trigger(e,t),r>o.options.transformMinRotation&&o.trigger("rotate",t),i>o.options.transformMinScale&&(o.trigger("pinch",t),o.trigger("pinch"+(t.scale<1?"in":"out"),t));break;case f:n&&t.changedLength<2&&(o.trigger(e+"end",t),n=!1)}}var n=!1;o.gestures.Transform={name:e,index:45,defaults:{transformMinScale:.01,transformMinRotation:1},handler:t}}("transform"),"function"==typeof define&&define.amd?define(function(){return o}):"undefined"!=typeof module&&module.exports?module.exports=o:e.Hammer=o}(window),/*! jQuery plugin for Hammer.JS - v1.1.3 - 2014-05-20
 * http://eightmedia.github.com/hammer.js
 *
 * Copyright (c) 2014 Jorik Tangelder <j.tangelder@gmail.com>;
 * Licensed under the MIT license */
function(e,t){"use strict";function n(e,n){Date.now||(Date.now=function(){return(new Date).getTime()}),e.utils.each(["on","off"],function(o){e.utils[o]=function(e,i,r){n(e)[o](i,function(e){var o=n.extend({},e.originalEvent,e);o.button===t&&(o.button=e.which-1),r.call(this,o)})}}),e.Instance.prototype.trigger=function(e,t){var o=n(this.element);return o.has(t.target).length&&(o=n(t.target)),o.trigger({type:e,gesture:t})},n.fn.hammer=function(t){return this.each(function(){var o=n(this),i=o.data("hammer");i?i&&t&&e.utils.extend(i.options,t):o.data("hammer",new e(this,t||{}))})}}"function"==typeof define&&define.amd?define(["hammerjs","jquery"],n):n(e.Hammer,e.jQuery||e.Zepto)}(window);var Verge=Verge||{};Verge.Util=function(e){var t=e("html"),n=e(".js-side-menu"),o=function(e){return"click"===e.type&&1===e.which&&!e.metaKey&&!e.ctrlKey},i=function(e){return"undefined"==typeof e||"click"!==e.type?!1:o(e)?!1:(e.stopPropagation(),!0)},r=function(){t.hasClass("-is-locked")||Chorus.Environment.largeBreakpoint.matches||(t.addClass("-is-locked"),n.css({"overflow-y":"auto"}))},s=function(){t.hasClass("-is-locked")&&(t.removeClass("-is-locked"),n.css({"overflow-y":""}))};return{isLeftClick:o,stopMetaClickPropagation:i,lockScroll:r,unlockScroll:s}}(jQuery);var Chorus=Chorus||{};Chorus.Modernizr.localstorage&&"object"==typeof sessionStorage&&(Chorus.GBSignal=function(e){"use strict";function t(){Util.isReferrerCurrentDomain()||(b.referralDomain=b.referralDomain||Util.getReferrerDomain())}function n(){b.pagesSeeninSession++}function o(){var e=new Date-new Date(2014,0,0),t=864e5;return Math.floor(e/t)}function i(){b.recordedSessionCount||(v.loyaltySessions.push(o()),b.recordedSessionCount=!0)}function r(){return v.loyaltySessions.length}function s(){var e=v.loyaltySessions.length;if(1>e)return 0;var t=(o()-f,0);for(var n in v.loyaltySessionTimes)v.loyaltySessionTimes.hasOwnProperty(n)&&(t+=v.loyaltySessionTimes[n]);return Math.ceil(t/e)}function a(){var e=o()-f,t={};for(var n in v.loyaltySessionTimes)v.loyaltySessionTimes.hasOwnProperty(n)&&n>e&&(t[n]=v.loyaltySessionTimes[n]);v.loyaltySessionTimes=t,v.loyaltySessions=_.reject(v.loyaltySessions,function(t){return e>t})}function l(){b.updatedAt=new Date,sessionStorage.setItem(p,JSON.stringify(b)),localStorage.setItem(p,JSON.stringify(v))}function c(){b=JSON.parse(sessionStorage.getItem(p)),v=JSON.parse(localStorage.getItem(p)),(null===b||"object"!=typeof b||new Date-b.updatedAt>g)&&(b={},e.extend(b,w)),(null===v||"object"!=typeof v)&&(v={},e.extend(v,C)),u()}function u(){for(var e in C)v[e]=v[e]||C[e];for(e in w)sessionStorage[e]=sessionStorage[e]||w[e]}function d(){if("undefined"!=typeof window.onbeforeunload){var t=new Date,n=function(){var e=Math.round((new Date-t)/1e3);v.loyaltySessionTimes[o()]=(v.loyaltySessionTimes[o()]||0)+e,l()};e(window).on("beforeunload",n)}}function h(){return{loyalty_bsg:r(),avgsestime_bsg:s(),firstimp_bsg:b.pagesSeeninSession,referral_bsg:b.referralDomain}}function m(){var e=[],t=h();for(var n in t)e.push(encodeURIComponent(n)+"="+encodeURIComponent(t[n]));var o="http://js.moatads.com/essencedigital34895338176918191/moatcontent.js?"+e.join("&"),i=document.getElementsByTagName("script")[0],r=document.createElement("SCRIPT");r.async=1,r.type="text/javascript",r.charset="UTF-8",r.src=o,i.parentNode.insertBefore(r,i)}var p="GBSignal",f=30,g=18e5,v={loyaltySessions:[],loyaltySessionTimes:{}},C={};e.extend(C,v);var b={referralDomain:null,pagesSeeninSession:0,recordedSessionCount:!1,updatedAt:new Date},w={};return e.extend(w,b),{init:function(){c(),d(),t(),a(),n(),i(),l(),m()},results:function(){return h()}}}(jQuery),Chorus.GBSignal.init());var Verge=Verge||{};Verge.SideNav=function(e){var t,n,o,i,r,s,a,l,c,u,d,h,m,p,f={root_selector:"#header",tabs_selector:".m-nav__menu li.has-dropdown",search_selector:".m-nav__menu li.has-dropdown.-search",nav_selector:".m-nav__container",site_nav_selector:".m-nav.-site",user_nav_selector:".m-nav.-user",sections_nav_selector:".m-nav.-sections",dropdown_selector:".m-nav-dropdown",dropdown_pane_selector:".m-nav-dropdown__pane",search_form_selector:".m-nav__search",side_nav_selector:".js-side-menu",open_site_nav_selector:".js-mobile-nav-menu-open",open_user_nav_selector:".js-mobile-user-menu-open",open_sections_nav_selector:".js-sections-menu-open",close_selector:".js-side-nav-close",back_to_top_selector:".-back-to-top a, .m-footer__back-to-top",open_nav_class:"is-nav-open",open_user_class:"is-user-nav-open",open_sections_class:"is-sections-nav-open",selected_section_class:"is-selected",animated_class:"is-animated",fixed_class:"is-fixed",hidden_class:"is-hidden",dropdown_endpoint:"/nav/dropdown"},g=e(document),v=e(window),C=e("html, body"),b=function(){return s.hasClass(f.open_nav_class)||(n.addClass(f.animated_class),T(),k(),s.addClass(f.open_nav_class),s.trigger("Verge.openNav")),!1},w=function(){return s.hasClass(f.open_nav_class)&&(s.removeClass(f.open_nav_class),i.removeClass(f.selected_section_class),s.trigger("Verge.closeNav")),!1},y=function(){return s.hasClass(f.open_sections_class)||(s.trigger("Verge.closeNav"),n.addClass(f.animated_class),w(),s.addClass(f.open_sections_class),s.trigger("Verge.openNav")),!1},k=function(){return s.hasClass(f.open_sections_class)&&(s.removeClass(f.open_sections_class),s.trigger("Verge.closeNav")),!1},A=function(e){return Verge.Util.stopMetaClickPropagation(e)?void 0:(s.hasClass(f.open_user_class)?(s.removeClass(f.open_user_class),s.trigger("Verge.closeNav")):(n.addClass(f.animated_class),w(),r.removeClass(f.selected_section_class),s.addClass(f.open_user_class),s.trigger("Verge.openNav")),!1)},T=function(){return s.hasClass(f.open_user_class)&&(s.removeClass(f.open_user_class),s.trigger("Verge.closeNav")),!1},x=function(e){Verge.Util.stopMetaClickPropagation(e)||(s.hasClass(f.open_nav_class)||s.hasClass(f.open_user_class)||r.hasClass(f.selected_section_class)||s.hasClass(f.open_sections_class))&&(s.removeClass(f.open_nav_class+" "+f.open_user_class+" "+f.open_sections_class),i.removeClass(f.selected_section_class),r.removeClass(f.selected_section_class),s.trigger("Verge.closeNav"))},E=function(){return Chorus.Environment.largeBreakpoint.matches?(r.hasClass(f.selected_section_class)?r.removeClass(f.selected_section_class):(w(),T(),m.focus(),r.addClass(f.selected_section_class),s.trigger("Verge.openNav")),!1):void 0},S=function(t){var n=e(this),o=n.parent();return!Verge.Util.stopMetaClickPropagation(t)&&Chorus.Environment.largeBreakpoint.matches?(o.hasClass(f.selected_section_class)?(o.removeClass(f.selected_section_class),w()):(i.removeClass(f.selected_section_class),r.removeClass(f.selected_section_class),o.addClass(f.selected_section_class),I(n.data("section"))),!1):void 0},I=function(e){s.hasClass(f.open_nav_class)||b(),t.data().selected=e,t.data().loaded?j():D()},j=function(){var n,o=e("#nav-"+t.data().selected);0!==o.length&&(n=-1*o.position().left,Chorus.Modernizr.csstransforms3d?l.css("transform","translate3d("+n+"px, 0, 0)"):l.css("left",n),Chorus.Modernizr.csstransitions&&l.hasClass(f.animated_class)||U())},D=function(){t.data().loading||(t.data().loading=!0,e.get(f.dropdown_endpoint,function(e){t.data().loaded=!0,t.data().loading=!1,l.html(e),j()}))},M=function(){return s.hasClass(f.open_nav_class)?l.addClass(f.animated_class):l.removeClass(f.animated_class),!1},U=function(){var n=e("#nav-"+t.data().selected);return Chorus.DynamicSizedImages.applyTo(n),!1},P=function(){Chorus.Environment.largeBreakpoint.matches&&!s.hasClass(f.fixed_class)&&(s.data().sticky_threshold=t.offset().top)},V=function(){if(!Chorus.Environment.largeBreakpoint.matches)return s.removeClass(f.fixed_class),void t.removeClass(f.hidden_class);"undefined"==typeof s.data().sticky_threshold&&P();var e=v.scrollTop(),n=s.hasClass(f.fixed_class);e>s.data().sticky_threshold?(n||(s.addClass(f.fixed_class),s.trigger("Verge.stickNav")),N(e)):n&&(s.removeClass(f.fixed_class),t.removeClass(f.hidden_class),t.css({visibility:"visible"}),P())},N=function(e){if("undefined"==typeof t.data().scroll)return void(t.data().scroll=e);var n=s.data().sticky_threshold,o=t.data().scroll,i=t.hasClass(f.hidden_class);e>n+p&&e>o&&!i?(t.addClass(f.hidden_class),Chorus.Modernizr.csstransitions||(s.trigger("Verge.hideNav"),t.css({visibility:"hidden"}))):(o-50>e||n+p>=e)&&i&&(t.css({visibility:"visible"}),t.removeClass(f.hidden_class)),t.data().scroll=e},$=function(){t.hasClass(f.hidden_class)&&(s.trigger("Verge.hideNav"),t.css({visibility:"hidden"}))},O=function(){return C.animate({scrollTop:0}),!1},F=function(t){var n,o=e(this);if(!Chorus.Environment.largeBreakpoint.matches)switch(t.type){case"touch":o.removeClass(f.animated_class),R(o);break;case"dragleft":case"dragright":t.gesture.preventDefault(),n=o.data().offset+t.gesture.deltaX,L(o,n,t.gesture.direction);break;case"swipeleft":case"swiperight":t.gesture.preventDefault(),o.addClass(f.animated_class),o.hasClass(t.gesture.direction)&&o.trigger("Verge.swipeClose"),z(o),t.gesture.stopDetect();break;case"release":o.addClass(f.animated_class),Math.abs(t.gesture.deltaX)>o.width()/4&&o.hasClass(t.gesture.direction)&&o.trigger("Verge.swipeClose"),z(o)}},L=function(e,t,n){e.hasClass(n)&&(Chorus.Modernizr.realcsstransforms3d?e.css("transform","translate3d("+t+"px, 0, 0)"):(t="right"===n?-1*t:t,e.css(n,t)))},R=function(e){var t;Chorus.Modernizr.realcsstransforms3d?(t=e.css("transform"),t.match("matrix3d")?e.data().offset=parseInt(e.css("transform").split(", ")[12]):e.data().offset=parseInt(e.css("transform").split(", ")[4])):e.data().offset="auto"===e.css("left")?parseInt(e.css("right")):parseInt(e.css("left"))},z=function(e){Chorus.Modernizr.realcsstransforms3d?e.css("transform",""):e.css({left:"",right:""})},B=function(e){s.addClass("-header-reskin"),e.useAlternateSocialIcons&&s.addClass("-light-social-icons"),P()},W=function(){Verge.Util.unlockScroll(),x(),P(),V(),n.addClass(f.animated_class),p=e(f.site_nav_selector).height()},H=function(e){e.gesture.preventDefault(),"release"===e.type&&t.trigger("Verge.swipeClose")},Q=function(p){e.extend(f,p),s=e(f.root_selector),0!==s.length&&(i=e(f.tabs_selector).not(f.search_selector),r=e(f.search_selector),t=e(f.nav_selector),a=e(f.dropdown_selector),l=e(f.dropdown_pane_selector),n=e(f.side_nav_selector),o=e(f.close_selector),c=e(f.open_user_nav_selector),u=e(f.open_site_nav_selector),d=e(f.open_sections_nav_selector),h=e(f.search_form_selector),m=h.find("input[name=q]"),c.on("click",A),u.on("click",b),d.on("click",y),e(f.back_to_top_selector).on("click",O),a.on("click",function(e){e.stopPropagation()}),o.hammer().on("touch release drag swipe",H),i.on("click","> a",S),r.on("click","> a",E),n.hammer().on("touch release dragleft dragright swipeleft swiperight",F),h.on("click",function(e){e.stopPropagation()}),n.on("click",function(e){e.stopPropagation()}),s.on("webkitTransitionEnd oTransitionEnd msTransitionEnd transitionend",f.dropdown_selector,M),s.on("webkitTransitionEnd oTransitionEnd msTransitionEnd transitionend",f.dropdown_pane_selector,U),s.on("webkitTransitionEnd oTransitionEnd msTransitionEnd transitionend",f.nav_selector,$),s.on("Verge.openNewArticlesEnd Verge.closeNewArticlesEnd",P),g.on("Verge.openNewArticlesStart Verge.openBigStories Verge.swipeClose Verge.hideNav click",x),g.on("scroll",_.throttle(V,50)),g.on("Verge.openNav",Verge.Util.lockScroll),g.on("Verge.closeNav",Verge.Util.unlockScroll),Chorus.EventDispatcher.subscribe("campaignReskinApplied",B),Chorus.Environment.largeBreakpoint.addListener(W),W())};return{init:Q}}(jQuery).init();var Verge=Verge||{};Verge.NewArticles=function(e){var t,n,o={root_selector:"#header",new_articles:".m-new-articles",toggle_selector:"#js-new-articles-toggle",close_selector:"#js-side-nav-close",open_class:"is-new-articles-open"},i=e(document),r=function(){return n.hasClass(o.open_class)?a():s(),!1},s=function(){return n.addClass(o.open_class),t.trigger("Verge.openNewArticlesStart"),Chorus.Modernizr.csstransitions||t.trigger("Verge.openNewArticlesEnd"),!1},a=function(){n.hasClass(o.open_class)&&(n.removeClass(o.open_class),t.trigger("Verge.closeNewArticlesStart"),Chorus.Modernizr.csstransitions||t.trigger("Verge.closeNewArticlesEnd"))},l=function(){n.hasClass(o.open_class)?t.trigger("Verge.openNewArticlesEnd"):t.trigger("Verge.closeNewArticlesEnd")},c=function(){a(),t.on("webkitTransitionEnd oTransitionEnd msTransitionEnd transitionend",l)},u=function(s){e.extend(o,s),n=e(o.root_selector),0!==n.length&&(t=e(o.new_articles),n.on("click",o.toggle_selector,r),n.on("click",o.close_selector,a),i.on("Verge.openNewArticlesStart",Verge.Util.lockScroll),i.on("Verge.closeNewArticlesStart",Verge.Util.unlockScroll),i.on("Verge.openBigStories Verge.swipeClose",a),Chorus.Environment.largeBreakpoint.addListener(c),c())};return{init:u}}(jQuery).init();var Verge=Verge||{};Verge.BigStories=function(e){var t,n,o={root_selector:"#header",big_stories:".m-big-stories",toggle_selector:"#big-stories-toggle",open_class:"is-open"},i=function(){return t.hasClass(o.open_class)?s():r(),!1},r=function(){return t.addClass(o.open_class),n.trigger("Verge.openBigStories"),!1},s=function(e){Verge.Util.stopMetaClickPropagation(e)||t.removeClass(o.open_class)},a=function(r){e.extend(o,r),n=e(o.root_selector),0!==n.length&&(t=e(o.big_stories),n.on("click",o.toggle_selector,i),e(document).on("Verge.openNewArticlesStart Verge.stickNav Verge.openNav click",s),Chorus.Environment.largeBreakpoint.addListener(s))};return{init:a}}(jQuery).init();var Verge=Verge||{};Verge.Carousel=function(e){var t={carousel_selector:".js-carousel",pane_selector:".js-carousel-pane",list_selector:".js-carousel-list",item_selector:".js-carousel-item",control_selector:".js-carousel-control",prev_class:"-previous",next_class:"-next",active_class:"is-active",animated_class:"is-animated"},n=function(e){if(!e.data().initialized){var n=e.find(t.item_selector);o(e),i(e,n),r(e),e.on("click",t.control_selector,{carousel:e},s),e.on("webkitTransitionEnd oTransitionEnd msTransitionEnd transitionend",t.list_selector,h),e.find(t.list_selector).hammer({drag_lock_to_axis:!0}).on("click touch release dragleft dragright swipeleft swiperight",d),e.addClass(t.animated_class),e.data().initialized=!0}},o=function(e){var t=e.data("items-per-page");e.data().items_per_page="undefined"==typeof t?1:t},i=function(e,t){var n=t.length,o=e.data().items_per_page,i=n%o,r=n/o,s=i>0?Math.ceil(r):Math.floor(r);e.data().item_count=n,e.data().page={on:1,total:s,position:0}},r=function(e){var n=e.data().page,o=e.find("."+t.next_class),i=e.find("."+t.prev_class);e.data().item_count>e.data().items_per_page&&(1===n.on?(i.removeClass(t.active_class),o.addClass(t.active_class)):n.on<n.total?(i.addClass(t.active_class),o.addClass(t.active_class)):(i.addClass(t.active_class),o.removeClass(t.active_class)))},s=function(n){var o=n.data.carousel,i=e(this);n.preventDefault(),i.hasClass(t.active_class)&&(i.hasClass(t.prev_class)?l(o):i.hasClass(t.next_class)&&a(o))},a=function(e){var t=e.data().page.on;c(e,t+1)},l=function(e){var t=e.data().page.on;c(e,t-1)},c=function(e,n){var o=e.data().page.total,i=e.data().items_per_page,s=0;1>n?n=1:n>o&&(n=o),s=i*(n-1),e.data().page.position=Math.round(-1*e.find(t.item_selector).eq(s).position().left),e.data().page.on=n,u(e),r(e)},u=function(e,n){var o,i=e.find(t.list_selector);n="undefined"==typeof n?0:n,o=e.data().page.position+n,Chorus.Modernizr.csstransforms3d?i.css("transform","translate3d("+o+"px, 0, 0)"):i.css("left",o),Chorus.Modernizr.csstransitions||0!==n||Chorus.DynamicSizedImages.applyTo(i)},d=function(n){var o,i=e(this).parents(t.carousel_selector),r=i.data().page.on,s=i.data().page.total,c=i.find(t.pane_selector).width();switch(n.type){case"touch":i.removeClass(t.animated_class),i.data().dragged=!1;break;case"dragright":case"dragleft":i.data().dragged=!0,n.gesture.preventDefault(),o=n.gesture.deltaX,(1===r&&"right"===n.gesture.direction||r===s&&"left"===n.gesture.direction)&&(o*=.1),u(i,o);break;case"swipeleft":i.data().dragged=!0,n.gesture.preventDefault(),i.addClass(t.animated_class),a(i),n.gesture.stopDetect();break;case"swiperight":i.data().dragged=!0,n.gesture.preventDefault(),i.addClass(t.animated_class),l(i),n.gesture.stopDetect();break;case"release":i.addClass(t.animated_class),Math.abs(n.gesture.deltaX)>c/4?"right"===n.gesture.direction?l(i):a(i):u(i);break;case"click":i.data().dragged&&n.preventDefault(),i.data().dragged=!1}},h=function(){Chorus.DynamicSizedImages.applyTo(e(this))},m=function(e){e.data().initialized&&(e.find(t.list_selector).removeAttr("style"),e.removeData("page initialized items_per_page item_count"),e.off("click",t.control_selector),e.off("webkitTransitionEnd oTransitionEnd msTransitionEnd transitionend"),e.find(t.list_selector).hammer().off("touch release dragleft dragright swipeleft swiperight"))},p=function(){e(t.carousel_selector).each(function(){var t=e(this),o=_.isUndefined(t.data("carousel-no-scroll"))?!1:!0;o||Chorus.Environment.largeBreakpoint.matches?n(t):m(t)})},f=function(){Chorus.Environment.largeBreakpoint.addListener(p),p()};return{init:f,goToPage:c}}(jQuery),jQuery(function(){Verge.Carousel.init()});var Verge=Verge||{};Verge.CollapsibleTabs=function(e){var t={tabs:e(".p-tabs.js-collapsible"),tab_selector:"li",active_tab_selector:"li.-is-active",active_class:"-is-active"},n=function(){var t=e(this),n=t.parents(".p-tabs");n.hasClass("js-stream-sort")?n.find("[data-sort="+t.val()+"]").trigger("click"):window.location.href=t.val()},o=function(){for(var n,o,r=t.tabs.length,s=0;r>s;s+=1)o=e(t.tabs[s]),n=o.hasClass("js-stream-sort")?o.find(t.tab_selector):o.find(t.active_tab_selector),n.append(i(o))},i=function(n){for(var o,i,r,s,a=[],l=n.find(t.tab_selector),c=l.length,u=0,d=0;c>d;d+=1)o=e(l[u]),i=n.hasClass("js-stream-sort")?o.find("a").data("sort"):o.find("a").attr("href"),r=o.hasClass(t.active_class)?" selected ":"",s='<option value="'+i+'"'+r+">"+o.text()+"</option>",a[++u]=s;return"<select>"+a.join("")+"</select>"},r=function(){t.tabs.on("change","select",n),o()};return{init:r}}(jQuery).init();var Verge=Verge||{};Verge.App=function(){var e=function(){Chorus.Modernizr.addTest("realcsstransforms3d",function(){return Chorus.Modernizr.csstransforms3d&&"undefined"==typeof window.navigator.msPointerEnabled}),Chorus.Modernizr.addTest("ios",function(){return window.navigator.userAgent.match(/iphone|ipad|ipod/i)}),Chorus.Modernizr.addTest("chorustouch",function(){return Chorus.Environment.touch()}),Chorus.Environment.smallBreakpoint.addListener(function(){Chorus.DynamicSizedImages.init()})};return{init:e}}().init();var Verge=Verge||{};Verge.Newsletter=function(e){function t(){o=e("#newsletter-step1"),o.length&&(o.on("submit",n),i=e("#newsletter-signup-step2"))}function n(e){e.preventDefault();var t=o.find('input[name="email"]').val();t?(i.find('input[name="email"]').val(t),Chorus.EventDispatcher.publish("modal_open",{content:i.show()})):e.stopImmediatePropagation()}var o,i;return{init:t}}(jQuery),jQuery(function(){Verge.Newsletter.init()});var Verge=Verge||{};Verge.VideoHero=function(e){function t(){Chorus.Environment.touch()&&e(".m-video-hero__more-videos").on("click",function(t){if(!Verge.Util.stopMetaClickPropagation(t)){var n=e(this),o=i.playlist;return o.hasClass("-expanded")?(o.removeClass("-expanded"),n.find("span").text("more")):(o.addClass("-expanded"),n.find("span").text("fewer")),!1}})}function n(){i.video_hero.find("a[ooyala-video-id]").each(function(){var t=e(this),n=t.data("ooyala-video-id"),i=t.data("placement");n&&i&&o.addOoyalaVideo(n,"No Title",i)}),i.video_hero.on("click","a[data-placement]",function(t){if(!Verge.Util.stopMetaClickPropagation(t)){var n=e(this),r=n.data("placement"),s=n.data("embed-code");if(s)e("#"+i.player_container_id).html(s);else if(r){var a="ooyala"===o.videos[r].provider_video_type;o.createPlayer(i.player_container_id,r,{disableViewport:!0,autoplay:a})}var l="is-playing",c="is-not-playing";e(".m-video-hero__playlist-entry").removeClass(l).addClass(c),n.parent().toggleClass(l+" "+c);var u=n.attr("href"),d=n.data("bottom-call-to-action-text")||e(".m-video-hero__comment-link").text(),h=e(".m-video-hero__comment-link");return"#"===u?h.addClass("is-hidden"):(h.removeClass("is-hidden"),h.attr("href",u)),h.text(d),!1}})}var o=Chorus.VideoContext,i={video_hero:e("#video-hero"),player_container_id:"video-hero-player",playlist:e(".m-video-hero__playlist")};return e(function(){n(),t()}),{selectMainVideo:function(t,n){n=o.findUnviewedVideo(t,n);var i=e("#link-set-"+n.id).removeClass("hidden");e(".m-video-hero__main-entry").remove(".hidden");var r=i.find("[data-placement]").data("placement");o.addPlacementForId(n.id,r),this.trackLinkset(n,i)},trackLinkset:function(e,t){o.createViewportGroup(i.video_hero,function(){o.addViewedVideo(e)})}}}(jQuery);var Verge=Verge||{};Verge.TabbedSwitcher=function(e){var t={tabs:e(".js-tab-switcher li"),pages:e(".js-tab-page"),active_class:"-is-active"},n=function(){var n=e(this),o=n.parent(),i=t.pages.filter(n.attr("href"));return i.length>0&&(t.pages.hide(),t.tabs.removeClass(t.active_class),i.show(),o.addClass(t.active_class),Chorus.DynamicSizedImages.applyTo(i)),!1},o=function(){t.tabs.on("click","a",n)};return{init:o}}(jQuery).init();var Verge=Verge||{};Verge.Syllabus=function(e){var t=function(){var t=e("#syllabus-list-template");if(0!=t.length){var o=_.template(t.html());e("[data-syllabus]").each(function(){var t=e(this),i=t.data("syllabus")+"live.json",r=Number(t.data("syllabus-limit"));t.data("syllabus-original-content",t.html()),e.getJSON(i,{crossDomain:!0},function(e){var i;e.pinnedEntries.length>0?(i=n(e.pinnedEntries).slice(0,r),!i.length>0&&(i=n(e.entries).slice(0,r))):i=n(e.entries).slice(0,r),t.html(o(i))})})}},n=function(e){return _.select(_.map(e,function(e){return e.body=o(e.body.replace(/<[^>]+>/g,"").trim(),80),e}),function(e){return e.body.length>0}).sort(function(e,t){return t.sequence-e.sequence})},o=function(e,t){if(e.length>t+25){var n=e.slice(t).search(/\s/);return e.substring(0,t+n)+"&hellip;"}return e};return{init:t}}(jQuery),document.addEventListener("DOMContentLoaded",function(){Verge.Syllabus.init()});var Chorus=Chorus||{};Chorus.UserMessaging=function(e){function t(e){e.on("webkittransitionend transitionend otransitionEnd mstransitionend transitionend",function(){e.remove()}),e.addClass("is-closed")}function n(n){n.preventDefault(),n.stopPropagation(),t(e(n.delegateTarget))}function o(){var t=e(".m-user-msg__notice");t.length>1&&i(),t.first().find(".m-user-msg__close").trigger("click")}function i(){a===!0&&(dur=e(".m-user-msg__notice_short").length>0?c:l,to=setTimeout(o,dur))}function r(){e(".m-user-msg__notice, .m-user-msg__error").on("click",".m-user-msg__close",n)}function s(){e(".m-user-msg__modal").each(function(){Chorus.EventDispatcher.publish("modal_open",{content:e(this)})})}var a="polygon"===Chorus.Context.network_slug,l=3e4,c=4e3;return{init:function(){e(".m-user-msg").length<1||(s(),r(),i())}}}(jQuery),jQuery(Chorus.UserMessaging.init);var Chorus=Chorus||{};Chorus.Modal=function(e){"use strict";function t(){if(null===w){var t=e(b());v.append(t),t.on("click",p),w=t.find(".m-chorus-modal__root").addBack(".m-chorus-modal__root").first()}}function n(){t(),v.addClass("chorus-modal-loading")}function o(){v.removeClass("chorus-modal-loading")}function i(){t(),v.addClass("chorus-modal-open")}function r(){v.removeClass("chorus-modal-open")}function s(t){n();t.data||{};t.success=function(e){t.content=e,a(t)},t.error=function(e,t){"abort"!==t&&alert("There was an error recieving data from the server."),o()},y.push(e.ajax(t))}function a(t){o(),i();var n=e(C(t));n.find(".m-chorus-modal__window-root").append(t.content),n.addClass(t.modalClass),n.data("chorus-modal-callbacks",t.callbacks),w.prepend(n),n.on("click","*[data-chorus-modal-action]",m),u("attach",n)}function l(e){e.remove(),0===w.children().length&&(r(),o())}function c(e){e.callbacks=e.callbacks||{},e.title=e.title||"Untitled Modal",e.content=e.content||null,e.modalClass=e.modalClass||null,e.url?s(e):null!==e.content&&a(e)}function u(e,t){var n=t.data("chorus-modal-callbacks");if("cancel_confirm"===e){if(!confirm("Are you sure you want to close this window?"))return;e="cancel"}"function"==typeof n[e]&&n[e](t),("cancel"==e||"close"==e)&&l(t)}function d(){for(Chorus.EventDispatcher.publish("modal_closed_by_modaljs"),e(".m-chorus-modal__window").each(function(){u("cancel",e(this))}),null!==w&&w.empty(),r(),o();y.length>0;)y.pop().abort()}function h(){k=!0;var t=e("#chorus-modal-window-template").html()||"",n=e("#chorus-modal-wrapper-template").html()||"";v=e("body"),C=_.template(t),b=_.template(n)}function m(t){t.preventDefault(),u(e(t.target).data("chorus-modal-action").toString().trim(),e(t.delegateTarget))}function p(t){e(t.target).is(w)&&d()}function f(e){k===!1&&h(),c(e)}function g(e){d()}var v,C,b,w=null,y=[],k=!1;return{init:function(){Chorus.EventDispatcher.subscribe("modal_open",f),Chorus.EventDispatcher.subscribe("modal_close",g)},open:function(e){Chorus.EventDispatcher.publish("modal_open",e)},close:function(e){Chorus.EventDispatcher.publish("modal_close",e)}}}(jQuery),Chorus.Modal.init();var shortcut={all_shortcuts:{},add:function(e,t,n){var o={type:"keydown",propagate:!1,disable_in_input:!1,target:document,keycode:!1};if(n)for(var i in o)"undefined"==typeof n[i]&&(n[i]=o[i]);else n=o;var r=n.target;"string"==typeof n.target&&(r=document.getElementById(n.target));e=e.toLowerCase();var s=function(o){if(o=o||window.event,n.disable_in_input){var i;if(o.target?i=o.target:o.srcElement&&(i=o.srcElement),3==i.nodeType&&(i=i.parentNode),"INPUT"==i.tagName||"TEXTAREA"==i.tagName)return}o.keyCode?code=o.keyCode:o.which&&(code=o.which),o.key?character=o.key.toLowerCase():character=String.fromCharCode(code).toLowerCase(),188==code&&(character=","),190==code&&(character=".");var r=e.split("+"),s=0,a={"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":":","'":'"',",":"<",".":">","/":"?","\\":"|"},l={esc:27,escape:27,tab:9,space:32,"return":13,enter:13,backspace:8,scrolllock:145,scroll_lock:145,scroll:145,capslock:20,caps_lock:20,caps:20,numlock:144,num_lock:144,num:144,pause:19,"break":19,insert:45,home:36,"delete":46,end:35,pageup:33,page_up:33,pu:33,pagedown:34,page_down:34,pd:34,left:37,up:38,right:39,down:40,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123},c={shift:{wanted:!1,pressed:!1},ctrl:{wanted:!1,pressed:!1},alt:{wanted:!1,pressed:!1},meta:{wanted:!1,pressed:!1}};o.ctrlKey&&(c.ctrl.pressed=!0),o.shiftKey&&(c.shift.pressed=!0),o.altKey&&(c.alt.pressed=!0),o.metaKey&&(c.meta.pressed=!0);for(var u=0;k=r[u],u<r.length;u++)"ctrl"==k||"control"==k?(s++,c.ctrl.wanted=!0):"shift"==k?(s++,c.shift.wanted=!0):"alt"==k?(s++,c.alt.wanted=!0):"meta"==k?(s++,c.meta.wanted=!0):k.length>1?l[k]==code&&s++:n.keycode?n.keycode==code&&s++:character==k?s++:a[character]&&o.shiftKey&&(character=a[character],character==k&&s++);return s!=r.length||c.ctrl.pressed!=c.ctrl.wanted||c.shift.pressed!=c.shift.wanted||c.alt.pressed!=c.alt.wanted||c.meta.pressed!=c.meta.wanted||(t(o),n.propagate)?void 0:(o.cancelBubble=!0,o.returnValue=!1,o.stopPropagation&&(o.stopPropagation(),o.preventDefault()),!1)};this.all_shortcuts[e]={callback:s,target:r,event:n.type},r.addEventListener?r.addEventListener(n.type,s,!1):r.attachEvent?r.attachEvent("on"+n.type,s):r["on"+n.type]=s},remove:function(e){e=e.toLowerCase();var t=this.all_shortcuts[e];if(delete this.all_shortcuts[e],t){var n=t.event,o=t.target,i=t.callback;o.detachEvent?o.detachEvent("on"+n,i):o.removeEventListener?o.removeEventListener(n,i,!1):o["on"+n]=!1}}},miuScript;!function($){$.fn.markItUp=function(settings,extraSettings){var method,params,options,ctrlKey,shiftKey,altKey;ctrlKey=shiftKey=altKey=!1,"string"==typeof settings&&(method=settings,params=extraSettings),options={id:"",nameSpace:"",root:"",previewHandler:!1,previewInWindow:"",previewInElement:"",previewAutoRefresh:!0,previewPosition:"after",previewTemplatePath:"~/templates/preview.html",previewParser:!1,previewParserPath:"",previewParserVar:"data",resizeHandle:!0,beforeInsert:"",afterInsert:"",onEnter:{},onShiftEnter:{},onCtrlEnter:{},onTab:{},markupSet:[{}]},$.extend(options,settings,extraSettings),options.root||$("script").each(function(e,t){miuScript=$(t).get(0).src.match(/(.*)jquery\.markitup(\.pack)?\.js$/),null!==miuScript&&(options.root=miuScript[1])});var uaMatch=function(e){e=e.toLowerCase();var t=/(chrome)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[];return{browser:t[1]||"",version:t[2]||"0"}},matched=uaMatch(navigator.userAgent),browser={};return matched.browser&&(browser[matched.browser]=!0,browser.version=matched.version),browser.chrome?browser.webkit=!0:browser.webkit&&(browser.safari=!0),this.each(function(){function localize(e,t){return t?e.replace(/("|')~\//g,"$1"+options.root):e.replace(/^~\//,options.root)}function init(){id="",nameSpace="",options.id?id='id="'+options.id+'"':$$.attr("id")&&(id='id="markItUp'+$$.attr("id").substr(0,1).toUpperCase()+$$.attr("id").substr(1)+'"'),options.nameSpace&&(nameSpace='class="'+options.nameSpace+'"'),$$.wrap("<div "+nameSpace+"></div>"),$$.wrap("<div "+id+' class="markItUp"></div>'),$$.wrap('<div class="markItUpContainer"></div>'),$$.addClass("markItUpEditor"),header=$('<div class="markItUpHeader"></div>').insertBefore($$),$(dropMenus(options.markupSet)).appendTo(header),footer=$('<div class="markItUpFooter"></div>').insertAfter($$),options.resizeHandle===!0&&browser.safari!==!0&&(resizeHandle=$('<div class="markItUpResizeHandle"></div>').insertAfter($$).bind("mousedown.markItUp",function(e){var t,n,o=$$.height(),i=e.clientY;t=function(e){return $$.css("height",Math.max(20,e.clientY+o-i)+"px"),!1},n=function(e){return $("html").unbind("mousemove.markItUp",t).unbind("mouseup.markItUp",n),!1},$("html").bind("mousemove.markItUp",t).bind("mouseup.markItUp",n)}),footer.append(resizeHandle)),$$.bind("keydown.markItUp",keyPressed).bind("keyup",keyPressed),$$.bind("insertion.markItUp",function(e,t){t.target!==!1&&get(),textarea===$.markItUp.focused&&markup(t)}),$$.bind("focus.markItUp",function(){$.markItUp.focused=this}),options.previewInElement&&refreshPreview()}function dropMenus(markupSet){var ul=$("<ul></ul>"),i=0;return $("li:hover > ul",ul).css("display","block"),$.each(markupSet,function(){var button=this,t="",title,li,j;if(title=button.key?(button.name||"")+" [Ctrl+"+button.key+"]":button.name||"",key=button.key?'accesskey="'+button.key+'"':"",button.separator)li=$('<li class="markItUpSeparator">'+(button.separator||"")+"</li>").appendTo(ul);else{for(i++,j=levels.length-1;j>=0;j--)t+=levels[j]+"-";li=$('<li class="markItUpButton markItUpButton'+t+i+" "+(button.className||"")+'"><a href="" '+key+' title="'+title+'" tabindex="-1">'+(button.name||"")+"</a></li>").bind("contextmenu.markItUp",function(){return!1}).bind("touchstart.markItUp",function(){(navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i))&&textarea.blur()}).bind("click.markItUp touchstart.markItUp",function(e){e.preventDefault()}).bind("mouseup touchend",function(){return button.call&&eval(button.call)(),markup(button),!1}).bind("mouseenter.markItUp",function(){$("> ul",this).show(),$(document).one("click",function(){$("ul ul",header).hide()})}).bind("mouseleave.markItUp",function(){$("> ul",this).hide()}).appendTo(ul),button.dropMenu&&(levels.push(i),$(li).addClass("markItUpDropMenu").append(dropMenus(button.dropMenu)))}}),levels.pop(),ul}function magicMarkups(e){return e?(e=e.toString(),e=e.replace(/\(\!\(([\s\S]*?)\)\!\)/g,function(e,t){var n=t.split("|!|");return altKey===!0?void 0!==n[1]?n[1]:n[0]:void 0===n[1]?"":n[0]}),e=e.replace(/\[\!\[([\s\S]*?)\]\!\]/g,function(e,t){var n=t.split(":!:");return abort===!0?!1:(value=prompt(n[0],n[1]?n[1]:""),null===value&&(abort=!0),value)})):""}function prepare(e){return $.isFunction(e)&&(e=e(hash)),magicMarkups(e)}function build(e){var t=prepare(clicked.openWith),n=prepare(clicked.placeHolder),o=prepare(clicked.replaceWith),i=prepare(clicked.closeWith),r=prepare(clicked.openBlockWith),s=prepare(clicked.closeBlockWith),a=clicked.multiline;if(""!==o)block=t+o+i;else if(""===selection&&""!==n)block=t+n+i;else{e=e||selection;var l=[e],c=[];a===!0&&(l=e.split(/\r?\n/));for(var u=0;u<l.length;u++){line=l[u];var d;(d=line.match(/ *$/))?c.push(t+line.replace(/ *$/g,"")+i+d):c.push(t+line+i)}block=c.join("\n")}return block=r+block+s,{block:block,openBlockWith:r,openWith:t,replaceWith:o,placeHolder:n,closeWith:i,closeBlockWith:s}}function markup(e){var t,n,o,i;if(hash=clicked=e,get(),$.extend(hash,{line:"",root:options.root,
textarea:textarea,selection:selection||"",caretPosition:caretPosition,ctrlKey:ctrlKey,shiftKey:shiftKey,altKey:altKey}),prepare(options.beforeInsert),prepare(clicked.beforeInsert),(ctrlKey===!0&&shiftKey===!0||e.multiline===!0)&&prepare(clicked.beforeMultiInsert),$.extend(hash,{line:1}),ctrlKey===!0&&shiftKey===!0){for(lines=selection.split(/\r?\n/),n=0,o=lines.length,i=0;o>i;i++)""!==$.trim(lines[i])?($.extend(hash,{line:++n,selection:lines[i]}),lines[i]=build(lines[i]).block):lines[i]="";string={block:lines.join("\n")},start=caretPosition,t=string.block.length+(browser.opera?o-1:0)}else ctrlKey===!0?(string=build(selection),start=caretPosition+string.openWith.length,t=string.block.length-string.openWith.length-string.closeWith.length,t-=string.block.match(/ $/)?1:0,t-=fixIeBug(string.block)):shiftKey===!0?(string=build(selection),start=caretPosition,t=string.block.length,t-=fixIeBug(string.block)):(string=build(selection),start=caretPosition+string.block.length,t=0,start-=fixIeBug(string.block));""===selection&&""===string.replaceWith&&(caretOffset+=fixOperaBug(string.block),start=caretPosition+string.openBlockWith.length+string.openWith.length,t=string.block.length-string.openBlockWith.length-string.openWith.length-string.closeWith.length-string.closeBlockWith.length,caretOffset=$$.val().substring(caretPosition,$$.val().length).length,caretOffset-=fixOperaBug($$.val().substring(0,caretPosition))),$.extend(hash,{caretPosition:caretPosition,scrollPosition:scrollPosition}),string.block!==selection&&abort===!1?(insert(string.block),set(start,t)):caretOffset=-1,get(),$.extend(hash,{line:"",selection:selection}),(ctrlKey===!0&&shiftKey===!0||e.multiline===!0)&&prepare(clicked.afterMultiInsert),prepare(clicked.afterInsert),prepare(options.afterInsert),previewWindow&&options.previewAutoRefresh&&refreshPreview(),shiftKey=altKey=ctrlKey=abort=!1}function fixOperaBug(e){return browser.opera?e.length-e.replace(/\n*/g,"").length:0}function fixIeBug(e){return browser.msie?e.length-e.replace(/\r*/g,"").length:0}function insert(e){if(document.selection){var t=document.selection.createRange();t.text=e}else textarea.value=textarea.value.substring(0,caretPosition)+e+textarea.value.substring(caretPosition+selection.length,textarea.value.length)}function set(e,t){if(textarea.createTextRange){if(browser.opera&&browser.version>=9.5&&0==t)return!1;range=textarea.createTextRange(),range.collapse(!0),range.moveStart("character",e),range.moveEnd("character",t),range.select()}else textarea.setSelectionRange&&textarea.setSelectionRange(e,e+t);textarea.scrollTop=scrollPosition,textarea.focus()}function get(){if(scrollPosition=textarea.scrollTop,document.selection)if(selection=document.selection.createRange().text,browser.msie){textarea.focus();var e=document.selection.createRange(),t=e.duplicate();for(t.moveToElementText(textarea),caretPosition=-1;t.inRange(e);)t.moveStart("character"),caretPosition++}else caretPosition=textarea.selectionStart;else caretPosition=textarea.selectionStart,selection=textarea.value.substring(caretPosition,textarea.selectionEnd);return selection}function preview(){"function"==typeof options.previewHandler?previewWindow=!0:options.previewInElement?previewWindow=$(options.previewInElement):!previewWindow||previewWindow.closed?options.previewInWindow?(previewWindow=window.open("","preview",options.previewInWindow),$(window).unload(function(){previewWindow.close()})):(iFrame=$('<iframe class="markItUpPreviewFrame"></iframe>'),"after"==options.previewPosition?iFrame.insertAfter(footer):iFrame.insertBefore(header),previewWindow=iFrame[iFrame.length-1].contentWindow||frame[iFrame.length-1]):altKey===!0&&(iFrame?iFrame.remove():previewWindow.close(),previewWindow=iFrame=!1),options.previewAutoRefresh||refreshPreview(),options.previewInWindow&&previewWindow.focus()}function refreshPreview(){renderPreview()}function renderPreview(){if(options.previewHandler&&"function"==typeof options.previewHandler)options.previewHandler($$.val());else if(options.previewParser&&"function"==typeof options.previewParser){var e=options.previewParser($$.val());writeInPreview(localize(e,1))}else""!==options.previewParserPath?$.ajax({type:"POST",dataType:"text",global:!1,url:options.previewParserPath,data:options.previewParserVar+"="+encodeURIComponent($$.val()),success:function(e){writeInPreview(localize(e,1))}}):template||$.ajax({url:options.previewTemplatePath,dataType:"text",global:!1,success:function(e){writeInPreview(localize(e,1).replace(/<!-- content -->/g,$$.val()))}});return!1}function writeInPreview(e){if(options.previewInElement)$(options.previewInElement).html(e);else if(previewWindow&&previewWindow.document){try{sp=previewWindow.document.documentElement.scrollTop}catch(t){sp=0}previewWindow.document.open(),previewWindow.document.write(e),previewWindow.document.close(),previewWindow.document.documentElement.scrollTop=sp}}function keyPressed(e){if(shiftKey=e.shiftKey,altKey=e.altKey,ctrlKey=e.altKey&&e.ctrlKey?!1:e.ctrlKey||e.metaKey,"keydown"===e.type){if(ctrlKey===!0&&(li=$('a[accesskey="'+(13==e.keyCode?"\\n":String.fromCharCode(e.keyCode))+'"]',header).parent("li"),0!==li.length))return ctrlKey=!1,li.triggerHandler("mouseup"),!1;if(13===e.keyCode||10===e.keyCode)return ctrlKey===!0?(ctrlKey=!1,markup(options.onCtrlEnter),options.onCtrlEnter.keepDefault):shiftKey===!0?(shiftKey=!1,markup(options.onShiftEnter),options.onShiftEnter.keepDefault):(markup(options.onEnter),options.onEnter.keepDefault);if(9===e.keyCode)return 1==shiftKey||1==ctrlKey||1==altKey?!1:-1!==caretOffset?(get(),caretOffset=$$.val().length-caretOffset,set(caretOffset,0),caretOffset=-1,!1):(markup(options.onTab),options.onTab.keepDefault)}}function remove(){$$.unbind(".markItUp").removeClass("markItUpEditor"),$$.parent("div").parent("div.markItUp").parent("div").replaceWith($$),$$.data("markItUp",null)}var $$,textarea,levels,scrollPosition,caretPosition,caretOffset,clicked,hash,header,footer,previewWindow,template,iFrame,abort;if($$=$(this),textarea=this,levels=[],abort=!1,scrollPosition=caretPosition=0,caretOffset=-1,options.previewParserPath=localize(options.previewParserPath),options.previewTemplatePath=localize(options.previewTemplatePath),method)switch(method){case"remove":remove();break;case"insert":markup(params);break;default:$.error("Method "+method+" does not exist on jQuery.markItUp")}else init()})},$.fn.markItUpRemove=function(){return this.each(function(){$(this).markItUp("remove")})},$.markItUp=function(e){var t={target:!1};return $.extend(t,e),t.target?$(t.target).each(function(){$(this).focus(),$(this).trigger("insertion",[t])}):void $("textarea").trigger("insertion",[t])}}(jQuery),window.Chorus||(Chorus={}),Chorus.Comments=_.extend({},Backbone.Events,{Collections:{},Models:{},Views:{},Mixins:{},autoUpdateTimeout:null,defaults:{ajaxParams:{},ajaxTimeout:15e3,alertErrors:!0,avatarBreakpointIndex:2,autoUpdateAlertMaxShown:5,autoUpdateAlertTimeShown:6500,autoUpdateEnabled:!1,buildAncestry:!0,currentAutoUpdateInterval:4e4,editTimeWindow:90,emptyUpdateTolerance:5,fastAutoUpdateInterval:3e4,flaggedThreshold:1,localClockOffset:null,markItUp:{onShiftEnter:{keepDefault:!1,replaceWith:"\n\n"},markupSet:[{name:"Bold",key:"B",closeWith:"*",openWith:"*"},{name:"Italic",key:"I",closeWith:"_",openWith:"_"},{name:"Strike through",key:"S",closeWith:"-",openWith:"-"},{name:"Spoilers",key:"F",openWith:"%(spoiler)",closeWith:"%"},{separator:"---------------"},{name:"Bulleted list",openWith:"* ",multiline:!0},{name:"Numeric list",openWith:"# ",multiline:!0},{separator:"---------------"},{name:"Picture",openWith:"![![Source:!:http://]!](",closeWith:")!"},{name:"Link",openWith:'"',closeWith:'(!(([![Title (Shown on hover)]!]))!)":[![Link:!:http://]!]',placeHolder:"Your text to link here..."},{separator:"---------------"},{name:"Quotes",openWith:"bq. "}],resizeHandle:!1},maxIndentationDepth:30,offsetHeight:Math.floor(.333*jQuery(window).height()),recommendedThreshold:1,renderChunkLength:200,renderTo:"#comments",scrollAnimationDuration:300,scrollBuffer:0,showAutoUpdateAlert:!0,showAvatars:!0,showSignatures:!0,showImages:!0,removeImages:!1,removeEmoji:!1,slowAutoUpdateInterval:6e4,sortMethod:"ancestry",startOnScroll:Chorus.Environment.currentBreakpoint().index>1},settings:{},initialize:function(e,t){return this.stop(),this.started=!1,this.context={},this.settings=_.extend({},this.defaults,this.settings,t),this.collection=new Chorus.Comments.Collections.Comments([],{entryId:e}),this.settings.renderTo&&(this.compileTemplates(),this.view=new Chorus.Comments.Views.Main({el:this.settings.renderTo,collection:this.collection}),this.view.render()),window.location.hash.match(/^#\d+$/)&&this.start(),this},initContext:function(e){this.context=e,this.settings.autoUpdateEnabled=this.settings.autoUpdateEnabled&&this.context.able_to_comment&&!this.context.comments_closed&&Chorus.Environment.currentBreakpoint().index>1,this.settings.autoUpdateEnabled&&this.startAutoUpdate()},start:function(){return this.started?void 0:(this.started=!0,this.listenTo(this,"ajaxSuccess",this.ajaxSuccess),this.listenTo(this,"ajaxError",this.ajaxError),this.collection.load(),this.trigger("start"),Chorus.Analytics&&Chorus.Analytics.eventAutoFormat("interaction","comment_load"),Chorus.EventDispatcher&&Chorus.EventDispatcher.publish("startComments"),this)},stop:function(){return this.view&&this.view.remove(),this.view=null,this.collection=null,this.started=!1,this.trigger("stop"),this.stopListening(),this},compileTemplates:function(){_.each(Chorus.Comments.Views,function(e){if(e.prototype.templateId){var t=jQuery("#"+e.prototype.templateId).html()||"";e.prototype.template=_.template(t)}})},scheduleAutoUpdate:function(e){if(this.settings.autoUpdateEnabled){var t;t=e.emptyUpdateCount<this.settings.emptyUpdateTolerance?this.settings.fastAutoUpdateInterval:this.settings.slowAutoUpdateInterval,this.settings.currentAutoUpdateInterval=t,clearTimeout(this.autoUpdateTimeout),this.autoUpdateTimeout=setTimeout(function(){e.update()},t)}},startAutoUpdate:function(){this.settings.autoUpdateEnabled=!0,this.listenTo(this.collection,"updateSuccess updateError",this.scheduleAutoUpdate),this.scheduleAutoUpdate(this.collection)},stopAutoUpdate:function(){this.settings.autoUpdateEnabled=!1,this.stopListening(this.collection,"updateSuccess updateError",this.scheduleAutoUpdate),clearTimeout(this.autoUpdateTimeout),this.autoUpdateTimeout=null},openModal:function(e){Chorus.EventDispatcher.publish("modal_open",{content:e})},closeModal:function(){Chorus.EventDispatcher.publish("modal_close")},ajaxSuccess:function(e,t,n,o){var i=Date.parse(n.getResponseHeader("Date")),r=((new Date).valueOf()-i.valueOf())/1e3,s=this.settings.localClockOffset;_.isNumber(s)?this.settings.localClockOffset=(s+r)/2:this.settings.localClockOffset=r},ajaxError:function(e,t,n,o){try{var i=JSON.parse(e.responseText);i.message&&this.settings.alertErrors&&alert(i.message)}catch(r){}}}),Chorus.Comments.Mixins.Ajax={urlFor:function(e){var t=this.urls[e];return t&&(t=t.replace(/:([^\/]+)/,_.bind(function(e,t){return this instanceof Backbone.Model?this.get(t):this[t]},this))),t},ajax:function(e,t){var n=this.urlFor(e);if(!n)throw"ArgumentError: No url specified for action: "+e;var o=this,i=_.extend({url:n,dataType:"json",context:this,timeout:Chorus.Comments.settings.ajaxTimeout},this.ajaxOptions||{},t);return i.data&&_.isObject(i.data)&&"POST"===i.type&&(i.contentType="application/json",i.data=JSON.stringify(i.data),i.processData=!1),i.error=function(n,r,s){t&&_.isFunction(t.error)&&t.error.call(i.context,o,s),o.trigger(e+"Error",o,s,n),Chorus.Comments.trigger("ajaxError",n,r,s,o)},i.success=function(n,r,s){t&&_.isFunction(t.success)&&t.success.call(i.context,o,n),o.trigger(e+"Success",o,n,s),Chorus.Comments.trigger("ajaxSuccess",n,r,s,o)},o.trigger(e+"Start",o),Chorus.Comments.trigger("ajaxStart",o),jQuery.ajax(i)}},Chorus.Comments.Models.Comment=Backbone.Model.extend(_.extend({},Chorus.Comments.Mixins.Ajax,{ajaxOptions:{type:"POST"},urls:{preview:"/comments/preview_comment",post:"/comments/post_comment",edit:"/comments/edit_comment/:id",hide:"/comments/hide_comment/:id",flag:"/comments/flag_comment/:id",unflag:"/comments/unflag_comment/:id",recommend:"/comments/recommend_comment/:id",destroy:"/comments/destroy_comment/:id",loadFlaggings:"/comments/ajax_comment_flags/:id",blockUser:"/comments/block_user/:id"},initialize:function(){!Chorus.Comments.settings.buildAncestry||this.get("ancestry")&&this.get("depth")||this.buildAncestry(),this.listenTo(this,"change:id change:parent_id",this.buildAncestry),this.listenTo(this,"change:collapsed",this.collapseDescendants)},buildAncestry:function(){var e,t=function(e){return e=e.toString(),e.length>=10?e:new Array(10-e.length+1).join("0")+e},n=this.id?t(this.id):"preview",o=this.parent();o&&(n=o.get("ancestry")+"/"+n),e=n.split("/").length,e=Math.min(e,Chorus.Comments.settings.maxIndentationDepth),this.set({ancestry:n,depth:e},{silent:!0})},user:function(){return this.collection.users.get(this.get("user_id"))||new Chorus.Comments.Models.User({display_name:this.get("username")||"anonymous"})},parent:function(){var e=this.get("parent_id");return e?this.collection.get(e):null},ancestors:function(){if(!this.get("ancestry"))return[];var e=this.get("ancestry").split("/");return e.pop(),_.map(e,function(e){return e=parseInt(e,10),this.collection.get(e)},this)},descendants:function(){var e=new RegExp("^"+this.get("ancestry")+"/");return this.collection.filter(function(t){return e.test(t.get("ancestry"))})},matchesConditions:function(e){for(var t in e)if(e[t]!=this.get(t))return!1;return!0},findNeighbor:function(e,t,n){var o,i=this.collection.indexOf(this),r=this.collection.length-1,s=i;if(0===r)return null;do{if(s=n?s-1:s+1,!t&&(0>s||s>r))return null;if(0>s?s=r:s>r&&(s=0),o=this.collection.at(s),o&&o.matchesConditions(e))return o}while(s!==i);return null},prev:function(e,t){return this.findNeighbor(e,t,!0)},next:function(e,t){return this.findNeighbor(e,t,!1)},flaggings:function(){return this.collection.flaggings.where({flaggable_id:this.id})},isFlagged:function(){return this.get("bad_flags_count")>=Chorus.Comments.settings.flaggedThreshold},isRecommended:function(){return this.get("recommended_flags_count")>=Chorus.Comments.settings.recommendedThreshold},createFlagging:function(e){return this.collection.flaggings.add({flag_name:e,flaggable_id:this.id,user_id:Chorus.Comments.context.user_id,created_on:new Date})},secondsSinceCreate:function(){var e=Chorus.Comments.settings.localClockOffset||0,t=(new Date).getTime()/1e3;return t=Math.round(t-e),t-this.get("created_on_timestamp")},isEditable:function(){return this.get("user_id")===Chorus.Comments.context.user_id&&this.secondsSinceCreate()<Chorus.Comments.settings.editTimeWindow},isPreview:function(){return!this.id},toJSON:function(){var e,t=_.clone(this.attributes);return t.is_flagged=this.isFlagged(),t.is_recommended=this.isRecommended(),t.is_editable=this.isEditable(),t.is_preview=this.isPreview(),t.permalink=this.getAbsoluteURL("permalink"),t.shortlink=this.getAbsoluteURL("shortlink"),Chorus.Environment.currentBreakpoint().index<2?t.created_on=this.get("created_on_short"):t.created_on=this.get("created_on_long"),e=this.user(),e&&(t.user=e.toJSON(!0)),t},getAbsoluteURL:function(e){return window.location.origin+this.get(e)},preview:function(){return this.ajax("preview",{data:{entry_id:this.collection.entryId,comment:_.pick(this.attributes,"user_id","parent_id","title","body")},success:function(e,t){e.collection.users.add(t,{parse:!0}),e.set(t.comments[0])}})},post:function(){var e=this.get("body");return e&&this.set("rawBody",e),this.ajax("post",{data:{entry_id:this.collection.entryId,comment:_.pick(this.attributes,"user_id","parent_id","title","body")},success:function(e,t){e.collection.users.add(t,{parse:!0}),e.set(t.comments[0]),e.collection.add(e)}})},edit:function(e){return e.body&&this.set("rawBody",e.body),this.ajax("edit",{data:{entry_id:this.collection.entryId,comment:e},success:function(e,t){e.set(t.comments[0])}})},hide:function(){var e={},t=this.descendants();return _.each(t,function(t){e[t.id]=t.get("hidden"),t.set("hidden",!0)}),this.set("hidden",!0),this.ajax("hide",{error:function(n){n.set("hidden",!1),_.each(t,function(t){t.set("hidden",e[t.id])})}})},unhide:function(){return this.set("hidden",!1),this.ajax("hide",{error:function(e){e.set("hidden",!0)}})},flag:function(e){var t=this.createFlagging("inappropriate");return this.set({is_flagged_by_user:!0,bad_flags_count:this.get("bad_flags_count")+1}),this.ajax("flag",{data:e,error:function(e){e.set({is_flagged_by_user:!1,bad_flags_count:e.get("bad_flags_count")-1}),e.collection.flaggings.remove(t)}})},unflag:function(){var e=this.flaggingsLoaded,t=this.flaggings();return this.flaggingsLoaded=!1,this.collection.flaggings.remove(t),this.set({is_flagged_by_user:!1,bad_flags_count:this.get("bad_flags_count")-1}),this.ajax("unflag",{error:function(n){n.set({is_flagged_by_user:!0,bad_flags_count:n.get("bad_flags_count")+1}),n.collection.flaggings.add(t),n.flaggingsLoaded=e}})},recommend:function(){var e=this.createFlagging("recommended");return this.set({is_recommended_by_user:!0,recommended_flags_count:(this.get("recommended_flags_count")||0)+1}),this.ajax("recommend",{error:function(t){t.set({is_recommended_by_user:!1,recommended_flags_count:t.get("recommended_flags_count")-1}),t.collection.flaggings.remove(e)}})},unrecommend:function(){var e=this.flaggings();return this.collection.flaggings.remove(e),this.set({is_recommended_by_user:!1,recommended_flags_count:this.get("recommended_flags_count")-1}),this.ajax("unflag",{error:function(t){t.set({is_recommended_by_user:!0,recommended_flags_count:t.get("recommended_flags_count")+1}),t.collection.flaggings.add(e)}})},destroy:function(){var e=this.collection,t=this.descendants();return e.remove(t),e.remove(this),this.ajax("destroy",{error:function(n){e.add(n),e.add(t)}})},loadFlaggings:function(){return this.ajax("loadFlaggings",{type:"GET",success:function(e,t){e.collection.users.add(t,{parse:!0,merge:!0}),e.collection.flaggings.add(t,{parse:!0,merge:!0}),e.flaggingsLoaded=!0}})},collapseDescendants:function(e,t){t?_.each(this.descendants(),function(e){e.get("collapsedAncestorId")||e.set("collapsedAncestorId",this.id)},this):_.each(this.descendants(),function(e){e.get("collapsedAncestorId")===this.id&&e.set("collapsedAncestorId",null)},this)},blockUser:function(){var e=this.user(),t=this.collection,n=t.where({user_id:this.get("user_id")});return t.remove(n),t.users.remove(e),this.ajax("blockUser",{error:function(){t.users.add(e),t.add(n)}})}})),Chorus.Comments.Models.Flagging=Backbone.Model.extend({initialize:function(){this.set("created_on_timestamp",Math.round(new Date(this.get("created_on")).getTime()/1e3))},user:function(){return this.collection.users.get(this.get("user_id"))},flaggable:function(){return this.collection.comments.get(this.get("flaggable_id"))},toJSON:function(){var e=_.clone(this.attributes),t=this.user(),n=new Date(this.get("created_on")).toLocaleString();return e.created_on=n,t&&(e.user=t.toJSON()),e}}),Chorus.Comments.Models.User=Backbone.Model.extend({initialize:function(){var e=this.get("author_profile"),t=this.get("network_membership"),n=this.get("membership");e?this.set({profile_image:this.get("author_profile").image_url,profile_url:this.get("author_profile").url}):t&&this.set({profile_image:t.image_url,profile_url:t.url}),n&&this.set({inspect_user_url:n.inspect_user_url})},isAuthor:function(){return Chorus.Comments.context.author_id===this.id},isContributor:function(){return _.indexOf(Chorus.Comments.context.contributor_ids,this.id)>-1},toJSON:function(){var e=_.clone(this.attributes);return e.is_author=this.isAuthor(),e.is_contributor=this.isContributor(),e}}),Chorus.Comments.Collections.Comments=Backbone.Collection.extend(_.extend({},Chorus.Comments.Mixins.Ajax,{model:Chorus.Comments.Models.Comment,urls:{load:"/comments/load_comments/:entryId",update:"/comments/ajax_comments_update/:entryId"},loaded:!1,lastRequestId:0,emptyUpdateCount:0,initialize:function(e,t){return this.entryId=t.entryId,this.users=new Chorus.Comments.Collections.Users,this.flaggings=new Chorus.Comments.Collections.Flaggings([],{users:this.users,comments:this}),this.listenTo(this,"add",this.findCollapsedAncestor),this},comparator:function(e,t){switch(Chorus.Comments.settings.sortMethod){case"ancestry":var n=e.get("ancestry"),o=t.get("ancestry");return o>n?-1:n>o?1:0;case"forward-chron":return e.get("created_on_timestamp")===t.get("created_on_timestamp")?e.get("id")-t.get("id"):e.get("created_on_timestamp")-t.get("created_on_timestamp");case"reverse-chron":return e.get("created_on_timestamp")===t.get("created_on_timestamp")?t.get("id")-e.get("id"):t.get("created_on_timestamp")-e.get("created_on_timestamp")}},parse:function(e){return e.comments||[]},load:function(){return this.ajax("load",{timeout:null,data:_.extend({t:(new Date).getTime()},Chorus.Comments.settings.ajaxParams),success:function(e,t){Chorus.Comments.initContext(t.context),e.loaded=!0,e.lastId=t.last_id,e.lastVersion=t.last_version,e.users.reset(t,{parse:!0}),e.flaggings.reset(t,{parse:!0}),e.reset(t,{parse:!0})}})},update:function(){return this.lastRequestId+=1,this.ajax("update",{data:_.extend({request_id:this.lastRequestId,last_id:this.lastId,last_version:this.lastVersion},Chorus.Comments.settings.ajaxParams),success:function(e,t){return e.lastRequestId!==t.last_request_id?void console.warn("Failed to update comments: updates arrived out of order"):(e.lastId=t.last_id,e.lastVersion=t.last_version,t.comments.length?e.emptyUpdateCount=0:e.emptyUpdateCount++,_.each(t.deleted_comment_ids,function(t){var n=e.get(t);n&&(e.remove(n.descendants()),e.remove(n))}),e.users.add(t,{parse:!0}),e.add(t,{parse:!0}),void e.flaggings.add(t,{parse:!0}))},error:function(e,t){e.emptyUpdateCount++}})},findCollapsedAncestor:function(e){var t=_.find(e.ancestors().reverse(),function(e){return e.get("collapsed")});t&&(e.set("collapsedAncestorId",t.id),t.trigger("change"))}})),Chorus.Comments.Collections.Flaggings=Backbone.Collection.extend({model:Chorus.Comments.Models.Flagging,initialize:function(e,t){this.users=t.users,this.comments=t.comments},parse:function(e){return e.flaggings||[]}}),Chorus.Comments.Collections.Users=Backbone.Collection.extend({model:Chorus.Comments.Models.User,parse:function(e,t){return e.users||[]},current:function(){return this.get(Chorus.Comments.context.user_id)}}),Chorus.Comments.Views.AccountActions=Backbone.View.extend({id:"",className:"",templateId:"comment-account-actions-template",render:function(){return this.$el.html(this.template()),this.trigger("render",this),this}}),Chorus.Comments.Views.AutoUpdateAlert=Backbone.View.extend({id:"autoupdate_info",templateId:"comment-auto-update-alert-template",events:{"click .close":"hide","click .go_to_comment":"goToComment"},initialize:function(e){this.listenTo(this.collection,"updateSuccess",this.show)},render:function(){return this.$el.hide(),this.trigger("render",this),this},show:function(e,t){if(Chorus.Comments.settings.showAutoUpdateAlert!==!1){var n=[];if(_.each(t.comments,function(t){if(t.user_id!==Chorus.Comments.context.user_id){var o=e.get(t.id),i=o.toJSON(),r=o.parent();r&&(i.parent=r.toJSON()),n.push(i)}}),0!==n.length){var o=this.template({comments:n,settings:Chorus.Comments.settings});this.$el.html(o).fadeIn(1e3),setTimeout(_.bind(this.hide,this),Chorus.Comments.settings.autoUpdateAlertTimeShown)}}},hide:function(){return this.$el.fadeOut(500),!1},goToComment:function(e){var t=e.currentTarget.getAttribute("data-comment-id");return Chorus.Comments.trigger("activateComment",t),!1}}),Chorus.Comments.Views.BaseForm=Backbone.View.extend({events:{"submit form":"submit","click .post_comment_button":"post","click .preview_comment_button":"preview","click .cancel_comment_button":"cancel","focusin textarea":"hideTouchTools","focusout textarea":"showTouchTools"},renderPreview:function(e){return this.previewView?this.previewView.model=e:this.previewView=new Chorus.Comments.Views.Comment({model:e}),this.previewView.render().$el.prependTo(this.el),this.$(".preview-controls").show(),this.$(".preview_comment_button").prop("disabled",!1).val("Preview"),this},formData:function(){var e=this.$("form").serializeArray(),t={};return _.each(e,function(e){t[e.name]=e.value}),t},submit:function(){return this.previewView?this.post():this.preview(),!1},post:function(){var e=this.$(".post_comment_button");e.prop("disabled",!0).val(this.submitText+"ing...");var t=new Chorus.Comments.Models.Comment(this.formData(),{collection:this.collection});return t.once("postSuccess",function(){this.cancel()},this),t.once("postError",function(){e.prop("disabled",!1).val(this.submitText)},this),t.post(),!1},preview:function(){var e=this.$(".preview_comment_button");e.prop("disabled",!0).val("Previewing...");var t=new Chorus.Comments.Models.Comment(this.formData(),{collection:this.collection});return t.once("previewSuccess",this.renderPreview,this),t.once("previewError",function(){e.prop("disabled",!1).val("Preview")},this),t.preview(),!1},remove:function(){return this.previewView&&(this.previewView.remove(),this.previewView=null),Backbone.View.prototype.remove.call(this)},hideTouchTools:function(){"undefined"!=typeof Chorus.Comments.view.touchTools&&Chorus.Comments.view.touchTools.hide()},showTouchTools:function(){"undefined"!=typeof Chorus.Comments.view.touchTools&&Chorus.Comments.view.touchTools.show()}}),Chorus.Comments.Views.Comment=Backbone.View.extend({templateId:"comment-template",events:{"click .reply_link":"reply","click .edit_link":"edit","click .flag_link":"toggleFlagged","click .rec_link":"toggleRecommended","click .delete_link":"destroy","click .hide_link":"toggleHidden","click .up_link":"activateParent","click .actions_toggle":"toggleActions","click .inspect_flags_link":"inspectFlags","click .inspect_user_link":"inspectUser","click .block_user_link":"blockUser","click .collapse_toggle":"toggleCollapsed","click .image_toggle .message":"toggleImage"},renderTriggers:["id","parent_id","title","body","user_id","signature","hidden","created_on_long","created_on_short","created_on_timestamp","recommended_flags_count","is_recommended_by_user","troll_flags_count","spam_flags_count","inappropriate_flags_count","bad_flags_count","is_flagged_by_user"],initialize:function(){return this.listenTo(this.model,"change:"+this.renderTriggers.join(" change:"),this.render),this.listenTo(this.model,"change",this.regenerateWrapperClass),this.listenTo(this.model,"markRead",this.markCollapsedDescendantsRead),this.listenTo(this.model,"remove",this.remove),this},className:function(){var e=this.model.toJSON(),t=Chorus.Comments.context,n=[],o=function(e,t){t?n.push(e):n=_.without(n,e)};return this.el&&this.el.className&&(n=n.concat(this.el.className.split(" "))),o("citem",!0),o("cdepth-"+e.depth,!0),o("recommended",e.is_recommended),o("flagged",t.able_to_moderate&&e.is_flagged),o("new",e.is_new),o("hidden",e.hidden),o("obscured",e.obscured),o("collapsed",e.collapsed),o("collapsed-child",e.collapsedAncestorId),o("moderator",e.is_posted_by_moderator),o("preview",e.is_preview),_.uniq(n).join(" ")},attributes:function(){return{id:this.model.id}},delegateEvents:function(){},hasProfilePicture:function(){return this.model.user().get("profile_image")&&Chorus.Environment.currentBreakpoint().index>=Chorus.Comments.settings.avatarBreakpointIndex&&Chorus.Comments.settings.showAvatars},render:function(){var e=this.model.toJSON();return this.$el.html(this.template({view:this,context:Chorus.Comments.context,settings:Chorus.Comments.settings,comment:e})),this.model.isEditable()&&this.updateEditCountdown(),Chorus.Comments.settings.removeImages?this.removeImages():this.makeImagesHideable(),Chorus.Comments.settings.removeEmoji&&this.$(".cbody img.emoji").each(function(){jQuery(this).replaceWith(this.getAttribute("alt"))}),this.replyForm&&(this.$el.append(this.replyForm.el),this.replyForm.delegateEvents()),this.trigger("render",this),this},makeImagesHideable:function(){var e=this.$(".cbody img:not(.emoji)");e.wrap('<span href="#" class="image_toggle"></span>').parent().toggleClass("hidden",!Chorus.Comments.settings.showImages).append('<span class="message"></span>'),Chorus.Modernizr.localstorage&&e.each(function(){var e=jQuery(this);localStorage.getItem(e.attr("src"))&&e.parent().addClass("hidden")})},removeImages:function(){this.$(".cbody img:not(.emoji)").remove()},toggleImage:function(e){if(jQuery(e.currentTarget).parent().toggleClass("hidden"),Chorus.Modernizr.localstorage){var t=jQuery(e.currentTarget).parent(),n=t.find("img").attr("src");t.hasClass("hidden")?localStorage.setItem(n,"hidden"):localStorage.removeItem(n)}return!1},renderReplyCounts:function(){var e=this.model.descendants(),t=e.length;if(t>0){var n=_.filter(e,function(e){return e.get("is_new")}).length,o=1===t?"1 reply":t+" replies";n>0&&(o+=", "+n+" new"),this.$(".reply_count").text(o)}},regenerateWrapperClass:function(){this.$el.attr("class",this.className())},updateEditCountdown:function(){var e=Chorus.Comments.settings.editTimeWindow-this.model.secondsSinceCreate();e>0?(this.$(".countdown_timer").text(Math.round(e)),this.$(".countdown_timer_bar").width(100*(e/Chorus.Comments.settings.editTimeWindow)+"%"),setTimeout(_.bind(this.updateEditCountdown,this),1e3)):(this.$(".edit_link").remove(),this.$(".countdown_timer").text(""),this.$(".countdown_timer_bar").remove())},reply:function(){if(Chorus.Comments.context.user_id)if(Chorus.Comments.context.able_to_comment)this.replyForm||(this.replyForm=new Chorus.Comments.Views.ReplyForm({model:this.model,collection:this.model.collection}),this.replyForm.renderTo(this.el),this.listenTo(this.replyForm,"cancel",function(){this.replyForm=null}));else{var e=jQuery("#comment_tease, #comments .m-user-msg__account-action, #comments .m-user-msg__membership_required").offset();e&&jQuery("html, body").animate({scrollTop:e.top-Chorus.Comments.settings.offsetHeight},{duration:Chorus.Comments.settings.scrollAnimationDuration})}else Chorus.Auth.modal.open("login");return!1},edit:function(){this.$el.addClass("ui-state-editing");var e=new Chorus.Comments.Views.EditForm({model:this.model});return e.render().$el.prependTo(this.el),e.once("cancel",function(){this.$el.removeClass("ui-state-editing")},this),!1},toggleHidden:function(){var e=this.model.get("hidden"),t=_.any(this.model.ancestors(),function(e){return e.get("hidden")});return t?alert("You can't "+(e?"unhide":"hide")+" this comment, because its parents are already hidden."):e?this.model.unhide():this.model.hide(),!1},destroy:function(){var e=confirm("You're about to delete this comment and all its replies. Are you sure?");return e===!0&&this.model.destroy(),!1},blockUser:function(){var e=["Spam ban is to be used exclusively for obvious spam, and not for normal moderation of community members.","","This action will ban the user from all Chorus communities (not just this one) and delete their comments. It is not reversible."].join("\n");return confirm(e)&&("BAN"==prompt("Enter the word 'BAN' (all caps) to confirm.")?this.model.blockUser():alert("Confirmation did not match.")),!1},toggleActions:function(){return this.$el.toggleClass("ui-state-tools-active"),!1},toggleRecommended:function(){return this.model.get("is_recommended_by_user")?this.model.unrecommend():this.model.recommend(),!1},toggleFlagged:function(){return this.model.get("is_flagged_by_user")?this.model.unflag():new Chorus.Comments.Views.FlagDialog({model:this.model}).render(),!1},inspectFlags:function(){return new Chorus.Comments.Views.InspectFlagsDialog({model:this.model}).render(),!1},inspectUser:function(){var e=this.model.user();return window.open(e.get("inspect_user_url")),!1},toggleCollapsed:function(){return this.model.get("collapsed")?this.uncollapse():(this.collapse(),this.renderReplyCounts()),!1},collapse:function(){this.model.set("collapsed",!0)},uncollapse:function(){this.model.set("collapsed",!1)},activate:function(){this.$el.addClass("active"),jQuery("html, body").stop(!0).animate({scrollTop:this.$el.offset().top-Chorus.Comments.settings.offsetHeight},{duration:Chorus.Comments.settings.scrollAnimationDuration})},activateParent:function(){var e=this.model.parent();return e&&Chorus.Comments.trigger("activateComment",e.id),!1},deactivate:function(){this.$el.removeClass("active")},markCollapsedDescendantsRead:function(){this.model.get("collapsed")&&(_.each(this.model.descendants(),function(e){e.set("is_new",!1)}),this.renderReplyCounts())}}),Chorus.Comments.Views.CommentList=Backbone.View.extend({id:"comments_list",className:"comment_master_list",childSelector:".citem",childView:Chorus.Comments.Views.Comment,shortcuts:{"Shift+a":"markAllRead",
"Shift+c":"activatePrev",c:"activateNext",j:"activateNext",k:"activatePrev",x:"markRead",z:"markReadAndActivateNext",r:"replyToCurrent"},initialize:function(){this.childViews={},this.listenTo(this.collection,"loadSuccess",this.renderAll),this.listenTo(this.collection,"add",this.renderOne),this.listenTo(this.collection,"remove",this.removeOne),this.listenTo(this.collection,"loadSuccess add",this.renderEmbeds),this.listenTo(Chorus.Comments,"activateComment",this.activateId),this.listenTo(this,"renderAll",this.activateHash),_.each(this.shortcuts,function(e,t){shortcut.add(t,_.bind(this[e],this),{disable_in_input:!0,type:"keypress"})},this)},render:function(){return this},delegateEvents:function(){return _.each(this.childView.prototype.events,function(e,t){var n=t.match(/^(\S+)\s+(.+)$/),o=n[1],i=n[2],r=this.childViews,s=this.childSelector;this.$el.on(o+".delegateEvents",s+" "+i,function(t){var n=jQuery(this).closest(s),o=r[n.attr("id")];return o?o[e].call(o,t):void 0})},this),Backbone.View.prototype.delegateEvents.call(this)},removeAll:function(){return this.$el.empty(),this.trigger("removeAll",this),this.childViews={},this},removeOne:function(e){var t=this.childViews[e.id];return t&&t.remove(),delete this.childViews[e.id],this.trigger("removeOne",this,t,e),this},renderAll:function(){var e=Chorus.Comments.settings;return this.renderPage(0,e.renderChunkLength)},renderPage:function(e,t){var n=(Chorus.Comments.settings,_.map(this.collection.slice(e,t),function(e){return this.renderOne(e,!1).el},this));if(this.$el.append(n),this.trigger("renderPage",this,e,t),t<this.collection.length){e=t,t=Math.min(this.collection.length,e+Chorus.Comments.settings.renderChunkLength);var o=function(){this.renderPage(e,t)};setTimeout(_.bind(o,this),0)}else this.trigger("renderAll",this);return this},renderOne:function(e,t){var n=this.childViews[e.id]||new this.childView({model:e});if(this.childViews[e.id]=n.render(),t){for(var o,i=this.collection.length,r=this.collection.indexOf(e)+1;!o&&i>r;)o=this.collection.at(r++),o=o&&this.childViews[o.id];o?o.$el.before(n.el):this.$el.append(n.el),this.trigger("renderOne",this,n,e)}return n},renderEmbeds:function(){window.twttr&&window.twttr.widgets&&_.isFunction(window.twttr.widgets.load)&&window.twttr.widgets.load()},activeModel:function(){return this.activeId?this.collection.get(this.activeId):null},activeView:function(){return this.activeId?this.childViews[this.activeId]:null},activateId:function(e){var t=this.activeView(),n=this.childViews[e];return t&&t.deactivate(),n&&(n.$el.hasClass("collapsed-child")?this.activateId(n.model.get("parent_id")):(n.activate(),this.activeId=e)),this},activateHash:function(){var e=window.location.hash.match(/^#(\d+)$/);e&&setTimeout(_.bind(this.activateId,this,e[1]),1e3)},activateNeighbor:function(e){var t,n=this.activeModel();if(n)t=n[e]({is_new:!0},!0);else for(t="next"===e?this.collection.first():this.collection.last();t&&!t.get("is_new");)t=t[e]();return t?this.activateId(t.id):void 0},activatePrev:function(){this.collection.loaded?this.activateNeighbor("prev"):this.loadThenRun("activatePrev")},activateNext:function(){this.collection.loaded?this.activateNeighbor("next"):this.loadThenRun("activateNext")},markRead:function(){var e=this.activeModel(),t=this.activeView();e&&(e.set("is_new",!1),e.trigger("markRead")),t&&t.deactivate()},markAllRead:function(){_.each(this.collection.where({is_new:!0}),function(e){e.set("is_new",!1)})},markAllUnread:function(){this.collection.each(function(e){e.set("is_new",!0)}),this.activeId||(this.activeId=this.collection.first().id)},markReadAndActivateNext:function(){this.collection.loaded?(this.markRead(),this.activateNext()):this.loadThenRun("markReadAndActivateNext")},replyToCurrent:function(){var e=this.activeView();e&&e.reply()},loadThenRun:function(e){jQuery("html, body").animate({scrollTop:this.$el.offset().top-Chorus.Comments.settings.offsetHeight},{duration:Chorus.Comments.settings.animationDuration}),Chorus.Comments.settings.startOnScroll||Chorus.Comments.start(),this.listenToOnce(this.collection,"loadSuccess",this[e])}}),Chorus.Comments.Views.CommentsClosedNotice=Backbone.View.extend({templateId:"comments-closed-notice-template",render:function(){return this.$el.html(this.template()),this.trigger("render",this),this}}),Chorus.Comments.Views.EditForm=Backbone.View.extend({className:"cedit cform",templateId:"comment-edit-form-template",events:{"submit form":"submit","click .post_edit_button":"submit","click .cancel_edit_button":"cancel"},render:function(){return this.$el.html(this.template({comment:this.model.toJSON()})),this.$("textarea").markItUp(Chorus.Comments.settings.markItUp),this.trigger("render",this),this},formData:function(){var e=this.$("form").serializeArray(),t={};return _.each(e,function(e){t[e.name]=e.value}),t},submit:function(){var e=this.$(".post_edit_button");return e.prop("disabled",!0).val("Saving..."),this.model.once("editSuccess",function(){this.cancel()},this),this.model.once("editError",function(){e.prop("disabled",!1).val("Save")},this),this.model.edit(this.formData()),!1},cancel:function(){return this.remove(),this.trigger("cancel"),!1}}),Chorus.Comments.Views.FlagDialog=Backbone.View.extend({templateId:"comment-flag-dialog-template",events:{"submit form":"submit"},render:function(){var e=this.template({comment:this.model.toJSON()});return Chorus.Comments.openModal(e),this.setElement("#comment_flag_modal"),this.trigger("render",this),this},submit:function(){return this.model.flag(this.$("form").serialize()),Chorus.Comments.closeModal(),!1}}),Chorus.Comments.Views.Footer=Backbone.View.extend({templateId:"comments-footer-template",render:function(){return this.$el.html(this.template()),this.trigger("render",this),this}}),Chorus.Comments.Views.FormattingGuide=Backbone.View.extend({id:"comment_formatting_guide",templateId:"comment-formatting-guide-template",render:function(){return this.$el.html(this.template()).hide(),this.trigger("render",this),this}}),Chorus.Comments.Views.Header=Backbone.View.extend({className:"comments-header ui-state-unloaded",templateId:"comments-header-template",events:{"click .show_comments_link":"loadComments","click .tips_link":"toggleTips","click .auto_update_alert_toggle":"toggleAutoUpdateAlert","click .touch_tools_toggle":"toggleTouchTools"},initialize:function(){this.listenTo(Chorus.Comments,"start",this.showLoadingIndicator),this.listenTo(this.collection,"loadSuccess",this.hideLoadingIndicator),this.listenTo(this.collection,"loadError",this.showLoadError),this.listenTo(this.collection,"loadSuccess",this.render),this.listenTo(this.collection,"updateSuccess",this.updateCount)},render:function(){return this.$el.html(this.template({context:Chorus.Comments.context,settings:Chorus.Comments.settings})),this.trigger("render",this),this},loadComments:function(){return Chorus.Comments.start(),!1},toggleTips:function(){return this.$el.toggleClass("ui-state-tips-active"),!1},showLoadError:function(){this.$el.removeClass("ui-state-loaded").removeClass("ui-state-unloaded").removeClass("ui-state-loading").addClass("ui-state-load-error")},showLoadingIndicator:function(){this.$el.removeClass("ui-state-loaded").removeClass("ui-state-unloaded").removeClass("ui-state-load-error").addClass("ui-state-loading")},hideLoadingIndicator:function(){this.$el.removeClass("ui-state-unloaded").removeClass("ui-state-loading").removeClass("ui-state-load-error").addClass("ui-state-loaded")},updateCount:function(){this.$(".count").text(this.collection.length)},toggleAutoUpdateAlert:function(){var e=!Chorus.Comments.settings.showAutoUpdateAlert;return Chorus.Comments.settings.showAutoUpdateAlert=e,this.$(".auto_update_alert_toggle").text(e?"Hide it!":"Show it!"),!1},toggleTouchTools:function(){return Chorus.Comments.view.touchTools&&Chorus.Comments.view.touchTools.toggle(),!1}}),Chorus.Comments.Views.InspectFlagsDialog=Backbone.View.extend({templateId:"comment-inspect-flags-dialog-template",render:function(){if(!this.model.flaggingsLoaded)return this.model.once("loadFlaggingsSuccess",this.render,this),this.model.loadFlaggings(),this;var e=this.template({comment:this.model.toJSON(),flaggings:_.invoke(this.model.flaggings(),"toJSON")});return Chorus.Comments.openModal(e),this.setElement("#inspect_flags_modal"),this.trigger("render",this),this}}),Chorus.Comments.Views.MainForm=Chorus.Comments.Views.BaseForm.extend({id:"main_comment_form",className:"cform cform-main",templateId:"comment-main-form-template",submitText:"Post",events:function(){var e=_.clone(Chorus.Comments.Views.BaseForm.prototype.events);return e["click #formatting_guide_links a"]="toggleFormattingGuide",e},render:function(){this.$el.html(this.template({context:Chorus.Comments.context})),this.$("textarea").markItUp(Chorus.Comments.settings.markItUp);var e=new Chorus.Comments.Views.FormattingGuide;return e.render().$el.appendTo(this.el),this.trigger("render",this),this},cancel:function(){return this.previewView&&(this.previewView.remove(),this.previewView=null),this.$(".preview-controls").hide(),this.$(".post_comment_button").prop("disabled",!1).val("Post"),this.$(".preview_comment_button").prop("disabled",!1).val("Preview"),this.$("form").get(0).reset(),this.trigger("cancel"),!1},toggleFormattingGuide:function(e){return jQuery(e.target).hide().siblings().show(),jQuery("#comment_formatting_guide").slideToggle(),!1}}),Chorus.Comments.Views.Main=Backbone.View.extend({events:{"click .spoiler":"toggleSpoiler"},initialize:function(){var e=Chorus.Comments.Views;this.header=new e.Header({collection:this.collection}),this.commentList=new e.CommentList({collection:this.collection}),this.footer=new e.Footer,Chorus.Comments.settings.startOnScroll&&this.pollScrollPosition(),this.listenTo(this.collection,"loadSuccess",this.renderWithContext),this.listenTo(this.collection,"loadError",this.renderError)},render:function(){return this.$el.append(this.header.render().el,this.commentList.render().el),this.trigger("render",this),this},remove:function(){return this.header.remove(),this.commentList.remove(),this.footer.remove(),this.mainForm&&this.mainForm.remove(),this.touchTools&&this.touchTools.remove(),this.autoUpdateAlert&&this.autoUpdateAlert.remove(),this.$el.remove(),this},renderWithContext:function(){var e=Chorus.Comments.Views,t=Chorus.Comments.context,n=Chorus.Comments.settings,o=!1;t.comments_closed?(this.mainForm=new e.CommentsClosedNotice,o=!0):t.able_to_comment?this.mainForm=new e.MainForm({collection:this.collection}):(this.mainForm=new Backbone.View,o=!0);var i=new e.AccountActions;return this.$el.append(i.render().el,this.mainForm.render().el,this.footer.render().el),o&&!_.isUndefined(Chorus.Auth)&&Chorus.Auth.init(),t.able_to_comment&&Chorus.Environment.touch()&&(this.touchTools=new e.TouchTools({collection:this.collection}),this.touchTools.render().$el.appendTo(this.el)),n.autoUpdateEnabled&&n.showAutoUpdateAlert&&(this.autoUpdateAlert=new e.AutoUpdateAlert({collection:this.collection}),this.autoUpdateAlert.render().$el.appendTo(this.el)),this.trigger("render",this),this},renderError:function(){this.$el.append('<h2 class="comments-load-error-msg">There was an error loading the comments. Please try again later</h2>')},pollScrollPosition:function(){var e=this.$el,t=jQuery(window),n=Chorus.Comments.settings.scrollBuffer,o=function(){e.offset().top-t.scrollTop()-t.height()-n<0&&Chorus.Comments.start()};o=_.throttle(o,200),o(),t.on("scroll",o),Chorus.Comments.once("start",function(){t.off("scroll",o)})},toggleSpoiler:function(e){return jQuery(e.target).toggleClass("reveal_spoiler"),!1}}),Chorus.Comments.Views.ReplyForm=Chorus.Comments.Views.BaseForm.extend({className:"cform",templateId:"comment-reply-form-template",submitText:"Reply",renderTo:function(e){return this.$el.html(this.template({context:Chorus.Comments.context,comment:this.model.toJSON()})),this.$("textarea").markItUp(Chorus.Comments.settings.markItUp),this.$el.appendTo(e),this.$("[autofocus]:first").focus(),this.trigger("render",this),this},cancel:function(){return this.remove(),this.trigger("cancel"),!1}}),Chorus.Comments.Views.TouchTools=Backbone.View.extend({id:"comment_touch_tools",templateId:"comment-touch-tools-template",events:{"click .close":"toggle","click .refresh":"refresh","click .next":"activateNext","click .mark":"markAllRead"},initialize:function(){this.listenTo(this.collection,"updateSuccess updateError",this.stopLoading)},render:function(){return this.$el.html(this.template()),this.trigger("render",this),this},toggle:function(){return this.$el.toggle(),!1},refresh:function(){return this.$el.addClass("loading"),this.collection.update(),!1},stopLoading:function(){this.$el.removeClass("loading")},activateNext:function(){return Chorus.Comments.view.commentList.markReadAndActivateNext(),!1},markAllRead:function(){return Chorus.Comments.view.commentList.markAllRead(),!1},show:function(){return this.$el.show(),!1},hide:function(){return this.$el.hide(),!1}});var Chorus=Chorus||{};Chorus.RemoteEntryAdminPermissions=function(e){"use strict";function t(){var t=e(a).map(function(t,n){return e(n).data(r)});t=_.uniq(_.compact(t)).sort(),t.length&&e.ajax({method:"GET",url:s,dataType:"json",data:{entry_ids:t.join(":")},success:n,error:o})}function n(e){i=_.extend(i,{loaded:!0},e),Chorus.EventDispatcher.publish("permissionsLoaded",_.clone(i),!0)}function o(){console&&console.error("there was an error loading the permissions object from the client controls")}var i={loaded:!1},r="remote-admin-entry-id",s="/remote_entry_admin/check_permissions",a="*[data-"+r+"]";return{init:function(){Chorus.Context.logged_in!==!1&&t()},getPermissions:function(){return i}}}(jQuery),jQuery(Chorus.RemoteEntryAdminPermissions.init);var Chorus=Chorus||{};Chorus.EntryAdminControls=function(e){"use strict";function t(t){e(f).each(function(n,o){var i=e(o),r=i.data(m),s=t[r];if(s&&s.permitted===!0){var a=i.data(p);"button"===a&&(i.append(b(s)),i.on("click",l)),"pane"===a&&i.load(g,{entry_id:r},function(){i.on("mouseenter",c),i.on("mouseleave",u)})}}),e("body").on("click","#inspect-images-link",d),e("body").on("click","#hide-entry-link",h)}function n(e){Chorus.EventDispatcher.publish("modal_open",{url:v,data:{entry_id:e}})}function o(e){return"*[data-"+m+'="'+e+'"][data-'+p+'="pane"]'}function i(t){e(o(t)).addClass("is-active")}function r(t){e(o(t)).removeClass("is-active")}function s(t){var n="Hidden"===t.text();t.text(n?"Unhiding":"Hiding"),e.ajax({method:"POST",url:t.attr("href"),dataType:"text",complete:function(){location.reload(!0)}})}function a(e){t(e)}function l(t){if(Util.UserAgentProfiler.isMobile()===!1){var i=e(t.delegateTarget).data(m);e(o(i)).length<1&&(t.preventDefault(),n(i))}}function c(t){i(e(t.delegateTarget).data(m))}function u(t){r(e(t.delegateTarget).data(m))}function d(t){t.preventDefault(),Chorus.EventDispatcher.publish("modal_open",{url:C+"/"+e(t.target).data(m)})}function h(t){t.preventDefault(),s(e(t.target))}var m="remote-admin-entry-id",p="remote-admin-entry-type",f="*[data-"+p+"]",g="/remote_entry_admin/pane",v="/remote_entry_admin/actions_modal",C="/remote_entry_admin/image_sizes_modal",b=_.template('<a href="[%= data.edit_url%]">Edit Entry</a>');return{init:function(){Chorus.Context.logged_in!==!1&&Chorus.EventDispatcher.subscribe("permissionsLoaded",a)}}}(jQuery),jQuery(Chorus.EntryAdminControls.init);var Chorus=Chorus||{};Chorus.RemoteHeadlineEdit=function(e){"use strict";function t(t){var n=t.data("remote-headline-promo-headine"),o=e(b({current_headline:t.text(),headline_save_url:v,field:t.data(f),entry_id:t.data(p),include_buttons:n?!1:!0}));if(t.after(o),t.addClass("is-editing"),o.on("change",'input[type="text"]',h),o.on("click",'input[type="submit"]',d),o.on("click",'input[value="cancel"]',u),o.on("submit",function(e){e.preventDefault()}),n){var i=e(b({current_headline:n,headline_save_url:v,field:g,entry_id:t.data(p),include_buttons:!0}));o.after(i),i.on("change",'input[type="text"]',h),i.on("click",'input[type="submit"]',d),i.on("click",'input[value="cancel"]',u),i.on("submit",function(e){e.preventDefault()})}}function n(t,n){return n===g&&(n="title"),e("*[data-"+f+'="'+n+'"][data-'+p+'="'+t+'"]')}function o(e){n(e.data(p),e.data(f)).removeClass("is-editing"),e.siblings(".m-inline-headline-edit__form").remove(),e.remove()}function i(e){e.find('input[type="text"], input[type="submit"]').prop("disabled",!0)}function r(e){e.find('input[type="text"], input[type="submit"]').prop("disabled",!1)}function s(e){e.data("remote-headline-edit-submit",!0)}function a(t){t.add(t.siblings(".m-inline-headline-edit__form")).each(function(t,s){var a=e(s);if(a.data("remote-headline-edit-submit")===!0){var l=a.find('input[name="entry_id"]').val(),c=a.find('input[name="new_value"]').val(),u=a.find('input[name="field"]').val();i(a),e.ajax({method:"POST",url:v,dataType:"json",data:{entry_id:l,field:u,value:c},success:function(e){u===g?n(l,"title").data("remote-headline-promo-headine",c):n(l,u).text(c),o(a),alert(Util.stringToTitleCase(u.replace(/_/g," "))+" saved!")},error:function(e,t){r(a),alert("There was an error recieving data from the server.")}})}})}function l(t){e("*[data-"+f+"]").each(function(n,o){var i=e(o),r=t[i.data(p)];r&&r.permitted===!0&&(i.addClass("is-editable"),i.on("click",c))})}function c(n){n.preventDefault();var o=e(n.delegateTarget);o.hasClass("is-editing")===!1&&t(o)}function u(t){t.preventDefault(),o(e(t.delegateTarget))}function d(t){t.preventDefault(),a(e(t.delegateTarget))}function h(t){s(e(t.delegateTarget))}function m(e){e.is_headline_editor===!0&&l(e)}var p="remote-admin-entry-id",f="remote-headline-edit",g="promo_headline_field",v="/remote_entry_admin/update_title",C=['<form action="[%= data.headline_save_url %]" data-'+p+'="[%= data.entry_id %]" data-'+f+'= "[%= data.field %]" method="post" class="m-inline-headline-edit__form">','<label for="new_value">[%= data.field.replace(/_/g, " ")  %]</label>','<input type="text" name="new_value" value="[%= data.current_headline %]" />','<input type="hidden" name="entry_id" value="[%= data.entry_id %]" />','<input type="hidden" name="field" value="[%= data.field %]" />','[% if (data.include_buttons === true) { %]<input type="submit" value="Save" class="p-button"/>','<input type="button" value="cancel" class="p-button" /> [% } %]',"</form>"].join(""),b=_.template(C);return{init:function(){Chorus.Context.logged_in!==!1&&Util.UserAgentProfiler.isMobile()!==!0&&Chorus.EventDispatcher.subscribe("permissionsLoaded",m)}}}(jQuery),jQuery(Chorus.RemoteHeadlineEdit.init);var Chorus=Chorus||{};Chorus.HubAdminMenu=function(e){"use strict";function t(){o.on("click",function(){o.toggleClass("is-open")}),n()}function n(){o.on("mouseenter",function(){if(!i){i=!0;var t=o.find(".m-quick_admin__pageviews");if(0!==t.length){var n=t.find(".m-quick_admin__pageviews-count"),r=window.location.hostname+window.location.pathname;e.ajax({method:"GET",dataType:"json",url:"http://providence.voxmedia.com/api/count.json",data:{event_name:"page_view",location:r},success:function(e){n.html(Number(e.count).toLocaleString()+" "+n.html()),t.show()}})}}})}var o=e("#hub-admin-menu"),i=!1;return{init:function(){t()}}}(jQuery),jQuery(Chorus.HubAdminMenu.init);var Util=Util||{};Util.UserAgentProfiler=function(){var e="ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch||navigator.msMaxTouchPoints>0,t=window.innerWidth,n=window.navigator.userAgent,o=e&&728>t||window.location.href.indexOf("mobile=true")>0,i=e&&t>=728,r=!o&&!i,s=/(iPad|iPhone|iPod)/g.test(n),a=s&&/OS\s(7|6_1_4)/g.test(n),l=/Android/g.test(n),c=!1,u=o?"mobile":i?"tablet":"desktop";if(n.indexOf("Android")>0)for(var d=n.split(";"),h=0,m=d.length;m>h;h++)if(d[h].indexOf("Android")>0){var p=d[h].split(" ");if(parseInt(p[p.length-1].split(".")[0])<3){c=!0;break}}return{screenWidth:function(){return t},profile:function(){return u},isTablet:function(){return i},isMobile:function(){return o},isDesktop:function(){return r},isAndroid:function(){return l},isAndroidLt3:function(){return c},isIOS:function(){return s},isIOS7:function(){return a},deviceTypeForAds:function(){return this.profile()},browserWidthForAds:function(){return Chorus.Environment.currentBreakpoint().name},doNotTrack:function(){var e;if(void 0!==navigator.doNotTrack)e=navigator.doNotTrack;else if(void 0!==window.doNotTrack)e=window.doNotTrack;else{if(void 0===navigator.msDoNotTrack)return"unsupported";e=navigator.msDoNotTrack}return/1|yes|true/.test(e)?"1":"0"}}}();var Kicksend={mailcheck:{threshold:3,defaultDomains:"yahoo.com google.com hotmail.com gmail.com me.com aol.com mac.com live.com comcast.net googlemail.com msn.com hotmail.co.uk yahoo.co.uk facebook.com verizon.net sbcglobal.net att.net gmx.com mail.com".split(" "),defaultTopLevelDomains:"co.uk com net org info edu gov mil".split(" "),run:function(e){e.domains=e.domains||Kicksend.mailcheck.defaultDomains,e.topLevelDomains=e.topLevelDomains||Kicksend.mailcheck.defaultTopLevelDomains,e.distanceFunction=e.distanceFunction||Kicksend.sift3Distance;var t=Kicksend.mailcheck.suggest(encodeURI(e.email),e.domains,e.topLevelDomains,e.distanceFunction);t?e.suggested&&e.suggested(t):e.empty&&e.empty()},suggest:function(e,t,n,o){if(e=e.toLowerCase(),e=this.splitEmail(e),t=this.findClosestDomain(e.domain,t,o)){if(t!=e.domain)return{address:e.address,domain:t,full:e.address+"@"+t}}else if(n=this.findClosestDomain(e.topLevelDomain,n),e.domain&&n&&n!=e.topLevelDomain)return t=e.domain,t=t.substring(0,t.lastIndexOf(e.topLevelDomain))+n,{address:e.address,domain:t,full:e.address+"@"+t};return!1},findClosestDomain:function(e,t,n){var o,i=99,r=null;if(!e||!t)return!1;n||(n=this.sift3Distance);for(var s=0;s<t.length;s++){if(e===t[s])return e;o=n(e,t[s]),i>o&&(i=o,r=t[s])}return i<=this.threshold&&null!==r?r:!1},sift3Distance:function(e,t){if(null==e||0===e.length)return null==t||0===t.length?0:t.length;if(null==t||0===t.length)return e.length;for(var n=0,o=0,i=0,r=0;n+o<e.length&&n+i<t.length;){if(e.charAt(n+o)==t.charAt(n+i))r++;else for(var s=i=o=0;5>s;s++){if(n+s<e.length&&e.charAt(n+s)==t.charAt(n)){o=s;break}if(n+s<t.length&&e.charAt(n)==t.charAt(n+s)){i=s;break}}n++}return(e.length+t.length)/2-r},splitEmail:function(e){if(e=e.split("@"),2>e.length)return!1;for(var t=0;t<e.length;t++)if(""===e[t])return!1;var n=e.pop(),o=n.split("."),i="";if(0==o.length)return!1;if(1==o.length)i=o[0];else{for(t=1;t<o.length;t++)i+=o[t]+".";2<=o.length&&(i=i.substring(0,i.length-1))}return{topLevelDomain:i,domain:n,address:e.join("@")}}}};window.jQuery&&function(e){e.fn.mailcheck=function(e){var t=this;if(e.suggested){var n=e.suggested;e.suggested=function(e){n(t,e)}}if(e.empty){var o=e.empty;e.empty=function(){o.call(null,t)}}e.email=this.val(),Kicksend.mailcheck.run(e)}}(jQuery);var Chorus=Chorus||{};Chorus.Auth=function(e){return{config:function(t){this.element={wrapper:e(".m-auth-modal__wrapper"),modal:e(".m-auth-modal"),close:e(".m-auth-modal__close"),body:e(".m-auth-modal__body"),form:e(".m-auth-modal__form"),loginTable:e(".m-auth-modal__login-table"),loadingMsg:e("#chorus-auth-loading-message")},this.authTriggers={data:e("[data-chorus-auth]"),goTo:e("[data-chorus-auth-goto]"),auto:e("[data-chorus-auth-auto]"),facebook:e('[data-chorus-auth-login="facebook"]'),openId:e('[data-chorus-auth-login="openid"]'),twitter:e('[data-chorus-auth-login="twitter"]'),yahoo:e('[data-chorus-auth-login="yahoo"]'),password:e("#chorus-auth-password")},this.globals={serializedForm:"",bindOnceExecuted:!1,dispatcherDefined:!!Chorus&&!!Chorus.EventDispatcher},this.openModalClass="-has-open-auth-modal",this.networkUrl=this.element.modal.data("chorus-auth-network-url"),Chorus.Auth.helpers.noCorsSupport()&&(this.networkUrl=Chorus.Auth.helpers.httpNetworkUrl()),t()},defaultAjaxOptions:{xhrFields:{withCredentials:!0}},init:function(){this.config(function(){Chorus.Auth.networkUrl&&(window.addEventListener&&window.addEventListener("message",function(e){var t=Chorus.Auth.helpers.httpNetworkUrl();if(e.origin===t&&"function"==typeof e.data.trim&&"{"===e.data.trim()[0]){var n=JSON.parse(e.data);n.is_from_chorus_auth&&Chorus.Auth.actions.callbacks.chorusAuth(n)}},!1),Chorus.Auth.events.bindOnce(),Chorus.Auth.helpers.placeholderPolyfill(),Chorus.Auth.helpers.checkForAutoLoad())})},events:{bindOnce:function(){Chorus.Auth.globals.bindOnceExecuted===!1&&(Util.UserAgentProfiler.isMobile()||Chorus.Auth.authTriggers.data.on("click",Chorus.Auth.modal.open),Chorus.Auth.globals.dispatcherDefined&&Chorus.EventDispatcher.subscribe("modal_closed_by_modaljs",Chorus.Auth.modal.forceClose),Chorus.Auth.globals.bindOnceExecuted=!0)},bind:function(){Chorus.Auth.authTriggers.goTo.on("click",Chorus.Auth.modal.goTo),Chorus.Auth.element.wrapper.on("click",Chorus.Auth.modal.close),Chorus.Auth.element.modal.find(Chorus.Auth.element.close).on("click",Chorus.Auth.modal.close),Chorus.Auth.authTriggers.password.on("submit",Chorus.Auth.actions.login.password);var e=Chorus.Auth.modal.goTo("login",!0);e.find('[name="username"]').on("change",Chorus.Auth.actions.validate.at_sign);var t=Chorus.Auth.modal.goTo("rec-migrate",!0);t.find("#rec-migrate-already").on("click",function(e){e.preventDefault(),Chorus.Auth.modal.goTo("rec-migrate-login")}),t.find("form").on("submit",Chorus.Auth.actions.form.startSubmission),t.find('[name="user[username]"]').on("focus blur",Chorus.Auth.actions.validate.username),t.find('[name="user[password]"]').on("blur",Chorus.Auth.actions.validate.password);var n=Chorus.Auth.modal.goTo("rec-migrate-login",!0);n.find("form").on("submit",Chorus.Auth.actions.form.startSubmission);var o=Chorus.Auth.modal.goTo("forgot",!0);o.find("form").on("submit",Chorus.Auth.actions.form.startSubmission);var i=Chorus.Auth.modal.goTo("forgot-username",!0);i.find("form").on("submit",Chorus.Auth.actions.form.startSubmission),Chorus.Auth.authTriggers.facebook.on("click",function(e){Chorus.Auth.actions.login.facebook(e)}),Chorus.Auth.authTriggers.twitter.on("click",function(e){Chorus.Auth.actions.login.twitter(e)}),Chorus.Auth.authTriggers.yahoo.on("click",function(e){Chorus.Auth.actions.login.yahoo(e)}),Chorus.Auth.authTriggers.openId.on("click",function(e){Chorus.Auth.actions.showOpenIdForm(e)}),Chorus.Auth.element.form.filter(".openid").on("submit",function(e){Chorus.Auth.actions.login.openId(e)});for(var r=["join","register-join"],s=0;s<r.length;s++){var a=Chorus.Auth.modal.goTo(r[s],!0);a.find('input[type="checkbox"]').on("change",Chorus.Auth.actions.validate.checkboxEnablesForm),a.find("form").on("submit",Chorus.Auth.actions.form.startSubmission)}Chorus.Auth.modal.goTo("umbel-permissions",!0).find("form").on("submit",Chorus.Auth.actions.form.startSubmission);var l=Chorus.Auth.modal.goTo("third-party-register",!0);l.find('[name="user[username]"]').on("focus",Chorus.Auth.actions.validate.validationEnablesForm),l.find('[name="user[username]"]').on("focus blur",Chorus.Auth.actions.validate.username),l.find("form").on("submit",Chorus.Auth.actions.form.startSubmission),Chorus.Auth.modal.goTo("captcha",!0).find("form").on("submit",Chorus.Auth.actions.form.startSubmission);var c=Chorus.Auth.modal.goTo("register",!0);c.find('[name="user[username]"]').on("blur",Chorus.Auth.actions.validate.username),c.find('[name="user[password]"]').on("blur",Chorus.Auth.actions.validate.password),c.find('[name="user[email]"]').on("blur",Chorus.Auth.actions.validate.email),c.find('[name="user[email]"]').on("blur",Chorus.Auth.actions.validate.suggestEmail),c.find("form").on("submit",Chorus.Auth.actions.form.startSubmission)}},actions:{validate:{email:function(e){var t=Chorus.Auth.actions.validate.getInputContext(e);t.errorId="email",_.isEmpty(t.value)?(t.status.removeClass("error success"),Chorus.Auth.actions.validate.errors.clear(t)):Chorus.Auth.actions.validate.testAgainstJSON("email_valid",{email:t.value},t)},suggestEmail:function(t){var n=Chorus.Auth.actions.validate.getInputContext(t);n.errorId="suggest-email",e(n.input).mailcheck({suggested:function(e,t){Chorus.Auth.actions.validate.errors.show(n,"Did you mean "+t.full+"?")},empty:function(e){Chorus.Auth.actions.validate.errors.clear(n)}})},at_sign:function(t){var n=Chorus.Auth.actions.validate.getInputContext(t);-1===n.value.indexOf("@")?e(".username-at-sign-warning").hide():e(".username-at-sign-warning").show()},username:function(e){var t=Chorus.Auth.actions.validate.getInputContext(e);t.errorId="username",_.isEmpty(t.value)||t.value==t.input.attr("placeholder")?t.status.removeClass("error success"):Chorus.Auth.actions.validate.testAgainstJSON("username_available",{username:t.value},t)},password:function(e){var t=Chorus.Auth.actions.validate.getInputContext(e);if(t.errorId="password",_.isEmpty(t.value))t.status.removeClass("error success");else{var n=t.value.length>=6&&t.value.match(/\d/)&&t.value.match(/\d/).length&&t.value.match(/[a-z]/i)&&t.value.match(/[a-z]/i).length?!0:!1;Chorus.Auth.actions.validate.addCheckOrX(n,t)}},checkboxEnablesForm:function(e){var t=Chorus.Auth.actions.validate.getInputContext(e);t.errorId="checkbox";var n=t.modalObj.find('[type="submit"]');t.input.is(":checked")?n.removeAttr("disabled"):n.attr("disabled",!0)},getInputContext:function(t){var n=e(t.target),o=n.parents(Chorus.Auth.element.body.selector),i={input:n,status:n.parent(),value:n.val(),modal:o.data("chorus-auth-modal"),modalObj:o,errorMsg:n.data("error-msg"),errorEl:n.parent().find("h6")};return i},testAgainstJSON:function(t,n,o){e.getJSON(Chorus.Auth.networkUrl+"/chorus_auth/"+t+".json?callback=?",n).success(function(e){Chorus.Auth.actions.validate.addCheckOrX(e,o)})},addCheckOrX:function(e,t){e.available||_.isBoolean(e)&&e?(t.status.addClass("success"),t.status.removeClass("error"),Chorus.Auth.actions.validate.errors.clear(t)):(t.status.addClass("error"),t.status.removeClass("success"),_.isUndefined(e.message)?Chorus.Auth.actions.validate.errors.show(t):Chorus.Auth.actions.validate.errors.show(t,e.message))},isFormValid:function(t){var n=e(t.target),o=n.find("fieldset").filter("[data-chorus-auth-validate]").length,i=n.find("fieldset").filter("[data-chorus-auth-validate].success").length;return o===i},errors:{show:function(t,n){var o=_.isUndefined(n)?t.errorMsg:n;t.status.find("#"+t.errorId).length||(e("<h6/>").appendTo(t.status).attr("id",t.errorId).text(o),t.status.hasClass("error")||(t.status.addClass("error"),t.status.removeClass("success")))},clear:function(e){e.status.find("#"+e.errorId).remove()}}},form:{startSubmission:function(t){var n=e(t.target).parents(Chorus.Auth.element.body.selector);switch(n.data("chorus-auth-modal")){case"forgot":Chorus.Auth.modal.spinner("Sending...");var o=e(t.target).find("[name='email']").val();e.ajax(_.extend({type:"post",url:Chorus.Auth.networkUrl+"/chorus_auth/request_password_reset.json",data:{email:o},dataType:"json",success:function(e){var t=Chorus.Auth.modal.goTo("forgot-result",!0);t.find("p.error").text(""),t.find("p.success").text(e.message),"success"===e.message_type&&(t.find('[ data-chorus-auth-goto="forgot"]').hide(),t.find(".third-party").hide()),Chorus.Auth.modal.goTo("forgot-result")},error:function(e,t,n){var o=(JSON.parse(e.responseText),Chorus.Auth.modal.goTo("forgot-result",!0));o.find("p.success").text(""),o.find("p.error").text(data.message),Chorus.Auth.modal.goTo("forgot-result")}},Chorus.Auth.defaultAjaxOptions));break;case"forgot-username":Chorus.Auth.modal.spinner("Sending...");var o=e(t.target).find("[name='email']").val();e.ajax(_.extend({type:"post",url:Chorus.Auth.networkUrl+"/chorus_auth/request_username_retrieval.json",data:{email:o},dataType:"json",success:function(e){var t=Chorus.Auth.modal.goTo("forgot-username-result",!0);t.find("p.error").text(""),t.find("p.success").text(e.message),"success"===e.message_type&&(t.find('[ data-chorus-auth-goto="forgot-username"]').hide(),t.find(".third-party").hide()),Chorus.Auth.modal.goTo("forgot-username-result")},error:function(e,t,n){var o=(JSON.parse(e.responseText),Chorus.Auth.modal.goTo("forgot-username-result",!0));o.find("p.success").text(""),o.find("p.error").text(data.message),Chorus.Auth.modal.goTo("forgot-username-result")}},Chorus.Auth.defaultAjaxOptions));break;case"join":Chorus.Auth.actions.form.submitJoin();break;case"register-join":Chorus.Auth.isCaptchaRequired?Chorus.Auth.modal.goTo("captcha"):Chorus.Auth.actions.form.completeSubmission();break;case"umbel-permissions":Chorus.Auth.actions.form.serialize(t.target),Chorus.Auth.modal.goTo("third-party-register");break;case"rec-migrate":Chorus.Auth.actions.validate.isFormValid(t)&&(Chorus.Auth.actions.form.serialize(t.target),Chorus.Auth.isCaptchaRequired=!1,Chorus.Auth.modal.goTo("register-join",!0).length?Chorus.Auth.modal.goTo("register-join"):Chorus.Auth.actions.form.completeSubmission());break;case"rec-migrate-login":t.preventDefault(),Chorus.Auth.actions.form.serialize(t.target),
Chorus.Auth.actions.login.recLinkChorus(t);break;case"third-party-register":Chorus.Auth.actions.validate.isFormValid(t)&&(Chorus.Auth.actions.form.serialize(t.target),Chorus.Auth.isCaptchaRequired=!1,Chorus.Auth.modal.goTo("register-join",!0).length?Chorus.Auth.modal.goTo("register-join"):Chorus.Auth.actions.form.completeSubmission());break;case"captcha":Chorus.Auth.actions.form.serialize(t.target),Chorus.Auth.actions.form.completeSubmission(Chorus.Auth.actions.captcha.error);break;case"register":if(Chorus.Auth.actions.validate.isFormValid(t)){Chorus.Auth.provider="password",Chorus.Auth.actions.form.serialize(t.target),Chorus.Auth.actions.captcha.init("chorus-auth-register-recaptcha");var i=e(t.target).find("[name='user[username]']").val();Chorus.Auth.modal.goTo("captcha",!0).find("span.username").text(i),Chorus.Auth.isCaptchaRequired=!0,Chorus.Auth.modal.goTo("register-join",!0).length?Chorus.Auth.modal.goTo("register-join"):Chorus.Auth.modal.goTo("captcha")}}t.preventDefault()},completeSubmission:function(t){return e.ajax(_.extend({type:"post",url:Chorus.Auth.networkUrl+"/chorus_auth/register.json",data:Chorus.Auth.globals.serializedForm,dataType:"json",success:function(e){Chorus.Auth.actions.login.completeLogin("Register")},error:function(e,n,o){var i=JSON.parse(e.responseText);t(i.message)}},Chorus.Auth.defaultAjaxOptions)),Chorus.Auth.modal.spinner("Registering"),!1},submitJoin:function(){var t=Chorus.Auth.networkUrl+"/chorus_auth/join_community.json";return Chorus.Context.community_id&&(t=t+"?community_id="+Chorus.Context.community_id),e.ajax(_.extend({type:"post",url:t,dataType:"json",success:function(e){window.location.reload()},error:function(e,t,n){var o=JSON.parse(e.responseText);console.log(o.message)}},Chorus.Auth.defaultAjaxOptions)),Chorus.Auth.modal.spinner("Registering"),!1},serialize:function(t){_.isEmpty(Chorus.Auth.globals.serializedForm)||(Chorus.Auth.globals.serializedForm+="&"),Chorus.Auth.globals.serializedForm+=e(t).serialize()}},captcha:{init:function(t){e(".m-auth-modal__captcha-container").html(""),e.ajax(_.extend({dataType:"html",url:Chorus.Auth.networkUrl+"/chorus_auth/recaptcha",success:function(n){e("#"+t).html(n),e.getScript("http://www.google.com/recaptcha/api/js/recaptcha_ajax.js",function(){Recaptcha.destroy(),Recaptcha.create("6LcgS98SAAAAAJLeEKGYuZxRROAovJl-ltyOgAC4",t,{theme:"custom"});var n=setInterval(function(){e(".m-auth-modal__recaptcha #recaptcha_image img").length&&(e(".m-auth-modal__recaptcha #recaptcha_image").removeAttr("style").find("img").removeAttr("width height"),clearInterval(n))},500)})}},Chorus.Auth.defaultAjaxOptions))},error:function(e){Recaptcha.reload(),Chorus.Auth.modal.goTo("captcha",!0).find("p.error").text(e),Chorus.Auth.modal.goTo("captcha")}},callbacks:{thirdParty:function(e,t,n){var o=Chorus.Auth.modal.goTo("third-party-register",!0);if(!_.isUndefined(t)){var i=o.find('[name="user[username]"]');i.val(t),i.focus()}_.isUndefined(n)||o.find(".m-auth-modal__avatar").attr("src",n)},chorusAuth:function(e){if(e.logged_in)Chorus.Auth.actions.login.completeLogin("Login");else if(_.isUndefined(e.error))Chorus.Auth.actions.callbacks.thirdParty(e.provider,e.username,e.profile_image_url),"facebook"===e.provider?Chorus.Auth.modal.goTo("umbel-permissions"):Chorus.Auth.modal.goTo("third-party-register");else{var t=Chorus.Auth.modal.goTo("register",!0);t.find("p.error").text(e.error),Chorus.Auth.modal.goTo("register")}}},login:{yahoo:function(e){Chorus.Auth.actions.openAuthWindow(Chorus.Auth.networkUrl+"/chorus_auth/initiate_yahoo_auth"),Chorus.Auth.provider="yahoo",e.preventDefault()},openId:function(t){var n=e(t.target).find("[name='openid']").val();Chorus.Auth.actions.openAuthWindow(Chorus.Auth.networkUrl+"/chorus_auth/initiate_openid_auth?openid_url="+n),Chorus.Auth.provider="open_id",t.preventDefault()},twitter:function(e){var t=Chorus.Auth.networkUrl+"/chorus_auth/initiate_twitter_auth";Chorus.Auth.actions.openAuthWindow(t),Chorus.Auth.provider="twitter",e.preventDefault()},facebook:function(e){Chorus.Auth.actions.openAuthWindow(Chorus.Auth.networkUrl+"/chorus_auth/initiate_facebook_auth"),Chorus.Auth.provider="facebook",e.preventDefault()},gplus:function(t){Chorus.Auth.provider="google_plus",t.code&&t["g-oauth-window"]&&(Chorus.Auth.modal.spinner("Authenticating"),e.ajax(_.extend({type:"POST",url:Chorus.Auth.networkUrl+"/chorus_auth/finalize_google_plus_auth.json?",data:{code:t.code},success:function(e){Chorus.Auth.actions.callbacks.chorusAuth(e)},dataType:"json"},Chorus.Auth.defaultAjaxOptions)))},recLinkChorus:function(t){var n=e(t.target);return e.ajax(_.extend({type:"post",url:Chorus.Auth.networkUrl+"/chorus_auth/rec_link_chorus.json",data:Chorus.Auth.globals.serializedForm,dataType:"json",success:function(e){e.logged_in?Chorus.Auth.actions.login.completeLogin("Login"):("undefined"!=typeof e.message&&n.find("p.error").text(e.message),Chorus.Auth.modal.goTo("rec-migrate-login"))},error:function(e,t,n){JSON.parse(e.responseText)}},Chorus.Auth.defaultAjaxOptions)),Chorus.Auth.modal.spinner("Registering"),!1},password:function(t){var n=e(t.target),o=function(e){if(Chorus.Auth.provider="password",e.logged_in)Chorus.Auth.actions.login.completeLogin("Login");else{if("undefined"!=typeof e.next_action)return void Chorus.Auth.modal.goTo(e.next_action);e.captcha_required&&Chorus.Auth.actions.captcha.init("chorus-auth-login-recaptcha"),"undefined"!=typeof e.message&&n.find("p.error").text(e.message),Chorus.Auth.modal.goTo("login")}};e.ajax(_.extend({type:"POST",url:Chorus.Auth.networkUrl+"/chorus_auth/initiate_password_auth.json",data:n.serialize(),success:o,dataType:"json"},Chorus.Auth.defaultAjaxOptions)),Chorus.Auth.modal.spinner("Logging in..."),Chorus.DynamicSizedImages.applyTo(".m-auth-modal"),t.preventDefault()},completeLogin:function(e){setTimeout(function(){window.location.reload()},100)}},openAuthWindow:function(e){Chorus.Auth.modal.spinner("Authenticating");var t=window.open(e,"_blank","height=450,width=800,menubar=yes,status=yes,scrollbars=yes,resizable=yes,titlebar=yes,toolbar=no,menubar=yes,location=yes");t||alert("welp, window blocked")},resetLoginOptions:function(){Chorus.Auth.element.loginTable.each(function(){e(this).find("tr").not(":first").addClass("other")}),Chorus.Auth.element.form.filter(".openid").hide()},showOpenIdForm:function(t){var n=e(t.target),o=n.parents(Chorus.Auth.element.body.selector);o.find(Chorus.Auth.element.form).filter(".openid").toggle(),t.preventDefault()}},modal:{open:function(t){var n=_.isObject(t)?e(this).data("chorus-auth"):t;if(Chorus.Auth.helpers.noCorsSupport()&&Chorus.Auth.helpers.notOnNetworkDomain()){var o=Chorus.Auth.helpers.httpNetworkUrl(),i=window.location.href.split("?")[0];window.location.href=o+"/login?return_to="+i}else Chorus.Auth.element.modal.find('[data-chorus-auth-modal="'+n+'"]').show(),Chorus.Auth.globals.dispatcherDefined&&Chorus.EventDispatcher.publish("modal_open",{content:Chorus.Auth.element.modal});_.isObject(t)&&t.preventDefault(),Chorus.DynamicSizedImages.applyTo(".m-auth-modal"),Chorus.Auth.events.bind()},forceClose:function(){e("body").removeClass(Chorus.Auth.openModalClass),Chorus.Auth.element.wrapper.hide(),Chorus.Auth.element.modal.find("[data-chorus-auth-modal]").hide(),Chorus.Auth.actions.resetLoginOptions()},close:function(t){t.target===this&&(e("body").removeClass(Chorus.Auth.openModalClass),Chorus.Auth.element.wrapper.hide(),Chorus.Auth.element.modal.find("[data-chorus-auth-modal]").hide(),Chorus.Auth.actions.resetLoginOptions(),t.preventDefault())},goTo:function(t,n){var o=_.isObject(t)?e(this).data("chorus-auth-goto"):t,i=Chorus.Auth.element.body.filter('[data-chorus-auth-modal="'+o+'"]');return _.isUndefined(n)?(Chorus.Auth.element.body.filter(":visible").hide(),i.show(),void(_.isObject(t)&&t.preventDefault())):i},spinner:function(e){Chorus.Auth.element.loadingMsg.text(e),Chorus.Auth.modal.goTo("spinner")},moveIntoView:function(){var t=e(window).scrollTop();Chorus.Auth.element.modal.css("top",t)}},helpers:{placeholderPolyfill:function(){var t=document.createElement("input");"placeholder"in t||Chorus.Auth.element.modal.find("[placeholder]").focus(function(){var t=e(this);t.val()===t.attr("placeholder")&&(t.val(""),t.removeClass("placeholder"))}).blur(function(){var t=e(this);(""===t.val()||t.val()===t.attr("placeholder"))&&(t.addClass("placeholder"),t.val(t.attr("placeholder")))}).blur()},checkForAutoLoad:function(){if(1===Chorus.Auth.authTriggers.auto.length){var e=Chorus.Auth.authTriggers.auto.eq(0).data("chorus-auth-auto");Chorus.Auth.modal.open(e)}},httpNetworkUrl:function(){return null==Chorus.Auth.networkUrl?null:Chorus.Auth.networkUrl.replace(/^https:\/\//,"http://")},noCorsSupport:function(){return window.navigator.userAgent.match(/MSIE (6|7|8|9)/)},notOnNetworkDomain:function(){return 0!==window.location.href.indexOf(Chorus.Auth.helpers.httpNetworkUrl())}}}}(jQuery),jQuery(function(){Chorus.Auth.init()}),/*
 * Lazy Load - jQuery plugin for lazy loading images
 *
 * Copyright (c) 2007-2012 Mika Tuupola
 *
 * Licensed under the MIT license:
 *   http://www.opensource.org/licenses/mit-license.php
 *
 * Project home:
 *   http://www.appelsiini.net/projects/lazyload
 *
 * Version:  1.8.0.sbn
 * - Hacked so that it lazy loads non-IMG tags
 * - Hacked so that the scroll event that ends up firing lazyload:appear is debounced
 * - Hacked so resize event is debounced
 * - Hacked so data attributes are not cached via jQuery (neccesary for optimization)
 *
 */
function(e,t){var n=e(t);e.fn.lazyload=function(o){function i(e,t){return"undefined"!=typeof _?_.debounce(e,t):e}function r(){var t=0;a.each(function(){var n=e(this);if(!l.skip_invisible||n.is(":visible"))if(e.abovethetop(this,l)||e.leftofbegin(this,l));else if(e.belowthefold(this,l)||e.rightoffold(this,l)){if(++t>l.failure_limit)return!1}else n.trigger("lazyload:appear")})}var s,a=this,l={threshold:0,failure_limit:0,event:"scroll",effect:"show",container:t,data_attribute:"original",skip_invisible:!0,appear:null,load:null,scrollInterval:200,resizeInterval:250};if(o&&(void 0!==o.failurelimit&&(o.failure_limit=o.failurelimit,delete o.failurelimit),void 0!==o.effectspeed&&(o.effect_speed=o.effectspeed,delete o.effectspeed),e.extend(l,o)),s=void 0===l.container||l.container===t?n:e(l.container),0===l.event.indexOf("scroll")){var c=function(e){return r()};s.bind(l.event,i(c,l.scrollInterval))}this.each(function(){var n=this,o=e(n);n.loaded=!1,n.error_event_set=!1;var r=4e3,s=4,c=0,u=function(){if(!this.loaded){if(l.appear){var i=a.length;l.appear.call(n,i,l)}if("IMG"===this.tagName)e("<img />").bind("load",function(){o.hide().attr("src",o.attr("data-"+l.data_attribute))[l.effect](l.effect_speed),n.loaded=!0;var t=e.grep(a,function(e){return!e.loaded});if(a=e(t),l.load){var i=a.length;l.load.call(n,i,l)}}).bind("error",function(){n.error_event_set||t.setTimeout(e.proxy(d,this),r),n.error_event_set=!0}).attr("src",o.attr("data-"+l.data_attribute));else{o.css("background-image","url('"+o.attr("data-"+l.data_attribute)+"')")[l.effect](l.effect_speed),n.loaded=!0;var s=e.grep(a,function(e){return!e.loaded});if(a=e(s),l.load){var i=a.length;l.load.call(n,i,l)}}}},d=function(){if(c+=1,s>=c){e(this).bind("error",function(){t.setTimeout(e.proxy(d,this),r)});var n=this.src.split("?")[0];this.src=n+"?"+(new Date).getTime()}};if(o.one("lazyload:appear",u),0!==l.event.indexOf("scroll")){var h=function(e){n.loaded||o.trigger("lazyload:appear")};o.bind(l.event,i(h,l.scrollInterval))}});var u=function(e){r()};return n.bind("resize",i(u,l.resizeInterval)),r(),this},e.belowthefold=function(o,i){var r;return r=void 0===i.container||i.container===t?n.height()+n.scrollTop():e(i.container).offset().top+e(i.container).height(),r<=e(o).offset().top-i.threshold},e.rightoffold=function(o,i){var r;return r=void 0===i.container||i.container===t?n.width()+n.scrollLeft():e(i.container).offset().left+e(i.container).width(),r<=e(o).offset().left-i.threshold},e.abovethetop=function(o,i){var r;return r=void 0===i.container||i.container===t?n.scrollTop():e(i.container).offset().top,r>=e(o).offset().top+i.threshold+e(o).height()},e.leftofbegin=function(o,i){var r;return r=void 0===i.container||i.container===t?n.scrollLeft():e(i.container).offset().left,r>=e(o).offset().left+i.threshold+e(o).width()},e.inviewport=function(t,n){return!(e.rightofscreen(t,n)||e.leftofscreen(t,n)||e.belowthefold(t,n)||e.abovethetop(t,n))},e.extend(e.expr[":"],{"below-the-fold":function(t){return e.belowthefold(t,{threshold:0})},"above-the-top":function(t){return!e.belowthefold(t,{threshold:0})},"right-of-screen":function(t){return e.rightoffold(t,{threshold:0})},"left-of-screen":function(t){return!e.rightoffold(t,{threshold:0})},"in-viewport":function(t){return!e.inviewport(t,{threshold:0})},"above-the-fold":function(t){return!e.belowthefold(t,{threshold:0})},"right-of-fold":function(t){return e.rightoffold(t,{threshold:0})},"left-of-fold":function(t){return!e.rightoffold(t,{threshold:0})}})}(jQuery,window);var Chorus=Chorus||{};Chorus.DynamicSizedImages=function(e){function t(t,n){var a={failure_limit:20,load:function(){var t=e(this),n=t.parent(".image-window");if(t.is("img")&&(n.length>0?(t.css({position:"absolute",top:Math.round((n.outerHeight()-t.outerHeight())/2),left:Math.round((n.outerWidth()-t.outerWidth())/2)}),"undefined"==typeof t.attr("height")&&t.css("height","auto")):"undefined"==typeof t.attr("height")&&t.css("height","auto")),t.addClass(r),t.removeClass(s),t.removeClass("m-chorus-asset__in-entry-body"),e.fn.playGIF){var o=Chorus.Context.gif_opts||{},i={on:"touchstart",off:"touchstart"};if(Chorus.Context&&Chorus.Context.main_link_color&&(o.circleBackgroundColor=Chorus.Context.main_link_color,o.circleTextColor="FFFFFF"),"undefined"==typeof PLAYGIF_DISABLE_FLAG){var a=e('.m-entry__body img[src*=".gif"], .m-entry__body img[data-original*=".gif"], .m-block__fanshot-media img[src*=".gif"]'),l=e('.m-entry__top-hero .m-entry__photo img[data-original*=".gif"]');a.length+l.length===1?PLAYGIF_DISABLE_FLAG=!0:a&&a.length>0&&(PLAYGIF_DISABLE_FLAG=!1,Modernizr.touch?a.playGIF(i):a.playGIF(o))}Modernizr.touch?t.playGIF(i):t.playGIF(o)}},threshold:800};n&&e.extend(a,n),t=e("undefined"!=typeof t&&null!==t?t:"body");var l=t.find(i+":visible").not("."+s,"."+r),c=[],u=[];l.each(function(){var t,n,i,r,l,d=e(this),h=d.attr("data-imgkey"),m=d.data("chorus-asset-id");if("undefined"!=typeof h){if(a.parentDimensionSlc){var p=d.closest(a.parentDimensionSlc);t=p.outerWidth(),n=p.outerHeight()}t||(t=d.outerWidth()),n||(n=d.outerHeight()),0==n&&(i=d.data("ratio"),n="undefined"!=typeof i&&i>0?Math.ceil(t/i):t),d.is("img")&&(i=d.data("ratio"),r=d.parent(".image-window"),"undefined"!=typeof i&&i>0&&(n=Math.ceil(t/i)),r.length>0&&(t=Math.ceil(r.outerWidth()),n=Math.ceil(r.outerHeight())),n>0&&d.css("height",n)),"undefined"!=typeof window.devicePixelRatio&&(t=Math.ceil(t*window.devicePixelRatio),n=Math.ceil(n*window.devicePixelRatio)),Chorus.Context&&"racked"===Chorus.Context.network_slug&&(t=Math.ceil(1.3*t),n=Math.ceil(1.3*n)),/\.(png|jpg|jpeg)$/i.test(d.attr("data-original"))&&o.webp&&!Chorus.Modernizr.touch&&(l="webp");var f=h+":"+t+"x"+n+(l?":"+l:"");c.push(f),d.attr("data-dim",t+"x"+n),d.addClass(s)}else if("undefined"!=typeof m){t=d.outerWidth(),n=d.outerHeight(),d.is("img")&&(i=d.data("ratio"),r=d.parent(".image-window"),"undefined"!=typeof i&&i>0&&(n=Math.ceil(t/i)),r.length>0&&(t=Math.ceil(r.outerWidth()),n=Math.ceil(r.outerHeight())),n>0&&d.css("height",n)),"undefined"!=typeof window.devicePixelRatio&&(t=Math.ceil(t*window.devicePixelRatio),n=Math.ceil(n*window.devicePixelRatio)),"racked"===Chorus.Context.network_slug&&(t=Math.ceil(1.3*t),n=Math.ceil(1.3*n));var g=m+":"+t+":"+n;u.push(g),d.data("asset-key",g),d.addClass(s)}else d.lazyload(a)}),(0!==c.length||0!==u.length)&&(e.each([u,c],function(e,t){t.sort(function(e,t){return+e.split(":")[0]-+t.split(":")[0]})}),e.ajax({type:"GET",url:"/chorus_page/optimally_sized_images",dataType:"json",contentType:"application/json",timeout:1e4,data:{imgkeys:c.join(","),asset_keys:u.join(",")},success:function(t){var n=t.urls,o={};_.forEach(n,function(e,t){var n=t.replace(/\:webp|\:jp2/,"");o[n]=e}),n=o,l.each(function(){var t,o=e(this);t=o.attr("data-imgkey")?o.attr("data-imgkey")+":"+o.attr("data-dim"):o.data("asset-key");var i=n[t];"undefined"!=typeof i&&(o.attr("data-original",i),o.lazyload(a))})}}))}e(document).ready(function(){Chorus.DynamicSizedImages.init(),Chorus.EventDispatcher&&Chorus.EventDispatcher.publish("dynamic-images-available",{},!0)});var n={},o={webp:!1,jp2:!1},i=".vox-lazy-load",r="lazy-loaded",s="lazy-loading";return n.init=function(){function e(){if(Chorus.Modernizr.localstorage&&window.localStorage.getItem("supportsWebp"))o.webp="true"===window.localStorage.getItem("supportsWebp")?!0:!1,i();else{var e=new Image;e.onload=function(){o.webp=!!(e.height>0&&e.width>0),Chorus.Modernizr.localstorage&&window.localStorage.setItem("supportsWebp",o.webp),i()},e.onerror=function(){o.webp=!1,Chorus.Modernizr.localstorage&&window.localStorage.setItem("supportsWebp",o.webp),i()},e.src="data:image/webp;base64,UklGRiYAAABXRUJQVlA4IBoAAAAwAQCdASoBAAEAAIAOJaQAA3AA/v89WAAAAA=="}}function i(){Chorus&&Chorus.Context&&Chorus.Context.defer_image_loading?Chorus.Context.defer_image_loading=!1:n.initUI(),Chorus.EventDispatcher&&Chorus.EventDispatcher.subscribe("moduleInserted",function(e){t(e.modules)})}e()},n.initUI=function(e,n){t(e,n)},n.applyTo=function(e,n){t(e,n)},n}(jQuery),function(){"use strict";/**
	 * @preserve FastClick: polyfill to remove click delays on browsers with touch UIs.
	 *
	 * @codingstandard ftlabs-jsv2
	 * @copyright The Financial Times Limited [All Rights Reserved]
	 * @license MIT License (see LICENSE.txt)
	 */
function e(t,o){function i(e,t){return function(){return e.apply(t,arguments)}}var r;if(o=o||{},this.trackingClick=!1,this.trackingClickStart=0,this.targetElement=null,this.touchStartX=0,this.touchStartY=0,this.lastTouchIdentifier=0,this.touchBoundary=o.touchBoundary||10,this.layer=t,this.tapDelay=o.tapDelay||200,this.tapTimeout=o.tapTimeout||700,!e.notNeeded(t)){for(var s=["onMouse","onClick","onTouchStart","onTouchMove","onTouchEnd","onTouchCancel"],a=this,l=0,c=s.length;c>l;l++)a[s[l]]=i(a[s[l]],a);n&&(t.addEventListener("mouseover",this.onMouse,!0),t.addEventListener("mousedown",this.onMouse,!0),t.addEventListener("mouseup",this.onMouse,!0)),t.addEventListener("click",this.onClick,!0),t.addEventListener("touchstart",this.onTouchStart,!1),t.addEventListener("touchmove",this.onTouchMove,!1),t.addEventListener("touchend",this.onTouchEnd,!1),t.addEventListener("touchcancel",this.onTouchCancel,!1),Event.prototype.stopImmediatePropagation||(t.removeEventListener=function(e,n,o){var i=Node.prototype.removeEventListener;"click"===e?i.call(t,e,n.hijacked||n,o):i.call(t,e,n,o)},t.addEventListener=function(e,n,o){var i=Node.prototype.addEventListener;"click"===e?i.call(t,e,n.hijacked||(n.hijacked=function(e){e.propagationStopped||n(e)}),o):i.call(t,e,n,o)}),"function"==typeof t.onclick&&(r=t.onclick,t.addEventListener("click",function(e){r(e)},!1),t.onclick=null)}}var t=navigator.userAgent.indexOf("Windows Phone")>=0,n=navigator.userAgent.indexOf("Android")>0&&!t,o=/iP(ad|hone|od)/.test(navigator.userAgent)&&!t,i=o&&/OS 4_\d(_\d)?/.test(navigator.userAgent),r=o&&/OS [6-7]_\d/.test(navigator.userAgent),s=navigator.userAgent.indexOf("BB10")>0;e.prototype.needsClick=function(e){switch(e.nodeName.toLowerCase()){case"button":case"select":case"textarea":if(e.disabled)return!0;break;case"input":if(o&&"file"===e.type||e.disabled)return!0;break;case"label":case"iframe":case"video":return!0}return/\bneedsclick\b/.test(e.className)},e.prototype.needsFocus=function(e){switch(e.nodeName.toLowerCase()){case"textarea":return!0;case"select":return!n;case"input":switch(e.type){case"button":case"checkbox":case"file":case"image":case"radio":case"submit":return!1}return!e.disabled&&!e.readOnly;default:return/\bneedsfocus\b/.test(e.className)}},e.prototype.sendClick=function(e,t){var n,o;document.activeElement&&document.activeElement!==e&&document.activeElement.blur(),o=t.changedTouches[0],n=document.createEvent("MouseEvents"),n.initMouseEvent(this.determineEventType(e),!0,!0,window,1,o.screenX,o.screenY,o.clientX,o.clientY,!1,!1,!1,!1,0,null),n.forwardedTouchEvent=!0,e.dispatchEvent(n)},e.prototype.determineEventType=function(e){return n&&"select"===e.tagName.toLowerCase()?"mousedown":"click"},e.prototype.focus=function(e){var t;o&&e.setSelectionRange&&0!==e.type.indexOf("date")&&"time"!==e.type&&"month"!==e.type?(t=e.value.length,e.setSelectionRange(t,t)):e.focus()},e.prototype.updateScrollParent=function(e){var t,n;if(t=e.fastClickScrollParent,!t||!t.contains(e)){n=e;do{if(n.scrollHeight>n.offsetHeight){t=n,e.fastClickScrollParent=n;break}n=n.parentElement}while(n)}t&&(t.fastClickLastScrollTop=t.scrollTop)},e.prototype.getTargetElementFromEventTarget=function(e){return e.nodeType===Node.TEXT_NODE?e.parentNode:e},e.prototype.onTouchStart=function(e){var t,n,r;if(e.targetTouches.length>1)return!0;if(t=this.getTargetElementFromEventTarget(e.target),n=e.targetTouches[0],o){if(r=window.getSelection(),r.rangeCount&&!r.isCollapsed)return!0;if(!i){if(n.identifier&&n.identifier===this.lastTouchIdentifier)return e.preventDefault(),!1;this.lastTouchIdentifier=n.identifier,this.updateScrollParent(t)}}return this.trackingClick=!0,this.trackingClickStart=e.timeStamp,this.targetElement=t,this.touchStartX=n.pageX,this.touchStartY=n.pageY,e.timeStamp-this.lastClickTime<this.tapDelay&&e.preventDefault(),!0},e.prototype.touchHasMoved=function(e){var t=e.changedTouches[0],n=this.touchBoundary;return Math.abs(t.pageX-this.touchStartX)>n||Math.abs(t.pageY-this.touchStartY)>n?!0:!1},e.prototype.onTouchMove=function(e){return this.trackingClick?((this.targetElement!==this.getTargetElementFromEventTarget(e.target)||this.touchHasMoved(e))&&(this.trackingClick=!1,this.targetElement=null),!0):!0},e.prototype.findControl=function(e){return void 0!==e.control?e.control:e.htmlFor?document.getElementById(e.htmlFor):e.querySelector("button, input:not([type=hidden]), keygen, meter, output, progress, select, textarea")},e.prototype.onTouchEnd=function(e){var t,s,a,l,c,u=this.targetElement;if(!this.trackingClick)return!0;if(e.timeStamp-this.lastClickTime<this.tapDelay)return this.cancelNextClick=!0,!0;if(e.timeStamp-this.trackingClickStart>this.tapTimeout)return!0;if(this.cancelNextClick=!1,this.lastClickTime=e.timeStamp,s=this.trackingClickStart,this.trackingClick=!1,this.trackingClickStart=0,r&&(c=e.changedTouches[0],u=document.elementFromPoint(c.pageX-window.pageXOffset,c.pageY-window.pageYOffset)||u,u.fastClickScrollParent=this.targetElement.fastClickScrollParent),a=u.tagName.toLowerCase(),"label"===a){if(t=this.findControl(u)){if(this.focus(u),n)return!1;u=t}}else if(this.needsFocus(u))return e.timeStamp-s>100||o&&window.top!==window&&"input"===a?(this.targetElement=null,!1):(this.focus(u),this.sendClick(u,e),o&&"select"===a||(this.targetElement=null,e.preventDefault()),!1);return o&&!i&&(l=u.fastClickScrollParent,l&&l.fastClickLastScrollTop!==l.scrollTop)?!0:(this.needsClick(u)||(e.preventDefault(),this.sendClick(u,e)),!1)},e.prototype.onTouchCancel=function(){this.trackingClick=!1,this.targetElement=null},e.prototype.onMouse=function(e){return this.targetElement?e.forwardedTouchEvent?!0:e.cancelable&&(!this.needsClick(this.targetElement)||this.cancelNextClick)?(e.stopImmediatePropagation?e.stopImmediatePropagation():e.propagationStopped=!0,e.stopPropagation(),e.preventDefault(),!1):!0:!0},e.prototype.onClick=function(e){var t;return this.trackingClick?(this.targetElement=null,this.trackingClick=!1,!0):"submit"===e.target.type&&0===e.detail?!0:(t=this.onMouse(e),t||(this.targetElement=null),t)},e.prototype.destroy=function(){var e=this.layer;n&&(e.removeEventListener("mouseover",this.onMouse,!0),e.removeEventListener("mousedown",this.onMouse,!0),e.removeEventListener("mouseup",this.onMouse,!0)),e.removeEventListener("click",this.onClick,!0),e.removeEventListener("touchstart",this.onTouchStart,!1),e.removeEventListener("touchmove",this.onTouchMove,!1),e.removeEventListener("touchend",this.onTouchEnd,!1),e.removeEventListener("touchcancel",this.onTouchCancel,!1)},e.notNeeded=function(e){var t,o,i,r;if("undefined"==typeof window.ontouchstart)return!0;if(o=+(/Chrome\/([0-9]+)/.exec(navigator.userAgent)||[,0])[1]){if(!n)return!0;if(t=document.querySelector("meta[name=viewport]")){if(-1!==t.content.indexOf("user-scalable=no"))return!0;if(o>31&&document.documentElement.scrollWidth<=window.outerWidth)return!0}}if(s&&(i=navigator.userAgent.match(/Version\/([0-9]*)\.([0-9]*)/),i[1]>=10&&i[2]>=3&&(t=document.querySelector("meta[name=viewport]")))){if(-1!==t.content.indexOf("user-scalable=no"))return!0;if(document.documentElement.scrollWidth<=window.outerWidth)return!0}return"none"===e.style.msTouchAction||"manipulation"===e.style.touchAction?!0:(r=+(/Firefox\/([0-9]+)/.exec(navigator.userAgent)||[,0])[1],r>=27&&(t=document.querySelector("meta[name=viewport]"),t&&(-1!==t.content.indexOf("user-scalable=no")||document.documentElement.scrollWidth<=window.outerWidth))?!0:"none"===e.style.touchAction||"manipulation"===e.style.touchAction?!0:!1)},e.attach=function(t,n){return new e(t,n)},"function"==typeof define&&"object"==typeof define.amd&&define.amd?define(function(){return e}):"undefined"!=typeof module&&module.exports?(module.exports=e.attach,module.exports.FastClick=e):window.FastClick=e}(),"addEventListener"in document&&document.addEventListener("DOMContentLoaded",function(){FastClick.attach(document.body)},!1);