/*!
 * Licensed Materials - Property of IBM
 *  Copyright IBM Corp. 2013
 * US Government Users Restricted Rights - Use, duplication or disclosure restricted by GSA ADP Schedule Contract with IBM Corp.
 *
 * @version 3.0.1.1068
 * @flags w3c,NDEBUG
 */

/**
 * @fileOverview Defines the core of the system, namely the TLT object.
 * @exports TLT
 */
/*global window*/
/*jshint loopfunc:true*/
/**
 * TLT (short for Tealeaf Technology) is the top-level object for the system. All
 * objects and functions live under TLT to prevent polluting the global
 * scope. This object also manages the modules and services on the page,
 * controlling their lifecycle, manages inter-module communication.
 * @namespace
 */
var TLT=(function(){"use strict";function logScreenview(type,name,referrerName,root){var screenviewMsg=null,queue=TLT.getService("queue"),replay=TLT.getModule("replay"),webEvent=null,winLocation=window.location,host=winLocation.origin||null;if(!name||typeof name!=="string"){return}if(!referrerName||typeof referrerName!=="string"){referrerName=""}if(!host){host=(winLocation.protocol||"")+"//"+(winLocation.host||"")}screenviewMsg={type:2,screenview:{type:type,name:name,url:winLocation.pathname,host:host,referrer:referrerName}};if(type==="LOAD"){webEvent={type:"screenview_load"}}else if(type==="UNLOAD"){webEvent={type:"screenview_unload"}}if(webEvent&&replay){replay.onevent(webEvent)}if(type==="LOAD"||type==="UNLOAD"){queue.post("",screenviewMsg,"DEFAULT")}}var tltStartTime=(new Date()).getTime(),modules={},services={},initialized=false,state=null,isFrameBlacklisted=(function(){var blacklistedFrames,checkedFrames=[];function prepareBlacklistedFrames(scope){var browserService=core.getService("browser"),blacklist=core.getCoreConfig().framesBlacklist,foundFrames,i;blacklistedFrames=blacklistedFrames||[];scope=scope||null;if(typeof blacklist!=="undefined"&&blacklist.length>0){for(i=0;i<blacklist.length;i+=1){foundFrames=browserService.queryAll(blacklist[i],scope);if(foundFrames&&foundFrames.length>0){blacklistedFrames=blacklistedFrames.concat(foundFrames)}}checkedFrames=checkedFrames.concat(browserService.queryAll('iframe',scope))}}function isFrameBlacklisted(iframe){if(core.utils.indexOf(checkedFrames,iframe)<0){prepareBlacklistedFrames(iframe.ownerDocument)}return core.utils.indexOf(blacklistedFrames,iframe)>-1}isFrameBlacklisted.clearCache=function(){blacklistedFrames=null};return isFrameBlacklisted}()),lastClickedElement=null,servicePassthroughs={"config":["getConfig","updateConfig","getCoreConfig","updateCoreConfig","getModuleConfig","updateModuleConfig","getServiceConfig","updateServiceConfig"],"queue":["post","setAutoFlush","flushAll"],"browserBase":["processDOMEvent"]},loadUnloadHandler=(function(){var status={};return{normalizeModuleEvents:function(moduleName,moduleEvents,localTop,documentScope){var load=false,unload=false,browserService=core.getService("browser");localTop=localTop||core._getLocalTop();documentScope=documentScope||localTop.document;status[moduleName]={loadFired:false,pageHideFired:false};core.utils.forEach(moduleEvents,function(eventConfig){switch(eventConfig.name){case"load":load=true;moduleEvents.push(core.utils.mixin(core.utils.mixin({},eventConfig),{name:"pageshow"}));break;case"unload":unload=true;moduleEvents.push(core.utils.mixin(core.utils.mixin({},eventConfig),{name:"pagehide"}));moduleEvents.push(core.utils.mixin(core.utils.mixin({},eventConfig),{name:"beforeunload"}));break;case"change":if(core.utils.isLegacyIE&&core.getFlavor()==="w3c"){moduleEvents.push(core.utils.mixin(core.utils.mixin({},eventConfig),{name:"propertychange"}))}break}});if(!load&&!unload){delete status[moduleName];return}status[moduleName].silentLoad=!load;status[moduleName].silentUnload=!unload;if(!load){moduleEvents.push({name:"load",target:localTop})}if(!unload){moduleEvents.push({name:"unload",target:localTop})}},canPublish:function(moduleName,event){var mod;if(status.hasOwnProperty(moduleName)===false){return true}mod=status[moduleName];switch(event.type){case"load":mod.pageHideFired=false;mod.loadFired=true;return!mod.silentLoad;case"pageshow":mod.pageHideFired=false;event.type="load";return!mod.loadFired&&!mod.silentLoad;case"pagehide":event.type="unload";mod.loadFired=false;mod.pageHideFired=true;return!mod.silentUnload;case"unload":case"beforeunload":event.type="unload";mod.loadFired=false;return!mod.pageHideFired&&!mod.silentUnload}return true},isUnload:function(event){return typeof event==="object"?(event.type==="unload"||event.type==="beforeunload"||event.type==="pagehide"):false}}}()),events={},_init=function(){},_callback=null,okToCallInit=true,_lastTouch=null,_hasScroll=false,_sendScroll=false,_isApple=navigator.userAgent.indexOf("iPhone")>-1||navigator.userAgent.indexOf("iPod")>-1||navigator.userAgent.indexOf("iPad")>-1,core={getStartTime:function(){return tltStartTime},init:function(config,callback){var timeoutCallback;_callback=callback;if(!okToCallInit){throw"init must only be called once!"}okToCallInit=false;timeoutCallback=function(event){event=event||window.event||{};if(document.addEventListener||event.type==="load"||document.readyState==="complete"){if(document.removeEventListener){document.removeEventListener("DOMContentLoaded",timeoutCallback,false);window.removeEventListener("load",timeoutCallback,false)}else{document.detachEvent("onreadystatechange",timeoutCallback);window.detachEvent("onload",timeoutCallback)}_init(config,callback)}};if(document.readyState==="complete"){setTimeout(timeoutCallback)}else if(document.addEventListener){document.addEventListener("DOMContentLoaded",timeoutCallback,false);window.addEventListener("load",timeoutCallback,false)}else{document.attachEvent("onreadystatechange",timeoutCallback);window.attachEvent("onload",timeoutCallback)}},isInitialized:function(){return initialized},getState:function(){return state},destroy:function(skipEvents){var token="",eventName="",target=null,serviceName=null,service=null,browser=null,delegateTarget=false;if(okToCallInit){return false}this.stopAll();if(!skipEvents){browser=this.getService("browser");for(token in events){if(events.hasOwnProperty(token)&&browser!==null){eventName=token.split("|")[0];target=events[token].target;delegateTarget=events[token].delegateTarget||undefined;browser.unsubscribe(eventName,target,this._publishEvent,delegateTarget)}}}for(serviceName in services){if(services.hasOwnProperty(serviceName)){service=services[serviceName].instance;if(service&&typeof service.destroy==="function"){service.destroy()}services[serviceName].instance=null}}isFrameBlacklisted.clearCache();events={};initialized=false;okToCallInit=true;state="destroyed";if(typeof _callback==="function"){try{_callback("destroyed")}catch(e){}}},_updateModules:function(scope){var config=this.getCoreConfig(),browser=this.getService("browser"),moduleConfig=null,moduleName=null;if(config&&browser&&config.modules){try{for(moduleName in config.modules){if(config.modules.hasOwnProperty(moduleName)){moduleConfig=config.modules[moduleName];if(modules.hasOwnProperty(moduleName)){if(moduleConfig.enabled===false){this.stop(moduleName)}else{this.start(moduleName)}if(moduleConfig.events&&browser!==null){this._registerModuleEvents(moduleName,moduleConfig.events,scope)}}else{if(browser.loadScript){browser.loadScript(config.moduleBase+moduleName+".js")}}}}this._registerModuleEvents.clearCache()}catch(e){core.destroy();return false}}else{return false}return true},rebind:function(scope){core._updateModules(scope)},getSessionData:function(){var rv=null,sessionData=null,scName,scValue,config=core.getCoreConfig();if(!config||!config.sessionDataEnabled){return null}sessionData=config.sessionData||{};scName=sessionData.sessionQueryName;if(scName){scValue=core.utils.getQueryStringValue(scName,sessionData.sessionQueryDelim)}else{scName=sessionData.sessionCookieName||"TLTSID";scValue=core.utils.getCookieValue(scName)}if(scName&&scValue){rv=rv||{};rv.tltSCN=scName;rv.tltSCV=scValue;rv.tltSCVNeedsHashing=!!sessionData.sessionValueNeedsHashing}return rv},logCustomEvent:function(name,customMsgObj){var customMsg=null,queue=this.getService("queue");if(!name||typeof name!=="string"){name="CUSTOM"}customMsgObj=customMsgObj||{};customMsg={type:5,customEvent:{name:name,data:customMsgObj}};queue.post("",customMsg,"DEFAULT")},logExceptionEvent:function(msg,url,line){var exceptionMsg=null,queue=this.getService("queue");if(!msg||typeof msg!=="string"){return}url=url||"";line=line||"";exceptionMsg={type:6,exception:{description:msg,url:url,line:line}};queue.post("",exceptionMsg,"DEFAULT")},logScreenviewLoad:function(name,referrerName,root){logScreenview("LOAD",name,referrerName,root)},logScreenviewUnload:function(name){logScreenview("UNLOAD",name)},_hasSameOrigin:function(iframe){try{return iframe.document.location.host===document.location.host&&iframe.document.location.protocol===document.location.protocol}catch(e){}return false},_registerModuleEvents:(function(){var idCache,normalizeToObject=function(prop,localTop,documentScope){if(prop==="window"){return localTop}if(prop==="document"){return documentScope}return prop};function _registerModuleEventsOnScope(moduleName,moduleEvents,scope){var browserBase=core.getService("browserBase"),browser=core.getService("browser"),documentScope=core.utils.getDocument(scope),localTop=core._getLocalTop(),isFrame=core.utils.isIFrameDescendant(scope),frameId,e;scope=scope||documentScope;loadUnloadHandler.normalizeModuleEvents(moduleName,moduleEvents,localTop,documentScope);if(isFrame){frameId=browserBase.ElementData.prototype.examineID(scope).id;if(typeof frameId==="string"){frameId=frameId.slice(0,frameId.length-1);for(e in events){if(events.hasOwnProperty(e)&&e.indexOf(frameId)!==-1){delete events[e]}}}}core.utils.forEach(moduleEvents,function(eventConfig){var target=normalizeToObject(eventConfig.target,localTop,documentScope)||documentScope,delegateTarget=normalizeToObject(eventConfig.delegateTarget,localTop,documentScope),token="";if(eventConfig.recurseFrames!==true&&isFrame){return}if(typeof target==="string"){if(eventConfig.delegateTarget&&core.getFlavor()==="jQuery"){token=core._buildToken4delegateTarget(eventConfig.name,target,eventConfig.delegateTarget);if(!events.hasOwnProperty(token)){events[token]=[moduleName];events[token].target=target;events[token].delegateTarget=delegateTarget;browser.subscribe(eventConfig.name,target,core._publishEvent,delegateTarget,token)}else{events[token].push(moduleName)}}else{core.utils.forEach(browser.queryAll(target,scope),function(element){var idData=idCache.get(element);if(!idData){idData=browserBase.ElementData.prototype.examineID(element);idCache.set(element,idData)}token=eventConfig.name+"|"+idData.id+idData.type;if(core.utils.indexOf(events[token],moduleName)!==-1){return}events[token]=events[token]||[];events[token].push(moduleName);events[token].target=element;browser.subscribe(eventConfig.name,element,core._publishEvent)})}}else{token=core._buildToken4bubbleTarget(eventConfig.name,target,typeof eventConfig.target==="undefined");if(!events.hasOwnProperty(token)){events[token]=[moduleName];browser.subscribe(eventConfig.name,target,core._publishEvent)}else{if(core.utils.indexOf(events[token],moduleName)===-1){events[token].push(moduleName)}}}if(token!==""){if(typeof target!=="string"){events[token].target=target}}})}function _isFrameLoaded(hIFrame){var iFrameWindow=core.utils.getIFrameWindow(hIFrame);return iFrameWindow&&core._hasSameOrigin(iFrameWindow)&&iFrameWindow.document&&iFrameWindow.document.readyState==="complete"}function registerModuleEvents(moduleName,moduleEvents,scope){scope=scope||core._getLocalTop().document;idCache=idCache||new core.utils.WeakMap();_registerModuleEventsOnScope(moduleName,moduleEvents,scope);if(moduleName!=="performance"){var hIFrame=null,hIFrameWindow=null,browserService=core.getService("browser"),cIFrames=browserService.queryAll("iframe, frame",scope),i,iLength;for(i=0,iLength=cIFrames.length;i<iLength;i+=1){hIFrame=cIFrames[i];if(isFrameBlacklisted(hIFrame)){continue}if(_isFrameLoaded(hIFrame)){hIFrameWindow=core.utils.getIFrameWindow(hIFrame);core._registerModuleEvents(moduleName,moduleEvents,hIFrameWindow.document)}(function(moduleName,moduleEvents,hIFrame){var hIFrameWindow=null,_iframeContext={moduleName:moduleName,moduleEvents:moduleEvents,hIFrame:hIFrame,_registerModuleEventsDelayed:function(){var hIFrameWindow=null;if(!isFrameBlacklisted(hIFrame)){hIFrameWindow=core.utils.getIFrameWindow(hIFrame);if(core._hasSameOrigin(hIFrameWindow)){core._registerModuleEvents(moduleName,moduleEvents,hIFrameWindow.document)}}}};core.utils.addEventListener(hIFrame,"load",function(){_iframeContext._registerModuleEventsDelayed()});if(core.utils.isLegacyIE){hIFrameWindow=core.utils.getIFrameWindow(hIFrame);if(hIFrameWindow&&hIFrameWindow.document){core.utils.addEventListener(hIFrameWindow.document,"readystatechange",function(){_iframeContext._registerModuleEventsDelayed()})}}}(moduleName,moduleEvents,hIFrame))}}}registerModuleEvents.clearCache=function(){if(idCache){idCache.clear();idCache=null}};return registerModuleEvents}()),_buildToken4currentTarget:function(event){var target=event.nativeEvent?event.nativeEvent.currentTarget:null,idData=target?this.getService("browserBase").ElementData.prototype.examineID(target):{id:event.target.id,type:event.target.idType};return event.type+"|"+idData.id+idData.type},_buildToken4delegateTarget:function(eventType,target,delegateTarget){return eventType+"|"+target+"|"+delegateTarget},_buildToken4bubbleTarget:function(eventType,target,checkIframe,delegateTarget){var localTop=core._getLocalTop(),localWindow,browserService=core.getService("browser"),_getIframeElement=function(documentScope){var retVal=null;if(core._hasSameOrigin(localWindow.parent)){core.utils.forEach(browserService.queryAll("iframe, frame",localWindow.parent.document),function(iframe){var iFrameWindow=null;if(!isFrameBlacklisted(iframe)){iFrameWindow=core.utils.getIFrameWindow(iframe);if(core._hasSameOrigin(iFrameWindow)&&iFrameWindow.document===documentScope){retVal=iframe}}})}return retVal},documentScope=core.utils.getDocument(target),browserBase=this.getService("browserBase"),iframeElement=null,tmpTarget,retVal=eventType,idData;if(documentScope){localWindow=documentScope.defaultView||documentScope.parentWindow}if(target===window||target===window.window){retVal+="|null-2|window"}else{if(checkIframe&&localWindow&&core._hasSameOrigin(localWindow.parent)&&typeof documentScope!=="undefined"&&localTop.document!==documentScope){iframeElement=_getIframeElement(documentScope);if(iframeElement){tmpTarget=browserBase.ElementData.prototype.examineID(iframeElement);retVal+="|"+tmpTarget.xPath+"-2"}}else if(delegateTarget&&delegateTarget!==document&&core.getFlavor()==="jQuery"){retVal+="|null-2|"+core.utils.getTagName(target)+"|"+core.utils.getTagName(delegateTarget)}else{retVal+="|null-2|document"}}return retVal},_reinitConfig:function(){core._updateModules()},_handleTouchStart:function(event){var i,j;if(_isApple){return false}if(_lastTouch===null){_lastTouch=event;return true}for(i=0;i<_lastTouch.nativeEvent.touches.length;i+=1){for(j=0;j<event.nativeEvent.touches.length;j+=1){if(_lastTouch.nativeEvent.touches[i]===event.nativeEvent.touches[j]){return true}}}core._prepNonIosTouchEnd();_lastTouch=event;return true},_handleTouchMove:function(event){if(_isApple){return}_lastTouch=event},_handleTouchScroll:function(event){if(_isApple){return false}if(_lastTouch!==null&&event.type==="scroll"){_lastTouch.target.position.x=event.target.position.x;_lastTouch.target.position.y=event.target.position.y;_hasScroll=true}return true},_prepNonIosTouchEnd:function(){var hasBeenPublished=false;if(_lastTouch!==null){_lastTouch.type="touchend";_lastTouch.nativeEvent.type="touchend";core._publishEvent(_lastTouch);if(_hasScroll){_lastTouch.type="scroll";_lastTouch.nativeEvent.type="scroll";_sendScroll=true;core._publishEvent(_lastTouch)}hasBeenPublished=true}_lastTouch=null;_hasScroll=false;_sendScroll=false;return hasBeenPublished},_publishEvent:function(event){var moduleName=null,module=null,token=(event.delegateTarget&&event.data)?event.data:core._buildToken4currentTarget(event),modules=null,i,len,target,modEvent=null,canIgnore=false,canPublish=false,browserService=core.getService("browser"),delegateTarget=event.delegateTarget||null;if((event.type==="load"||event.type==="pageshow")&&!event.nativeEvent.customLoad){return}if(_isApple&&(event.type==="touchstart"||event.type==="touchmove")){return}if(_lastTouch!==null&&event.type!=="touchstart"&&event.type!=="touchmove"&&event.type!=="scroll"&&event.type!=="touchend"){core._prepNonIosTouchEnd()}else{if(event.type==="touchstart"){core._handleTouchStart(event);return}if(event.type==="touchmove"){core._handleTouchMove(event);return}if(_lastTouch!==null&&event.type==="scroll"&&!_sendScroll){core._handleTouchScroll(event);return}if(_hasScroll){token="scroll|null-2|window"}}if(core.utils.isIE){if(event.type==="click"){lastClickedElement=event.target.element}if(event.type==="beforeunload"){canIgnore=false;core.utils.forEach(core.getCoreConfig().ieExcludedLinks,function(selector){var i,len,el=browserService.queryAll(selector);for(i=0,len=el?el.length:0;i<len;i+=1){if(typeof el[i]!==undefined&&el[i]===lastClickedElement){canIgnore=true;return}}});if(canIgnore){return}}}if(loadUnloadHandler.isUnload(event)){state="unloading"}if(event.type==="change"&&core.utils.isLegacyIE&&core.getFlavor()==="w3c"&&(event.target.element.type==="checkbox"||event.target.element.type==="radio")){return}if(event.type==="propertychange"){if(event.nativeEvent.propertyName==="checked"&&(event.target.element.type==="checkbox"||(event.target.element.type==="radio"&&event.target.element.checked))){event.type=event.target.type="change"}else{return}}if(!events.hasOwnProperty(token)){if(event.hasOwnProperty("nativeEvent")){target=event.nativeEvent.currentTarget||event.nativeEvent.target}token=core._buildToken4bubbleTarget(event.type,target,true,delegateTarget)}if(events.hasOwnProperty(token)){modules=events[token];for(i=0,len=modules.length;i<len;i+=1){moduleName=modules[i];module=core.getModule(moduleName);modEvent=core.utils.mixin({},event);if(module&&core.isStarted(moduleName)&&typeof module.onevent==="function"){canPublish=loadUnloadHandler.canPublish(moduleName,modEvent);if(canPublish){module.onevent(modEvent)}}}}if(modEvent&&modEvent.type==="unload"&&canPublish){TLT.destroy()}},_getLocalTop:function(){return window.window},addModule:function(moduleName,creator){modules[moduleName]={creator:creator,instance:null,context:null,messages:[]};if(this.isInitialized()){this.start(moduleName)}},getModule:function(moduleName){if(modules[moduleName]&&modules[moduleName].instance){return modules[moduleName].instance}return null},removeModule:function(moduleName){this.stop(moduleName);delete modules[moduleName]},isStarted:function(moduleName){return modules.hasOwnProperty(moduleName)&&modules[moduleName].instance!==null},start:function(moduleName){var moduleData=modules[moduleName],instance=null;if(moduleData&&moduleData.instance===null){moduleData.context=new TLT.ModuleContext(moduleName,this);instance=moduleData.instance=moduleData.creator(moduleData.context);if(typeof instance.init==="function"){instance.init()}}},startAll:function(){var moduleName=null;for(moduleName in modules){if(modules.hasOwnProperty(moduleName)){this.start(moduleName)}}},stop:function(moduleName){var moduleData=modules[moduleName],instance=null;if(moduleData&&moduleData.instance!==null){instance=moduleData.instance;if(typeof instance.destroy==="function"){instance.destroy()}moduleData.instance=moduleData.context=null}},stopAll:function(){var moduleName=null;for(moduleName in modules){if(modules.hasOwnProperty(moduleName)){this.stop(moduleName)}}},addService:function(serviceName,creator){services[serviceName]={creator:creator,instance:null}},getService:function(serviceName){if(services.hasOwnProperty(serviceName)){if(!services[serviceName].instance){try{services[serviceName].instance=services[serviceName].creator(this);if(typeof services[serviceName].instance.init==="function"){services[serviceName].instance.init()}}catch(e){return null}if(typeof services[serviceName].instance.getServiceName!=="function"){services[serviceName].instance.getServiceName=function(){return serviceName}}}return services[serviceName].instance}return null},removeService:function(serviceName){delete services[serviceName]},broadcast:function(message){var i=0,len=0,prop=null,module=null;if(message&&typeof message==="object"){for(prop in modules){if(modules.hasOwnProperty(prop)){module=modules[prop];if(core.utils.indexOf(module.messages,message.type)>-1){if(typeof module.instance.onmessage==="function"){module.instance.onmessage(message)}}}}}},listen:function(moduleName,messageType){var module=null;if(this.isStarted(moduleName)){module=modules[moduleName];if(core.utils.indexOf(module.messages,messageType)===-1){module.messages.push(messageType)}}},fail:function(message,failcode,skipEvents){message="UIC FAILED. "+message;try{core.destroy(!!skipEvents)}finally{core.utils.clog(message);throw new core.UICError(message,failcode)}},UICError:(function(){function UICError(message,errorCode){this.message=message;this.code=errorCode}UICError.prototype=new Error();UICError.prototype.name="UICError";UICError.prototype.constructor=UICError;return UICError}()),getFlavor:function(){return"w3c"}};_init=function(config,callback){var configService,event,webEvent,baseBrowser,browserService;if(initialized){core.utils.clog("TLT.init() called more than once. Ignoring.");return}configService=core.getService("config");configService.updateConfig(config);if(!core._updateModules()){if(state!=="destroyed"){core.destroy()}return}if(configService.subscribe){configService.subscribe("configupdated",core._reinitConfig)}initialized=true;state="loaded";event={type:'load',target:window.window,srcElement:window.window,currentTarget:window.window,bubbles:true,cancelBubble:false,cancelable:true,timeStamp:+new Date(),customLoad:true};baseBrowser=core.getService("browserBase");webEvent=new baseBrowser.WebEvent(event);core._publishEvent(webEvent);if(typeof _callback==="function"){try{_callback("initialized")}catch(e){}}};(function(){var name=null,i,len;for(name in servicePassthroughs){if(servicePassthroughs.hasOwnProperty(name)){for(i=0,len=servicePassthroughs[name].length;i<len;i+=1){(function(serviceName,methodName){core[methodName]=function(){var service=this.getService(serviceName);if(service){return service[methodName].apply(service,arguments)}}}(name,servicePassthroughs[name][i]))}}}}());return core}());(function(){"use strict";var _isIE=(function(){var ua=window.navigator.userAgent.toLowerCase();return(ua.indexOf("msie")!==-1)}()),_isLegacyIE=(function(){var isNavTimingSupported=!!window.performance;return(_isIE&&(!isNavTimingSupported||document.documentMode<9))}()),utils={isIE:_isIE,isLegacyIE:_isLegacyIE,indexOf:function(array,item){var i,len;if(array&&array instanceof Array){for(i=0,len=array.length;i<len;i+=1){if(array[i]===item){return i}}}return-1},forEach:function(array,callback,context){var i,len;if(!array||!array.length||!callback||!callback.call){return}for(i=0,len=array.length;i<len;i+=1){callback.call(context,array[i],i,array)}},some:function(array,callback){var i,len,val=false;for(i=0,len=array.length;i<len;i+=1){val=callback(array[i],i,array);if(val){return val}}return val},convertToArray:function(items){var i=0,len=items.length,result=[];while(i<len){result.push(items[i]);i+=1}return result},isUndefOrNull:function(obj){return typeof obj==="undefined"||obj===null},mixin:function(dst){var prop,src,srcId,len;for(srcId=1,len=arguments.length;srcId<len;srcId+=1){src=arguments[srcId];for(prop in src){if(Object.prototype.hasOwnProperty.call(src,prop)){dst[prop]=src[prop]}}}return dst},extend:function(deep,target,src){var prop="";for(prop in src){if(Object.prototype.hasOwnProperty.call(src,prop)){if(deep&&Object.prototype.toString.call(src[prop])==="[object Object]"){if(typeof target[prop]==="undefined"){target[prop]={}}utils.extend(deep,target[prop],src[prop])}else{target[prop]=src[prop]}}}return target},clone:function(obj){var copy,attr;if(null===obj||"object"!==typeof obj){return obj}if(obj instanceof Object){copy=(Object.prototype.toString.call(obj)==="[object Array]")?[]:{};for(attr in obj){if(Object.prototype.hasOwnProperty.call(obj,attr)){copy[attr]=utils.clone(obj[attr])}}return copy}},createObject:(function(){var fn=null,F=null;if(typeof Object.create==="function"){fn=Object.create}else{F=function(){};fn=function(o){if(typeof o!=="object"&&typeof o!=="function"){throw new TypeError("Object prototype need to be an object!")}F.prototype=o;return new F()}}return fn}()),access:function(path,rootObj){var obj=rootObj||window,arr,i,len;if(typeof path!=="string"||(typeof obj!=="object"&&obj!==null)){return}arr=path.split(".");for(i=0,len=arr.length;i<len;i+=1){if(i===0&&arr[i]==="window"){continue}if(!Object.prototype.hasOwnProperty.call(obj,arr[i])){return}obj=obj[arr[i]];if(i<(len-1)&&!(obj instanceof Object)){return}}return obj},isNumeric:function(character){return!isNaN(character+1-1)},isUpperCase:function(character){return character===character.toUpperCase()&&character!==character.toLowerCase()},isLowerCase:function(character){return character===character.toLowerCase()&&character!==character.toUpperCase()},getDocument:function(node){if(node.nodeType!==9){return(!utils.isUndefOrNull(node.ownerDocument))?(node.ownerDocument):(node.document)}return node},getWindow:function(node){if(node.self!==node){var ownerDocument=utils.getDocument(node);return(!utils.isUndefOrNull(ownerDocument.defaultView))?(ownerDocument.defaultView):(ownerDocument.parentWindow)}return node},getIFrameWindow:function(iFrameElement){var contentWindow=null;if(!iFrameElement){return contentWindow}try{contentWindow=iFrameElement.contentWindow||(iFrameElement.contentDocument?iFrameElement.contentDocument.parentWindow:null)}catch(e){}return contentWindow},getTagName:function(node){if(node===document){return"document"}if(node===window||node===window.window){return"window"}if(typeof node==="string"){return node.toLowerCase()}if(typeof node==="object"&&!utils.isUndefOrNull(node)&&typeof node.tagName==="string"){return node.tagName.toLowerCase()}return""},isIFrameDescendant:function(node){return utils.getWindow(node)!=TLT._getLocalTop()},getOrientationMode:function(orientation){var mode="INVALID";if(typeof orientation!=="number"){return mode}switch(orientation){case 0:case 180:case 360:mode="PORTRAIT";break;case 90:case-90:case 270:mode="LANDSCAPE";break;default:mode="UNKNOWN";break}return mode},clog:(function(window){return function(){}}(window)),trim:function(str){if(!str||!str.toString){return str}return str.toString().replace(/^\s+|\s+$/g,"")},ltrim:function(str){if(!str||!str.toString){return str}return str.toString().replace(/^\s+/,"")},rtrim:function(str){if(!str||!str.toString){return str}return str.toString().replace(/\s+$/,"")},getCookieValue:function(cookieName,cookieString){var i,len,cookie,cookies,cookieValue=null,cookieNameLen;try{cookieString=cookieString||document.cookie;if(!cookieName||!cookieName.toString){return null}cookieName+="=";cookieNameLen=cookieName.length;cookies=cookieString.split(';');for(i=0,len=cookies.length;i<len;i+=1){cookie=cookies[i];cookie=utils.ltrim(cookie);if(cookie.indexOf(cookieName)===0){cookieValue=cookie.substring(cookieNameLen,cookie.length);break}}}catch(e){}return cookieValue},getQueryStringValue:function(paramName,queryDelim,queryString){var i,j,queryStringLen,paramValue=null,valueStartIndex;try{queryString=queryString||window.location.search;queryStringLen=queryString.length;if(!paramName||!paramName.toString||!queryStringLen){return null}queryDelim=queryDelim||"&";queryString=queryDelim+queryString.substring(1);paramName=queryDelim+paramName+"=";i=queryString.indexOf(paramName);if(i!==-1){valueStartIndex=i+paramName.length;j=queryString.indexOf(queryDelim,valueStartIndex);if(j===-1){j=queryStringLen}paramValue=decodeURIComponent(queryString.substring(valueStartIndex,j))}}catch(e){}return paramValue},addEventListener:(function(){if(window.addEventListener){return function(element,eventName,listener){element.addEventListener(eventName,listener,false)}}return function(element,eventName,listener){element.attachEvent("on"+eventName,listener)}}()),WeakMap:(function(){function index(data,key){var i,len;data=data||[];for(i=0,len=data.length;i<len;i+=1){if(data[i][0]===key){return i}}return-1}return function(){var data=[];this.set=function(key,val){var idx=index(data,key);data[idx>-1?idx:data.length]=[key,val]};this.get=function(key){var arr=data[index(data,key)];return(arr?arr[1]:undefined)};this.clear=function(){data=[]};this.has=function(key){return(index(data,key)>=0)};this.remove=function(key){var idx=index(data,key);if(idx>=0){data.splice(idx,1)}};this["delete"]=this.remove}}())};if(typeof TLT==="undefined"||!TLT){window.TLT={}}TLT.utils=utils}());(function(){"use strict";TLT.EventTarget=function(){this._handlers={}};TLT.EventTarget.prototype={constructor:TLT.EventTarget,publish:function(name,data){var i=0,len=0,handlers=this._handlers[name],event={type:name,data:data};if(typeof handlers!=="undefined"){for(len=handlers.length;i<len;i+=1){handlers[i](event)}}},subscribe:function(name,handler){if(!this._handlers.hasOwnProperty(name)){this._handlers[name]=[]}this._handlers[name].push(handler)},unsubscribe:function(name,handler){var i=0,len=0,handlers=this._handlers[name];if(handlers){for(len=handlers.length;i<len;i+=1){if(handlers[i]===handler){handlers.splice(i,1);return}}}}}}());TLT.ModuleContext=(function(){"use strict";var methodsToExpose=["broadcast","getConfig:getModuleConfig","listen","post","getStartTime"];return function(moduleName,core){var context={},i=0,len=methodsToExpose.length,parts=null,coreMethod=null,contextMethod=null;for(i=0;i<len;i+=1){parts=methodsToExpose[i].split(":");if(parts.length>1){contextMethod=parts[0];coreMethod=parts[1]}else{contextMethod=parts[0];coreMethod=parts[0]}context[contextMethod]=(function(coreMethod){return function(){var args=core.utils.convertToArray(arguments);args.unshift(moduleName);return core[coreMethod].apply(core,args)}}(coreMethod))}context.utils=core.utils;return context}}());TLT.addService("config",function(core){"use strict";function mergeConfig(oldConf,newConf){core.utils.extend(true,oldConf,newConf);configService.publish("configupdated",configService.getConfig())}var config={core:{},modules:{},services:{}},configService=core.utils.extend(false,core.utils.createObject(new TLT.EventTarget()),{getConfig:function(){return config},updateConfig:function(newConf){mergeConfig(config,newConf)},getCoreConfig:function(){return config.core},updateCoreConfig:function(newConf){mergeConfig(config.core,newConf)},getServiceConfig:function(serviceName){return config.services[serviceName]||null},updateServiceConfig:function(serviceName,newConf){if(typeof config.services[serviceName]==="undefined"){config.services[serviceName]={}}mergeConfig(config.services[serviceName],newConf)},getModuleConfig:function(moduleName){return config.modules[moduleName]||null},updateModuleConfig:function(moduleName,newConf){if(typeof config.modules[moduleName]==="undefined"){config.modules[moduleName]={}}mergeConfig(config.modules[moduleName],newConf)},destroy:function(){config={core:{},modules:{},services:{}}}});return configService});TLT.addService("queue",function(core){"use strict";var CONFIG=null,aS=core.getService("ajax"),bS=core.getService("browser"),sS=core.getService("serializer"),cS=core.getService("config"),mS=core.getService("message"),defaultQueue=null,queueTimers={},autoFlushing=true,isInitialized=false,queueManager=(function(){var queues={};function queueExists(queueId){return typeof queues[queueId]!=="undefined"}function addQueue(queueId,opts){if(!queueExists(queueId)){queues[queueId]={data:[],queueId:queueId,url:opts.url,threshold:opts.threshold,serializer:opts.serializer,crossDomainEnabled:!!opts.crossDomainEnabled,crossDomainIFrame:opts.crossDomainIFrame}}return queues[queueId]}function removeQueue(queueId){if(queueExists(queueId)){delete queues[queueId]}}function getQueue(queueId){if(queueExists(queueId)){return queues[queueId]}return null}function clearQueue(queueId){var queue=getQueue(queueId);if(queue!==null){queue.data=[]}}function flushQueue(queueId){var data=null;if(queueExists(queueId)){data=getQueue(queueId).data;clearQueue(queueId)}return data}function pushToQueue(queueId,data){var queue=null,jsonStr=null,bridgeAndroid=window.tlBridge,bridgeiOS=window.iOSJSONShuttle;if((typeof bridgeAndroid!=="undefined")&&(typeof bridgeAndroid.addMessage==="function")){jsonStr=sS.serialize(data);bridgeAndroid.addMessage(jsonStr)}else if((typeof bridgeiOS!=="undefined")&&(typeof bridgeiOS==="function")){jsonStr=sS.serialize(data);bridgeiOS(jsonStr)}else{if(queueExists(queueId)){queue=getQueue(queueId);return queue.data.push(data)}}return 0}return{SEND_HEADER_ONCE:-1,SEND_HEADER_ALWAYS:-2,exists:queueExists,add:addQueue,remove:removeQueue,get:getQueue,clear:clearQueue,flush:flushQueue,push:pushToQueue}}());function handleXhrCallback(){}function getUrlPath(){return window.location.pathname}function flushQueue(queueId,sync){var data=queueManager.flush(queueId),count=data!==null?data.length:0,queue=queueManager.get(queueId),httpHeaders={"Content-Type":"application/json","X-Tealeaf":"device (UIC) Lib/3.0.1.1068","X-TealeafType":"GUI","X-TeaLeaf-Page-Url":getUrlPath()},serializer=queue.serializer||"json",requestData,xdomainFrameWindow=null;data=mS.wrapMessages(data);if(count){if(queue.crossDomainEnabled){xdomainFrameWindow=core.utils.getIFrameWindow(queue.crossDomainIFrame);if(!xdomainFrameWindow){return}requestData={request:{url:queue.url,async:!sync,headers:httpHeaders,data:sS.serialize(data,serializer)}};if(!core.utils.isIE&&typeof window.postMessage==="function"){xdomainFrameWindow.postMessage(requestData,queue.crossDomainIFrame.src)}else{try{xdomainFrameWindow.sendMessage(requestData)}catch(e){return}}}else{aS.sendRequest({oncomplete:handleXhrCallback,url:queue.url,async:!sync,headers:httpHeaders,data:sS.serialize(data,serializer)})}}}function flushAll(sync){var conf=null,i=0;for(i=0;i<CONFIG.length;i+=1){conf=CONFIG[i];flushQueue(conf.qid,sync)}return true}function addToQueue(queueId,data){var length=queueManager.push(queueId,mS.createMessage(data));if(length>=queueManager.get(queueId).threshold&&autoFlushing&&core.getState()!=="unloading"){flushQueue(queueId)}}function getQueueId(moduleName){var conf=null,module="",i=0,j=0;for(i=0;i<CONFIG.length;i+=1){conf=CONFIG[i];if(conf&&conf.modules){for(j=0;j<conf.modules.length;j+=1){module=conf.modules[j];if(module===moduleName){return conf.qid}}}}return defaultQueue.qid}function setTimer(qid,interval){queueTimers[qid]=window.setTimeout(function tick(){flushQueue(qid);queueTimers[qid]=window.setTimeout(tick,interval)},interval)}function clearTimers(){var key=0;for(key in queueTimers){if(queueTimers.hasOwnProperty(key)){window.clearTimeout(queueTimers[key]);delete queueTimers[key]}}queueTimers={}}function handleConfigUpdated(newConf){}function initQueueService(config){CONFIG=config;var conf=null,key,crossDomainIFrame=null;for(key in CONFIG){if(CONFIG.hasOwnProperty(key)){crossDomainIFrame=null;conf=CONFIG[key];if(conf.qid==="DEFAULT"){defaultQueue=conf}if(conf.crossDomainEnabled){crossDomainIFrame=bS.query(conf.crossDomainFrameSelector);if(!crossDomainIFrame){core.fail("Cross domain iframe not found")}}queueManager.add(conf.qid,{url:conf.endpoint,threshold:conf.maxEvents,serializer:conf.serializer,timerInterval:conf.timerInterval||0,crossDomainEnabled:conf.crossDomainEnabled||false,crossDomainIFrame:crossDomainIFrame});if(typeof conf.timerInterval!=="undefined"&&conf.timerInterval>0){setTimer(conf.qid,conf.timerInterval)}}}cS.subscribe("configupdated",handleConfigUpdated);isInitialized=true}function destroy(){if(autoFlushing){flushAll(true)}cS.unsubscribe("configupdated",handleConfigUpdated);clearTimers();CONFIG=null;defaultQueue=null;isInitialized=false}return{init:function(){if(!isInitialized){initQueueService(cS.getServiceConfig("queue")||{})}else{}},destroy:function(){destroy()},_getQueue:function(qid){return queueManager.get(qid).data},setAutoFlush:function(value){if(value===1){autoFlushing=true}else{autoFlushing=false}},flush:function(queueId){if(!queueManager.exists(queueId)){throw new Error("Queue: "+queueId+" does not exist!")}flushQueue(queueId)},flushAll:function(sync){return flushAll(!!sync)},post:function(moduleName,queueEvent,queueId){queueId=queueId||getQueueId(moduleName);if(!queueManager.exists(queueId)){throw new Error("Queue: "+queueId+" does not exist!")}addToQueue(queueId,queueEvent)}}});TLT.addService("browserBase",function(core){"use strict";var nonClickableTags={OPTGROUP:true,OPTION:true,NOBR:true},queryDom={},configService=core.getService("config"),serializer,config,blacklist,customid,getXPathFromNode,isInitialized=false;function updateConfig(){configService=core.getService("config");serializer=core.getService("serializer");config=core.getService("config").getServiceConfig("browser")||{};blacklist=config.hasOwnProperty("blacklist")?config.blacklist:[];customid=config.hasOwnProperty("customid")?config.customid:[]}function initBrowserBase(){updateConfig();configService.subscribe("configupdated",updateConfig);isInitialized=true}function destroy(){configService.unsubscribe("configupdated",updateConfig);isInitialized=false}function checkId(node){var i,len,re;if(!node||!node.id||typeof node.id!=="string"){return false}for(i=0,len=blacklist.length;i<len;i+=1){if(typeof blacklist[i]==="string"){if(node.id===blacklist[i]){return false}}else if(typeof blacklist[i]==="object"){re=new RegExp(blacklist[i].regex,blacklist[i].flags);if(re.test(node.id)){return false}}}return true}getXPathFromNode=(function(){var specialChildNodes={"NOBR":true,"P":true};function getXPathArrayFromNode(node){var i,j,idValid=false,tmp_child=null,parent_window=null,parent_node=null,xpath=[],loop=true,localTop=core._getLocalTop();while(loop){loop=false;if(!core.utils.isUndefOrNull(node)){if(!core.utils.isUndefOrNull(node.tagName)){if(specialChildNodes.hasOwnProperty(node.tagName)){node=node.parentNode}}for(idValid=checkId(node);node!==document&&!idValid;idValid=checkId(node)){parent_node=node.parentNode;if(!parent_node){parent_window=core.utils.getWindow(node);parent_node=(parent_window!==localTop)?parent_window.frameElement:document}tmp_child=parent_node.firstChild;if(typeof tmp_child==="undefined"){return xpath}for(j=0;tmp_child;tmp_child=tmp_child.nextSibling){if(tmp_child.nodeType===1&&tmp_child.tagName===node.tagName){if(tmp_child===node){xpath[xpath.length]=[node.tagName,j];break}j+=1}}node=parent_node}if(idValid){xpath[xpath.length]=[node.id];if(core.utils.isIFrameDescendant(node)){loop=true;node=core.utils.getWindow(node).frameElement}}}}return xpath}return function getXPathFromNode(node){var xpath=getXPathArrayFromNode(node),parts=[],i=xpath.length;if(i<1){return"null"}while(i){i-=1;if(xpath[i].length>1){parts[parts.length]='["'+xpath[i][0]+'",'+xpath[i][1]+"]"}else{parts[parts.length]='['+serializer.serialize(xpath[i][0],"json")+']'}}return("["+parts.join(",")+"]")}}());function isJQueryEvent(event){return event&&typeof event.originalEvent!=="undefined"&&typeof event.isDefaultPrevented!=="undefined"&&!event.isSimulated}function getEventDetails(event){if(!event){return null}if(event.type&&event.type.indexOf("touch")===0){if(isJQueryEvent(event)){event=event.originalEvent}if(event.type==="touchstart"){event=event.touches[event.touches.length-1]}else if(event.type==="touchend"){event=event.changedTouches[0]}}return event}function normalizeEvent(event){var e=event||window.event,doc=document.documentElement,body=document.body;if(isJQueryEvent(e)){e=e.originalEvent}if(typeof event==='undefined'||typeof e.target==='undefined'){e.target=e.srcElement||window.window;e.timeStamp=Number(new Date());if(e.pageX===null||typeof e.pageX==="undefined"){e.pageX=e.clientX+((doc&&doc.scrollLeft)||(body&&body.scrollLeft)||0)-((doc&&doc.clientLeft)||(body&&body.clientLeft)||0);e.pageY=e.clientY+((doc&&doc.scrollTop)||(body&&body.scrollTop)||0)-((doc&&doc.clientTop)||(body&&body.clientTop)||0)}e.preventDefault=function(){this.returnValue=false};e.stopPropagation=function(){this.cancelBubble=true}}return e}function normalizeTarget(event){var itemSource=null;if(!event){return null}if(event.srcElement){itemSource=event.srcElement}else{itemSource=event.target;if(!itemSource){itemSource=event.explicitOriginalTarget}if(!itemSource){itemSource=event.originalTarget}}if(!itemSource&&event.type.indexOf("touch")===0){itemSource=getEventDetails(event).target}while(itemSource&&nonClickableTags[itemSource.tagName]){itemSource=itemSource.parentNode}if(!itemSource&&event.srcElement===null){itemSource=window.window}return itemSource}function getEventPosition(event){var posX=0,posY=0,doc=document.documentElement,body=document.body;event=getEventDetails(event);if(event!==null){if(event.pageX&&event.pageY&&event.pageX>0&&event.pageY>0){posX=event.pageX;posY=event.pageY}else if(event.clientX&&event.clientY){posX=event.clientX+((doc&&doc.scrollLeft)||(body&&body.scrollLeft)||0)-((doc&&doc.clientLeft)||(body&&body.clientLeft)||0);posY=event.clientY+((doc&&doc.scrollTop)||(body&&body.scrollTop)||0)-((doc&&doc.clientTop)||(body&&body.clientTop)||0)}}return{x:posX,y:posY}}queryDom.xpath=function(query,scope){var xpath=serializer.parse(query),elem,pathElem=null,i,j,k,len,jlen;scope=typeof scope!=="undefined"?scope:document;elem=scope;if(!xpath){return null}for(i=0,len=xpath.length;i<len&&elem;i+=1){pathElem=xpath[i];if(pathElem.length===1){elem=scope.getElementById(pathElem[0])}else{for(j=0,k=-1,jlen=elem.childNodes.length;j<jlen;j+=1){if(elem.childNodes[j].nodeType===1&&elem.childNodes[j].tagName.toUpperCase()===pathElem[0]){k+=1;if(k===pathElem[1]){elem=elem.childNodes[j];break}}}if(k===-1){return null}}}return elem===scope||!elem?null:elem};function Point(x,y){this.x=x||0;this.y=y||0}function Size(width,height){this.width=width||0;this.height=height||0}function ElementData(event,target){var id,type,pos;target=normalizeTarget(event);id=this.examineID(target);type=this.examineType(target,event);pos=this.examinePosition(event,target);this.element=target;this.id=id.id;this.idType=id.type;this.type=type.type;this.subType=type.subType;this.state=this.examineState(target);this.position=new Point(pos.x,pos.y);this.size=new Size(pos.width,pos.height);this.xPath=id.xPath;this.name=id.name}ElementData.HTML_ID=-1;ElementData.XPATH_ID=-2;ElementData.ATTRIBUTE_ID=-3;ElementData.prototype.examineID=function(target){var id,type,xPath,attribute_id,name,i=customid.length,attrib;try{xPath=getXPathFromNode(target)}catch(e){}name=target.name;try{if(!core.utils.isIFrameDescendant(target)){if(checkId(target)){id=target.id;type=ElementData.HTML_ID}else if(customid.length&&target.attributes){while(i){i-=1;attrib=target.attributes[customid[i]];if(typeof attrib!=="undefined"){id=customid[i]+"="+(attrib.value||attrib);type=ElementData.ATTRIBUTE_ID}}}}}catch(e2){}if(!id){id=xPath;type=ElementData.XPATH_ID}return{id:id,type:type,xPath:xPath,name:name}};ElementData.prototype.examineType=function(target,event){var subType="";if(event.type==="change"){if(target.tagName==="TEXTAREA"||(target.tagName==="INPUT"&&target.type==="text")){subType="textChange"}else{subType="valueChange"}}else{subType=event.type}return{type:event.type,subType:subType}};ElementData.prototype.examineState=function(target){var tagnames={"a":["innerText","href"],"input":{"range":["maxValue:max","value"],"checkbox":["value","checked"],"radio":["value","checked"],"image":["src"]},"select":["value"],"button":["value","innerText"],"textarea":["value"]},tagName=typeof target.tagName!=="undefined"?target.tagName.toLowerCase():"",properties=tagnames[tagName]||null,selectedOption=null,values=null,i=0,len=0,alias=null,key="";if(properties!==null){if(Object.prototype.toString.call(properties)==="[object Object]"){properties=properties[target.type]||["value"]}values={};for(key in properties){if(properties.hasOwnProperty(key)){if(properties[key].indexOf(":")!==-1){alias=properties[key].split(":");values[alias[0]]=target[alias[1]]}else if(properties[key]==="innerText"){values[properties[key]]=target.innerText||target.textContent}else{values[properties[key]]=target[properties[key]]}}}}if(tagName==="select"&&target.options&&!isNaN(target.selectedIndex)){values.index=target.selectedIndex;if(values.index>=0&&values.index<target.options.length){selectedOption=target.options[target.selectedIndex];values.value=selectedOption.getAttribute("value")||selectedOption.getAttribute("label")||selectedOption.text||selectedOption.innerText;values.text=selectedOption.text||selectedOption.innerText}}return values};function getZoomValue(){var factor=1,rect,physicalW,logicalW;if(document.body.getBoundingClientRect){try{rect=document.body.getBoundingClientRect()}catch(e){core.utils.clog("getBoundingClientRect failed.",e);return factor}physicalW=rect.right-rect.left;logicalW=document.body.offsetWidth;factor=Math.round((physicalW/logicalW)*100)/100}return factor}function getBoundingClientRectNormalized(element){var rect,rectangle,zoom;if(typeof element==="undefined"||element===null||!element.getBoundingClientRect){return{x:0,y:0,width:0,height:0}}try{rect=element.getBoundingClientRect()}catch(e){core.utils.clog("getBoundingClientRect failed.",e);return{x:0,y:0,width:0,height:0}}rectangle={x:rect.left,y:rect.top,width:rect.right-rect.left,height:rect.bottom-rect.top};if(core.utils.isIE){rectangle.x-=document.documentElement.clientLeft;rectangle.y-=document.documentElement.clientTop;zoom=getZoomValue();if(zoom!==1){rectangle.x=Math.round(rectangle.x/zoom);rectangle.y=Math.round(rectangle.y/zoom);rectangle.width=Math.round(rectangle.width/zoom);rectangle.height=Math.round(rectangle.height/zoom)}}return rectangle}ElementData.prototype.examinePosition=function(event,target){var posOnDoc=getEventPosition(event),elPos=getBoundingClientRectNormalized(target);elPos.x=posOnDoc.x!==0&&posOnDoc.y!==0?Math.round(Math.abs(posOnDoc.x-elPos.x)):elPos.width/2;elPos.y=posOnDoc.x!==0&&posOnDoc.y!==0?Math.round(Math.abs(posOnDoc.y-elPos.y)):elPos.height/2;return elPos};function WebEvent(event){var pos;this.data=event.data||null;this.delegateTarget=event.delegateTarget||null;event=normalizeEvent(event);pos=getEventPosition(event);this.custom=false;this.nativeEvent=this.custom===true?null:event;this.position=new Point(pos.x,pos.y);this.target=new ElementData(event,event.target);this.timestamp=(new Date()).getTime();this.type=event.type;switch(this.type){case"focusin":this.type="focus";break;case"focusout":this.type="blur";break;default:break}}function processDOMEvent(event){core._publishEvent(new WebEvent(event))}return{init:function(){if(!isInitialized){initBrowserBase()}else{}},destroy:function(){destroy()},WebEvent:WebEvent,ElementData:ElementData,processDOMEvent:processDOMEvent,queryDom:queryDom}});TLT.addService("browser",function(core){"use strict";var configService=core.getService("config"),browserBaseService=core.getService('browserBase'),ajaxService=core.getService('ajax'),addEventListener=null,removeEventListener=null,serviceConfig=configService.getServiceConfig("browser")||{},useCapture=(serviceConfig.useCapture===true),isInitialized=false,errorCodes={NO_QUERY_SELECTOR:"NOQUERYSELECTOR"},wrapWebEvent=function(handler){return function(event){handler(new browserBaseService.WebEvent(event))}},loadScript=function(url){var fjs=document.getElementsByTagName('script')[0],js=document.createElement('script');js.src=url;fjs.parentNode.insertBefore(js,fjs)},queryDom={list2Array:function(nodeList){var len=nodeList.length,result=[],i;if(typeof nodeList.length==="undefined"){return[nodeList]}for(i=0;i<len;i+=1){result[i]=nodeList[i]}return result},find:function(query,scope,type){type=type||"css";return this.list2Array(this[type](query,scope))},css:function(query,scope){var self=this,message=null,bodyEl=document.getElementsByTagName("body")[0],bConfig=configService.getServiceConfig("browser")||{},sizzleURL=bConfig.sizzleURL||null,jQuery=bConfig.hasOwnProperty("jQueryObject")?core.utils.access(bConfig.jQueryObject):window.jQuery,sizzle=bConfig.hasOwnProperty("sizzleObject")?core.utils.access(bConfig.sizzleObject):window.Sizzle;if(typeof document.querySelectorAll==="undefined"){self.css=function(query,scope){scope=scope||document;return self.Sizzle(query,scope)};if(typeof self.Sizzle==="undefined"){if(sizzleURL){message={type:"GET",url:sizzleURL,async:false,oncomplete:function(result){function define(definition){self.Sizzle=definition()}define.amd=true;eval(result.responseText)}};ajaxService.sendRequest(message)}else{try{if(bodyEl===sizzle("html > body",document)[0]){self.Sizzle=sizzle}}catch(e){try{if(bodyEl===jQuery(document).find("html > body").get()[0]){self.Sizzle=function(query,scope){return jQuery(scope).find(query).get()}}}catch(ex){core.fail("Sizzle was not found",errorCodes.NO_QUERY_SELECTOR)}}}}}else{self.css=function(query,scope){scope=scope||document;return scope.querySelectorAll(query)}}return self.css(query,scope)}},handlerMappings=(function(){var data=new core.utils.WeakMap();return{add:function(originalHandler){var handlers=data.get(originalHandler)||[wrapWebEvent(originalHandler),0];handlers[1]+=1;data.set(originalHandler,handlers);return handlers[0]},find:function(originalHandler){var handlers=data.get(originalHandler);return handlers?handlers[0]:null},remove:function(originalHandler){var handlers=data.get(originalHandler);if(handlers){handlers[1]-=1;if(handlers[1]<=0){data.remove(originalHandler)}}}}}());function initBrowserServiceW3C(){queryDom.xpath=browserBaseService.queryDom.xpath;if(typeof document.addEventListener==='function'){addEventListener=function(target,eventName,handler){target.addEventListener(eventName,handler,useCapture)};removeEventListener=function(target,eventName,handler){target.removeEventListener(eventName,handler,useCapture)}}else if(typeof document.attachEvent!=='undefined'){addEventListener=function(target,eventName,handler){target.attachEvent('on'+eventName,handler)};removeEventListener=function(target,eventName,handler){target.detachEvent('on'+eventName,handler)}}else{throw new Error("Unsupported browser")}isInitialized=true}return{init:function(){if(!isInitialized){initBrowserServiceW3C()}else{}},destroy:function(){isInitialized=false},getServiceName:function(){return"W3C"},query:function(query,scope,type){return queryDom.find(query,scope,type)[0]||null},queryAll:function(query,scope,type){return queryDom.find(query,scope,type)},loadScript:function(url){loadScript(url)},subscribe:function(eventName,target,handler){var wrappedHandler=handlerMappings.add(handler);addEventListener(target,eventName,wrappedHandler)},unsubscribe:function(eventName,target,handler){var wrappedHandler=handlerMappings.find(handler);if(wrappedHandler){try{removeEventListener(target,eventName,wrappedHandler)}catch(e){}handlerMappings.remove(handler)}}}});TLT.addService("ajax",function(core){"use strict";var getXHRObject,convertHeaders=function(headersObj){var header="",headers=[];for(header in headersObj){if(headersObj.hasOwnProperty(header)){headers.push([header,headersObj[header]])}}return headers},isInitialized=false;function extractResponseHeaders(headers){headers=headers.split('\n');var headersObj={},i=0,len=headers.length,header=null;for(i=0;i<len;i+=1){header=headers[i].split(': ');headersObj[header[0]]=header[1]}return headersObj}function makeAjaxCall(message){var xhr=getXHRObject(),headers=[["X-Requested-With","XMLHttpRequest"]],timeout=0,async=typeof message.async!=="boolean"?true:message.async,header="",callbackFn=null,i,length;if(message.headers){headers=headers.concat(convertHeaders(message.headers))}if(message.contentType){headers.push(["Content-Type",message.contentType])}xhr.open(message.type.toUpperCase(),message.url,async);for(i=0,length=headers.length;i<length;i+=1){header=headers[i];if(header[0]&&header[1]){xhr.setRequestHeader(header[0],header[1])}}xhr.onreadystatechange=callbackFn=function(){if(xhr.readyState===4){xhr.onreadystatechange=callbackFn=function(){};if(message.timeout){window.clearTimeout(timeout)}message.oncomplete({headers:extractResponseHeaders(xhr.getAllResponseHeaders()),responseText:(xhr.responseText||null),statusCode:xhr.status,success:(xhr.status===200)});xhr=null}};xhr.send(message.data||null);callbackFn();if(message.timeout){timeout=window.setTimeout(function(){if(!xhr){return}xhr.onreadystatechange=function(){};if(xhr.readyState!==4){xhr.abort()}xhr=null},message.timeout)}}function initAjaxService(){if(typeof window.XMLHttpRequest!=='undefined'){getXHRObject=function(){return new XMLHttpRequest()}}else{getXHRObject=function(){return new ActiveXObject("Microsoft.XMLHTTP")}}isInitialized=true}return{init:function(){if(!isInitialized){initAjaxService()}},destroy:function(){isInitialized=false},sendRequest:function(message){message.type=message.type||"POST";makeAjaxCall(message)}}});TLT.addService("message",function(core){"use strict";var screenviewOffsetTime=null,count=0,messageCount=0,sessionStart=new Date(),tlStartLoad=new Date(),browserBaseService=core.getService("browserBase"),browserService=core.getService("browser"),configService=core.getService("config"),config=configService.getServiceConfig("message")||{},windowHref=window.location.href,windowId="TODO",pageId="ID"+tlStartLoad.getHours()+"H"+tlStartLoad.getMinutes()+"M"+tlStartLoad.getSeconds()+"S"+tlStartLoad.getMilliseconds()+"R"+Math.random(),privacy=config.hasOwnProperty("privacy")?config.privacy:[],privacyMasks={},maskingCharacters={lower:"x",upper:"X",numeric:"9",symbol:"@"},isApple=navigator.userAgent.indexOf("iPhone")>-1||navigator.userAgent.indexOf("iPod")>-1||navigator.userAgent.indexOf("iPad")>-1,devicePixelRatio=window.devicePixelRatio||1,deviceOriginalWidth=window.screen?window.screen.width:0,deviceOriginalHeight=window.screen?window.screen.height:0,deviceOrientation=window.orientation||0,deviceWidth=isApple?deviceOriginalWidth:deviceOriginalWidth<=320?deviceOriginalWidth:deviceOriginalWidth/devicePixelRatio,deviceHeight=isApple?deviceOriginalHeight:deviceOriginalWidth<=320?deviceOriginalHeight:deviceOriginalHeight/devicePixelRatio,deviceToolbarHeight=(window.screen===null?0:window.screen.height-window.screen.availHeight),startWidth=window.innerWidth||document.documentElement.clientWidth,startHeight=window.innerHeight||document.documentElement.clientHeight,isInitialized=false;function Message(event){var key='';this.type=event.type;this.offset=(new Date()).getTime()-sessionStart.getTime();if((event.type===2)||(screenviewOffsetTime===null)){screenviewOffsetTime=new Date()}this.screenviewOffset=(new Date()).getTime()-screenviewOffsetTime.getTime();this.count=(messageCount+=1);this.fromWeb=true;for(key in event){if(event.hasOwnProperty(key)){this[key]=event[key]}}}privacyMasks.PVC_MASK_EMPTY=function(value){return""};privacyMasks.PVC_MASK_BASIC=function(value){var retMask="XXXXX";if(typeof value!=="string"){return""}return(value.length?retMask:"")};privacyMasks.PVC_MASK_TYPE=function(value){var characters,i=0,len=0,retMask="";if(typeof value!=="string"){return retMask}characters=value.split("");for(i=0,len=characters.length;i<len;i+=1){if(core.utils.isNumeric(characters[i])){retMask+=maskingCharacters.numeric}else if(core.utils.isUpperCase(characters[i])){retMask+=maskingCharacters.upper}else if(core.utils.isLowerCase(characters[i])){retMask+=maskingCharacters.lower}else{retMask+=maskingCharacters.symbol}}return retMask};privacyMasks.PVC_MASK_EMPTY.maskType=1;privacyMasks.PVC_MASK_BASIC.maskType=2;privacyMasks.PVC_MASK_TYPE.maskType=3;privacyMasks.PVC_MASK_CUSTOM={maskType:4};function applyMask(mask,message){var filter=privacyMasks.PVC_MASK_BASIC;if(mask.maskType===privacyMasks.PVC_MASK_EMPTY.maskType){filter=privacyMasks.PVC_MASK_EMPTY}else if(mask.maskType===privacyMasks.PVC_MASK_BASIC.maskType){filter=privacyMasks.PVC_MASK_BASIC}else if(mask.maskType===privacyMasks.PVC_MASK_TYPE.maskType){filter=privacyMasks.PVC_MASK_TYPE}else if(mask.maskType===privacyMasks.PVC_MASK_CUSTOM.maskType){if(typeof mask.maskFunction==="string"){filter=core.utils.access(mask.maskFunction)}else{filter=mask.maskFunction}if(typeof filter!=="function"){filter=privacyMasks.PVC_MASK_BASIC}}if(typeof message.target.prevState!=="undefined"&&message.target.prevState.hasOwnProperty("value")){message.target.prevState.value=filter(message.target.prevState.value)}if(typeof message.target.currState!=="undefined"&&message.target.currState.hasOwnProperty("value")){message.target.currState.value=filter(message.target.currState.value)}}function matchesTarget(targets,target){var i,j,qr,qrLen,qrTarget,regex,len,tmpTarget;for(i=0,len=targets.length;i<len;i+=1){tmpTarget=targets[i];if(typeof tmpTarget==="string"){qr=browserService.queryAll(tmpTarget);for(j=0,qrLen=qr?qr.length:0;j<qrLen;j+=1){if(qr[j]){qrTarget=browserBaseService.ElementData.prototype.examineID(qr[j]);if(qrTarget.type===target.idType&&qrTarget.id===target.id){return true}}}}else if(tmpTarget.id&&tmpTarget.idType&&target.idType.toString()===tmpTarget.idType.toString()){switch(typeof tmpTarget.id){case"string":if(tmpTarget.id===target.id){return true}break;case"object":regex=new RegExp(tmpTarget.id.regex,tmpTarget.id.flags);if(regex.test(target.id)){return true}break}}}return false}function privacyFilter(message){var i,len,mask;if(!message||!message.hasOwnProperty("target")){return message}for(i=0,len=privacy.length;i<len;i+=1){mask=privacy[i];if(matchesTarget(mask.targets,message.target)){applyMask(mask,message);break}}return message}function updateConfig(){configService=core.getService("config");config=configService.getServiceConfig("message")||{};privacy=config.hasOwnProperty("privacy")?config.privacy:[]}function initMessageService(){if(configService.subscribe){configService.subscribe("configupdated",updateConfig)}isInitialized=true}function destroy(){configService.unsubscribe("configupdated",updateConfig);isInitialized=false}return{init:function(){if(!isInitialized){initMessageService()}else{}},destroy:function(){destroy()},createMessage:function(event){if(typeof event.type==="undefined"){throw new TypeError("Invalid queueEvent given!")}return privacyFilter(new Message(event))},wrapMessages:function(messages){var messagePackage={messageVersion:"2.2.0.0",serialNumber:(count+=1),sessions:[{id:pageId,startTime:tlStartLoad.getTime(),timezoneOffset:tlStartLoad.getTimezoneOffset(),messages:messages,clientEnvironment:{webEnvironment:{libVersion:"3.0.1.1068",page:windowHref,windowId:windowId,screen:{devicePixelRatio:devicePixelRatio,deviceOriginalWidth:isApple?deviceOriginalWidth*devicePixelRatio:deviceOriginalWidth,deviceOriginalHeight:isApple?deviceOriginalHeight*devicePixelRatio:deviceOriginalHeight,deviceWidth:deviceWidth,deviceHeight:deviceHeight,deviceToolbarHeight:deviceToolbarHeight,width:startWidth,height:startHeight,orientation:deviceOrientation}}}}]},webEnvScreen=messagePackage.sessions[0].clientEnvironment.webEnvironment.screen;webEnvScreen.orientationMode=core.utils.getOrientationMode(webEnvScreen.orientation);return messagePackage}}});TLT.addService("serializer",function(core){"use strict";function serializeToJSON(obj){var str,key,len=0;if(typeof obj!=="object"||obj===null){switch(typeof obj){case"function":case"undefined":return"null";case"string":return'"'+obj.replace(/\"/g,'\\"')+'"';default:return String(obj)}}else if(Object.prototype.toString.call(obj)==="[object Array]"){str="[";for(key=0,len=obj.length;key<len;key+=1){if(Object.prototype.hasOwnProperty.call(obj,key)){str+=serializeToJSON(obj[key])+","}}}else{str="{";for(key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)){str=str.concat('"',key,'":',serializeToJSON(obj[key]),",");len+=1}}}if(len>0){str=str.substring(0,str.length-1)}str+=String.fromCharCode(str.charCodeAt(0)+2);return str}var configService=core.getService("config"),serialize={},parse={},defaultSerializers={json:(function(){if(typeof window.JSON!=="undefined"){return{serialize:window.JSON.stringify,parse:window.JSON.parse}}return{serialize:serializeToJSON,parse:function(data){return eval("("+data+")")}}}())},updateConfig=null,isInitialized=false;function addObjectIfExist(paths,rootObj,propertyName){var i,len,obj;paths=paths||[];for(i=0,len=paths.length;i<len;i+=1){obj=paths[i];if(typeof obj==="string"){obj=core.utils.access(obj)}if(typeof obj==="function"){rootObj[propertyName]=obj;break}}}function initSerializerService(config){var format;for(format in config){if(config.hasOwnProperty(format)){addObjectIfExist(config[format].stringifiers,serialize,format);addObjectIfExist(config[format].parsers,parse,format)}}if(!(config.json&&config.json.hasOwnProperty("defaultToBuiltin"))||config.json.defaultToBuiltin===true){serialize.json=serialize.json||defaultSerializers.json.serialize;parse.json=parse.json||defaultSerializers.json.parse}if(typeof serialize.json!=="function"||typeof parse.json!=="function"){core.fail("JSON parser and/or serializer not provided in the UIC config. Can't continue.")}if(configService.subscribe){configService.subscribe("configupdated",updateConfig)}isInitialized=true}function destroy(){serialize={};parse={};configService.unsubscribe("configupdated",updateConfig);isInitialized=false}updateConfig=function(){configService=core.getService("config");initSerializerService(configService.getServiceConfig("serializer")||{})};return{init:function(){if(!isInitialized){initSerializerService(configService.getServiceConfig("serializer")||{})}else{}},destroy:function(){destroy()},parse:function(data,type){type=type||"json";return parse[type](data)},serialize:function(data,type){type=type||"json";return serialize[type](data)}}});if(TLT&&typeof TLT.addModule==="function"){TLT.addModule("overstat",function(context){"use strict";var hoverTargets={},hoverThreshold=null,DEFAULT_HOVER_THRESHOLD=250,MIN_HOVER_THRESHOLD=100;function postUIEvent(queueEvent){context.post(queueEvent)}function getValue(parentObj,propertyAsStr){var i,properties;if(!parentObj||typeof parentObj!=="object"){return null}properties=propertyAsStr.split(".");for(i=0;i<properties.length;i+=1){if((typeof parentObj==="undefined")||(parentObj[properties[i]]===null)){return null}parentObj=parentObj[properties[i]]}return parentObj}function getHoverTimeThreshold(){var overstatConfig=context.getConfig()||{},threshold=overstatConfig.hoverThreshold;threshold=typeof threshold!=="number"?DEFAULT_HOVER_THRESHOLD:(threshold<MIN_HOVER_THRESHOLD?MIN_HOVER_THRESHOLD:threshold);return threshold}function handleHoverEvents(event,tlEvent){var hoverTarget=null,targetId=getValue(event,"target.id"),hoverTime=0,hoverEvent=null,hoverToClickEvent=null;if(!targetId){return}if(hoverThreshold===null){hoverThreshold=getHoverTimeThreshold()}if(event.type==="mouseover"){hoverTargets[targetId]=hoverTargets[targetId]||{clickOccurred:false};hoverTargets[targetId].timestamp=event.timestamp;return}hoverTarget=hoverTargets[targetId];if(!hoverTarget||!hoverTarget.timestamp){return}hoverTime=Math.abs(event.timestamp-hoverTarget.timestamp);if(event.type==="mouseout"){delete hoverTarget.timestamp;hoverTarget.clickOccurred=false;if(hoverTime>=hoverThreshold){hoverEvent={type:4,event:{type:event.type,tlEvent:"hover"},target:{id:getValue(event,"target.id"),idType:getValue(event,"target.idType"),currState:{hoverTime:hoverTime}}};postUIEvent(hoverEvent)}return}if(event.type==="click"&&hoverTime>=hoverThreshold&&!hoverTarget.clickOccurred){hoverTarget.clickOccurred=true;hoverEvent={type:4,event:{type:event.type,tlEvent:"hoverToClick"},target:{id:getValue(event,"target.id"),idType:getValue(event,"target.idType"),currState:{hoverTime:hoverTime}}};postUIEvent(hoverEvent);return}}return{init:function(){},destroy:function(){},onevent:function(event){if(typeof event!=="object"||!event.type){return}switch(event.type){case"mouseover":handleHoverEvents(event);break;case"mouseout":handleHoverEvents(event);break;case"click":handleHoverEvents(event);break;default:break}},onmessage:function(msg){}}})}else{}if(TLT&&typeof TLT.addModule==="function"){TLT.addModule("performance",function(context){"use strict";var moduleState={loadReceived:false,unloadReceived:false,perfEventSent:false},calculatedRenderTime=0;function isFiltered(prop,filter){if(typeof prop!=="string"){return false}if(!filter||typeof filter!=="object"){return false}return(filter[prop]===true)}function parseTiming(timing,filter){var epoch=0,normalizedTiming={},prop="",value=0;if(!timing||typeof timing!=="object"||!timing.navigationStart){return{}}epoch=timing.navigationStart;for(prop in timing){if(Object.prototype.hasOwnProperty.call(timing,prop)||typeof timing[prop]==="number"){if(!isFiltered(prop,filter)){value=timing[prop];if(typeof value==="number"&&value){normalizedTiming[prop]=value-epoch}else{normalizedTiming[prop]=value}}}}return normalizedTiming}function getRenderTime(timing){var renderTime=0,startTime,endTime,utils=context.utils;if(timing){startTime=(timing.responseEnd>0&&timing.responseEnd<timing.domLoading)?timing.responseEnd:timing.domLoading;endTime=timing.loadEventStart;if(utils.isNumeric(startTime)&&utils.isNumeric(endTime)&&endTime>startTime){renderTime=endTime-startTime}}return renderTime}function processLoadEvent(event){var startTime=context.getStartTime();if(event.timestamp>startTime&&!calculatedRenderTime){calculatedRenderTime=event.timestamp-startTime}}function postPerformanceEvent(window){var config=context.getConfig()||{},navType="UNKNOWN",queueEvent={type:7,performance:{}},navigation,performance,timing;if(!window||moduleState.perfEventSent){return}performance=window.performance||{};timing=performance.timing;navigation=performance.navigation;if(timing){queueEvent.performance.timing=parseTiming(timing,config.filter);queueEvent.performance.timing.renderTime=getRenderTime(timing);queueEvent.performance.rawTiming=context.utils.clone(timing)}else if(config.calculateRenderTime){queueEvent.performance.timing={renderTime:calculatedRenderTime,calculated:true}}else{return}if(navigation){switch(navigation.type){case 0:navType="NAVIGATE";break;case 1:navType="RELOAD";break;case 2:navType="BACKFORWARD";break;default:navType="UNKNOWN";break}queueEvent.performance.navigation={type:navType,redirectCount:navigation.redirectCount}}context.post(queueEvent);moduleState.perfEventSent=true}return{init:function(){},destroy:function(){},onevent:function(event){if(typeof event!=="object"||!event.type){return}switch(event.type){case"load":moduleState.loadReceived=true;processLoadEvent(event);break;case"unload":moduleState.unloadReceived=true;if(!moduleState.perfEventSent){postPerformanceEvent(window)}break;default:break}},onmessage:function(msg){}}})}else{}TLT.addModule("replay",function(context){"use strict";var tlTypes={"input:radio":"radioButton","input:checkbox":"checkBox","input:text":"textBox","input:password":"textBox","input:file":"fileInput","input:button":"button","input:submit":"submitButton","input:reset":"resetButton","input:image":"image","input:color":"color","input:date":"date","input:datetime":"datetime","input:datetime-local":"datetime-local","input:number":"number","input:email":"email","input:tel":"tel","input:search":"search","input:url":"url","input:time":"time","input:week":"week","input:month":"month","textarea:":"textBox","select:":"selectList","button:":"button","a:":"link"},currOrientation=window.orientation||0,savedTouch={scale:0,timestamp:0},pastEvents={},prevHash=window.location.hash,lastEventId=null,tmpQueue=[],eventCounter=0,curClientState=null,pastClientState=null,errorCount=0,visitOrder="",lastVisit="",pageLoadTime=(new Date()).getTime(),pageDwellTime=0,prevWebEvent=null,viewEventStart=null,viewTimeStart=null,viewPortXStart=0,viewPortYStart=0,inBetweenEvtsTimer=null,lastFocusEvent={inFocus:false},lastClickEvent=null,isApple=navigator.userAgent.indexOf("iPhone")>-1||navigator.userAgent.indexOf("iPod")>-1||navigator.userAgent.indexOf("iPad")>-1,devicePixelRatio=window.devicePixelRatio||1,deviceOriginalWidth=(window.screen===null?0:window.screen.width),deviceOriginalHeight=(window.screen===null?0:window.screen.height),deviceToolbarHeight=(window.screen===null?0:window.screen.height-window.screen.availHeight),config=context.getConfig(),extendGetItem;function getValue(parentObj,propertyAsStr){var i,properties;if(!parentObj||typeof parentObj!=="object"){return null}properties=propertyAsStr.split(".");for(i=0;i<properties.length;i+=1){if((typeof parentObj==="undefined")||(parentObj[properties[i]]===null)){return null}parentObj=parentObj[properties[i]]}return parentObj}function parentElements(node){var parents=[];node=node.parentNode;while(node){parents.push(node);node=node.parentNode}return parents}function getParentLink(parents){return context.utils.some(parents,function(node){if(node.tagName==="A"||node.tagName==="BUTTON"){return node}return null})}function getTlEvent(webEvent){var tlEvent=webEvent.type;if(typeof tlEvent==="string"){tlEvent=tlEvent.toLowerCase()}else{tlEvent="unknown"}if(tlEvent==="blur"){tlEvent="focusout"}return tlEvent}function createQueueEvent(options){var control,tagName=getValue(options,"webEvent.target.element.tagName"),type=tagName.toLowerCase()==="input"?getValue(options,"webEvent.target.element.type"):"",tlType=tlTypes[tagName.toLowerCase()+":"+type]||tagName,parents=parentElements(getValue(options,"webEvent.target.element")),parentLinkNode=null,relXY=getValue(options,"webEvent.target.position.relXY"),eventSubtype=getValue(options,"webEvent.target.subtype");control={type:4,target:{id:options.id||"",idType:getValue(options,"webEvent.target.idType"),name:getValue(options,"webEvent.target.name"),tlType:tlType,type:tagName,subType:type,position:{width:getValue(options,"webEvent.target.element.offsetWidth"),height:getValue(options,"webEvent.target.element.offsetHeight")},currState:options.currState||null},event:{tlEvent:getTlEvent(getValue(options,"webEvent")),type:getValue(options,"webEvent.target.type")}};if(relXY){control.target.position.relXY=relXY}if(typeof options.dwell==="number"&&options.dwell>0){control.target.dwell=options.dwell}if(typeof options.visitedCount==="number"){control.target.visitedCount=options.visitedCount}if(typeof options.prevState!=="undefined"){control.prevState=options.prevState}if(typeof eventSubtype!=="undefined"){control.event.subType=eventSubtype}control.target.name=getValue(options,"webEvent.target.name");parentLinkNode=getParentLink(parents);control.target.isParentLink=!!parentLinkNode;if(parentLinkNode){if(parentLinkNode.href){control.target.currState=control.target.currState||{};control.target.currState.href=control.target.currState.href||parentLinkNode.href}if(parentLinkNode.value){control.target.currState=control.target.currState||{};control.target.currState.value=control.target.currState.value||parentLinkNode.value}if(parentLinkNode.innerText||parentLinkNode.textContent){control.target.currState=control.target.currState||{};control.target.currState.innerText=control.target.currState.innerText||parentLinkNode.innerText||parentLinkNode.textContent}}return control}function postUIEvent(queueEvent){context.post(queueEvent)}function postEventQueue(queue){var i=0,j,len=queue.length,e1,e2,tmp,ignoredEvents={mouseout:true,mouseover:true},results=[];for(i=0;i<len;i+=1){e1=queue[i];if(!e1){continue}if(ignoredEvents[e1.event.type]){results.push(e1)}else{for(j=i+1;j<len&&queue[j];j+=1){if(!ignoredEvents[queue[j].event.type]){break}}if(j<len){e2=queue[j];if(e2&&e1.target.id===e2.target.id&&e1.event.type!==e2.event.type){if(e1.event.type==="click"){tmp=e1;e1=e2;e2=tmp}if(e2.event.type==="click"){e1.target.position=e2.target.position;i+=1}else if(e2.event.type==="blur"){e1.target.dwell=e2.target.dwell;e1.target.visitedCount=e2.target.visitedCount;e1.focusInOffset=e2.focusInOffset;e1.target.position=e2.target.position;i+=1}queue[j]=null;queue[i]=e1}}results.push(queue[i])}}for(e1=results.shift();e1;e1=results.shift()){context.post(e1)}queue.splice(0,queue.length)}if(typeof window.onerror!=="function"){window.onerror=function(msg,url,line){var errorMessage=null;if(typeof msg!=="string"){return}line=line||-1;errorMessage={type:6,exception:{description:msg,url:url,line:line}};errorCount+=1;context.post(errorMessage)}}function handleFocus(id,webEvent){lastFocusEvent=webEvent;lastFocusEvent.inFocus=true;if(typeof pastEvents[id]==="undefined"){pastEvents[id]={}}pastEvents[id].focus=lastFocusEvent.dwellStart=Number(new Date());pastEvents[id].focusInOffset=viewTimeStart?lastFocusEvent.dwellStart-Number(viewTimeStart):-1;pastEvents[id].prevState=getValue(webEvent,"target.state");pastEvents[id].visitedCount=pastEvents[id].visitedCount+1||1}function addToTmpQueue(webEvent,id){tmpQueue.push(createQueueEvent({webEvent:webEvent,id:id,currState:getValue(webEvent,"target.state")}))}function isTargetClickable(target){var clickable=false,clickableInputTypes="|button|image|submit|reset|checkbox|radio|",subType=null;if(typeof target!=="object"||!target.type){return clickable}switch(target.type){case"INPUT":subType="|"+(target.subType||"")+"|";if(clickableInputTypes.indexOf(subType.toLowerCase())===-1){clickable=false}else{clickable=true}break;case"TEXTAREA":clickable=false;break;default:clickable=true;break}return clickable}function handleBlur(id,webEvent){var lastQueueEvent;if(typeof id==="undefined"||id===null||typeof webEvent==="undefined"||webEvent===null){return}lastFocusEvent.inFocus=false;if(typeof pastEvents[id]!=="undefined"&&pastEvents[id].hasOwnProperty("focus")){pastEvents[id].dwell=Number(new Date())-pastEvents[id].focus}else{pastEvents[id]={};pastEvents[id].dwell=0}if(tmpQueue.length===0){webEvent.type=webEvent.target.type="blur";addToTmpQueue(webEvent,id)}lastQueueEvent=tmpQueue[tmpQueue.length-1];if(lastQueueEvent){lastQueueEvent.target.dwell=pastEvents[id].dwell;lastQueueEvent.focusInOffset=pastEvents[id].focusInOffset;lastQueueEvent.target.visitedCount=pastEvents[id].visitedCount;if(lastQueueEvent.event.type==="click"&&!isTargetClickable(lastQueueEvent.target)){lastQueueEvent.event.type="blur";lastQueueEvent.event.tlEvent="focusout"}}postEventQueue(tmpQueue)}function checkQueue(id,webEvent){var hasInQueue=false;if(tmpQueue.length>0&&tmpQueue[tmpQueue.length-1]&&tmpQueue[tmpQueue.length-1].target.id!==id&&webEvent.type!=="scroll"&&webEvent.type!=="resize"&&webEvent.type!=="mouseout"&&webEvent.type!=="mouseover"&&(tmpQueue[tmpQueue.length-1].target.tlType!=="textBox"&&tmpQueue[tmpQueue.length-1].target.tlType!=="selectList")){handleBlur(tmpQueue[tmpQueue.length-1].target.id,tmpQueue[tmpQueue.length-1]);hasInQueue=true}return hasInQueue}function handleChange(id,webEvent){if(typeof pastEvents[id]!=="undefined"&&!pastEvents[id].hasOwnProperty("focus")){handleFocus(id,webEvent)}addToTmpQueue(webEvent,id);if(typeof pastEvents[id]!=="undefined"&&typeof pastEvents[id].prevState!=="undefined"){if(tmpQueue[tmpQueue.length-1].target.tlType==="textBox"||tmpQueue[tmpQueue.length-1].target.tlType==="selectList"){tmpQueue[tmpQueue.length-1].target.prevState=pastEvents[id].prevState}}}function setRelativeXY(webEvent){var x=webEvent.target.position.x,y=webEvent.target.position.y,width=webEvent.target.size.width,height=webEvent.target.size.height,relX=Math.abs(x/width).toFixed(1),relY=Math.abs(y/height).toFixed(1);relX=relX>1||relX<0?0.5:relX;relY=relY>1||relY<0?0.5:relY;return relX+","+relY}function handleClick(id,webEvent){var relXY,addRelXY=true,tmpQueueLength=0;if(webEvent.target.element.tagName==="SELECT"&&lastClickEvent&&lastClickEvent.target.id===id){lastClickEvent=null;return}if(!lastFocusEvent.inFocus){handleFocus(id,webEvent)}tmpQueueLength=tmpQueue.length;if(tmpQueueLength&&getValue(tmpQueue[tmpQueueLength-1],"event.type")!=="change"){handleChange(id,webEvent)}relXY=setRelativeXY(webEvent);tmpQueueLength=tmpQueue.length;if(webEvent.position.x===0&&webEvent.position.y===0&&tmpQueueLength&&getValue(tmpQueue[tmpQueueLength-1],"target.tlType")==="radioButton"){addRelXY=false}else{webEvent.target.position.relXY=relXY}if(tmpQueueLength&&getValue(tmpQueue[tmpQueueLength-1],"target.id")===id){if(addRelXY){tmpQueue[tmpQueueLength-1].target.position.relXY=relXY}}else{addToTmpQueue(webEvent,id)}lastClickEvent=webEvent}function getNormalizedOrientation(){var orientation=window.orientation||0;return orientation}function handleOrientationChange(webEvent){var newOrientation=getNormalizedOrientation(),orientationChangeEvent={type:4,event:{type:"orientationchange"},target:{prevState:{orientation:currOrientation,orientationMode:context.utils.getOrientationMode(currOrientation)},currState:{orientation:newOrientation,orientationMode:context.utils.getOrientationMode(newOrientation)}}};postUIEvent(orientationChangeEvent);currOrientation=newOrientation}function isDuplicateTouch(touchState){var result=false;if(!touchState){return result}result=(savedTouch.scale===touchState.scale&&Math.abs((new Date()).getTime()-savedTouch.timestamp)<500);return result}function saveTouchState(touchState){savedTouch.scale=touchState.scale;savedTouch.rotation=touchState.rotation;savedTouch.timestamp=(new Date()).getTime()}function getPinchType(scale){var s,pinchType="INVALID";if(typeof scale==="undefined"||scale===null){return pinchType}s=Number(scale);if(isNaN(s)){pinchType="INVALID"}else if(s<1){pinchType="CLOSE"}else if(s>1){pinchType="OPEN"}else{pinchType="NONE"}return pinchType}function handleTouchEnd(webEvent){var prevTouchState={},rotation=getValue(webEvent,"nativeEvent.rotation")||0,scale=getValue(webEvent,"nativeEvent.scale")||1,touchState=null,touchEndEvent={type:4,event:{type:"touchend"},target:{id:getValue(webEvent,"target.id"),idType:getValue(webEvent,"target.idType")}};if((isApple&&(!scale||scale===1))||(!isApple&&webEvent.nativeEvent.touches.length<=1)){return}touchState={rotation:rotation?rotation.toFixed(2):0,scale:scale?scale.toFixed(2):1};touchState.pinch=getPinchType(touchState.scale);if(isDuplicateTouch(touchState)){return}if(savedTouch&&savedTouch.timestamp){prevTouchState.rotation=savedTouch.rotation;prevTouchState.scale=savedTouch.scale;prevTouchState.pinch=getPinchType(prevTouchState.scale)}if(getValue(prevTouchState,"scale")){touchEndEvent.target.prevState=prevTouchState}touchEndEvent.target.currState=touchState;postUIEvent(touchEndEvent);saveTouchState(touchState)}function handleClientState(webEvent){var clientState={type:1,clientState:{pageWidth:document.width||(document.documentElement===null?0:document.documentElement.offsetWidth),pageHeight:Math.max((typeof document.height==="undefined"?0:document.height),(typeof document.documentElement==="undefined"?0:document.documentElement.offsetHeight),(typeof document.documentElement==="undefined"?0:document.documentElement.scrollHeight)),viewPortWidth:window.innerWidth||document.documentElement.clientWidth,viewPortHeight:window.innerHeight||document.documentElement.clientHeight,viewPortX:window.pageXOffset||(document.body===null?0:document.body.scrollLeft),viewPortY:window.pageYOffset||(document.body===null?0:document.body.scrollTop),deviceOrientation:window.orientation||0,event:getValue(webEvent,"type")}},deviceWidth=1,scaleWidth=1;if(Math.abs(clientState.clientState.deviceOrientation)===90){if(isApple){deviceWidth=deviceOriginalHeight-deviceToolbarHeight}else{deviceWidth=deviceOriginalWidth<=320?deviceOriginalHeight-deviceToolbarHeight:((deviceOriginalHeight/devicePixelRatio)-deviceToolbarHeight)}}else{if(isApple){deviceWidth=deviceOriginalWidth+deviceToolbarHeight}else{deviceWidth=deviceOriginalWidth<=320?deviceOriginalWidth-deviceToolbarHeight:((deviceOriginalWidth/devicePixelRatio)-deviceToolbarHeight)}}scaleWidth=(clientState.clientState.viewPortWidth===0?1:deviceWidth/clientState.clientState.viewPortWidth);clientState.clientState.deviceScale=scaleWidth-0.02;clientState.clientState.deviceScale=clientState.clientState.deviceScale.toFixed(3);clientState.clientState.viewTime=viewEventStart===null?0:(new Date()).getTime()-viewEventStart.getTime();if(webEvent.type==="scroll"&&eventCounter<=0){viewPortXStart=pastClientState.clientState.viewPortX;viewPortYStart=pastClientState.clientState.viewPortY}if(webEvent.type==="scroll"){clientState.clientState.viewPortXStart=viewPortXStart;clientState.clientState.viewPortYStart=viewPortYStart}curClientState=context.utils.clone(clientState);return clientState}function checkViewClientState(){if(curClientState!==null&&curClientState.clientState.event!=="load"){if(curClientState.clientState.event==="scroll"){delete curClientState.clientState.viewPortXStart;delete curClientState.clientState.viewPortYStart}curClientState.clientState.event="attention";curClientState.clientState.viewTime=viewTimeStart===null?0:(new Date()).getTime()-viewTimeStart.getTime();postUIEvent(curClientState);viewTimeStart=new Date();return true}return false}function checkScrollState(clientState){if((clientState.clientState.event==="scroll")&&(clientState.clientState.viewPortXStart===clientState.clientState.viewPortX)&&(clientState.clientState.viewPortYStart===clientState.clientState.viewPortY)){return false}return true}function checkClientState(webEvent){var inBetweenEvtsTime=inBetweenEvtsTimer===null?0:(new Date()).getTime()-inBetweenEvtsTimer.getTime();if(curClientState!==null&&(webEvent.type!==curClientState.clientState.event||inBetweenEvtsTime>=1000)){if(checkScrollState(curClientState)){postUIEvent(curClientState);if(curClientState.clientState.event!=="touchend"){pastClientState=context.utils.clone(curClientState)}}curClientState=null;viewEventStart=null;eventCounter=0;return true}if(curClientState!==null&&(eventCounter===1&&inBetweenEvtsTime>=1000)&&(curClientState.clientState.event==="resize"||curClientState.clientState.event==="scroll"||curClientState.clientState.event==="orientationchange"||webEvent.type==="screenview_load")){checkViewClientState()}return false}function isDuplicateEvent(curr,prev){var propsToCompare=["type","target.id"],prop=null,i,len,duplicate=true,DUPLICATE_EVENT_THRESHOLD_TIME=10,timeDiff=0,currTimeStamp=0,prevTimeStamp=0;if(!curr||!prev||typeof curr!=="object"||typeof prev!=="object"){duplicate=false}for(i=0,len=propsToCompare.length;duplicate&&i<len;i+=1){prop=propsToCompare[i];if(getValue(curr,prop)!==getValue(prev,prop)){duplicate=false;break}}if(duplicate){currTimeStamp=getValue(curr,"timestamp");prevTimeStamp=getValue(prev,"timestamp");if(!(isNaN(currTimeStamp)&&isNaN(prevTimeStamp))){timeDiff=Math.abs(getValue(curr,"timestamp")-getValue(prev,"timestamp"));if(isNaN(timeDiff)||timeDiff>DUPLICATE_EVENT_THRESHOLD_TIME){duplicate=false}}}return duplicate}function trackHashchange(){var currHash=window.location.hash;if(currHash===prevHash){return}if(prevHash){TLT.logScreenviewUnload(prevHash)}if(currHash){TLT.logScreenviewLoad(currHash)}prevHash=currHash}function defaultEventHandler(webEvent){var msg={type:4,event:{type:webEvent.type},target:{id:getValue(webEvent,"target.id"),idType:getValue(webEvent,"target.idType")}};postUIEvent(msg)}return{init:function(){},destroy:function(){handleBlur(lastEventId)},onevent:function(webEvent){var id=null,handleObj=null;if(typeof webEvent!=="object"||!webEvent.type){return}if(isDuplicateEvent(webEvent,prevWebEvent)){prevWebEvent=webEvent;return}prevWebEvent=webEvent;id=getValue(webEvent,"target.id");if(Object.prototype.toString.call(pastEvents[id])!=="[object Object]"){pastEvents[id]={}}checkClientState(webEvent);checkQueue(id,webEvent);inBetweenEvtsTimer=new Date();switch(webEvent.type){case"hashchange":trackHashchange();break;case"focus":handleObj=handleFocus(id,webEvent);break;case"blur":handleObj=handleBlur(id,webEvent);break;case"click":handleObj=handleClick(id,webEvent);break;case"change":handleObj=handleChange(id,webEvent);break;case"orientationchange":handleObj=handleOrientationChange(webEvent);break;case"touchend":handleObj=handleTouchEnd(webEvent);handleObj=handleClientState(webEvent);break;case"load":TLT.logScreenviewLoad("root");handleObj=handleClientState(webEvent);viewTimeStart=new Date();break;case"screenview_load":viewTimeStart=new Date();break;case"screenview_unload":break;case"resize":case"scroll":if(viewEventStart===null&&eventCounter<=0){viewEventStart=new Date()}handleObj=handleClientState(webEvent);if(checkScrollState(handleObj)){handleObj=null}else{eventCounter+=1}break;case"unload":if(tmpQueue!==null){postEventQueue(tmpQueue)}handleObj=handleClientState(webEvent);checkViewClientState();postUIEvent(handleObj);TLT.logScreenviewUnload("root");break;default:defaultEventHandler(webEvent);break}lastEventId=id;return handleObj},onmessage:function(){}}});

(function () {
var changeTarget;
if (TLT.getFlavor() === "w3c" && TLT.utils.isLegacyIE) {
    changeTarget = "input, select, textarea, button";
}
TLT.init({
  "services": {
    "browser": {
      "sizzleObject": "window.Sizzle"
    },
    "queue": [
      {
        "qid": "DEFAULT",
        "endpoint": "/gifts/CommonAssets/commerceInclude/vendors/Tealeaf/TealeafTarget.jsp",
        "maxEvents": 25,
        "timerinterval": 0
      }
    ],
    "message": {
      "privacy": [
        {
          "targets": [
            {
              "id": "account",
              "idType": "-1"
            },
            {
	            "id": "clearTextAccount",
	            "idType": "-1"
	        	},
            {
	            "id": "cc_cvc",
	            "idType": "-1"
	        	},
            {
	            "id": "expire_year",
	            "idType": "-1"
	        	},
            {
	            "id": "expire_month",
	            "idType": "-1"
	        	},
            {
	            "id": "gcAccount",
	            "idType": "-1"
	        	},
            {
	            "id": "gcPin",
	            "idType": "-1"
	        	}
          ],
          "maskType": 3
        }
      ]
    },
    "serializer": {
      "json": {
        "defaultToBuiltin": true,
        "parsers": [],
        "stringifiers": []
      }
    }
  },
  "core": {
    "modules": {
      "performance": {
        "enabled": true,
        "events": [
          {
            "name": "load",
            "target": window
          },
          {
            "name": "unload",
            "target": window
          }
        ]
      },
      "replay": {
        "enabled": true,
        "events": [
          {
            "name": "load",
            "target": window
          },
          {
            "name": "unload",
            "target": window
          },
          {
            "name": "mousedown",
            "recurseFrames": true
          },          
          {
            "name": "click",
            "recurseFrames": true
          },
          {
            "name": "focus",
            "target": "input, select, textarea",
            "recurseFrames": true
          },
          {
            "name": "blur",
            "target": "input, select, textarea",
            "recurseFrames": true
          },
          {
            "name": "change",
            "target": changeTarget,
            "recurseFrames": true
          },
          {
            "name": "resize",
            "target": window
          },
          {
            "name": "scroll",
            "target": window
          },
          {
            "name": "hashchange",
            "target": window
          },
          {
            "name": "orientationchange",
            "target": window
          },
          {
            "name": "touchend"
          }
        ]
      }
    },
    "sessionData": {
      "sessionCookieName": "TLTSID"
    }
  },
  "modules": {
    "performance": {
      "calculateRenderTime": true,
      "filter": {
        "navigationStart": false,
        "unloadEventStart": true,
        "unloadEventEnd": true,
        "redirectStart": true,
        "redirectEnd": true,
        "fetchStart": false,
        "domainLookupStart": true,
        "domainLookupEnd": true,
        "connectStart": true,
        "connectEnd": true,
        "secureConnectionStart": true,
        "requestStart": true,
        "responseStart": true,
        "responseEnd": true,
        "domLoading": true,
        "domInteractive": false,
        "domContentLoadedEventStart": true,
        "domContentLoadedEventEnd": false,
        "domComplete": false,
        "loadEventStart": true,
        "loadEventEnd": false
      }
    }
  }
});
}());