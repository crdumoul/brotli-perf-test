dojo.require("dojox.xml.DomParser");if(typeof(QuickInfoJS)=="undefined"||QuickInfoJS==null||!QuickInfoJS){QuickInfoJS={productImgDimensions:"1000x1000",quickInfoImgDimensions:"330x330",catEntryParams:{},selectedAttributes:new Object(),catEntryQuantity:1,itemDetailsArr:new Object(),params:null,replaceOrderItemId:"",itemId:"",selectedSkuIndex:null,selectedThumbnailIndex:null,selectedCatentryId:null,replaceQuantity:"",orderType:null,orderSource:null,setOrderType:function(orderType){this.orderType=orderType;
},setOrderSource:function(orderSource){this.orderSource=orderSource;},setReplaceQuantity:function(replaceQuantity){this.replaceQuantity=replaceQuantity;},setReplaceOrderItemId:function(replaceOrderItemId){this.replaceOrderItemId=replaceOrderItemId;},setValues:function(){if(dojo.byId("catEntryParamsForJS")){this.catEntryParams=dojo.fromJson(dojo.byId("catEntryParamsForJS").value);
}this.catEntryParams.attributes=this.selectedAttributes;},setCatEntryQuantity:function(catEntryQuantity){this.catEntryQuantity=catEntryQuantity;},showDetails:function(productId,params,itemId,quantity){if(params){this.params=params;}else{this.params=null;}this.selectedAttributes=new Object();this.selectedSkuIndex=null;
this.selectedThumbnailIndex=null;if(!submitRequest()){return;}this.close();cursor_wait();var contextValues=this.setCommonParams();if(itemId){this.itemId=itemId;contextValues.updateAttributes="true";}else{this.itemId="";contextValues.updateAttributes="false";}if(quantity){this.catEntryQuantity=quantity;
}contextValues.productId=productId;wc.render.updateContext("QuickInfoContext",contextValues);document.getElementById("productIdQuickInfo").innerHTML=productId;},changeAttributes:function(orderItemId,productId,itemId,quantity){this.setReplaceOrderItemId(orderItemId);this.showDetails(productId,null,itemId,quantity);
},changeImage:function(elementId,imgSrc){this.selectedThumbnailIndex=elementId-1;dojo.byId("quickInfoMainImage").src=this.getQuickInfoImage(this.catEntryParams.skus[this.selectedSkuIndex].fullImageAttachments[this.selectedThumbnailIndex].path);dojo.query(".widget_quick_info_popup .other_views li").removeClass("selected");
dojo.addClass("quickInfoThumbnail"+elementId,"selected");},setSelectedAttribute:function(selectedAttributeName,selectedAttributeValue){this.selectedAttributes[selectedAttributeName]=selectedAttributeValue;},notifyAttributeChange:function(){dojo.publish("QuickInfo_attributesChanged",[dojo.toJson(this.selectedAttributes)]);
},selectItem:function(displayPriceRange,updateItemImageOnly){this.displayPriceRange=displayPriceRange;this.setValues();var catEntryId=this.resolveSKU();if(catEntryId==-1&&updateItemImageOnly){var skuId=-1;for(idx=0;idx<this.catEntryParams.skus.length;idx++){for(attribute in this.catEntryParams.skus[idx].attributes){if(this.catEntryParams.attributes&&this.catEntryParams.skus[idx].attributes[attribute]==this.catEntryParams.attributes[attribute]){skuId=this.catEntryParams.skus[idx].id;
break;}}}if(skuId!=-1){catEntryId=skuId;this.updateItemImageOnly=updateItemImageOnly;}}this.selectedCatentryId=catEntryId;if(catEntryId!=-1){if(this.itemDetailsArr[catEntryId]!=null&&this.itemDetailsArr[catEntryId]!="undefined"){this.displayItemDetails(this.itemDetailsArr[catEntryId]);}else{var params=this.setCommonParams();
params.catalogEntryId=catEntryId;dojo.xhrPost({url:getAbsoluteURL()+"GetCatalogEntryDetailsByIDView",handleAs:"json-comment-filtered",content:params,service:this,load:QuickInfoJS.setItemDetails,error:function(errObj,ioArgs){console.debug("QuickInfoJS.selectItem: Unexpected error occurred during an xhrPost request.");
}});}}},selectSwatch:function(selectedAttributeName,selectedAttributeValue,swatchId,swatchGrp){if(dojo.hasClass("quickInfoSwatch_"+selectedAttributeName+"_"+selectedAttributeValue,"color_swatch_disabled")){return false;}this.setValues();var swatchNames=dojo.byId("WC_QuickInfo_SwatchNames").value.split("_");
var currentSwatchPos=-1;for(var i=0;i<swatchNames.length;i++){if(swatchNames[i]==selectedAttributeName){currentSwatchPos=i;break;}}var currentSwatchkey="quickInfoSwatch_"+selectedAttributeName+"_"+selectedAttributeValue;var currentSwatchkeyLink="WC_QuickInfo_Swatch_"+selectedAttributeName+"_"+selectedAttributeValue;
var validSwatchArr=new Array();for(idx in this.catEntryParams.skus){var validItem=false;var entitledItem=this.catEntryParams.skus[idx];for(attribute in entitledItem.attributes){if(selectedAttributeName==attribute&&selectedAttributeValue==entitledItem.attributes[attribute]){validItem=true;break;}}if(validItem){for(attribute in entitledItem.attributes){var attributePos=-1;
for(var i=0;i<swatchNames.length;i++){if(swatchNames[i]==attribute){attributePos=i;break;}}if(attributePos>currentSwatchPos){validSwatchArr.push(attribute+"_"+entitledItem.attributes[attribute]);}}}}var swatchesDisabled=new Array();var selectedSwatches=new Array();for(idx in this.catEntryParams.skus){var entitledItem=this.catEntryParams.skus[idx];
for(attribute in entitledItem.attributes){var attributePos=-1;for(var i=0;i<swatchNames.length;i++){if(swatchNames[i]==attribute){attributePos=i;break;}}if(attributePos>currentSwatchPos){var swatchSelection=attribute+"_"+entitledItem.attributes[attribute];var swatchId="quickInfoSwatch_"+swatchSelection;
var swatchLinkId="WC_QuickInfo_Swatch_"+swatchSelection;var validSwatchArrPos=-1;for(var i=0;i<validSwatchArr.length;i++){if(validSwatchArr[i]==swatchSelection){validSwatchArrPos=i;break;}}var swatchesDisabledPos=-1;for(var i=0;i<swatchesDisabled.length;i++){if(swatchesDisabled[i]==swatchSelection){swatchesDisabledPos=i;
break;}}if(validSwatchArrPos>-1){if(!dojo.hasClass(swatchId,"color_swatch_selected")){dojo.byId(swatchId).className="color_swatch";if(dojo.byId(swatchId).src!=undefined){dojo.byId(swatchId).src=dojo.byId(swatchId).src.replace("_disabled.png","_enabled.png");}document.getElementById(swatchLinkId).setAttribute("aria-disabled","false");
}}else{if(swatchesDisabledPos==-1){swatchesDisabled.push(swatchSelection);if(dojo.hasClass(swatchId,"color_swatch_selected")){selectedSwatches.push(swatchId);}dojo.byId(swatchId).className="color_swatch_disabled";if(dojo.byId(swatchId).src!=undefined){dojo.byId(swatchId).src=dojo.byId(swatchId).src.replace("_enabled.png","_disabled.png");
}document.getElementById(swatchLinkId).setAttribute("aria-disabled","true");}}}if(document.getElementById("WC_QuickInfo_Swatch_"+attribute+"_"+entitledItem.attributes[attribute])!=null){document.getElementById("WC_QuickInfo_Swatch_"+attribute+"_"+entitledItem.attributes[attribute]).setAttribute("aria-checked","false");
}}}if(selectedSwatches.length>0){for(idx in selectedSwatches){var selectedSwatch=selectedSwatches[idx];var idSelector="img[id^='"+selectedSwatch.substring(0,selectedSwatch.lastIndexOf("_"))+"']";var swatchSelected=false;dojo.query(idSelector).forEach(function(node,index,arr){if(!swatchSelected&&dojo.hasClass(node,"color_swatch")){var values=node.id.split("_");
QuickInfoJS.selectSwatch(values[1],values[2],"quickInfoSwatch_"+values[1]+"_"+values[2],"quickInfoSwatch_"+values[1]+"_");QuickInfoJS.selectItem(true);swatchSelected=true;}});}}selector="img[id^='"+swatchGrp+"']";dojo.query(selector).forEach(function(node,index,arr){if(!dojo.hasClass(node,"color_swatch_disabled")){dojo.addClass(node,"color_swatch");
if(dojo.hasClass(node,"color_swatch_selected")){dojo.removeClass(node,"color_swatch_selected");}}});dojo.byId(currentSwatchkey).className="color_swatch_selected";dojo.byId("quickinfo_swatch_selection_"+selectedAttributeName).innerHTML=selectedAttributeValue;document.getElementById(currentSwatchkeyLink).setAttribute("aria-checked","true");
this.setSelectedAttribute(selectedAttributeName,selectedAttributeValue);},setCommonParams:function(){var params=new Object();params.storeId=WCParamJS.storeId;params.catalogId=WCParamJS.catalogId;params.langId=WCParamJS.langId;return params;},setItemDetails:function(serviceResponse,ioArgs){console.debug("QuickInfoJS.setItemDetails",serviceResponse);
QuickInfoJS.itemDetailsArr[serviceResponse.catalogEntry.catalogEntryIdentifier.uniqueID]=serviceResponse.catalogEntry;QuickInfoJS.displayItemDetails(serviceResponse.catalogEntry);},displayItemDetails:function(catalogEntry){if(null!=this.catEntryParams){for(idx in this.catEntryParams.skus){if(null!=this.catEntryParams.skus[idx]&&(this.catEntryParams.skus[idx].id==catalogEntry.catalogEntryIdentifier.uniqueID)){for(idx2=1;
idx2<=this.catEntryParams.skus[idx].thumbnailAttachments.length;idx2++){var angleImgNode=dojo.query("#quickInfoThumbnail"+idx2+" img")[0];if(angleImgNode!=null){angleImgNode.src=this.catEntryParams.skus[idx].thumbnailAttachments[idx2-1].path;}}if(null==this.selectedThumbnailIndex){this.selectedThumbnailIndex=0;
}this.selectedSkuIndex=idx;if(null==this.catEntryParams.skus[idx].fullImageAttachments[this.selectedThumbnailIndex]){var quickInfoMainImage=dojo.byId("quickInfoMainImage");if(quickInfoMainImage){quickInfoMainImage.src=this.getQuickInfoImage(catalogEntry.description[0].fullImage);}}else{var quickInfoMainImage=dojo.byId("quickInfoMainImage");
if(quickInfoMainImage){quickInfoMainImage.src=this.getQuickInfoImage(this.catEntryParams.skus[idx].fullImageAttachments[this.selectedThumbnailIndex].path);}}}}}if(this.updateItemImageOnly){this.updateItemImageOnly=false;return;}var header=dojo.query(".widget_quick_info_popup .main_header");if(header.length>0){dojo.html.set(header[0],catalogEntry.description[0].name);
}if(catalogEntry.listPriced&&catalogEntry.listPrice>catalogEntry.offerPrice){if(null!=dojo.query(".widget_quick_info_popup .old_price")[0]){dojo.html.set(dojo.query(".widget_quick_info_popup .old_price")[0],catalogEntry.listPrice);}else{var oldPriceTag="<span class='old_price'>"+catalogEntry.listPrice+"</span>";
var priceTag=dojo.query(".widget_quick_info_popup .price")[0];dojo.place(oldPriceTag,priceTag,"before");}}else{if(null!=dojo.query(".widget_quick_info_popup .old_price")[0]){dojo.query(".widget_quick_info_popup .old_price").orphan();}}var price=dojo.query(".widget_quick_info_popup .price");if(price.length>0){dojo.html.set(price[0],catalogEntry.offerPrice);
}var sku=dojo.query(".widget_quick_info_popup .sku");if(sku.length>0){dojo.html.set(sku[0],storeNLS["SKU"]+" "+catalogEntry.catalogEntryIdentifier.externalIdentifier.partNumber);}},validate:function(){if(this.catEntryParams.type=="ProductBean"&&(null==this.catEntryParams.attributes||"undefined"==this.catEntryParams.attributes)){MessageHelper.displayErrorMessage(storeNLS["ERR_RESOLVING_SKU"]);
return false;}else{if(!isPositiveInteger(this.catEntryQuantity)){MessageHelper.displayErrorMessage(storeNLS["QUANTITY_INPUT_ERROR"]);return false;}}return true;},add2CSRReturnOrderShopCart:function(rmaId){if(this.selectedCatentryId!=null){var parameters={};parameters.returnQuantity=(this.catEntryQuantity==undefined)?1:this.catEntryQuantity;
parameters.returnWithoutOrderNumber=true;parameters.catEntryId=this.selectedCatentryId;parameters.rmaId=rmaId;if(this.replaceOrderItemId!=null&&this.replaceOrderItemId!=""){parameters.replaceItem=true;parameters.replaceRMAItemId=this.replaceOrderItemId;QuickInfoJS.setReplaceOrderItemId("");}else{parameters.replaceItem=false;
}$("#popupViewer").trigger("close");wc.service.invoke("AjaxMattelReturnItemAddValidationCmd",parameters);}},add2ShopCart:function(customParams,childCatentryIds){this.setValues();var childCats="";if(!this.validate()){return;}if(null==this.params){this.params=this.setCommonParams();this.params.orderId=".";
this.params.calculationUsage="-1,-2,-5,-6,-7";this.params.inventoryValidation="true";this.params.mattelOrderType="Standard Orders";}if(this.catEntryParams.type.toLowerCase()=="itembean"||this.catEntryParams.type.toLowerCase()=="packagebean"||this.catEntryParams.type.toLowerCase()=="dynamickitbean"){updateParamObject(this.params,"catEntryId",this.catEntryParams.id,false,-1);
updateParamObject(this.params,"quantity",this.catEntryQuantity,false,-1);if(dojo.isArray(childCatentryIds)){for(var i=0;i<childCatentryIds.length;i++){updateParamObject(this.params,"catEntryId",childCatentryIds[i],false,i+2);updateParamObject(this.params,"quantity",this.catEntryQuantity,false,i+2);childCats=childCats+childCatentryIds[i];
if(i<childCatentryIds.length-1){childCats=childCats+"_";}}updateParamObject(this.params,"parentCatentryId",this.catEntryParams.id,false,-1);updateParamObject(this.params,"childCatentryId",childCats,false,-1);updateParamObject(this.params,"productoperationType","WCSSet",false,-1);updateParamObject(this.params,"actioncode","create",false,-1);
}}else{var sku=this.resolveSKU();if(-1==sku){MessageHelper.displayErrorMessage(storeNLS["ERR_RESOLVING_SKU"]);return;}else{updateParamObject(this.params,"catEntryId",sku,false,-1);updateParamObject(this.params,"quantity",this.catEntryQuantity,false,-1);}}var shopCartService="AddOrderItem";if(customParams!=null&&customParams!="undefined"){for(i in customParams){this.params[i]=customParams[i];
}if(customParams["catalogEntryType"]=="dynamicKit"){shopCartService="AddPreConfigurationToCart";}}if(this.params["catalogEntryType"]=="dynamicKit"){shopCartService="AddPreConfigurationToCart";}this.close();if(!submitRequest()){return;}cursor_wait();wc.service.invoke(shopCartService,this.params);},add2CSRShopCart:function(customParams,childCatentryIds){if(this.selectedCatentryId!=null){var csrParams=[];
csrParams["catEntryId"]=this.selectedCatentryId;csrParams["quantity"]=(this.catEntryQuantity==undefined)?1:this.catEntryQuantity;csrParams["calculateOrder"]="1";if(this.orderSource!=null){csrParams["orderSource"]=this.orderSource;}if(this.orderType!=null){csrParams["orderType"]=this.orderType;}csrParams["orderTypeName"]="Standard";
if(this.replaceOrderItemId!=null&&this.replaceOrderItemId!=""){var params=[];params["orderItemId"]=this.replaceOrderItemId;params["orderId"]=".";params["quantity"]=0;wc.service.invoke("AjaxCsrDeleteOrderItem",params);}wc.service.invoke("AjaxCsrAddOrderItem",csrParams);}},resolveSKU:function(){if(this.catEntryParams.skus!=null&&this.catEntryParams.skus!="undefined"){if(this.catEntryParams.skus.length==1){return this.catEntryParams.skus[0].id;
}for(idx=0;idx<this.catEntryParams.skus.length;idx++){var matches=0;var attributeCount=0;for(attribute in this.catEntryParams.skus[idx].attributes){attributeCount++;if(this.catEntryParams.attributes&&this.catEntryParams.skus[idx].attributes[attribute]==this.catEntryParams.attributes[attribute]){matches++;
}else{break;}}if(0!=matches&&matches==attributeCount){return this.catEntryParams.skus[idx].id;}}}return -1;},showQuickInfoButton:function(id){var quickInfoBtn=dojo.byId(id);if(quickInfoBtn!=null&&quickInfoBtn!="undefined"){quickInfoBtn.style.visibility="visible";}},hideQuickInfoButton:function(id){var quickInfoBtn=dojo.byId(id);
if(quickInfoBtn!=null&&quickInfoBtn!="undefined"){quickInfoBtn.style.visibility="";}},shiftTabHideQuickInfoButton:function(id,event){if((event.shiftKey)&&(event.keyCode==dojo.keys.TAB)){this.hideQuickInfoButton(id);}},close:function(focusElement){dijit.byId("quickInfoPopup").hide();if(focusElement!=null&&focusElement!="undefined"&&document.getElementById(focusElement)){document.getElementById(focusElement).focus();
}},setFocus:function(event){if(event.keyCode==dojo.keys.ESCAPE&&dojo.byId("catEntryParamsForJS")){var catEntryParams=dojo.byId("catEntryParamsForJS").value;var catEntryId=dojo.fromJson(catEntryParams).id;if(document.getElementById("catalogEntry_img"+catEntryId)){document.getElementById("catalogEntry_img"+catEntryId).focus();
}}},selectDefaultSwatch:function(){var swatchElement=dojo.query("a[id^='WC_QuickInfo_Swatch_']")[0];if(swatchElement){eval(dojo.attr(swatchElement,"href"));}},replaceCartItem:function(){var prodId=document.getElementById("partNumber");this.setValues();if(!this.validate()){return;}var catalogEntryId=this.resolveSKU();
if(-1==catalogEntryId){MessageHelper.displayErrorMessage(storeNLS["ERR_RESOLVING_SKU"]);return;}try{if(prodId.value!=null||prodId.value!=undefined){analyticTagVar_addInfo=document.getElementById("partNumber").value;Mattel.Analytics.addEvent("loadUpdateCartQVEvent");analyticTagVar_addInfo=undefined;}}catch(err){Mattel.Utils.log(err);
}this.close();var addressId="";var shipModeId="";var physicalStoreId="";var typeId=dojo.byId("shipmentTypeId");if(null!=dojo.byId("addressId_all")&&null!=dojo.byId("shipModeId_all")){if(null==typeId||typeId.value!="1"){addressId=dojo.byId("addressId_all").value;}else{if(null!=dojo.byId("physicalStoreId")){physicalStoreId=dojo.byId("physicalStoreId").value;
}}shipModeId=dojo.byId("shipModeId_all").value;}else{if(null!=dojo.byId("MS_ShipmentAddress_"+this.replaceOrderItemId)&&null!=dojo.byId("MS_ShippingMode_"+this.replaceOrderItemId)){addressId=dojo.byId("MS_ShipmentAddress_"+this.replaceOrderItemId).value;shipModeId=dojo.byId("MS_ShippingMode_"+this.replaceOrderItemId).value;
}}if(this.replaceOrderItemId!=""&&categoryDisplayJS){shoppingActionsJS.replaceItemAjaxHelper(catalogEntryId,this.catEntryQuantity,this.replaceOrderItemId,addressId,shipModeId,physicalStoreId);}else{console.error("categoryDisplayJS not defined");}},selectCurrentAttributes:function(){for(idx=0;idx<this.catEntryParams.skus.length;
idx++){var selectedSKU=this.catEntryParams.skus[idx];if(selectedSKU.id==this.itemId){for(attribute in selectedSKU.attributes){var selectNode=dojo.query("select[alt='"+attribute+"']")[0];if(selectNode){selectNode.value=selectedSKU.attributes[attribute];this.setSelectedAttribute(attribute,selectNode.value);
}else{var attrValue=selectedSKU.attributes[attribute];this.selectSwatch(attribute,attrValue,"quickInfoSwatch_"+attribute+"_"+attrValue,"quickInfoSwatch_"+attribute+"_");}}this.notifyAttributeChange();this.selectItem(true);dojo.byId("WC_QuickInfo_input_quantity").disabled=true;dojo.byId("WC_QuickInfo_input_quantity").value=this.catEntryQuantity;
return;}}},getQuickInfoImage:function(fullImage){if(fullImage==""){return fullImage;}return fullImage.replace(this.productImgDimensions,this.quickInfoImgDimensions);}};}