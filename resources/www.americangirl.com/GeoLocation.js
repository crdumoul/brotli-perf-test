GeoLocationJS={domainCountryCode:"",akamaiCountryCode:"",geoLocateCookieValue:"",redirectVar:false,langId:"-1",storeId:"",catalogId:"",setCommonParameters:function(langId,storeId,catalogId){this.langId=langId;this.storeId=storeId;this.catalogId=catalogId;},setValueToCookie:function(cookieKey,cookieValue){var newValue=cookieValue;
if(newValue!=null&&newValue!="undefined"&&newValue!=""){var currentValue=this.getValueFromCookie(cookieKey);if(newValue!=currentValue){dojo.cookie(cookieKey,null,{path:"/",expires:-1});dojo.cookie(cookieKey,newValue,{path:"/"});}}},getValueFromCookie:function(cookieKey){this.geoLocateCookieValue=dojo.cookie(cookieKey);
return this.geoLocateCookieValue;},createCookie:function(cookieKey,newCookieValue){dojo.cookie(cookieKey,newCookieValue,{path:"/"});},getDomainCountryCode:function(){var StoreName=document.getElementById("StoreName").value;if((StoreName=="AGCAStore")||(StoreName=="American Girl Canada")){this.domainCountryCode="CA";
}else{this.domainCountryCode="US";}return this.domainCountryCode;},getAkamaiCountryCode:function(){var akamaiCountryCode="";var xAkamaiEdgescape;try{var geoCookieValue=this.getValueFromCookie("X-MAT-GEO");if(typeof geoCookieValue!=undefined&&null!=geoCookieValue&&geoCookieValue!=""){xAkamaiEdgescape=geoCookieValue;
}else{var req=new XMLHttpRequest();req.open("GET",document.location,false);req.send(null);xAkamaiEdgescape=req.getResponseHeader("X-MAT-GEO");}if(typeof xAkamaiEdgescape!="undefined"){var headerParams=xAkamaiEdgescape.split(/\s*,\s*/);for(count=0;count<headerParams.length;count++){var params=headerParams[count].split(/\s*=\s*/);
this.akamaiCountryCode=params[1];if(params[1]=="CA"){break;}}}if(typeof xAkamaiEdgescape=="undefined"||xAkamaiEdgescape==""){xAkamaiEdgescape=req.getAllResponseHeaders();if(xAkamaiEdgescape&&xAkamaiEdgescape.indexOf("country_code=")!=-1){var truncatedAkamaiInfo=xAkamaiEdgescape.split("country_code=")[1];
var index=(truncatedAkamaiInfo.indexOf(",")>-1)?truncatedAkamaiInfo.indexOf(","):truncatedAkamaiInfo.length();this.akamaiCountryCode=truncatedAkamaiInfo.substring(0,index);}else{}}}catch(err){var xAkamaiEdgescape="";}},gup:function(name){name=name.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var regexS="[\\?&]"+name+"=([^&#]*)";
var regex=new RegExp(regexS);var results=regex.exec(window.location.href);if(results==null){return"";}else{return results[1];}},invokeIntlOverlay:function(){var StoreName=document.getElementById("StoreName").value,url=document.getElementById("MattelIntlShippingURLVar").value;if((StoreName=="AGStore"||StoreName=="American Girl")&&(this.akamaiCountryCode=="CA"||this.geoLocateCookieValue=="CA")){$.v_modal({transition:"fade",href:url,onComplete:function(){Mattel.init();
$(this).v_modal.resize();}});}else{if((StoreName=="AGCAStore"||StoreName=="American Girl Canada")&&(this.akamaiCountryCode=="US"||this.geoLocateCookieValue=="US")){$.v_modal({transition:"fade",href:url,onComplete:function(){Mattel.init();$(this).v_modal.resize();}});}}},redirectValue:function(){if(undefined!=document.getElementById("redirectVar")){this.redirectVar=document.getElementById("redirectVar").value;
}},redirectionFlow:function(){var USHomePageURL=document.getElementById("USHomePageURL").value;var canadaHomePageURL=document.getElementById("CanadaHomePageURL").value;console.info("canadaHomePageURL: "+canadaHomePageURL);if(this.geoLocateCookieValue=="US"){window.location.href=USHomePageURL;}else{if(this.geoLocateCookieValue=="CA"){window.location.href=canadaHomePageURL;
}}},callGeoLocationFlow:function(){GeoLocationJS.getDomainCountryCode();GeoLocationJS.redirectValue();GeoLocationJS.getValueFromCookie("geoLocate");if(this.geoLocateCookieValue==undefined||this.geoLocateCookieValue==null||this.geoLocateCookieValue==""){GeoLocationJS.getAkamaiCountryCode();if(this.akamaiCountryCode&&this.akamaiCountryCode.indexOf(this.domainCountryCode)!=-1){GeoLocationJS.createCookie("geoLocate",this.akamaiCountryCode);
}else{GeoLocationJS.invokeIntlOverlay();}}else{if(this.geoLocateCookieValue&&this.geoLocateCookieValue.indexOf(this.domainCountryCode)!=-1){$("#vmClose").click();}else{if(this.redirectVar){GeoLocationJS.redirectionFlow();}else{GeoLocationJS.setValueToCookie("geoLocate",this.domainCountryCode);}}}}};