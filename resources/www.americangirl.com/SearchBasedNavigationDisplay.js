var itemsPageLimit="12";if(typeof Mattel!="undefined"&&null!=Mattel&&(Mattel.storeName=="AGStore"||Mattel.storeName=="American Girl"||Mattel.storeName=="AGCAStore"||Mattel.storeName=="American Girl Canada")){itemsPageLimit="500";}wc.render.declareContext("searchBasedNavigation_context",{"contentBeginIndex":"0","productBeginIndex":"0","beginIndex":"0","sortBy":"0","itemsPage":itemsPageLimit,"filter1By":"0","filter2By":"0","filter3By":"0","isHistory":"false","pageView":"","resultType":"both","orderByContent":"","searchTerm":"","facet":"","minPrice":"","maxPrice":""},"");
wc.render.declareRefreshController({id:"searchBasedNavigation_controller",renderContext:wc.render.getContextById("searchBasedNavigation_context"),url:"",formId:"",renderContextChangedHandler:function(message,widget){var controller=this;var renderContext=this.renderContext;var resultType=renderContext.properties["resultType"];
if(resultType=="products"||resultType=="both"){renderContext.properties["beginIndex"]=renderContext.properties["productBeginIndex"];widget.refresh(renderContext.properties);}},postRefreshHandler:function(widget){var resultType=widget.controller.renderContext.properties["resultType"];if(resultType=="products"||resultType=="both"){var currentIdValue=currentId;
cursor_clear();if(widget.controller.renderContext.properties["isHistory"]=="false"){var currentContextProperties=widget.controller.renderContext.properties;dojo.back.addToHistory(new SearchBasedNavigationDisplayJS.HistoryTracker(currentContextProperties));}SearchBasedNavigationDisplayJS.initControlsOnPage(widget.controller.renderContext.properties);
if(currentIdValue=="sortBy"){$("sortBy").focus();}else{if(currentIdValue=="filter1By"){$("filter1By").focus();}else{if(currentIdValue=="filter2By"){$("filter2By").focus();}else{if(currentIdValue=="filter3By"){$("filter3By").focus();}else{if(currentIdValue=="itemsPage"){$("itemsPage").focus();}}}}}}populateWelcomeSection();
try{tealiumAttributes();}catch(err){}dojo.publish("CMPageRefreshEvent");}});wc.render.getRefreshControllerById("searchBasedNavigation_controller").refresh=MattelControllerRefresh();wc.render.declareRefreshController({id:"searchBasedNavigation_content_controller",renderContext:wc.render.getContextById("searchBasedNavigation_context"),url:"",formId:"",renderContextChangedHandler:function(message,widget){var controller=this;
var renderContext=this.renderContext;var resultType=renderContext.properties["resultType"];if(resultType=="content"||resultType=="both"){renderContext.properties["beginIndex"]=renderContext.properties["contentBeginIndex"];widget.refresh(renderContext.properties);}},postRefreshHandler:function(widget){var resultType=widget.controller.renderContext.properties["resultType"];
if(resultType=="content"||resultType=="both"){var currentIdValue=currentId;cursor_clear();if(widget.controller.renderContext.properties["isHistory"]=="false"){var currentContextProperties=widget.controller.renderContext.properties;dojo.back.addToHistory(new SearchBasedNavigationDisplayJS.HistoryTracker(currentContextProperties));
}SearchBasedNavigationDisplayJS.initControlsOnPage(widget.controller.renderContext.properties);shoppingActionsJS.initCompare();if(currentIdValue=="sortBy"){$("sortBy").focus();}else{if(currentIdValue=="filter1By"){$("filter1By").focus();}else{if(currentIdValue=="filter2By"){$("filter2By").focus();}else{if(currentIdValue=="filter3By"){$("filter3By").focus();
}else{if(currentIdValue=="itemsPage"){$("itemsPage").focus();}}}}}}}});if(typeof(SearchBasedNavigationDisplayJS)=="undefined"||SearchBasedNavigationDisplayJS==null||!SearchBasedNavigationDisplayJS){SearchBasedNavigationDisplayJS={facetIdsArray:new Array,init:function(searchResultUrl,galleryPIP,topCategoryName){wc.render.getRefreshControllerById("searchBasedNavigation_controller").url=searchResultUrl;
wc.render.updateContext("searchBasedNavigation_context",{"GalleryPIP":galleryPIP,"topCategoryName":topCategoryName});this.initControlsOnPage(WCParamJS);this.updateContextProperties("searchBasedNavigation_context",WCParamJS);var currentContextProperties=wc.render.getContextById("searchBasedNavigation_context").properties;
var historyObject=new SearchBasedNavigationDisplayJS.HistoryTracker(currentContextProperties);dojo.back.setInitialState(historyObject);},initControlsOnPage:function(properties){var selectBox=dojo.byId("sortBy");if(selectBox!=null&&selectBox!="undefined"){dojo.byId("sortBy").value=properties["sortBy"];
}var selectBox=dojo.byId("filter1By");if(selectBox!=null&&selectBox!="undefined"){dojo.byId("filter1By").value=properties["filter1By"];}var selectBox=dojo.byId("filter2By");if(selectBox!=null&&selectBox!="undefined"){dojo.byId("filter2By").value=properties["filter2By"];}var selectBox=dojo.byId("filter3By");
if(selectBox!=null&&selectBox!="undefined"){dojo.byId("filter3By").value=properties["filter3By"];}var selectBox=dojo.byId("itemsPage");if(selectBox!=null&&selectBox!="undefined"){dojo.byId("itemsPage").value=properties["itemsPage"];}},initContentUrl:function(contentUrl){wc.render.getRefreshControllerById("searchBasedNavigation_content_controller").url=contentUrl;
},resetFacetCounts:function(){for(var i=0;i<this.facetIdsArray.length;i++){var facetValue=$("facet_count"+this.facetIdsArray[i]);if(facetValue!=null){facetValue.innerHTML=0;}}},updateFacetCount:function(id,count){var facetValue=$("facet_count"+id);if(facetValue!=null){var checkbox=$("facet_checkbox"+id);
if(count>0){checkbox.disabled=false;facetValue.innerHTML=count;}}},isValidNumber:function(n){return !isNaN(parseFloat(n))&&isFinite(n)&&n>0;},checkPriceInput:function(event,currencySymbol,imgUrlPath,section,removeCaption){if(this.validatePriceInput()&&event.keyCode==13){this.appendFilterPriceRange(currencySymbol,imgUrlPath,section,removeCaption);
}return false;},validatePriceInput:function(){if($("low_price_input")!=null&&$("high_price_input")!=null&&$("price_range_go")!=null){var low=$("low_price_input").value;var high=$("high_price_input").value;var go=$("price_range_go");if(this.isValidNumber(low)&&this.isValidNumber(high)&&parseFloat(high)>parseFloat(low)){go.className="go_button";
go.disabled=false;}else{go.className="go_button_disabled";go.disabled=true;}return !go.disabled;}return false;},toggleShowMore:function(index,show){var list=$("more_"+index);var morelink=$("morelink_"+index);if(list!=null){if(show){morelink.style.display="none";list.style.display="block";}else{morelink.style.display="block";
list.style.display="none";}}},toggleSearchFilter:function(element,id,section,imgUrlPath,removeCaption){if(element.checked){this.appendFilterFacet(id,section,imgUrlPath,removeCaption);}else{this.removeFilterFacet(id,section);}if(section!=""){$("section_"+section).style.display="none";}},appendFilterPriceRange:function(currencySymbol,imgUrlPath,section,removeCaption){var facetFilterList=$("facetFilterList");
var filter=$("pricefilter");if(filter==null){filter=document.createElement("li");filter.setAttribute("id","pricefilter");facetFilterList.appendChild(filter);}var label=currencySymbol+$("low_price_input").value+" - "+currencySymbol+$("high_price_input").value;filter.innerHTML="<a href='#' onclick='SearchBasedNavigationDisplayJS.removeFilterPriceRange(\""+section+"\"); return false;'>"+"<div class='filter_option'><div class='filter_sprite'><img src='"+imgUrlPath+"' alt='"+removeCaption+"' title='"+removeCaption+"'></div><span>"+label+"</span></div></a>";
$("clear_all_filter").style.display="block";if(this.validatePriceInput()){$("low_price_value").value=$("low_price_input").value;$("high_price_value").value=$("high_price_input").value;}if(section!=""){$("section_"+section).style.display="none";}this.doSearchFilter();},removeFilterPriceRange:function(section){$("low_price_value").value="";
$("high_price_value").value="";var facetFilterList=$("facetFilterList");var filter=$("pricefilter");if(filter!=null){facetFilterList.removeChild(filter);}if(facetFilterList.childNodes.length==0){$("clear_all_filter").style.display="none";}if(section!=""){$("section_"+section).style.display="block";}this.doSearchFilter();
},appendFilterFacet:function(id,section,imgUrlPath,removeCaption){var facetFilterList=$("facetFilterList");var filter=$("filter_"+id);if(filter==null){filter=document.createElement("li");filter.setAttribute("id","filter_"+id);var label=$("facetLabel_"+id).innerHTML;filter.innerHTML="<a href='#' onclick='SearchBasedNavigationDisplayJS.removeFilterFacet(\""+id+'", "'+section+"\"); return false;'>"+"<div class='filter_option'><div class='filter_sprite'><img src='"+imgUrlPath+"' alt='"+removeCaption+"' title='"+removeCaption+"'></div><span>"+label+"</span></div></a>";
facetFilterList.appendChild(filter);}$("clear_all_filter").style.display="block";this.doSearchFilter();},removeFilterFacet:function(id,section){var facetFilterList=$("facetFilterList");var filter=$("filter_"+id);if(filter!=null){facetFilterList.removeChild(filter);$("facet_checkbox"+id).checked=false;
}if(facetFilterList.childNodes.length==0){$("clear_all_filter").style.display="none";}if(section!=""){$("section_"+section).style.display="block";}this.doSearchFilter();},getEnabledProductFacets:function(){var facetForm=document.forms["productsFacets"];var elementArray=facetForm.elements;var facetArray=new Array();
for(var i=0;i<elementArray.length;i++){var element=elementArray[i];if(element.type!=null&&element.type.toUpperCase()=="CHECKBOX"){element.disabled=true;if(element.checked){facetArray.push(element.value);}}}if($("price_range_go")!=null){$("price_range_go").disabled=true;}return facetArray;},doSearchFilter:function(){if(!submitRequest()){return;
}cursor_wait();var minPrice="";var maxPrice="";if($("low_price_value")!=null&&$("high_price_value")!=null){minPrice=$("low_price_value").value;maxPrice=$("high_price_value").value;}var facetArray=this.getEnabledProductFacets();wc.render.updateContext("searchBasedNavigation_context",{"productBeginIndex":"0","facet":facetArray,"resultType":"products","minPrice":minPrice,"maxPrice":maxPrice,"isHistory":"false"});
MessageHelper.hideAndClearMessage();},clearAllFacets:function(){$("clear_all_filter").style.display="none";$("facetFilterList").innerHTML="";$("low_price_value").value="";$("high_price_value").value="";var facetForm=document.forms["productsFacets"];var elementArray=facetForm.elements;for(var i=0;i<elementArray.length;
i++){var element=elementArray[i];if(element.type!=null&&element.type.toUpperCase()=="CHECKBOX"&&element.checked){element.checked=false;}}for(var i=0;true;i++){var facetSection=$("section_"+i);if(facetSection==null){break;}else{facetSection.style.display="block";}}this.doSearchFilter();},toggleSearchContentFilter:function(){if(!submitRequest()){return;
}cursor_wait();var facetList="";var facetForm=document.forms["contentsFacets"];var elementArray=facetForm.elements;for(var i=0;i<elementArray.length;i++){var element=elementArray[i];if(element.type!=null&&element.type.toUpperCase()=="CHECKBOX"&&element.checked){facetList+=element.value+";";}}wc.render.updateContext("searchBasedNavigation_context",{"facet":facetList,"resultType":"content"});
MessageHelper.hideAndClearMessage();},updateContextProperties:function(contextId,properties){for(key in properties){wc.render.getContextById(contextId).properties[key]=properties[key];console.debug(" key = "+key+" and value ="+wc.render.getContextById(contextId).properties[key]);}},showResultsPageForContent:function(data){var pageNumber=data["pageNumber"];
var pageSize=data["pageSize"];pageNumber=dojo.number.parse(pageNumber);pageSize=dojo.number.parse(pageSize);setCurrentId(data["linkId"]);if(!submitRequest()){return;}var beginIndex=pageSize*(pageNumber-1);cursor_wait();wc.render.updateContext("searchBasedNavigation_context",{"contentBeginIndex":beginIndex,"resultType":"content","isHistory":"false"});
MessageHelper.hideAndClearMessage();},showResultsPage:function(data){var pageNumber=data["pageNumber"];var pageSize=data["pageSize"];pageNumber=dojo.number.parse(pageNumber);pageSize=dojo.number.parse(pageSize);setCurrentId(data["linkId"]);if(!submitRequest()){return;}console.debug(wc.render.getRefreshControllerById("searchBasedNavigation_controller").renderContext.properties);
var beginIndex=pageSize*(pageNumber-1);cursor_wait();wc.render.updateContext("searchBasedNavigation_context",{"productBeginIndex":beginIndex,"resultType":"products","isHistory":"false"});MessageHelper.hideAndClearMessage();Mattel.Analytics.addEvent("loadPaginationRefreshArea");},toggleView:function(data){var pageView=data["pageView"];
setCurrentId(data["linkId"]);if(!submitRequest()){return;}cursor_wait();console.debug("pageView = "+pageView+" controller = +searchBasedNavigation_controller");wc.render.updateContext("searchBasedNavigation_context",{"pageView":pageView,"isHistory":"false"});MessageHelper.hideAndClearMessage();},toggleExpand:function(id){var expand_icon=$("expand_icon_"+id);
var section_list=$("section_list_"+id);if(expand_icon.className=="expand_icon_open"){expand_icon.className="expand_icon_close";section_list.style.display="none";}else{expand_icon.className="expand_icon_open";section_list.style.display="block";}},sortResults:function(sortBy){if(!submitRequest()){return;
}try{var e=document.getElementById("sortBy");analyticTagVar_addInfo=e.options[e.selectedIndex].text;Mattel.Analytics.addEvent("loadItemsSortEvent");analyticTagVar_addInfo=undefined;}catch(err){Mattel.Utils.log(err);}cursor_wait();console.debug("sortBy = "+sortBy+" controller = +searchBasedNavigation_controller");
wc.render.updateContext("searchBasedNavigation_context",{"productBeginIndex":"0","sortBy":sortBy,"resultType":"products","isHistory":"false"});MessageHelper.hideAndClearMessage();},changeItemsPerPage:function(itemsPage){if(!submitRequest()){return;}try{if(storeName.value=="AGStore"||storeName.value=="American Girl"){var e=document.getElementById("itemsPage");
}else{var e=document.getElementById("itemPage");}analyticTagVar_addInfo=e.options[e.selectedIndex].text;Mattel.Analytics.addEvent("loadItemsPerPageEvent");analyticTagVar_addInfo=undefined;}catch(err){Mattel.Utils.log(err);}cursor_wait();console.debug("itemsPage = "+itemsPage+" controller = +searchBasedNavigation_controller");
wc.render.updateContext("searchBasedNavigation_context",{"productBeginIndex":"0","itemsPage":itemsPage,"resultType":"products","isHistory":"false"});MessageHelper.hideAndClearMessage();},filter1Results:function(filterBy){if(!submitRequest()){return;}try{var e=document.getElementById("filter1By");analyticTagVar_addInfo=e.options[e.selectedIndex].text;
Mattel.Analytics.addEvent("loadItemsFilterByEvent");analyticTagVar_addInfo=undefined;}catch(err){Mattel.Utils.log(err);}cursor_wait();console.debug("filter1By = "+filterBy+" controller = +searchBasedNavigation_controller");wc.render.updateContext("searchBasedNavigation_context",{"productBeginIndex":"0","filter1By":filterBy,"resultType":"products","isHistory":"false"});
MessageHelper.hideAndClearMessage();},filter2Results:function(filterBy){if(!submitRequest()){return;}try{var e=document.getElementById("filter2By");analyticTagVar_addInfo=e.options[e.selectedIndex].text;Mattel.Analytics.addEvent("loadItemsFilterByEvent");analyticTagVar_addInfo=undefined;}catch(err){Mattel.Utils.log(err);
}cursor_wait();console.debug("filter2By = "+filterBy+" controller = +searchBasedNavigation_controller");wc.render.updateContext("searchBasedNavigation_context",{"productBeginIndex":"0","filter2By":filterBy,"resultType":"products","isHistory":"false"});MessageHelper.hideAndClearMessage();},filter3Results:function(filterBy){if(!submitRequest()){return;
}try{var e=document.getElementById("filter3By");analyticTagVar_addInfo=e.options[e.selectedIndex].text;Mattel.Analytics.addEvent("loadItemsFilterByEvent");analyticTagVar_addInfo=undefined;}catch(err){Mattel.Utils.log(err);}cursor_wait();console.debug("filter3By = "+filterBy+" controller = +searchBasedNavigation_controller");
wc.render.updateContext("searchBasedNavigation_context",{"productBeginIndex":"0","filter3By":filterBy,"resultType":"products","isHistory":"false"});MessageHelper.hideAndClearMessage();},sortResults_content:function(sortBy){if(!submitRequest()){return;}cursor_wait();console.debug("sortBy = "+sortBy+" controller = +searchBasedNavigation_controller");
wc.render.updateContext("searchBasedNavigation_context",{"productBeginIndex":"0","orderByContent":sortBy,"resultType":"content","isHistory":"false"});MessageHelper.hideAndClearMessage();},HistoryTracker:function(currentContextProperties){this.changeUrl=false;this.contextProperties=SearchBasedNavigationDisplayJS.clone(currentContextProperties);
this.contextProperties["isHistory"]="true";this.contextProperties["resultType"]="both";this.back=SearchBasedNavigationDisplayJS.handleBrowserBackForward;this.forward=SearchBasedNavigationDisplayJS.handleBrowserBackForward;console.debug("Add to history...."+this.contextProperties["itemsPage"]+" "+this.contextProperties["sortBy"]+" "+this.contextProperties["productBeginIndex"]+" "+this.contextProperties["contentBeginIndex"]+" "+this.contextProperties["resultType"]+" "+this.contextProperties["facet"]);
console.debug(this.contextProperties);},handleBrowserBackForward:function(){cursor_wait();console.debug("From history...."+this.contextProperties["itemsPage"]+" "+this.contextProperties["sortBy"]+" "+this.contextProperties["productBeginIndex"]+" "+this.contextProperties["contentBeginIndex"]+" "+this.contextProperties["resultType"]+" "+this.contextProperties["facet"]);
wc.render.updateContext("searchBasedNavigation_context",this.contextProperties);$("widget_left_nav").innerHTML=this.leftNavSnapshot;},clone:function(masterObj){if(null==masterObj||"object"!=typeof masterObj){return masterObj;}var clone=masterObj.constructor();for(var attr in masterObj){if(masterObj.hasOwnProperty(attr)){clone[attr]=masterObj[attr];
}}return clone;}};}function MattelControllerRefresh(){return function(widget,parameters){var formNode=null;if(this.formId){formNode=document.getElementById(this.formId);}if(parameters){if(!parameters.requesttype){parameters.requesttype="ajax";}}else{parameters=[];parameters.requesttype="ajax";}this.url=this.url.replace(/amp;/g,"");
dojo.publish("ajaxRequestInitiated");dojo.xhrGet({url:this.url+"&"+$.param(parameters),mimetype:this.mimetype,form:formNode,load:function(data){function getIds(idType,controllerURL){var myId="";if(parameters&&parameters[idType]){myId=parameters[idType];}if(myId==""&&formNode!=null&&formNode[idType]){myId=formNode[idType];
if(formNode[idType].value!=null){myId=formNode[idType].value;}}if(myId==""&&controllerURL){var temp=controllerURL;if(temp.indexOf(idType)!=-1){temp=temp.substring(temp.indexOf(idType));var tokens=temp.split("&");var tokens2=tokens[0].split("=");myId=tokens2[1];}}return myId;}var storeId=getIds("storeId",this.url);
var catalogId=getIds("catalogId",this.url);var langId=getIds("langId",this.url);var errorCodeBegin=data.indexOf("errorCode");if(errorCodeBegin!=-1){var errorCodeEnd=data.indexOf(",",errorCodeBegin);var errorCodeString=data.substring(errorCodeBegin,errorCodeEnd);console.debug("error condition encountered - error code: "+errorCodeString);
if(errorCodeString.indexOf("2550")!=-1){console.debug("error type: ERR_DIDNT_LOGON - the customer did not log on to the system.");console.debug("redirecting to URL: "+"AjaxLogonForm?storeId="+storeId+"&catalogId="+catalogId+"&langId="+langId+"&myAcctMain=1");document.location.href="AjaxLogonForm?storeId="+storeId+"&catalogId="+catalogId+"&langId="+langId+"&myAcctMain=1";
}else{if(errorCodeString.indexOf("2510")!=-1){console.debug("error type: ERR_SESSION_TIMEOUT - use session has timed out");console.debug("redirecting to URL: "+"Logoff?URL=ReLogonFormView&storeId="+storeId);document.location.href="Logoff?URL=ReLogonFormView&storeId="+storeId;}else{if(errorCodeString.indexOf("2520")!=-1){console.debug("error type: ERR_PROHIBITED_CHAR - detected prohibited characters in request");
console.debug("redirecting to URL: "+"ProhibitedCharacterErrorView?storeId="+storeId+"&catalogId="+catalogId+"&langId="+langId);document.location.href="ProhibitedCharacterErrorView?storeId="+storeId+"&catalogId="+catalogId+"&langId="+langId;}else{if(errorCodeString.indexOf("2540")!=-1){console.debug("error type: ERR_CSRF - cross site request forgery attempt was detected");
console.debug("redirecting to URL: "+"CrossSiteRequestForgeryErrorView?storeId="+storeId+"&catalogId="+catalogId+"&langId="+langId);document.location.href="CrossSiteRequestForgeryErrorView?storeId="+storeId+"&catalogId="+catalogId+"&langId="+langId;}else{if(errorCodeString.indexOf("CMN1039E")!=-1){console.debug("error type: _ERR_INVALID_COOKIE - cookie error was detected");
console.debug("redirecting to URL: "+"CookieErrorView?storeId="+storeId+"&catalogId="+catalogId+"&langId="+langId);document.location.href="CookieErrorView?storeId="+storeId+"&catalogId="+catalogId+"&langId="+langId;}}}}}}else{var controller=widget.controller;console.debug("RefreshController.refresh - calling refreshHandler for "+widget);
controller.refreshHandler(widget,data);if(controller.postRefreshHandler!=null){console.debug("RefreshController.refresh - calling postRefreshHandler for "+widget);controller.postRefreshHandler(widget);}}dojo.publish("ajaxRequestCompleted");widget.updateLiveRegion();},error:function(error){var messages=dojo.i18n.getLocalization("wc","common");
console.debug("Warning: communication error while updating the refresh area");dojo.publish("ajaxRequestCompleted");}});};}