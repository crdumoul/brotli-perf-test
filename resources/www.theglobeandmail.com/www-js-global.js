
var GlobeLiveSuggest=function($,url){var $this=this;this.$wrapper=$('#sNews_masthead');this.$form=$('#searchForm_gam_masthead');this.$input=$('#news_search_masthead');this.$button=$('input[type="submit"]',this.$form);this.$results=$('#menu_popup');this.lsUrl=url;this.mouse_is_inside=false;this.addHandlers=function(){this.$wrapper.hover(function(){this.mouse_is_inside=true;},function(){this.mouse_is_inside=false;});this.$button.click(function(e){e.preventDefault();var q=$this.$button.val();if(q!=''&&q.split(',').length>1){window.location.href=$g_conf.publicationUrl+'globe-investor/search/?q='+encodeURIComponent(q);}else{$this.$form.submit();}});this.$input.bind('keydown keypress',function(e){if(e.keyCode==38||e.keyCode==40){e.preventDefault();}});this.$input.keyup(this.debounce(function(e){if(e.keyCode>47&&e.keyCode<106){var q=$this.$input.val();var qs=q.split(",");if(q==''){$this.$results.hide();}else{if(qs.length>1){q=q.replace(" ","").toUpperCase();$this.$input.val(q).css('text-transform','uppercase');}else{$this.$input.val(q).css('text-transform','none');}
q=encodeURIComponent(q);$.get($this.lsUrl+q,function(data){if(data!=''){$this.$results.html(data).show();}else{$this.$results.hide();}});}}else if(e.keyCode==13){var q=$this.$input.val();$this.search(q);}else{return;}},300,false));$('body').mouseup(function(){if(!$this.mouse_is_inside)$this.$results.hide();});}
this.debounce=function(func,threshold,execAsap){var timeout;return function debounced(){var obj=this,args=arguments;function delayed(){if(!execAsap)func.apply(obj,args);timeout=null;}
if(timeout){clearTimeout(timeout);}else if(execAsap){func.apply(obj,args);}
timeout=setTimeout(delayed,threshold||100);}}
this.search=function(val){this.$results.hide();var qs=val.split(",");if(qs.length>1){window.location.href=$g_conf.publicationUrl+'globe-investor/search/?q='+encodeURIComponent(val);}else{this.$input.val(val);this.$form.submit();}}
this.addSymbolToSearch=function(symbol){var val=this.$input.val().split(' ').join('');var split=val.split(","),len=split.length,newVal='';for(var i=0;i<len-1;i++){newVal=newVal+split[i]+", ";}
newVal=newVal+symbol+", ";this.$input.val(newVal).focus();}};$g.namespace('globe.investor');var globeInvestorFundName="";var globeInvestorUserId="";var globeInvestorSecurity="";var globeInvestorSecurityType="stocks";globe.investor.securityType={FUND:'1',STOCK:'5',BOND:'100',COMMODITY:'15',ETF:'20',INDEX:'25',CURRENCY:'30'};globe.investor.addToWatchlistNum=0;globe.investor.successMsg=[];globe.investor.failMsg=[];globe.investor.securityAlreadyExists;globe.investor.type;globe.investor.tiemeoutId;globe.investor.watchlistDropDown;globe.investor.overlayTimeout=2000;globe.investor.getInvestorUserId=function(uid){var hdCookie=$g.getCookie("hd");var stringIndex=0;var cookieUid="";if(uid==""){try{if(hdCookie!=""){stringIndex=hdCookie.indexOf("|",0);cookieUid=hdCookie.substring(0,stringIndex);if(cookieUid==""){cookieUid="-1"
return cookieUid}else{return cookieUid}}else{cookieUid="-1"
return cookieUid}}catch(e){return"-1";}}else{return uid;}}
globe.investor.popWatchlistSelect=function(json){globe.investor.watchlistDropDown.find('option').remove().end().append("<option value=\"-\">Select Watchlist</option>");$.each(json,function(i,val){if(this.watchlistId!=""||this.watchlistName!=""){var wlName=this.watchlistName;if(wlName.length>25)wlName=wlName.substring(0,25)+"...";globe.investor.watchlistDropDown.append("<option value=\""+this.watchlistId+"\">"+wlName+"</option>");}});if(globeInvestorSecurityType=='funds'){$("#watchlist-add-security-name").html(globeInvestorFundName);}else{$("#watchlist-add-security-name").html(globeInvestorSecurity);}}
globe.investor.addSecurityToWatchlistSingle=function(){globe.investor.addToWatchlistNum=1;globe.investor.successMsg=[];globe.investor.failMsg=[];globe.investor.securityAlreadyExists=true;var watchlistid=globe.investor.watchlistDropDown.val();if(watchlistid=="-"){globe.investor.failedOverlay("Please select a watchlist");setTimeout(globe.investor.showWatchlistOverlay,globe.investor.overlayTimeout);}else{globe.investor.loadingOverlay(true);globe.investor.addSecurityToWatchlist();}
return false;}
globe.investor.addSecurityToWatchlistMultiple=function(){var symbols=$("#watchlist-briefcase-inner-watchlist .article-symbol input:checked").map(function(){return $(this).attr("value")}).get();if(symbols.length==0){globe.investor.failedOverlay("No symbol selected");setTimeout(globe.investor.showWatchlistOverlay,globe.investor.overlayTimeout);return false;}
globe.investor.addToWatchlistNum=symbols.length;globe.investor.successMsg=[];globe.investor.failMsg=[];globe.investor.securityAlreadyExists=true;var watchlistid=globe.investor.watchlistDropDown.val();if(watchlistid=="-"){globe.investor.failedOverlay("Please select a watchlist");setTimeout(globe.investor.showWatchlistOverlay,globe.investor.overlayTimeout);}else{globe.investor.loadingOverlay(true);$(symbols).each(function(i,el){globeInvestorSecurity=el;globe.investor.addSecurityToWatchlist();});}
return false;}
globe.investor.addSecurityToWatchlist=function(){if(globeInvestorUserId==""){globeInvestorUserId=globe.investor.getInvestorUserId(globeInvestorUserId);}
if(globeInvestorUserId!="-1"){if($g_user.isLoggedIn){var watchlistid="";var watchlistNm="";var sym="";var ex="";var st="";var strSearch="";var strIndex=0;var postString="";var fundId="";watchlistid=globe.investor.watchlistDropDown.val();watchlistNm=$("option[value='"+watchlistid+"']",globe.investor.watchlistDropDown).text();if(globeInvestorSecurityType=="stocks"||globeInvestorSecurityType=="indices"||globeInvestorSecurityType==globe.investor.securityType.STOCK||globeInvestorSecurityType==globe.investor.securityType.ETF||globeInvestorSecurityType==globe.investor.securityType.INDEX||globeInvestorSecurityType==globe.investor.securityType.COMMODITY||globeInvestorSecurityType==globe.investor.securityType.CURRENCY){strIndex=globeInvestorSecurity.indexOf("-");sym=$.trim(globeInvestorSecurity.substring(0,strIndex));ex=$.trim(globeInvestorSecurity.substring(strIndex+1));postString="s="+sym+"&e="+ex+"&st="+globeInvestorSecurityType+"&wid="+watchlistid+"&wn="+watchlistNm}else if(globeInvestorSecurityType.indexOf("1,")!=-1){fundId=$.trim(globeInvestorSecurityType.substring(globeInvestorSecurityType.indexOf(",")+1));var securityParts=globeInvestorSecurity.split("-");globeInvestorFundName=securityParts[1];postString="fid="+fundId+"&fn="+globeInvestorFundName+"&wid="+watchlistid+"&wn="+watchlistNm;}else{var securityParts=globeInvestorSecurity.split("-");fundId=securityParts[0]
globeInvestorFundName=securityParts[1];postString="fid="+fundId+"&fn="+globeInvestorFundName+"&wid="+watchlistid+"&wn="+watchlistNm;}
$.ajax({url:$g_conf.publicationUrl+'template/framework/watchlist/ajax/add.watchlist.ajax.jsp',type:'POST',dataType:'json',data:postString,cache:false,error:function(XMLHttpRequest,textStatus,errorThrown){globe.investor.failMsg.push('Your request could not be completed at this time; please refresh the page and try again');globe.investor.addToWatchlistNum--;if(globe.investor.addToWatchlistNum==0){globe.investor.loadingOverlay(false);globe.investor.mixedOverlay("Add to Watchlist");setTimeout(globe.investor.showAddToOverlay,globe.investor.overlayTimeout);}},success:function(json){if(globeInvestorSecurityType=="funds"){var symbol=json.symbol.split(',')[0];}else{var symbol=json.symbol;}
if(json.returnCode=="0"){globe.investor.successMsg.push(symbol);s.linkTrackVars='events';s.linkTrackEvents='event29';s.events='event29';s.tl(true,'o','Add to Watchlist');}else{globe.investor.failMsg.push(symbol);if(json.remessage!="This security already exists in this watchlist.")globe.investor.securityAlreadyExists=false;}
globe.investor.addToWatchlistNum--;if(globe.investor.addToWatchlistNum==0){globe.investor.loadingOverlay(false);if(globe.investor.failMsg.length>0){if(globe.investor.securityAlreadyExists){var footer="One or more securities already exist in this watchlist.";}else{var footer="An error occured, please try again";}
var isSuccess=false;}else{var footer="Successfully added";var isSuccess=true;}
globe.investor.mixedOverlay("Add to Watchlist",footer,isSuccess);setTimeout(globe.investor.showAddToOverlay,globe.investor.overlayTimeout*2);}
globe.investor.loadingOverlay(false);}});}}else{globe.investor.failedOverlay("System error: Error getting user id. Please try login in again.");setTimeout(globe.investor.showAddToOverlay,globe.investor.overlayTimeout);}
return false;}
globe.investor.addToOverlay=function(clickedEl){globe.investor.showAddToOverlay();var watchlistBriefcaseAdd=$(".watchlist-briefcase-add");if($("#ie-warning:visible").length>0){var vBias=$("#ie-warning:first").height();}else{var vBias=0;}
if(typeof(clickedEl)!=='undefined'){$('body').append('<div id="loginOverlayUnderlay"></div>');var clickedElObj=$(clickedEl);if(clickedElObj.hasClass("awl-symbol")){globe.investor.type='symbol';if(clickedElObj.closest(".widget-chart").length!=0){var bias=$("#page").offset().left+180;}else if(clickedElObj.closest(".column-2").length!=0){var bias=clickedElObj.closest(".column-2").offset().left;}else{var bias=$("#page").offset().left+180;}
watchlistBriefcaseAdd.fadeIn().css('left',clickedElObj.offset().left-bias+watchlistBriefcaseAdd.width()+22).css('top',clickedElObj.offset().top-53-vBias);watchlistBriefcaseAdd.find(".read").hide();watchlistBriefcaseAdd.find(".follow").hide();watchlistBriefcaseAdd.find(".watchlist").show();}else if(clickedElObj.hasClass("awl-article")){globe.investor.type='article';watchlistBriefcaseAdd.fadeIn().css('left',clickedElObj.offset().left-clickedElObj.closest("article.hentry").offset().left+watchlistBriefcaseAdd.width()-140).css('top',clickedElObj.offset().top-53-vBias);if(typeof(globe.investor.watchlistStockList)!=="undefined"){watchlistBriefcaseAdd.find(".watchlist").show();}else{watchlistBriefcaseAdd.find(".watchlist").hide();}}
watchlistBriefcaseAdd.css(' z-index','999999 !important');}
if($("#watchlist-briefcase-inner-addto .button:visible").length==1){watchlistBriefcaseAdd.css('top',clickedElObj.offset().top-23-vBias);$(".point",watchlistBriefcaseAdd).css("top",20);}else{watchlistBriefcaseAdd.css('top',clickedElObj.offset().top-53-vBias);$(".point",watchlistBriefcaseAdd).css("top","");}
watchlistBriefcaseAdd.find(".toWatchlist").unbind().click(function(event){event.preventDefault();globe.investor.watchlistOverlay(clickedElObj.attr('rel'));});}
globe.investor.showAddToOverlay=function(){$(".watchlist-briefcase-add .watchlist-briefcase-inner > div[id!='watchlist-briefcase-inner-addto']").hide();$("#watchlist-briefcase-inner-addto").fadeIn();}
globe.investor.initWatchlistOverlay=function(){if(globeInvestorUserId==""){globeInvestorUserId=globe.investor.getInvestorUserId(globeInvestorUserId);}
if(globeInvestorUserId!="-1"){if($g_user.isLoggedIn){$.ajax({url:$g_conf.publicationUrl+'template/framework/watchlist/ajax/get.watchlists.ajax.jsp',type:'GET',dataType:'json',cache:false,error:function(XMLHttpRequest,textStatus,errorThrown){globe.investor.failedOverlay('Your request could not be completed at this time; please refresh the page and try again');globe.investor.loadingOverlay(false);},success:function(json){if(json.length==1&&json[0].remessage!="-"){if(json[0].returnCode!="0"){globe.investor.failedOverlay(json[0].remessage);}}else{globe.investor.popWatchlistSelect(json);}}});}}else{globe.investor.failedOverlay("System error: Error getting user id.  <br/>Please try logging in again.");}}
globe.investor.watchlistOverlay=function(security){var watchlistBriefcaseInnerWatchlist=$("#watchlist-briefcase-inner-watchlist");if($("option[value='-']",globe.investor.watchlistDropDown).text()!=""){globe.investor.showWatchlistOverlay();if(globe.investor.type=='symbol'){$(".button input",watchlistBriefcaseInnerWatchlist).hide();if(typeof(security)!=='undefined'){if(globeInvestorSecurityType=="funds"){var securityParts=security.split("-");if($("h3.fundHeader").length==1){$(".button span:first",watchlistBriefcaseInnerWatchlist).text($("h3.fundHeader").text());}else{$(".button span:first",watchlistBriefcaseInnerWatchlist).text(securityParts[1].split(',')[0]);}
$(".button span:last",watchlistBriefcaseInnerWatchlist).hide();}else{$(".button span:first",watchlistBriefcaseInnerWatchlist).text(security);$(".button span:last",watchlistBriefcaseInnerWatchlist).show().html(globe.investor.getCompanyBySymbol(security));}}
$(".article-symbol",watchlistBriefcaseInnerWatchlist).hide();$(".button:first",watchlistBriefcaseInnerWatchlist).show();$('.submitButton',watchlistBriefcaseInnerWatchlist).unbind().bind('click',globe.investor.addSecurityToWatchlistSingle);}else if(globe.investor.type=='article'){$(".button input",watchlistBriefcaseInnerWatchlist).show();var firstButton=$(".button:first",watchlistBriefcaseInnerWatchlist).hide();$(".button:gt(0):not(.submitButton)",watchlistBriefcaseInnerWatchlist).remove();for(var i=0;i<globe.investor.watchlistStockList.length;i++){firstButton.clone().addClass("article-symbol").insertAfter(firstButton).show().find("span:first").text(globe.investor.watchlistStockList[i].stock).end().find("span:last").html(globe.investor.watchlistStockList[i].companyName).end().find("input").attr("value",globe.investor.watchlistStockList[i].stock);}
$('.submitButton',watchlistBriefcaseInnerWatchlist).unbind().bind('click',globe.investor.addSecurityToWatchlistMultiple);}}else{}
return false;}
globe.investor.showWatchlistOverlay=function(){$(".watchlist-briefcase-add .watchlist-briefcase-inner > div[id!='watchlist-briefcase-inner-watchlist']").hide();$("#watchlist-briefcase-inner-watchlist").fadeIn();}
globe.investor.showFollowOverlay=function(){$(".watchlist-briefcase-add .watchlist-briefcase-inner > div[id!='watchlist-briefcase-inner-follow']").hide();$("#watchlist-briefcase-inner-follow").fadeIn();}
globe.investor.failedOverlay=function(message,header){if(!message)message="We've run into a glitch. Please try again later.";if(!header)header="Add to Watchlist";$(".watchlist-briefcase-add .watchlist-briefcase-inner > div[id!='watchlist-briefcase-inner-failed']").hide();var watchlistBriefcaseInnerFailed=$("#watchlist-briefcase-inner-failed");$("h3",watchlistBriefcaseInnerFailed).text(message);$("h5",watchlistBriefcaseInnerFailed).text(header);watchlistBriefcaseInnerFailed.fadeIn();}
globe.investor.successOverlay=function(message,header){if(!message)message="Success";if(!header)header="Add to Watchlist";$(".watchlist-briefcase-add .watchlist-briefcase-inner > div[id!='watchlist-briefcase-inner-success']").hide();var watchlistBriefcaseInnerSuccess=$("#watchlist-briefcase-inner-success");$("h3",watchlistBriefcaseInnerSuccess).text(message);$("h5",watchlistBriefcaseInnerSuccess).text(header);watchlistBriefcaseInnerSuccess.fadeIn();}
globe.investor.mixedOverlay=function(header,footer,isSuccess){if(globe.investor.successMsg.length==0&&globe.investor.failMsg.length==0)return;if(typeof(footer)=="undefined")footer="We've run into a glitch. Please try again later.";$(".watchlist-briefcase-add .watchlist-briefcase-inner > div[id!='watchlist-briefcase-inner-mixed']").hide();$("#watchlist-briefcase-inner-mixed").fadeIn();if(typeof(header)!=="undefined")$("#watchlist-briefcase-inner-mixed h5").text(header);if(typeof(footer)!=="undefined")$("#watchlist-briefcase-inner-mixed h3").text(footer);var firstButton=$("#watchlist-briefcase-inner-mixed .cautionWrapper .button:first").hide();$("#watchlist-briefcase-inner-mixed .cautionWrapper .button:gt(0)").remove();if(isSuccess){$("#watchlist-briefcase-inner-mixed .cautionWrapper span:first").removeClass("cautionIcon").addClass("successIcon");}else{$("#watchlist-briefcase-inner-mixed .cautionWrapper span:first").removeClass("successIcon").addClass("cautionIcon");}
$(globe.investor.successMsg).each(function(i,el){firstButton.clone().insertAfter(firstButton).show().find("span.companyName").html(el).end().find("span:first").removeClass("errorIcon").addClass("successIcon");});$(globe.investor.failMsg).each(function(i,el){firstButton.clone().insertAfter(firstButton).show().find("span.companyName").html(el);});}
globe.investor.loadingOverlay=function(showHide){if(showHide){$(".watchlist-briefcase-add .watchlist-briefcase-inner > div[id!='watchlist-briefcase-inner-loader']").css('visibility','hidden');$("#watchlist-briefcase-inner-loader").fadeIn();}else{$(".watchlist-briefcase-add .watchlist-briefcase-inner > div[id!='watchlist-briefcase-inner-loader']").css('visibility','visible');$("#watchlist-briefcase-inner-loader").hide();}}
globe.investor.hideOverlays=function(){$(".watchlist-briefcase-add").fadeOut();}
globe.investor.getCompanyBySymbol=function(symbol){if(typeof(globe.investor.watchlistStockList)==="undefined")return"";for(var i=0;i<globe.investor.watchlistStockList.length;i++){if(symbol==globe.investor.watchlistStockList[i].stock)return globe.investor.watchlistStockList[i].companyName;}}
globe.investor.isBriefcaseOn=function(){return $("#dashwrapper").hasClass('web');}
globe.investor.showAddToButton=function(){$(".awl-article").css("display","inline-block");}
globe.investor.updateCompanyNames=function(){if(typeof(globe.investor.watchlistStockList)==="undefined")return;globe.investor.watchlistStockList.sort(function(a,b){if(a.companyName<b.companyName)
return-1;if(a.companyName>b.companyName)
return 1;return 0;});var duplicates=[];for(var i=0;i<globe.investor.watchlistStockList.length-1;i++){if(globe.investor.watchlistStockList[i+1].companyName==globe.investor.watchlistStockList[i].companyName){if(duplicates.length==0){duplicates.push(i);}
duplicates.push(i+1)}}
for(var i=0;i<globe.investor.watchlistStockList.length;i++){globe.investor.watchlistStockList[i].companyNameUpdated=globe.investor.watchlistStockList[i].companyName}
for(var i=0;i<duplicates.length;i++){globe.investor.watchlistStockList[duplicates[i]].companyNameUpdated=globe.investor.watchlistStockList[duplicates[i]].companyName+" ("+globe.investor.watchlistStockList[duplicates[i]].stock+")";}}
globe.investor.isArticleFollowable=function(){if(typeof(globe.investor.watchlistStockList)==="undefined")return false;var hasStock=false;$(globe.investor.watchlistStockList).each(function(i,el){if(el.companyID){hasStock=true;}});return hasStock;}
globe.investor.detectAction=function(security,clickID,clickedEl){if(!$g_user.isLoggedIn){var params=window.location.search.substring(1);window.location=$g_conf.securePubUrl+"/login/?force=addtowatchlist&articleId="+
$g_conf.current.articleId+"&sectionId="+$g_conf.current.sectionId+"&watchlist="+security+"&clicked="+clickID+"&myparams="+escape(params);}else{globeInvestorSecurity=security;if($(clickedEl).attr('data-security-type')==globe.investor.securityType.FUND){globeInvestorSecurityType="funds";}else{globeInvestorSecurityType="stocks";}
globe.investor.addToOverlay(clickedEl);}
return false;}
$(document).ready(function(){if(typeof(globe.investor.watchlistStockList)!=="undefined"){globe.investor.showAddToButton();}
if($g_user.isLoggedIn){globe.investor.showAddToButtonAttempts=0;globe.investor.tiemeoutId=setInterval(function(){if(globe.investor.isBriefcaseOn()){globe.investor.showAddToButton();clearInterval(globe.investor.tiemeoutId);}
globe.investor.showAddToButtonAttempts++;if(globe.investor.showAddToButtonAttempts==120)clearInterval(globe.investor.tiemeoutId);},1000);}
globe.investor.initWatchlistOverlay();globe.investor.watchlistDropDown=$("#copy-watchlist");$("li#watchlist a,a.awl-article,a.awl-symbol").click(function(event){event.preventDefault();var security=$(this).attr('rel');var clickID=$(this).attr('id');globe.investor.detectAction(security,clickID,this);return false;});$("#loginOverlayUnderlay").on('click',function(){$(".watchlist-briefcase-add").fadeOut();$(this).remove();});globe.investor.updateCompanyNames();});$(window).load(function(){if(window.location.hash){var hash=window.location.hash.substring(1);$('#'+hash).click();}});!function($){var Modal=function(content,options){this.options=options;this.$element=$(content).delegate('[data-dismiss="modal"]',"click.dismiss.modal",$.proxy(this.hide,this))};Modal.prototype={constructor:Modal,toggle:function(){return this[!this.isShown?"show":"hide"]()},show:function(){var that=this;if(this.isShown)return;$("body").addClass("modal-open");this.isShown=true;this.$element.trigger("show");escape.call(this);backdrop.call(this,function(){var transition=$.support.transition&&that.$element.hasClass("fade");!that.$element.parent().length&&that.$element.appendTo(document.body);that.$element.show();if(transition)that.$element[0].offsetWidth;that.$element.addClass("in");transition?that.$element.one($.support.transition.end,function(){that.$element.trigger("shown")}):that.$element.trigger("shown")})},hide:function(e){e&&e.preventDefault();if(!this.isShown)return;var that=this;this.isShown=false;$("body").removeClass("modal-open");escape.call(this);this.$element.trigger("hide").removeClass("in");$.support.transition&&this.$element.hasClass("fade")?hideWithTransition.call(this):hideModal.call(this)}};function hideWithTransition(){var that=this,timeout=setTimeout(function(){that.$element.off($.support.transition.end);hideModal.call(that)},500);this.$element.one($.support.transition.end,function(){clearTimeout(timeout);hideModal.call(that)})}function hideModal(that){this.$element.hide().trigger("hidden");backdrop.call(this)}function backdrop(callback){var that=this,animate=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var doAnimate=$.support.transition&&animate;this.$backdrop=$('<div class="modal-backdrop '+animate+'" />').appendTo(document.body);if(this.options.backdrop!="static")this.$backdrop.click($.proxy(this.hide,this));if(doAnimate)this.$backdrop[0].offsetWidth;this.$backdrop.addClass("in");doAnimate?this.$backdrop.one($.support.transition.end,callback):callback()}else if(!this.isShown&&this.$backdrop){this.$backdrop.removeClass("in");$.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one($.support.transition.end,$.proxy(removeBackdrop,this)):removeBackdrop.call(this)}else if(callback)callback()}function removeBackdrop(){this.$backdrop.remove();this.$backdrop=null}function escape(){var that=this;if(this.isShown&&this.options.keyboard)$(document).on("keyup.dismiss.modal",function(e){e.which==27&&that.hide()});else if(!this.isShown)$(document).off("keyup.dismiss.modal")}$.fn.modal=function(option){return this.each(function(){var $this=$(this),data=$this.data("modal"),options=$.extend({},$.fn.modal.defaults,$this.data(),typeof option=="object"&&option);if(!data)$this.data("modal",data=new Modal(this,options));if(typeof option=="string")data[option]();else if(options.show)data.show()})};$.fn.modal.defaults={backdrop:true,keyboard:true,show:true};$.fn.modal.Constructor=Modal;$(function(){$("body").on("click.modal.data-api",'[data-toggle="modal"]',function(e){var $this=$(this),href,$target=$($this.attr("data-target")||(href=$this.attr("href"))&&href.replace(/.*(?=#[^\s]+$)/,"")),option=$target.data("modal")?"toggle":$.extend({},$target.data(),$this.data());e.preventDefault();$target.modal(option)})})}(window.jQuery);var cityList=[{"link":"#","value":"Select City"},{"link":"CAAB0049","value":"Calgary"},{"link":"CANS0057","value":"Halifax"},{"link":"CAQC0363","value":"Montreal"},{"link":"CAON0696","value":"Toronto"},{"link":"CABC0308","value":"Vancouver"},{"link":$g_conf.publicationUrl+"weather/","value":"More Cities"}];var weather={};weather.setDefaultCity=function(){var locArr=util.getStoredValue('weatherLocid').split('=');$.getJSON($g_conf.publicationUrl+"template/mobile/weather/controller/helper/city.jsp?locationid="+locArr[0],function(data){var iconUrl=$g_conf.publicationUrl+"media/mobile/images/weather/20/"+data.contents.OBS.ICON+".png";var linkUrl=$g_conf.publicationUrl+"weather/?locationid="+data.contents.LOCATIONID;var htmlContent="<img src='"+iconUrl+"' />";htmlContent+=data.contents.OBS.TEMPERATURE+"<sup class='tempUnit'>&deg;C</sup>";$("#weather-icon").css("background-image","none").attr("href",linkUrl).html(function(){return htmlContent;});$("#weather_list").html(function(){var cityName=data.contents.NAME_EN;if(cityName.length>8)
{var shortened=data.contents.NAME_EN.substring(0,8)+"&hellip;";return"<li><a href='"+linkUrl+"' title='"+data.contents.NAME_EN+"'>"+shortened+"</a></li>";}
else
{return"<li><a href='"+linkUrl+"' title='"+data.contents.NAME_EN+"'>"+data.contents.NAME_EN+"</a></li>";}}).css("background-color","transparent").css("border","none");$("#weather_list a").css("margin","7px");});}
weather.resetDefaultCity=function(){$("#weather-icon").css("background","url('"+$g_conf.mediaUrl+"/media/mobile/images/weather/default-weather-icon.gif') no-repeat scroll 20px 3px transparent");$("#weather-icon").html("");var listLength=cityList.length;$("#weather_list").html(function(){var markup="<li><span class='arrow arrowLeft'></span><a href='"+cityList[0].link+"' id='select_city' title='Select City'>"+cityList[0].value+"</a></li>";for(var i=1;i<listLength-1;i++){markup+="<li class='bullet'><a class='selected_city' href='"+$g_conf.publicationUrl+"weather/?locationid="+cityList[i].link+"'>"+cityList[i].value+"</a></li>";}
markup+="<li><a href='"+cityList[listLength-1].link+"' id='select_city' title='Select City'>"+cityList[listLength-1].value+"</a></li>";return markup;});$('#select_city').click(function(e){e.preventDefault();$(this).parent().parent().toggleClass('state_show');$(this).parent().siblings().toggle();$('.arrow').toggleClass('arrowLeft').toggleClass('arrowDown');});$('.selected_city').click(function(e){var city=$(this).html();for(x in cityList){if(cityList[x].value==city)
util.store('weatherLocid',cityList[x].link,7);}});}
$(document).ready(function(){$('#global_search ul li a').click(function(e){e.preventDefault();$('#global_search ul li a').removeClass('state_current');$(this).addClass('state_current');$('#global_search div').removeClass('state_show');var _attrib=$(this).attr('href');$(_attrib).addClass('state_show');});if(util.getStoredValue('weatherLocid')!=null){weather.setDefaultCity();}
else{weather.resetDefaultCity();}
$('.quad_nav').parent().hover(function(){$('a',this).addClass('on');$('.quad_nav',this).slideDown(125).show();},function(){$('a',this).removeClass('on');$('.quad_nav',this).slideUp(125);});$('.widget_poll').each(function(e){var $form=$(this).find('form');var $pollID=$form.attr('id');if($pollID.indexOf('-')>-1){$pollID=$pollID.split("-")[1];}
var $results=$(this).find('.poll_result');var $mentometer=util.getCookie('mentometer');if($mentometer==null||$mentometer=='undefined'){$form.css('display','block');$results.css('display','none');}else{if($mentometer.indexOf($pollID)>-1){$form.css('display','none');$results.css('display','block');}else{$form.css('display','block');$results.css('display','none');}}
$form.find(':submit').click(function(e){e.preventDefault();var _checked=false;$form.find('input').each(function(e){if($(this).is(':checked')){_checked=true;}});if(_checked){$form.submit();}});});$('form.keyword_tag_search').submit(function(e){var thisthing=$('form.keyword_tag_search input[type="text"]').val();var thatthing=$('#search_kt_tag').val();if(thisthing==''&&thatthing==''){e.preventDefault();}});if($('div.keyword_tag_search').length&&$('#tag_nav').length){var $search_form=$('div.keyword_tag_search').parent('form');var $tag_val=$search_form.find('input#search_kt_tag').val();if($tag_val.length){var $selected_tag=$('#tag_nav ul li a[name="'+$tag_val+'"]');if($selected_tag.length){$('#tag_nav ul li').removeClass('selected');$selected_tag.parent().addClass('selected');}}
var $selected=$('li.selected');if($selected.has('ul').length){$selected.find('ul').slideToggle('slow').addClass('open');}
$selected.parent('ul.parent').slideToggle('slow').addClass('open');}
$('#tag_nav ul li a').click(function(e){var $li=$(this).parent('li');e.preventDefault();var $search_form=$('div.keyword_tag_search').parent('form');if(!$li.hasClass("selected")){if($li.has('ul').length&&$li.has('ul.open').length){$('#tag_nav ul li').removeClass('selected');$li.addClass('selected');var $tag_val=$(this).attr('name');if($tag_val.length>0){$search_form.find('input#search_kt_tag').val($tag_val);}
$search_form.submit();}else{$('#tag_nav ul li').removeClass('selected');$li.addClass('selected');if($li.has('ul').length&&!$li.has('ul.open').length){$li.siblings().find('ul.open').slideToggle('slow').removeClass('open');$li.find('ul').slideToggle('slow').addClass('open');}else{var $ul=$li.parent('ul');if(!$ul.hasClass('open')){$('ul.open').slideToggle('slow').removeClass('open');}
var $tag_val=$(this).attr('name');if($tag_val.length>0){$search_form.find('input#search_kt_tag').val($tag_val);}
$search_form.submit();}}}});$('.view_slider').each(function(e){var $$this=$(this);var $nextButton=$$this.find('.next');var $prevButton=$$this.find('.prev');var $gallery_slides=$$this.find('.slider_container');var $gallery_slide_list=$gallery_slides.find('li');var $gallery_thumbnails=$$this.find('.carousel-thumbs');var $gallery_thumbnail_list=$$this.find('.carousel-thumbs').find('.thumbnail');var $scroll_count=$gallery_slide_list.size();var $slide_count=$scroll_count-1;var $item_width=$gallery_slide_list.width();var $scroll_width=Math.floor($scroll_count*$item_width);$('.slider_panel').width($item_width);$gallery_slides.width($scroll_width);$nextButton.click(function(e){e.preventDefault();$gallery_slides.trigger('scroll_left');});$prevButton.click(function(e){e.preventDefault();$gallery_slides.trigger('scroll_right');});$gallery_slides.bind('scroll_left',function(e){var $slide_index=$(".slider_container li.current",$$this).index();if($slide_count>$slide_index){$slide_index++;$gallery_slides.find('li.current').removeClass('current').next().addClass('current');$gallery_thumbnails.find('li.current').removeClass('current').next().addClass('current');}else{$slide_index=0;$gallery_slides.find('li.current').removeClass('current');$gallery_thumbnails.find('li.current').removeClass('current');$gallery_slide_list.first().addClass('current');$gallery_thumbnail_list.first().addClass('current');}
var $scroll_to=($slide_index*$item_width)*-1;$gallery_slides.css('marginLeft',$scroll_to);});$gallery_slides.bind('scroll_right',function(e){var $slide_index=$(".slider_container li.current",$$this).index();if($slide_index>0){$slide_index--;$gallery_slides.find('li.current').removeClass('current').prev().addClass('current');$gallery_thumbnails.find('li.current').removeClass('current').prev().addClass('current');}else{$slide_index=$slide_count;$gallery_slides.find('li.current').removeClass('current');$gallery_thumbnails.find('li.current').removeClass('current');$gallery_slide_list.last().addClass('current');$gallery_thumbnail_list.last().addClass('current');}
var $scroll_to=($slide_index*$item_width)*-1;$gallery_slides.css('marginLeft',$scroll_to);});});$('.modal_trigger').each(function(e){var unique_id=$(this).attr('unique-id');if(!$(this).hasClass('enlarge')){var $modalCode=fnBuildModal(unique_id);}
$(this).on("click",function(e){e.preventDefault();var $img=$("#modal_"+unique_id).find("img"),srcAttr=$img.attr("src"),dataSrcAttr=$img.attr("data-src");if(srcAttr===""){$img.hide();$img.before("<p class='loader'></p>");$img.load(function(){$img.show();$img.prev("p.loader").remove();});$img.attr("src",dataSrcAttr);}});});function fnBuildModal(id){var target_ele=$("div#target_"+id),datastyle=target_ele.attr("data-style"),modalklass=(datastyle?'modal '+datastyle:'modal'),tgamModalHead=target_ele.find('header').html(),tgamModalBody=target_ele.find('.modal-body-data').html(),tgamModalFoot=target_ele.find('footer').html(),tgamModalStyle=target_ele.find('styles').html();if(tgamModalStyle){tgamModalStyle=' style="'+tgamModalStyle+'"';}else{tgamModalStyle="";}
target_ele.remove();var modal_code='<div class="'+modalklass+'" id="modal_'+id+'"'+tgamModalStyle+'>'+'  <div class="modal-header"><a class="close" data-dismiss="modal">x</a>'+tgamModalHead+'</div>'+'  <div class="modal-body">'+'    <p>'+(tgamModalBody||'')+'</p>'+'  </div>'+'  <div class="modal-footer">'+(tgamModalFoot||'')+'</div>'+'</div>';$(document.body).append(modal_code);}
$(function(){$("#meterModal").modal();});$(function(){$("#meterAlert").modal({backdrop:false});});(function(exports){var $n=$('#tooltipMobNews'),$i=$('#tooltipMobInvest'),$tipI=$('#toolTipInv'),$tipN=$('#toolTipNews'),$closers=$(".tools-Tips").find('.close');$n.on('click',function(e){e.preventDefault();$tipI.hide();$tipN.show();});$i.on('click',function(e){e.preventDefault();$tipN.hide();$tipI.show();});$closers.on('click',function(e){e.preventDefault();$(this).parent().hide();});})(window);});