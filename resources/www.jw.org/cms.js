/*! jworg-content-theme - v0.1.0 - 2016-02-18 04:59:42 PM UTC */
!function(){"use strict";var a=module.require("settings");a.setSettings({ARCHIVE_MIMETYPE:"application/zip",AUDIO_FORMATS:"MP3,AAC",AUDIO_STREAM_FORMAT:"MP3",AUDIO_STREAM_MIMETYPE:"audio/mpeg",VIDEO_STREAM_MIMETYPES:["video/mp4","video/x-m4v","video/x-w4v"],WINDOW_WIDTH:640,WINDOW_HEIGHT:600,STREAMING_CLASS:"streaming",HIGHLIGHT_CLASS:"highlight",HIGHLIGHT_VS_CONTENT_CLASS:"contentHighlight",HIGHLIGHT_ADD_CLASS:"addHighlight",IMAGE_GALLERY_IMAGE_RATIO:.625,BASE_URL:function(){return $("base").attr("href")},CAST_LOAD_SCREEN:function(){return a.getSetting("THEME_URL")+"images/chromecast_splash.png"},CAST_END_SCREEN:function(){return a.getSetting("THEME_URL")+"images/chromecast_splash.png"},CAST_LOGO:function(){return a.getSetting("THEME_URL")+"images/chromecast_logo.png"},DOWNLOAD_WINDOW_URL:function(){return a.getSetting("BASE_URL")+"download/"},PUB_MEDIA_URL:function(){return a.getSetting("BASE_URL")+"apps/TRGCHlZRQVNYVrXF"},THEME_URL:function(){return a.getSetting("BASE_URL")+"themes/content-theme/"},IS_MOBILE_LAYOUT:function(){return $(window).width()<520},IS_SMALL_LAYOUT:function(){return $(window).width()<760},IS_RTL:function(){return $("body").hasClass("dir-rtl")},USE_DOWNLOAD_WINDOW:function(){return a.getPageConfig("ACCESSIBILITY_MODE")||$(window).width()<=768},AUDIO_ICON:function(){return a.getSetting("THEME_URL")+"images/icon_audio.png"},WRITTEN_ICON:function(){return a.getSetting("THEME_URL")+"images/icon_digitalPub.png"},VIDEO_ICON:function(){return a.getSetting("THEME_URL")+"images/icon_video.png"},VIDEO_THUMBNAIL:function(){return a.getSetting("THEME_URL")+"images/video_placeholder.png"},VIDEO_BLANK_POSTER:function(){return a.getSetting("THEME_URL")+"images/video_poster.png"},TEMPLATE_URL:function(){return a.getSetting("JS_CORE_BASE")+"/templates/"},PAGE_ID:function(){return $("body").attr("id")}})}(),function(a,b,c){"use strict";function d(){var b;h.send("DOMReady"),f.DOMReady();for(b in f)f.hasOwnProperty(b)&&"function"==typeof f[b].DOMReady&&f[b].DOMReady();$("body").addClass("jsPageReady").focus(),$(a).on("beforeunload",function(){$("body").removeClass("jsPageReady")}),h.send("PageBooted")}var e,f,g=module.require("settings"),h=module.require("signal");e={DOMReady:function(){this.setContentAttributes(),this.setLanguageCookie(),$('a[href*="#"]').click(function(){var a,b,c,d;a=$(this).attr("href"),b=a.split("#"),c=b[b.length-1],d=$("#"+c),d.attr("tabIndex",0),d.css("outline","none"),d.focus()})},setContentAttributes:function(){var a=g.getPageConfig("CONTENT_LANG"),b=g.getPageConfig("CONTENT_LANG_DIRECTION"),c="lang-"+a,d="dir-"+b;$("#article").addClass(c+" "+d),$("#article").attr({lang:a,"xml:lang":a,dir:b})},setLanguageCookie:function(){var a=g.getPageConfig("WT_LANG"),b=(new Date).getTime(),c=31536e6,d={};d.path="/",d.expires=new Date(b+c),$.cookie("ckLang",a,d)}},a._t=a._t||a.opener._t,f=a.jworg=Object.create(e),h.listen("ArticleLoaded",f.setContentAttributes),$(b).ready(d)}(window,window.document),function(){"use strict";var a,b,c=module.require("settings"),d=module.require("signal");a={autoScroll:!0,actions:{},CSS_SLIDE_PROPERTY:c.getSetting("IS_RTL")?"right":"left",bindActions:function(){$(document).off("click","#slidePrevButton, #slideShadowLeft",this.actions.prevButton).on("click","#slidePrevButton, #slideShadowLeft",this.actions.prevButton),$(document).off("click","#slideNextButton, #slideShadowRight",this.actions.nextButton).on("click","#slideNextButton, #slideShadowRight",this.actions.nextButton),this.openButton.off("click",this.actions.openButton).on("click",this.actions.openButton),this.closeButton.off("click",this.actions.closeButton).on("click",this.actions.closeButton)},balanceSlides:function(a){a=a||-1;var b,d,e,f=this.getIndex(),g=this.getSlides(),h=this.getNumSlides(),i=this.getSlideList(),j=(h+1)/2;for(a*=c.getSetting("IS_RTL")?-1:1,b=0>a||Math.floor(j)===j?-1:0,j=Math.floor(j+b);f!==j;)j>f?(d=g.last(),i.prepend(d),f++):(d=g.first(),i.append(d),f--),e=-(100*f)+"%",i.css(this.CSS_SLIDE_PROPERTY,e)},DOMReady:function(){if(0!==this.getSlideMain().length){this.openButton=this.getSlideMain().find(".jsDescrControl.jsOpen"),this.closeButton=this.getSlideMain().find(".jsDescrControl.jsClose"),this.shuffleSlides(),this.balanceSlides();var a=$.proxy(this.resizeSlider,this);a(),$(window).resize(a),setTimeout(a,500),this.bindActions(),this.isPreviewPage()||this.startAutoScrollDaemon(8e3),this.updateDescription()}},generateActions:function(){var a=this;return this.actions.closeButton=function(){a.closeButton.hide(),a.openButton.show(),a.getSliderContainer().slideUp()},this.actions.openButton=function(){a.isAnimating()||(a.stopAutoScroll(),a.openButton.hide(),a.closeButton.show(),a.getSliderContainer().slideDown())},this.actions.nextButton=function(){a.stopAutoScroll(),a.nextSlide()},this.actions.prevButton=function(){a.stopAutoScroll(),a.prevSlide()},this.actions},getActiveSlide:function(){var a=this.getIndex(),b=this.getSlides();return b.slice(a,a+1)},getActiveSlideDescription:function(){var a=this.getActiveSlide();return a.find("div.jsImgDescr")},getDescriptionContainer:function(){return $("#sliderImgDescr .inner .imgDesc")},getSliderContainer:function(){return $("#sliderImgDescr .inner")},getIndex:function(){if(this.isAnimating())return-1;var a,b=this.getSlideList().css(this.CSS_SLIDE_PROPERTY),c=-1!==b.indexOf("%"),d=this.getSlideWidth();return b=b.replace(/[^0-9\.]/gi,""),b=parseInt(b,10)||0,c?b/100:a=Math.round(b/d,2)},getNumSlides:function(){return this.getSlides().length},getSlideList:function(){return $("#slideList")},getSlideMain:function(){return $("#slideMain")},getSlides:function(){return this.getSlideList().find(".jsSliderItem")},getSlideWidth:function(){return this.getSlideMain().width()},isAnimating:function(){return!!this.animationLock},isPreviewPage:function(){return $("body").hasClass("SlidePreviewPage")},nextSlide:function(){if(!this.isAnimating()){this.balanceSlides(-1);var a=this.getIndex();a+=c.getSetting("IS_RTL")?-1:1,this.changeSlide(a)}},prevSlide:function(){if(!this.isAnimating()){this.balanceSlides(1);var a=this.getIndex();a+=c.getSetting("IS_RTL")?1:-1,this.changeSlide(a)}},randomSort:function(){var a=1e3,b=parseInt(Math.random()*a,10),c=b%2,d=b>a/2?1:-1;return c*d},resizeSlider:function(){var a=this.getSlideWidth(),b=this.getSlideList(),c=this.getSlideList().find(".jsSliderItem, .jsSliderItem > img"),d=this.getIndex();c.css("width",a),b.css("width",a*this.getNumSlides()),this.changeSlide(d)},setDescriptionContents:function(a){var b=this.getDescriptionContainer();b.html(a)},changeSlide:function(a){var b=-(100*a)+"%",c=this.getIndex(),d={},e=this;this.isAnimating()||0>a||c===a||(this.animationLock=!0,d[this.CSS_SLIDE_PROPERTY]=b,this.getSlideList().animate(d,"slow",function(){e.animationLock=!1,e.balanceSlides(c-a),e.updateDescription()}))},shuffleSlides:function(){var a,b=this.getSlides(),c=10;for(a=0;c>a;a++)b=b.sort(this.randomSort);b.remove(),this.getSlideList().append(b)},startAutoScroll:function(){this.autoScroll=!0},startAutoScrollDaemon:function(a){var b,d=this;a=a||1e3,b=function(){d.autoScroll&&(c.getSetting("IS_RTL")?d.prevSlide():d.nextSlide()),setTimeout(b,a)},setTimeout(b,a)},stopAutoScroll:function(){this.autoScroll=!1},updateDescription:function(){var a=this.getActiveSlideDescription().html();this.setDescriptionContents(a)}},b=window.jworg.slider=Object.create(a),b.generateActions(),d.listen("simple-modal-before-show",b.stopAutoScroll.bind(b))}(),function(){"use strict";var a,b,c,d,e=module.require("base64"),f=module.require("guid"),g=module.require("url");c=function(){var a,b,c,d,e=$("#insightAnalytics");a=g.parse("?"+e.data("params")).query,b=g.parse().hash.query,c=$.extend(a,b.insight),delete c.length;for(d in c)c.hasOwnProperty(d)&&("<guid>"===c[d]&&(c[d]=f.generate()),e.data(d,c[d]));return c},a=function(){var a="",b=window,c=document;try{a=b.top.document.referrer}catch(d){if(b.parent)try{a=b.parent.document.referrer}catch(e){a=""}}return""===a&&(a=c.referrer),a},b=function(b,d,f){var h,i,j,k,l=$("#insightAnalytics");!$("#insight").exists()&&l.exists()&&(h=l.data("src"),i=c(),j=b||a(),i.ref=e.encode(j),i.id=d||$("body").data("insight-id"),f&&(i.cb=Date.now()),h=g.build({path:h,query:i}),k=$('<img id="insight" class="trackingImg" />'),k.attr("src",h),$("#copyright").append(k))},d=function(a,c){$("#insight").remove(),b(a,c,!0)},b(),module.define("insight",{updateAnalytics:d})}(),function(){"use strict";var a,b=module.require("signal");a=Class.extend({init:function(a){var c=this;this.id=_.uniqueId("headless-"),this.playlist=a,this.skipTo(0),b.listen("requestSilence",function(a){a!==c.id&&c.pause()})},bind:function(a,b){$(this.elem).on(a,b)},nextTrack:function(){var a=this.currentTrack+1;this.skipTo(this.playlist[a]?a:0)},play:function(){this.elem&&(b.send("requestSilence",this.id),this.elem.play())},pause:function(){this.elem&&this.elem.pause()},remove:function(){this.$elem&&this.$elem.remove(),delete this.elem,delete this.$elem},skipTo:function(a){this.__createPlayerElem(this.playlist[a]),this.currentTrack=a},stop:function(){this.pause(),this.skipTo(0)},__createPlayerElem:function(a){var b=_.first(a.sources),c=!1,d=this;this.elem?this.elem.src="":(this.elem=document.createElement("audio"),this.elem.preload="metadata",this.$elem=$(this.elem),this.$elem.addClass("headlessAudioPlayer"),this.$elem.appendTo(document.body)),this.elem.src=b.file,this.$elem.off("loadedmetadata"),this.$elem.off("timeupdate"),this.$elem.off("ended"),this.$elem.on("loadedmetadata",function(){a.startTime&&!c&&(c=!0,d.elem.currentTime=a.startTime)}),this.$elem.on("timeupdate",function(){a.endTime&&d.elem.currentTime>=a.endTime&&(d.pause(),_.defer(d.stop.bind(d)))}),this.$elem.on("ended",function(){d.nextTrack(),0!==d.currentTrack&&d.elem.play()})}}),module.define("HeadlessAudioPlayer",a)}(),function(){"use strict";var a,b=module.require("settings"),c=module.require("url");a=Class.extend({init:function(a){this.setPubSymbol(a)},setPubSymbol:function(a){this.pubSymbol=a?a.toUpperCase():""},getMediaAPIBase:function(a){var d=b.getSetting("PUB_MEDIA_URL"),e=b.getPageConfig("WT_LANG");return d=c.parse(d),d.query.pub=this.pubSymbol,d.query.langwritten=e,d.query.txtCMSLang=e,d.query.fileformat=a||b.getSetting("AUDIO_STREAM_FORMAT"),d},getTextAPIBase:function(){return this._getAPIBase("BIBLE_HTML_API")},getDataAPIBase:function(){return this._getAPIBase("BIBLE_DATA_API")},getMultimediaAPIBase:function(){return this._getAPIBase("BIBLE_MULTIMEDIA_API")},_getAPIBase:function(a){var d=a+"_"+this.pubSymbol,e=b.getPageConfig(d),f=b.getPageConfig(a);return c.parse(e||f)},getDataAPIURL:function(){return this._getURL(this.getDataAPIBase())},getMultimediaAPIURL:function(a){var b=this.getMultimediaAPIBase();return b.path=c.join(b.path,a),c.build(b)},getTextAPIURL:function(){return this._getURL(this.getTextAPIBase())},_getURL:function(a){return this.getID&&this.getID()&&(a.path=c.join(a.path,this.getID())),c.build(a)}}),module.define("BibleAPIBase",a)}(),function(){"use strict";var a,b=module.require("BibleAPIBase");a=b.extend({}),a.PUB_SYMBOLS={NWT:"nwt",NWTSTY:"nwtsty"},module.define("Bible",a)}(),function(){"use strict";var a;a=Class.extend({init:function(a){this.id=a.toString(),this.verse=parseInt(this.id.slice(-3),10),this.chapter=parseInt(this.id.slice(-6,-3),10),this.book=parseInt(this.id.slice(-8,-6),10)}}),module.define("BibleVerse",a)}(),function(){"use strict";var a,b=module.require("BibleAPIBase"),c=module.require("BibleVerse"),d=module.require("PubMediaResource"),e=module.require("MediaPlaylist"),f=module.require("url"),g="-",h=/^(v?[0-9]+)(-v?[0-9]+)?$/;a=b.extend({init:function(a,b){var d=a.split(g);this.range=a,this.startRange=_.first(d),this.endRange=_.last(d),this.startRangeIndex=parseInt(this.startRange.replace(/[^0-9]/g,""),10),this.endRangeIndex=parseInt(this.endRange.replace(/[^0-9]/g,""),10),this.start=new c(this.startRange),this.end=new c(this.endRange),this._super(b)},buildPlaylist:function(){var a,b=this;return a=new e({listFiles:this.listMediaFiles.bind(this)}),a.build().then(function(a){return a=_.map(a,function(a){var c;return a.booknum===b.start.book&&a.track===b.start.chapter&&(c=_.find(a.markers,function(a){return a.verseNumber===b.start.verse}),a.startTime=c?c.startTime:null),a.booknum===b.end.book&&a.track===b.end.chapter&&(c=_.find(a.markers,function(a){return a.verseNumber===b.end.verse}),a.endTime=c?c.endTime:null),a})})},getID:function(){var a=_.uniq([this.start.id,this.end.id]);return a.join(g)},hasAudio:function(){var a=$.Deferred();return this.listMediaFiles().then(function(b){a.resolve(b.length>0)}).fail(function(){a.resolve(!1)}),a},listMediaAPIURLs:function(a){var b,c,d;return this.hasAudio?(b=_.range(this.start.book,this.end.book+1),c=this.getMediaAPIBase(a),d=_.map(b,function(a){return c.query.booknum=a,f.build(c)})):[]},listMediaFiles:function(){var a,b=this.listMediaAPIURLs(),c=new $.Deferred,e=this;return c.resolve([]),a=_.reduce(b,function(a,b){return a.then(function(a){var c=new d(b);return c.listFiles().then(a.concat.bind(a))})},c),a.then(function(a){return _.filter(a,function(a){var b=!0;return b&=!!a.markers,b&=a.booknum>=e.start.book,b&=a.booknum<=e.end.book,b&=a.booknum===e.start.book?a.track>=e.start.chapter:!0,b&=a.booknum===e.end.book?a.track<=e.end.chapter:!0})})},isVerseRangeInRange:function(b){return b?(_.isString(b)&&(b=new a(b)),b.startRangeIndex>=this.startRangeIndex&&b.endRangeIndex<=this.endRangeIndex):!1},toRangeString:function(){return this.startRange===this.endRange?"v%s".format(this.startRange):"v%s%sv%s".format(this.startRange,g,this.endRange)}}),a.allForChapter=function(b,c,d){var e,f;for(b=b?b.toString():"01",c=c?c.toString():"001";c.length<3;)c="0"+c;return e=b+c+"000",f=b+c+"999",new a(e+g+f,d)},a.createCitation=function(a,b){var c,d="; ",e=b?"abbreviatedCitation":"standardCitation";return c=_.reduce(a,function(a,b){return a+b[e]+d},""),c.substring(0,c.length-d.length)},a.isRange=function(a){return h.test(a)},a.VERSE_SEPARATOR=g,module.define("BibleVerseRange",a)}(),function(){"use strict";var a,b=module.require("BibleAPIBase"),c=module.require("BibleVerseRange"),d=",";a=b.extend({init:function(a,b){a=a.toString().split(d),this.ranges=_.map(a,function(a){return new c(a,b)}),this._super(b)},getID:function(){return _.invoke(this.ranges,"getID").join(d)},getRange:function(a){return _.find(this.ranges,function(b){return b.getID()===a.toString()})}}),a.toVerseRangeString=function(a){var b=_.reduce(a,function(a,b){return a+b+d},"");return b.substring(0,b.length-d.length)},a.splitRanges=function(a){return a?a.toString().split(d):[]},module.define("BibleVerseRangeCollection",a)}(),function(){"use strict";var a,b=module.require("BibleAPIBase");a=b.extend({init:function(a){this.bibleVerseRange=a},getID:function(){return this.bibleVerseRange.getID()},getDataAPIBase:function(){return this._getAPIBase("BIBLE_TRANSLATIONS_API")}}),a.getParallelTranslations=function(b){var c=new a(b);return $.getJSONCached(c.getDataAPIURL()).then(function(a){return a.ranges[b.getID()]||{}})},module.define("BibleTranslations",a)}(),function(){"use strict";var a,b=module.require("BibleVerseRange");a=Class.extend({init:function(a){this.rangeCollection=a},render:function(a){return this.rangeCollection?this._fetch(a):$.when(null)},_fetch:function(a){return this.fetched?$.when(this.verses):$.getJSONCached(this.rangeCollection.getTextAPIURL()).then(_.bind(this._parseVerses,this,a))},_parseVerses:function(a,c){var d,e={},f=this;return _.each(c.ranges,function(c,g){d=new b(g,""),e[g]={citation:c.citation,content:f._filterVerseContent(c.html,a),startBook:d.start.book,startChapter:d.start.chapter,validRange:c.validRange}}),this.verses=e,e},_filterVerseContent:function(a,b){return b?this._removeLinks(a):a},_removeLinks:function(a){var b=$("<div></div>").html(a);return b.find(".verseNum a, .chapterNum a").contents().unwrap(),b.find(".xrefLink, .footnoteLink").remove(),b.find("span.verse").removeAttr("id"),b.html()}}),module.define("BibleVerseRangeRenderer",a)}(),function(){"use strict";var a;a={addSourceFlags:function(b,c){a._addSourceFlagForSelector(".jsBibleLink",b,c),a._addSourceFlagForSelector(".footnoteLink",b,c),a._addSourceFlagForSelector(".endnoteLink",b,c)},_addSourceFlagForSelector:function(a,b,c){b.find(a).each(function(){$(this).attr("data-dialogsource",c)})}},module.define("DialogUtils",a)}(),function(){"use strict";var a;a={getPrettyFileSizeString:function(a){return Math.ceil(a/1e6).toLocaleString()+" MB"}},module.define("FileUtils",a)}(),function(){"use strict";var a,b=0;a={open:function(){b++;var a,c,d=$("#jsFullScreenLoadingIndicator"),e=$.Deferred(),f=0;return d.exists()?$.when(!1):(d=$("<div id='jsFullScreenLoadingIndicator'><div class='inner'><div class='loadingIndicator'></div></div></div>"),$("body").append(d),$("#jsFullScreenLoadingIndicator").addClass("show"),a=function(){return f++,f>=2?(e.resolve(),cancelAnimationFrame(c)):void(c=requestAnimationFrame(a))},requestAnimationFrame(a),e.promise())},close:function(){if(b--,!(b>0)){b=0;var a=$("#jsFullScreenLoadingIndicator");return a.animate({opacity:0},400),a.promise().done(function(){$(this).remove()})}}},module.define("loadingIndicator",a)}(),function(){"use strict";var a;a=Class.extend({scrollTo:function(a,b,c,d){var e,f,g,h,i=b instanceof jQuery;i&&!b.length||!a.length||(e=this._getScrollHeight(a,d),f=e-a.height(),c=c||0,b instanceof jQuery?(g=b.offset().top,h=a.offset()?a.offset().top:0,g-=h,$.isWindow(a.get(0))||(g+=a.scrollTop())):g=b||0,a.scrollTop(Math.min(g+c,f)))},_getScrollHeight:function(a,b){return b&&b.get(0)?b.get(0).scrollHeight||b.outerHeight():a.get(0).scrollHeight||0}}),module.define("ScrollHelper",a),module.get("ScrollHelper")}(),function(){"use strict";var a,b,c=module.require("settings");a=function(){this.child=void 0,this.setURL(),this.setTitle(),this.setOptions()},a.prototype={assembleOptionsString:function(){var a,b=this.options,c=[];for(a in b)b.hasOwnProperty(a)&&(b[a]===!0&&(b[a]="yes"),b[a]===!1&&(b[a]="no"),c.push(a+"="+b[a]));return c.join(",")},close:function(){this.child&&(this.child.close(),this.child=void 0)},open:function(){var a,c=this.assembleOptionsString();return b&&b.close(),this.child=window.open(this.url,this.title,c),b=this,a=this.child.document,this.child},setOptions:function(a){var b,d;d={resizable:!0,scrollbars:!1,width:c.getSetting("WINDOW_WIDTH"),height:c.getSetting("WINDOW_HEIGHT"),menubar:!1,toolbar:!1,location:!1},a=a||{};for(b in a)a.hasOwnProperty(b)&&null===a[b]&&delete a[b];this.options=$.extend(!0,d,this.options,a)},setURL:function(a){this.url=a||""},setTitle:function(a){this.title=a||"_blank"}},module.define("ChildWindow",a)}(),function(){"use strict";var a,b,c=module.require("settings"),d=module.require("signal"),e=[];b=function(a,d){this.html=$("<div>"),this.html.addClass("jsSimpleModalContainer"),d||(this.closeButton=$('<a class="closeModal jsCloseModal" href="javascript:;">'+_t("CMSPUBS.LnkCloseUppCase")+"</a>"),this.closeButton.click(b.close)),this.html.append($(a)),this.settings={},this.updateSettings({closeOnEscapeKey:!0,closeOnOverlayClick:!0,maxWidth:c.getSetting("WINDOW_WIDTH"),maxHeight:c.getSetting("WINDOW_HEIGHT")})},b.close=function(){a&&a._close()},b.registerResizeListener=function(a){e.push(a)},b.prototype={_close:function(){var b=this.elements,c=this;clearTimeout(this.__positionTimer),a=null,this.settings.beforeClose(),b.animate({opacity:0},200,function(){b.remove(),c.settings.afterClose()})},_handleEscapeKey:function(){this.settings.closeOnEscapeKey&&this._close()},updateSettings:function(a){var b=this.html,c=a.beforeShow,e=a.afterShow,f=a.beforeClose,g=a.afterClose;a.beforeShow=$.proxy(function(){$("body").css("overflow","hidden"),d.send("simple-modal-before-show"),"function"==typeof c&&c()},this),a.afterShow=$.proxy(function(){var a=b.find("h1, h2, h3, h4, h5").filter(":first");b.trap(),a.attr("tabIndex",0),a.css("outline","none"),a.focus(),"function"==typeof e&&e()},this),a.beforeClose=$.proxy(function(){b.untrap(),"function"==typeof f&&f()},this),a.afterClose=$.proxy(function(){$("body").css("overflow","auto"),"function"==typeof g&&g()},this),this.settings=$.extend(this.settings,a)},open:function(){b.close(),a=this;var c,d=$("<div>"),f=$("<div>"),g=this;f.addClass("jsSimpleModalOverlay"),this.settings.closeOnOverlayClick&&f.click(b.close),d.addClass("jsSimpleModalWrapper"),d.append(this.closeButton),d.append(this.html),d.css({"max-width":this.settings.maxWidth,"max-height":this.settings.maxHeight,width:this.settings.width,height:this.settings.height}),this.elements=f.add(d),$("body").append(this.elements),c=function(){var a,b,h,i,j=$(document).scrollTop();a=(f.height()-d.height())/2,a+=j,a=Math.max(j,a),b=(f.width()-d.width())/2,h=Math.min($(window).height(),g.settings.maxHeight),i=Math.min($(window).width(),g.settings.maxWidth),d.css({top:a,left:b,height:h,maxWidth:i}),_.each(e,function(a){a()}),clearTimeout(g.__positionTimer),g.__positionTimer=setTimeout(c,500)},c(),$(window).resize(c),this.__positionTimer=setTimeout(c,500),this.settings.beforeShow(),f.animate({opacity:.5},200),d.animate({opacity:1},300,this.settings.afterShow)}},module.define("SimpleModal",b),$(document).on("click","a.jsCloseModal",b.close),$(document).on("keydown",null,"esc",function(){a&&a._handleEscapeKey()})}(),function(){"use strict";var a,b=module.require("MediaPlayer"),c=module.require("PubMediaResource"),d=module.require("browser"),e=module.require("signal"),f="excludePin",g="loading";a=Class.extend({init:function(a,b){if(!a.exists())throw new Error("Element does not exist");var c=a.data("filetype"),d=a.data("langindex"),e=$.proxy(this.__initPlayer,this),f=a.parent(".jsVideoPlayer, .jsAudioPlayer"),h=this;d=parseInt(d,10),d=0===d||d>0?d:void 0,this.elem=a,this.parent=f,this.mediaList=b,this.autoPlay=a.hasClass("autoplay"),this.isVideo=a.parent().hasClass("jsVideoPlayer"),this.__generatePlayerID(),this.loadPending=b.listLanguages().then(function(a){return void 0===d&&a.length>1&&h.__buildSpokenLangSelector(a),d=d||0,b.hasSubtitles(d||0,c)}).then(function(a){return b.getPlaylist().build(d,c,a===b.SUBTITLES_ONLY).done(e)}),this.loadPending.done(function(){f.removeClass(g)})},getPlayer:function(){return this.player},loading:function(){return this.loadPending},remove:function(){},startAutoPlayDaemon:function(){var a=this;!function b(){return d.isIOS()||d.isAndroid()?void 0:"IDLE"===a.player.getStatus()?void a.player.play():void setTimeout(b,500)}()},__attachEventHandlers:function(){var a,b,c=this.__getPlayerID(),d=this.getPlayer();b=function(a){a.preventDefault();var b=d.getPlaylistIndex(),c=parseInt($(this).data("track"),10);void 0!==b&&("PLAYING"!==d.getStatus()&&c===b?d.play():"PLAYING"!==d.getStatus()||c!==b?(d.skipTo(c),d.play()):d.pause())},a='a.jsTrackPlay[data-mediaplayer="%s"],a.jsTrackPause[data-mediaplayer="%s"],a.jsTrackPlayLink[data-mediaplayer="%s"]',a=a.format(c,c,c),$(document).on("click",a,b),e.listen("mediaPause",d.pause.bind(d)),this.remove=function(){$(document).off("click",a),d.remove()}},__attachMarker:function(a,b){var c,d;if(b.mepsParagraphId)c=".p"+b.mepsParagraphId;else{if(!b.verseNumber)return;c='[id^="v"][id$="'+b.verseNumber+'"].verse'}d=$(c),d.data("track",a),d.data("start",b.startTime),d.data("player",this.player)},__attachMarkers:function(a){var b=this;_.each(a,function(a,c){_.each(a.markers,b.__attachMarker.bind(b,c))})},__buildSpokenLangSelector:function(a){var b,c,d=this,e=[];return c=$("<select></select>"),c.addClass("selectSpokenLanguage"),$(a).each(function(a){var b=d.mediaList.getPlaylist().build(a),f=d.mediaList.getLanguageName(a),g=$.when(b,f);g.done(function(a,b){var d=$("<option></option>");d.html(b),d.data("playlist",a),c.append(d)}),e.push(g)}),b=$.when.apply($,e),b=b.then(function(){return c.on("change",function(){var a=$(this).children("option:selected").data("playlist");d.player.setPlaylist(a)}),d.elem.before(c),$(".jsPlayUppCaseLabel").show(),c})},__generatePlayerID:function(){var a=this.elem.attr("id");a||(a=Math.floor(1e4*Math.random()),a="mediaPlayer-%s".format(a),this.elem.attr("id",a))},__getPlayerID:function(){return this.elem.attr("id")},__initPlayer:function(a){var c=["play","pause","trackChanged","idle","playlistItemComplete"],d=$.proxy(this.__updatePlayerUI,this);if(a.length)return this.player=new b(this.elem,a,this.isVideo),this.player.bind(c,d),this.__attachEventHandlers(),this.__attachMarkers(a),this.autoPlay&&this.startAutoPlayDaemon(),this.player},__updatePlayerUI:function(){var a,b,c,d,e=this.__getPlayerID(),g=$("*[data-mediaplayer="+e+"]"),h=this.player.getStatus(),i=this.player.getCurrentTrack(),j=this.player.getPlaylistIndex();a=g.filter(".jsTrackPlay, .jsTrackPause"),b=g.filter(".jsTrackPlay[data-track="+j+"],.jsTrackPause[data-track="+j+"]"),c=g.filter(".jsTrackPlay[data-track!="+j+"],.jsTrackPause[data-track!="+j+"]"),b.removeClass("jsTrackInactive"),b.addClass("jsTrackActive"),c.removeClass("jsTrackActive"),c.addClass("jsTrackInactive"),"PLAYING"===h?(b.removeClass("jsTrackPlay"),b.addClass("jsTrackPause"),c.removeClass("jsTrackPause"),c.addClass("jsTrackPlay"),this.parent.removeClass(f)):(a.removeClass("jsTrackPause"),a.addClass("jsTrackPlay")),d=i.title||i.sources[0].title,g.filter(".jsCurrentTrack").show().html(d)}}),a.from_url=function(b,d){var e,f;return e=function(b){return new a(d,b)},f=new c(b),new a(d,f)},module.define("StreamingController",a)}(),function(){"use strict";var a,b=module.require("UIController"),c=module.require("SimpleModal"),d=module.require("MediaPlayer"),e=module.require("StreamingController"),f=module.require("settings");a=b.extend({MODAL_CONFIG:{width:"95%",height:"auto"},open:function(a){var b=this;this.injectCallback=a,this._draw().fail(function(){b._injectHTML(d.GENERIC_ERROR)})},_beforeClose:function(){var a=this.streaming&&this.streaming.getPlayer();a&&"IDLE"!==this.streaming.getPlayer().getStatus()&&this.streaming.getPlayer().stop()},_initStreaming:function(a){var b=this.html.find(".jsMediaPlayer");!this.streaming&&b.exists()&&(this.streaming=new e(b,a))},_injectHTML:function(a){var b=!1;this._super(a),this.container||(this.container=$("<div></div>"),b=!0),this.streaming&&(this.streaming.remove(),delete this.streaming),this.container.empty().html(a),b&&(this.injectCallback?this.injectCallback(this.container):this._openModal(this.container))},_openModal:function(a){var b,d;b=new c(a),d=$.extend({},{beforeClose:this._beforeClose.bind(this)},this.MODAL_CONFIG),b.updateSettings(d),b.open()},_pausePlayer:function(){this.streaming&&this.streaming.getPlayer()&&this.streaming.getPlayer().pause()},_updateStreamingPlaylist:function(a,b,c,d){var e,f;this.streaming?(e=this.streaming.getPlayer(),e&&(f=$.proxy(e.setPlaylist,e),d.getPlaylist().build(a,b,c).then(f))):this._initStreaming(d)},_findArchives:function(a){return _.filter(a,function(a){return a.mimetype===f.getSetting("ARCHIVE_MIMETYPE")})},_sortByFileLabel:function(a){return _.sortBy(a,function(a){return parseInt(a.label)})},_parseFileBundles:function(a,b){var c,d=this._findArchives(b);a.state.bundled=this._sortByFileLabel(d),a.state.hasBundles=function(){return a.state.bundled.length>0},c=_.first(a.state.bundled),a.state.bundleLabel=c?c.title:""}}),module.define("MediaModal",a)}(),function(){"use strict";var a,b=module.require("settings"),c=module.require("MediaModal"),d=module.require("FileUtils");a=c.extend({TEMPLATE_NAME:"DownloadModal",init:function(a,b){this._super(),this.resource=a,this.preselect=b},setCoverImage:function(a){this.coverImage=a},setDefaultPubName:function(a){this.defaultPubName=a},onLanguageChange:function(a,b){var c=$(this),d=b.controller.html.find("ul.tracklist"),e=c.data("index")||0;b.controller._pausePlayer(),d.removeClass(b.state.activeLanguage.locale),b.state.activeLanguage=_.extend({},_.find(b.state.languages,function(a){return a.index===e})),d.addClass(b.state.activeLanguage.locale),_.each(b.state.languages,function(a,c){b.state.languages[c].isActive=a.index===e}),b.controller.resource.listFileTypes(e).then(function(a){b.state.fileTypes=a,b.controller.html.find(".jsFileTypeSwitcher").change()})},onFileTypeChange:function(a,c){var d=c.state.activeFileType.name=$(this).val(),e=-1!==b.getSetting("AUDIO_FORMATS").indexOf(d);c.controller._pausePlayer(),c.state.icon=b.getSetting(e?"AUDIO_ICON":"WRITTEN_ICON"),c.controller._buildFileList(c)},_buildFileList:function(a){var c=this,e=a.state.activeLanguage.code,f=a.state.activeFileType.name,g=this.resource.listFiles(e,f);return g=g.then(function(e){var f;return a.state.streamable=!1,f=_.groupBy(e,function(a){return a.specialty||a.format||a.edition}),f=_.map(f,function(e){var f=_.first(e),g={},h=!1;return h=_.reduce(["specialty","format","edition"],function(a,b){return a||_.isEmpty(f[b])?a:f[b+"Descr"]},!1),g.name=h||f.specialtyDescr||f.formatDescr||f.editionDescr,g.archives=c._findArchives(e),_.each(g.archives,function(a){a.prettyFileSize=d.getPrettyFileSizeString(a.filesize)}),g.tracks=_.filter(e,function(a){return a.mimetype!==b.getSetting("ARCHIVE_MIMETYPE")}),_.each(g.tracks,function(c,e){g.tracks[e].index=e,c.mimetype===b.getSetting("AUDIO_STREAM_MIMETYPE")&&(a.state.streamable=!0),g.tracks[e].prettyFileSize=d.getPrettyFileSizeString(c.filesize),g.tracks[e].linkTitleTag=function(){return a.state.streamable?a.literals.CMSPUBS.LblPlay:a.literals.CMSPUBS.LblDownload}}),g}),a.state.variants=f,a.state.multiVariant=f.length>1,c._redraw()}),g=g.then(function(){a.state.streamable&&c._updateStreamingPlaylist(e,f)})},_buildStateContext:function(){var a,b,c,d,e,f,g=this;return a=this.resource.listLanguages().then(function(a){return _.each(a,function(b,c){a[c].isActive=!1}),a}),d=a.then(function(a){return _.filter(a,function(a){return a.isPrimary})}),e=a.then(function(a){return _.filter(a,function(a){return!a.isPrimary})}),b=d.then(function(a){return _.extend({},_.first(a))}),c=b.then(function(a){return g.resource.listFileTypes(a.code)}),f=this.resource.getPubName().then(function(a){return a?a:g.defaultPubName}),{activeLanguage:b,activeFileType:c.then(function(a){return _.first(a)}),archives:[],coverImage:this.coverImage,date:this.resource.getFormattedDate(),fileTypes:c,tracks:[],icon:null,languages:a,primaryLanguages:d,otherLanguages:e,pubName:f,streamable:!1,showFileTypeSelector:!1}},_injectHTML:function(a){this._super(a),this._initStreaming(this.resource)},_onFirstRender:function(){if(this.html.find("ul.languageTabs li:first").click(),this.preselect){var a=this.preselect.toUpperCase();this.html.find(".jsFileTypeSwitcher").val(a),this.html.find(".jsFileTypeSwitcher").change()}},_updateStreamingPlaylist:function(a,b,c,d){return d=d||this.resource,this._super(a,b,c,d)}}),module.define("DownloadModal",a)}(),function(){"use strict";var a,b=module.require("settings"),c=module.require("PubMediaResource"),d=module.require("DownloadModal"),e=module.require("FileUtils");a=d.extend({TEMPLATE_NAME:"BibleModal",onBookSelect:function(a,b){var c,d=$(this).data("booknum"),e=b.controller,f=e.__getBookResource(d),g=e.html.find(".book h2"),h=g.filter('[data-booknum="'+d+'"]'),i=h.parent().next().children("h2"),j=b.state.activeLanguage.code,k=b.state.activeFileType.name;return a.preventDefault(),c=function(){i.exists()&&e.onBookSelect.call(i,a,b).then(function(){e.streaming.startAutoPlayDaemon()})},g.removeClass("viewHdgExpand"),g.addClass("viewHdgCollapse"),d=parseInt(d,10),b.state.activeBookNum===d?(b.state.streamable=!1,b.state.activeBookNum=null):(b.state.streamable=!0,b.state.activeBookNum=d,h.addClass("viewHdgExpand"),h.removeClass("viewHdgCollapse"),e._redraw(),e._updateStreamingPlaylist(j,k,void 0,f),e.streaming.loading().then(function(){var a=e.streaming.getPlayer();a&&a.bind("playlistComplete",c)})),f.listFiles(j,k).then(function(a){e.__updateChapters(b,a),e._redraw()})},onFileTypeChange:function(a,b){b.state.isExpandable="MP3"===$(this).val(),this._super(a,b)},_buildFileList:function(a){var b=this,c=a.state.activeLanguage.code,d=a.state.activeFileType.name,f=this.resource.listFiles(c,d);return a.state.streamable=!1,
f=f.then(function(c){return _.each(c,function(a){a.active=!1,a.chapters=[],a.archives=[],a.prettyFileSize=e.getPrettyFileSizeString(a.filesize)}),a.state.books=c,b._redraw()})},_buildStateContext:function(){var a=this._super();return a.activeBookNum=null,a.books=[],a},__getBookResource:function(a){var b=this.resource.sourceURL,d="booknum="+parseInt(a,10);return b.indexOf("booknum")?b=b.replace(/booknum=[\d]+/,d):b+="&"+d,new c(b)},__updateChapters:function(a,c){var d=_.find(c,function(a){return a.mimetype===b.getSetting("ARCHIVE_MIMETYPE")});c=_.filter(c,function(a){return a.mimetype!==b.getSetting("ARCHIVE_MIMETYPE")}),_.each(c,function(a,b){a.index=b,a.prettyFileSize=e.getPrettyFileSizeString(a.filesize)}),_.each(a.state.books,function(b){b.booknum===a.state.activeBookNum?(b.chapters=c,b.active=!0,b.archives=[d]):(b.chapters=[],b.active=!1,b.archives=[])})}}),module.define("BibleModal",a)}(),function(){"use strict";var a,b=module.require("DownloadModal");a=b.extend({TEMPLATE_NAME:"TourBrochureModal",MODAL_CONFIG:{},_buildStateContext:function(){return{pubName:this.title||this.resource.getPubName(),files:this.__listFiles()}},__listFiles:function(){var a=this,b=this.resource.listLanguages();return b=b.then(function(b){return _.map(b,function(b){return a.resource.listFileTypes(b.index).then(function(c){return _.map(c,function(c){return a.resource.listFiles(b.index,c.name)})})})}),a._resolveDeferrends(b).then(function(a){return _.flatten(a)})}}),module.define("TourBrochureModal",a)}(),function(){"use strict";var a,b=module.require("settings"),c=module.require("DownloadModal"),d=module.require("FileUtils");a=c.extend({TEMPLATE_NAME:"VideoModal",init:function(a){this._super(a),this.autoPlay=!1,this.coverDocURL="",this.title=void 0},onLanguageChange:function(a,b){var c=$(this).val(),d=b.controller.resource.hasSubtitles(c);b.state.activeLanguage=_.extend({},_.find(b.state.languages,function(a){return a.code===c})),d.then(function(a){b.state.showSubtitleSelector=!1,a===b.controller.resource.SUBTITLES_ONLY?b.state.subtitled=!0:a===b.controller.resource.SUBTITLES_NONE?b.state.subtitled=!1:b.state.showSubtitleSelector=!0,b.controller._buildFileList(b)})},onSubtitledChange:function(a,b){b.state.subtitled=$(this).prop("checked"),b.controller._buildFileList(b)},setAutoPlay:function(a){this.autoPlay=a===!0},setCoverDocURL:function(a){this.coverDocURL=a},setTitle:function(a){return this.title=a,this.title},_buildFileList:function(a){var c=this,e=a.state.activeLanguage.code,f=this.resource.listFileTypes(e);return f=f.then(function(b){var d=_.first(b);return a.state.fileType=d,c.resource.listFiles(e,d.name)}).then(function(d){var f=0,g=0;return c._parseFileBundles(a,d),d=_.filter(d,function(c){return c.subtitled===a.state.subtitled&&-1!==b.getSetting("VIDEO_STREAM_MIMETYPES").indexOf(c.mimetype)}),d=_.groupBy(d,"track"),g=Object.keys(d).length,_.map(d,function(a){var d,h=_.first(a);return d=g>1?h.trackImage.url||b.getSetting("VIDEO_THUMBNAIL"):null,{index:f++,name:h.title,thumbnail:d,resolutions:a,language:c.resource.getLanguage(e)}})}).then(function(a){return c._resolveDeferrends(a)}).then(function(b){_.each(b,function(a){_.each(a.resolutions,function(a){a.prettyFileSize=d.getPrettyFileSizeString(a.filesize)})}),a.state.tracks=b,c._redraw(),c._updateStreamingPlaylist(e,a.state.fileType.name,a.state.subtitled)})},_buildStateContext:function(){var a=this._super();return _.extend(a,{autoPlay:this.autoPlay,coverDocURL:this.coverDocURL,pubName:this.title||this.resource.getPubName(),showLanguageSelector:this.resource.listLanguages().then(function(a){return a.length>1}),showSubtitleSelector:!1,showLangSeparator:$.when(a.primaryLanguages,a.otherLanguages).then(function(a,b){return a.length>0&&b.length>0}),subtitleControlID:this.id+"_SubtitleControl",subtitled:!1})},_onFirstRender:function(){this.html.find(".selectSpokenLanguage select").change()}}),module.define("VideoModal",a)}(),function(){"use strict";var a,b=module.require("MediaModal"),c=module.require("PubMediaResource"),d=module.require("FileUtils");a=b.extend({TEMPLATE_NAME:"VideoBibleModal",init:function(a,b){this._super(),this.baseURL=b,this.books=_.map(a,function(a,b){return{active:!1,booknum:parseInt(b,10),title:a,chapters:[]}})},onAccordionSelect:function(a,b){var c,d=$(this),e=d.closest("h2"),f=d.data("booknum");return e.hasClass("viewHdgExpand")?b.controller.__closeAllBooks(b):(c=b.controller.__loadBook(b,f),void c.then(function(){e.removeClass("viewHdgCollapse").addClass("viewHdgExpand"),b.controller._redraw()}))},onBookSelect:function(a,b){var c=$(this),d=c.val(),e=b.controller.html.find(".book h2[data-booknum="+d+"]");e.click()},onChapterJump:function(a,b){if(b.controller.streaming||b.controller.streaming.getPlayer()){var c=b.controller.streaming.getPlayer();c.skipTo(b.state.activeTrack)}},_buildStateContext:function(){return{language:{},fileType:{},activeBook:{},activeTrack:0,pubName:"",parentPubName:"",books:this.books}},__closeAllBooks:function(a){_.each(a.state.books,function(a){a.active=!1}),a.controller.html.find(".jsExpandCollapse").removeClass("viewHdgExpand").addClass("viewHdgCollapse")},__fillChapterList:function(a,b,c){var e;b=parseInt(b,10),this.__closeAllBooks(a),e=_.find(a.state.books,function(a){return a.booknum===b}),_.each(c,function(a){_.each(a.resolutions,function(a){a.prettyFileSize=d.getPrettyFileSizeString(a.filesize)})}),e.chapters=c,e.active=!0,a.state.activeBook=$.extend({},e),a.state.activeTrack=0},__groupFiles:function(a){var b=0;return a=_.groupBy(a,"track"),_.map(a,function(a){var c=_.first(a);return{index:b++,track:c.track,name:c.title,resolutions:a}})},__loadBook:function(a,b){var c,d,e,f,g=this;return c=this.__loadBookResource(b),c.getPubName().then(function(b){a.state.pubName=b}),c.getParentPubName().then(function(b){a.state.parentPubName=b}),d=c.listLanguages(),d=d.then(function(b){return e=_.first(b),a.state.language=e,c.listFileTypes(e.code)}),d=d.then(function(b){return f=_.first(b),a.state.fileType=f,c.listFiles(e.code,f.name)}),d=d.then(function(b){return g._parseFileBundles(a,b),b}),d=d.then(function(a){return _.filter(a,function(a){return a.track>0})}),d=d.then(this.__groupFiles),d=d.then(function(c){g.__fillChapterList(a,b,c)}),d=d.then(function(){g._updateStreamingPlaylist(e.code,f.name,"",c),g.streaming.loading().then(function(){var b=g.streaming.getPlayer();b&&b.bind("playlistComplete",function(){return g.__nextBook(a)})})})},__loadBookResource:function(a){var b=this.baseURL,d="booknum="+parseInt(a,10);return-1!==b.indexOf("booknum")?b=b.replace(/booknum=[\d]+/,d):b+="&"+d,new c(b)},__nextBook:function(a){var b,c;b=_.find(a.state.books,function(a){return a.active}),c=a.state.books.indexOf(b)+1,a.state.books[c]&&this.__loadBook(a,a.state.books[c].booknum)},_draw:function(){var a=this;return this._super().done(function(){a.html.find(".book:first h2:first").click()})}}),module.define("VideoBibleModal",a)}(),function(){"use strict";var a,b,c=module.require("SimpleModal"),d=module.require("UIController"),e="drag",f="pinch",g=200;b=d.extend({TEMPLATE_NAME:"ImageModal",container:null,image:null,wrap:null,imageOrigin:null,lastDragX:null,lastDragY:null,pinchStartingDistance:null,pinchStartingScale:null,scale:1,minScale:1,panX:0,panY:0,lastX:0,lastY:0,translateX:0,translateY:0,originX:0,originY:0,init:function(a){this.src=a},open:function(){this._draw()},_injectHTML:function(a){var b,d=this;this._super(a),this.container=a.find(".largeModalContent"),this.wrap=a.find(".jsImageWrap"),this.image=a.find(".jsImageWrap img"),this.zoomInButton=a.find(".jsZoomIn"),this.zoomOutButton=a.find(".jsZoomOut"),b=new c(a,!0),b.open(),this.image.load(function(){d.imageOrigin={top:0,left:d.image.offset().left},d.__attachEventHandlers(),d.__centerImage()}),this.image.error(function(){c.close()}),this.image.attr("src",this.src)},__applyTransform:function(a,b,c){var d="scale(%s) translate(%spx, %spx)";b=Math.round(b),c=Math.round(c),d=d.format(a,b,c),this.wrap.css({"-webkit-transform":d,"-moz-transform":d,transform:d})},__applyTransformOrigin:function(a,b){var c="%spx %spx";a=Math.round(a),b=Math.round(b),c=c.format(a,b),this.wrap.css({"-webkit-transform-origin":c,"-moz-transform-origin":c,"transform-origin":c})},__attachEventHandlers:function(){var a=$(document),b=this.image.hammer(),c=$.proxy(this.__handleDrag,this),d=$.proxy(this.__handleDragStart,this),e=$.proxy(this.__handlePinch,this),f=$.proxy(this.__handleTouchStart,this),g=$.proxy(this.__handleZoomIn,this),h=$.proxy(this.__handleZoomOut,this);b.on("touchstart",f),b.on("dragstart",d),b.on("drag",c),b.on("doubletap",g),this.zoomInButton.click(g),this.zoomOutButton.click(h),b.on("pinch",e),a.on("keypress",null,"+",g),a.on("keypress",null,"-",h)},__centerImage:function(){var a,b,c,d,e,f=this.image.width()*this.scale,g=this.image.height()*this.scale,h=this.container.width(),i=this.container.height()-this.container.find(".toolbar").height();a=h/f,b=i/g,c=Math.min(a,b),this.minScale=c,this.__zoom(c),f=this.image.width()*this.scale,g=this.image.height()*this.scale,d=(h-f)/2,e=(i-g)/2,this.__pan(d,e)},__getNominalSize:function(){var a=(this.image.width()+this.image.height())/2;return a},__handleDrag:function(b){if(b.preventDefault(),b.gesture&&(!a||a===e)){var c=b.gesture.deltaX-this.lastDragX,d=b.gesture.deltaY-this.lastDragY;this.lastDragX=b.gesture.deltaX,this.lastDragY=b.gesture.deltaY,this.__pan(c,d),a=e,setTimeout(function(){a=null},g)}},__handleDragStart:function(){this.lastDragX=0,this.lastDragY=0},__handlePinch:function(b){var c,d,e,h,i,j=b.gesture.touches,k=b.gesture.center.pageX-this.imageOrigin.left,l=b.gesture.center.pageY-this.imageOrigin.top,m=this.__getNominalSize();if(2===j.length&&(!a||a===f)){if(c=Math.abs(j[0].pageX-j[1].pageX)*this.scale,d=Math.abs(j[0].pageY-j[1].pageY)*this.scale,c=Math.pow(c,2),d=Math.pow(d,2),e=Math.sqrt(c+d),void 0===this.pinchStartingDistance)return void(this.pinchStartingDistance=e);h=e-this.pinchStartingDistance,i=(m+h)/m,i+=this.pinchStartingScale-1,this.__zoom(i,k,l),a=f,setTimeout(function(){a=null},g)}},__handleTouchStart:function(a){a.preventDefault(),this.pinchStartingDistance=void 0,this.pinchStartingScale=this.scale},__handleZoomIn:function(a){a.preventDefault();var b,c,d=this.scale+.5*this.scale;a.gesture?(b=a.gesture.center.pageX-this.imageOrigin.left,c=a.gesture.center.pageY-this.imageOrigin.top):(b=this.container.width()/2,c=this.container.height()/2),this.__zoomTo(d,b,c)},__handleZoomOut:function(a){var b=this.scale-.5*this.scale,c=this.container.width()/2,d=this.container.height()/2;a.preventDefault(),this.__zoomTo(b,c,d)},__pan:function(a,b){a/=this.scale,b/=this.scale,this.panX+=a,this.panY+=b,this.__zoom(this.scale,this.panX,this.panY)},__zoom:function(a,b,c){b=b||this.lastX,c=c||this.lastY,this.originX=this.originX+(b-this.lastX)/this.scale,this.originY=this.originY+(c-this.lastY)/this.scale,a=Math.max(this.minScale,a),this.scale=a,this.translateX=(b-this.originX)/this.scale+this.panX,this.translateY=(c-this.originY)/this.scale+this.panY,this.lastX=b,this.lastY=c,this.__applyTransform(this.scale,this.translateX,this.translateY),this.__applyTransformOrigin(this.originX,this.originY)},__zoomTo:function(a,b,c){var d,e=10,f=1/e,g=this.scale,h=a-g,i=0,j=this;(d=function(){i++;var a=h*$.easing.swing(f*i);j.__zoom(a+g,b,c),e>i&&setTimeout(d,10)})()}}),module.define("ImageModal",b)}(),function(){"use strict";var a,b=400,c=300,d=.375,e=module.require("settings"),f=module.require("BibleVerseRangeCollection"),g=module.require("UIController"),h=module.require("HeadlessAudioPlayer");a=g.extend({TEMPLATE_NAME:"ScriptureDialog",elem:null,loading:null,dialogClass:"",init:function(a,b,c,d){this._super(),this.verseRanges=new f(a,b),this.isXRef=!!c,this.players={},this.hideLinkRanges=d},close:function(){this.elem.dialog("close"),_.each(this.players,function(a){a.remove()}),this.players={}},load:function(){if(!this.loading){var a=this.verseRanges.getTextAPIURL();this.loading=$.getJSONCached(a)}return this.loading},open:function(){this.elem=this.__buildDialog(),this._draw()},playRange:function(a,b){var c=b.controller,d=$(this),e=d.closest(".verseRange").data("verse-id"),f=c.verseRanges.getRange(e);return c.players[e]?void c.players[e].play():void c.__buildPlayer(d,f).then(function(){c.players[e].play()})},pauseRange:function(a,b){var c=b.controller,d=$(this),e=d.closest(".verseRange").data("verse-id");c.players[e]&&c.players[e].pause()},onScriptureClick:function(a,b){b.controller.close()},_buildStateContext:function(){var a=this.load(),b=this,c={};return c.ranges=a.then(function(a){var c,d=_.isFunction(b.hideLinkRanges)?b.hideLinkRanges():b.hideLinkRanges;return c=_.map(a.ranges,function(a,c){var e=b.verseRanges.getRange(c),f=$("<div></div>"),g=_.contains(d,c);return f.append(a.html),f.find("sup.verseNum a, span.chapterNum a").contents().unwrap(),f.find("span.verse").removeAttr("id"),{id:c,citation:a.citation,link:a.link,content:f.html(),audio:e.hasAudio(),book:e.start.book,chapter:e.start.chapter,hideLink:g,startRange:e.startRange}})}),c},_injectHTML:function(a){this.elem.empty().append(a),this.elem.dialog("option","position",{my:"center",at:"center center+"+this.__dialogVerticalOffset()/2,of:window})},__buildDialog:function(){var a=e.getSetting("IS_MOBILE_LAYOUT"),f=a?c:b,g=f*d,h=.9*$(window).height()-this.__dialogVerticalOffset(),i=.9*$(window).width(),j=$("<div><div class='loadingIndicator small'></div></div>"),k=$("html"),l=k.attr("lang"),m=k.attr("dir"),n=$("#article"),o=n.attr("lang"),p=n.attr("dir"),q=this;return j.addClass("scriptureDialog"),j.dialog({dialogClass:"scriptureDialog "+(this.dialogClass||""),title:this.__getTitle(),maxHeight:h,maxWidth:i,width:f,minHeight:g,modal:a,open:function(){q.dialogClass&&$(".ui-widget-overlay").addClass(q.dialogClass)},close:function(){q.close()},closeText:_t("CMSPUBS.LnkCloseUppCase"),position:{my:"center",at:"center",of:window}}),j.parent().addClass("lang-"+o).addClass("dir-"+p).attr("lang",o).attr("xml:lang",o).attr("dir",o),j.parent().children(".ui-dialog-titlebar").addClass("lang-"+l).addClass("dir-"+m).attr("lang",l).attr("xml:lang",l).attr("dir",l),$(document).on("click",".ui-widget-overlay",function(){q.close()}),j},__buildPlayer:function(a,b){var c=this;return b.buildPlaylist().then(function(d){var e=b.getID();c.players[e]=new h(d),c.players[e].bind("play playing",function(){c.__showPauseButton(a)}),c.players[e].bind("ended pause",function(){c.__showPlayButton(a)})})},__getTitle:function(){return _t(this.isXRef?"CMSPUBS.HdgMarginalReferences":"CMSPUBS.HdgCitedScripture")},__showPlayButton:function(a){var b=a.parent();b.children(".pause").hide(),b.children(".play").show()},__showPauseButton:function(a){var b=a.parent();b.children(".pause").show(),b.children(".play").hide()},__dialogVerticalOffset:function(){var a=$("#mobileNavTopBar:visible");return a.length>0?a.height():0}}),module.define("ScriptureDialog",a)}(),function(){"use strict";var a,b,c,d=module.require("settings"),e=module.require("browser"),f=18,g=13,h=27,i=37,j=38,k=39,l=40,m=4,n="AutocompleteFeatured";c=function(){this.index=0,this.value="",this.label="",this.altLabel="",this.altSpellings="",this.elemOption=null,this.icon=null},b=function(){this.values=[],this.labels=[],this.altLabels=[],this.altSpellings=[],this.optionElems=[],this.icons=[]},b.prototype={exists:function(a){return void 0!==this.values[a]},get:function(a){if(void 0===this.values[a])return void 0;var b=new c;return b.index=a,b.value=this.values[a],b.label=this.labels[a],b.altLabel=this.altLabels[a],b.altSpellings=this.altSpellings[a],b.elemOption=this.optionElems[a],b.icon=this.icons[a],b},indexOf:function(a){return this.values.indexOf(a)},list:function(a){var b,c,d=[];for(b=0;b<this.values.length;b++)d.push(this.get(b));return void 0===a?d:(c=this.__getSearchIndex(),a=a.toLowerCase(),d=$.grep(d,function(b,d){return-1!==c[d].indexOf(a)}))},loadData:function(a){var b=this;a.children("option").each(function(){var a=$(this);b.__addOption(a)})},__addOption:function(a){var b=a.attr("value"),c=a.text(),d=a.data("alternative-label"),e=a.data("alternative-spellings"),f=a.data("icon");this.values.push(b),this.labels.push(c),this.altLabels.push(d),this.altSpellings.push(e),this.optionElems.push(a),this.icons.push(f)},__getSearchIndex:function(){if(this.searchIndex)return this.searchIndex;var a,b,c=/<(?:.|\n)*?>/gm;for(this.searchIndex=[],b=0;b<this.values.length;b++)a=this.values[b],a+=this.labels[b],a+=this.altLabels[b],a+=this.altSpellings[b],a=a.toLowerCase().replace(c,""),this.searchIndex.push(a);return this.searchIndex}},a=function(a,b){var c,d=$("<div></div>");c={activeClass:"active",columnWidth:235,minColumns:1,maxColumns:4,showFeatured:!1},this.__dimensionCache={},this.__optionHTMLCache={},this.elemSelect=a,this.settings=$.extend(c,b),this.selector={container:$("body"),elem:null,customStyle:!1,isOpen:!1,isClosable:!0},this.loadOptions(),this.elemInput=this.__renderTextField(),this.elemSelect.hide(),d.addClass("jsAutoCompleteInputWrapper"),d.append(this.elemInput),d.insertAfter(this.elemSelect),this.__bindInputEventHandlers()},a.prototype={clearOptionCache:function(){this.__optionHTMLCache={}},close:function(){this.__handleBlur(this.selector.elem)},configureSelector:function(a,b,c){this.selector.container=a||$("body"),this.selector.customStyle=!!b,this.selector.isClosable=!!c},loadOptions:function(){var a,c;this.options=new b,this.options.loadData(this.elemSelect),a=this.options.indexOf(this.elemSelect.val()),a=-1===a?null:a,this.selectedIndex=a,null!==a&&(c=this.options.get(a),this.__addFeaturedOption(c.value),this.elemInput&&this.elemInput.val(c.label)),this.selector.elem&&this.selector.isOpen&&this.__drawSelector()},open:function(){if(!this.selector.isOpen){var a=this.options.indexOf(this.elemSelect.val()),b=this.options.get(a);this.elemInput.val(""),this.elemInput.removeClass(b.elemOption.data("input-icon-class")),this.__drawSelector(),this.selector.isOpen=!0}},selectOption:function(a){var b,c,d,e,f;return this.options.exists(a)?(b=this.options.get(a),c=this.elemSelect.val(),d=this.options.indexOf(c),e=this.options.get(d),f=e.elemOption.data("input-icon-class"),this.elemInput.removeClass(f),this.elemInput.addClass(b.elemOption.data("input-icon-class")),this.selectedIndex=a,this.elemInput.val(b.label),this.elemSelect.children().prop("selected",!1),this.elemSelect.children('[value="'+b.value+'"]').prop("selected",!0),this.__addFeaturedOption(b.value),c!==b.value&&this.elemSelect.trigger("change"),void this.elemSelect.trigger("autocomplete-option-selected")):(this.elemInput.val(""),void this.__drawSelector())},__attachSelector:function(a){var b,c=this;this.selector.customStyle||(b=$(window).scrollTop()),this.selector.container.append(a),this.selector.customStyle||(this.__positionSelector(a),$(window).resize(function(){c.__positionSelector(a)}),$(window).scrollTop(b))},__bindInputEventHandlers:function(){var a,b,c,d,f,g=this;this.elemInput.on("focus",this.open.bind(this)),a=function(a){b!==a&&(g.__drawSelector(a),b=a)},c=e.isIE()?"keydown":"input keydown",d=e.isIE()?"keyup":"input keyup",this.elemInput.on(c,function(a){g.__handleControlKey(g.selector.elem,a.keyCode)&&a.preventDefault()}),this.elemInput.on(d,function(){var b=g.elemInput.val();f&&clearTimeout(f),f=setTimeout(function(){a(b)},0)})},__bindSelectorRemove:function(a){var b,c=this,d=!0,e=!1;b=function(){d||e||c.__handleBlur(a)},a.on("mouseenter",function(){e=!0}),a.on("mouseleave",function(){e=!1,setTimeout(b,200)}),this.elemInput.on("focus",function(){d=!0}),this.elemInput.on("blur",function(){d=!1,setTimeout(b,200)})},__addFeaturedOption:function(a){if(this.settings.showFeatured){var b=this.__getFeaturedKey(),c=this.__listFeaturedOptions(),e=c.indexOf(a);-1!==e&&c.splice(e,1),c.unshift(a),c=c.slice(0,2*m),d.setPageConfig(b,c)}},__copyAttrs:function(a,b,c){var d,e;for(d=0;d<c.length;d++)e=a.attr(c[d]),b.attr(c[d],e);return b},__drawSelector:function(a){this.selector.elem&&this.selector.elem.remove(),this.selector.elem=this.__renderSelector(a),this.__attachSelector(this.selector.elem),this.__bindSelectorRemove(this.selector.elem)},__getFeaturedKey:function(){var a=this.elemSelect,b=a.data("featured-items-name")||a.attr("id")||a.attr("name");return"%s-%s".format(n,b)},__getNumColumns:function(){var a=$(window),b=a.width()-this.__getSelectorLeft(),c=Math.floor(b/this.settings.columnWidth);return c=Math.min(this.settings.maxColumns,c),c=Math.max(this.settings.minColumns,c)},__getSelectorLeft:function(a){var b,c,d=$(window),e=this.elemInput.offset(),f=e.left+this.elemInput.outerWidth()/2,g=d.width()/2;return b=a?a.outerWidth():this.settings.maxColumns*this.settings.columnWidth,c=g>f?e.left:e.left+this.elemInput.outerWidth()-b,Math.max(0,c)},__getSelectorTop:function(){if(this.__dimensionCache.selectorTop)return this.__dimensionCache.selectorTop;var a=this.elemInput.offset(),b=a.top+this.elemInput.outerHeight();return this.__dimensionCache.selectorTop=Math.max(0,b),this.__dimensionCache.selectorTop},__handleBlur:function(a){var b=this.elemInput.val();this.selector.isClosable&&(this.selector.isOpen=!1,-1===this.options.indexOf(b)&&this.selectOption(this.selectedIndex),a.fadeOut(function(){a.remove()}),this.__dimensionCache={},this.elemInput.next("input").focus())},__handleControlKey:function(a,b){var c,d,e,f,m,n=a.find("li."+this.settings.activeClass),o=!1;return b===h?(this.elemInput.blur(),!0):b===g?(e=n.data("index"),this.selectOption(e),this.elemInput.blur(),!0):((b===j||b===l)&&(d=b===j?"prev":"next",c=n[d](),o=!0),(b===i||b===k)&&(d=b===i?"prev":"next",e=n.parent().children().index(n),c=n.parent().parent()[d]().children().children().filter(":eq("+e+")"),o=!0),c&&c.length>0?(n.removeClass(this.settings.activeClass),c.addClass(this.settings.activeClass),e=c.parent().children().index(c),f=c.parent().height()-a.innerHeight(),m=$.easing.swing(e/c.parent().children().length)*f,a.scrollTop(m),!0):o)},__handleOptionClick:function(a){var b=a.data("value").toString();this.selectOption(this.options.indexOf(b))},__listFeaturedOptions:function(){if(!this.settings.showFeatured)return[];var a=this.__getFeaturedKey(),b=d.getPageConfig(a)||[];return b},__positionSelector:function(a){var b=this.__getSelectorTop(),c=this.__getSelectorLeft(a);a.offset({top:b,left:c})},__renderOptionHTML:function(a){var b,c;return void 0!==this.__optionHTMLCache[a.value]?(b=this.__optionHTMLCache[a.value],a.index!==this.selectedIndex&&b.removeClass(this.settings.activeClass),b):(c=["class","lang","xml:lang"],b=$("<li></li>"),b=this.__copyAttrs(a.elemOption,b,c),a.icon&&b.append(a.icon),a.altLabel&&b.append("<span class='altLabel'>"+a.altLabel+"</span>"),b.attr("data-index",a.index),b.attr("data-value",a.value),b.append(a.label),a.index===this.selectedIndex&&b.addClass(this.settings.activeClass),this.__optionHTMLCache[a.value]=b,b)},__renderSelector:function(a){var b=this.options.list(a),c=this.__renderSelectorHTML(b),d=this;return c.find("li").on("click",function(){d.__handleOptionClick($(this)),d.__handleBlur(c)}),c},__renderSelectorHTML:function(a){var b,c,d,e=$("<div></div>"),g=$("<div><ul></ul></div>"),h=this.__listFeaturedOptions(),i=g.clone(),j=Math.min(a.length,this.__getNumColumns()),k=this.__renderOptionHTML.bind(this);return g.addClass("jsAutoCompleteContainer featuredOptions"),i.addClass("jsAutoCompleteContainer"),d=_.intersection(h,_.pluck(a,"value")),b=m-m%j,d=d.slice(0,b),d=_.filter(a,function(b){return d.length<a.length&&-1!==d.indexOf(b.value)}),d=_.sortBy(d,function(a){return h.indexOf(a.value)}),c=function(a){var b=$("<div><ul></ul></div>");return b.addClass("jsAutoCompleteContainer"),b.children("ul").append(a),b},g.children("ul").append(_.invoke(_.map(d,k),"clone")),i.children("ul").append(_.invoke(_.map(a,k),"clone")),g.find("li").length&&e.append(g),e.append(i),0===e.find("li."+this.settings.activeClass).length&&e.find("li:first").addClass(this.settings.activeClass),e.addClass("jsAutoCompleteSelector"),e.addClass("dir-"+(this.settings.direction||"ltr")),e.addClass(this.elemInput.data("autocompleteclass")),this.selector.customStyle||e.css("width",j*this.settings.columnWidth+f),e},__renderTextField:function(){var a=$("<input />"),b=this.options.get(this.selectedIndex);return this.__copyAttrs(this.elemSelect,a,["class","placeholder","data-autocompleteclass"]),a.addClass("jsAutoCompleteInput"),a.addClass(this.elemSelect.data("autocompleteclass")),a.addClass(b.elemOption.data("input-icon-class")),a.val(b?b.label:""),a.attr("autocomplete","off"),a}},module.define("Autocomplete",a),module.define("autocomplete",{Autocomplete:a,OptionRecord:c,OptionSet:b,init:function(b,c){var d;!b.data("autocomplete")&&b.children("option").length>0&&(d=new a(b,c),b.data("autocomplete",d))}})}(),function(){"use strict";var a,b=module.require("signal"),c=module.require("loadingIndicator"),d=module.require("url");a=Class.extend({swapContent:function(a,d,e,f){var g,h=$(d.join(", ")),i=this;return c.open(),g=$.get(a),f||h.fadeOut(),g.fail(function(){window.location.href=a}),g.done(function(a){var g,h,j,k,l,m,n;for(a=$(a),k=a.filter("#pageConfig").data("page_id"),c.close(),e&&(i.updatePageID(k),l=a.filter("title"),i.updatePageTitle(l.text()),m=a.filter(".jsVideoPoster"),i.updateVideoPoster(m)),n=0;n<d.length;n++)g=d[n],h=$(g),j=a.filter(g),j=j.length>0?j:$(g,a),f||j.hide(),h.replaceWith(j),f||$(g).fadeIn();i.updateAnchorLinks(),b.send("DOMReady")}),g},getHTML:function(a,b){return a?$.get(a).then(function(a){return b?$(a).find(b):$(a)}):$.when(null)},updateURL:function(a){if(a&&a.urlString){var b,c;if(a.hash?(b=d.parse(a.urlString),b.hash.path=a.hash,a.urlString=d.build(b)):a.preserveHash&&(b=d.parse(a.urlString),b.hash.path=this.getCurrentHashValue(),a.urlString=d.build(b)),c=a.overwriteHistory?this._hasReplaceState():this._hasPushState(),!c)return void this.updateAnchorLinks();this._pushOrReplace(a.urlString,a.state,a.overwriteHistory),this.updateAnchorLinks()}},updateHash:function(a,b,c){if(!this._hasPushState()||b&&!this._hasReplaceState())return void(window.location.hash=a);var e=d.parse(window.location.href);e.hash.path=a,this._pushOrReplace(d.build(e),c,b)},getHashFromURL:function(a){if(!a)return null;var b=d.parse(a);return b.hash.path},_pushOrReplace:function(a,b,c){var d=c?window.history.replaceState:window.history.pushState;d.call(window.history,b,null,a)},updateState:function(a){this._hasReplaceState()&&window.history.replaceState(a,null,window.location.href)},getCurrentHashValue:function(){var a=window.location.hash;return a&&-1!==a.indexOf("#")?a.substring(1):""},removeHash:function(a){if(a){var b=d.parse(a);return b.hash.path="",d.build(b)}},_hasPushState:function(){return window.history&&"pushState"in window.history},_hasReplaceState:function(){return window.history&&"replaceState"in window.history},updateAnchorLinks:function(){$('a[data-anchor^="#"]').each(function(){var a=$(this),b=window.location.pathname+a.data("anchor");a.attr("href",b)})},updatePageID:function(a){$("body").attr("id",a),$("#pageConfig").data("page_id",a)},updatePageTitle:function(a){a&&(a=$("<span></span>").html(a).text(),$("title").text(a))},updateVideoPoster:function(a){var b=$(".jsVideoPoster");return a.exists()?void(b.exists()?b.after(a).remove():$("body").append(a)):void b.remove()},updatePageCSSClasses:function(a){$("body").attr("class",a)},getURL:function(){return window.location.href}}),module.define("Navigation",a),module.get("Navigation")}(),function(){"use strict";var a,b=.6211,c=module.require("url"),d=module.get("Navigation"),e=module.get("ScrollHelper"),f=module.require("signal");a=Class.extend({init:function(){var a=this.onAnchorClick.bind(this);$(document).on("click","a:not(.jsNoScroll)[href*=#]",a),this.targetResolvers=[],this.addTargetResolver(function(a){return $("#"+a)})},addTargetResolver:function(a){var b=this;this.targetResolvers.unshift(a),$(document).ready(function(a){b.__scrollTimer&&clearTimeout(b.__scrollTimer),b.__scrollTimer=setTimeout(function(){b.onAnchorClick(a)},1e3)}),f.listen("PageLoaded",function(a){b.onAnchorClick({target:document},a)})},getHash:function(a){return a=a||window.location.href,a=c.parse(a),window.location.pathname!==a.path&&a.path?void 0:a.hash.path},onAnchorClick:function(a,b){var c,e,f,g,h,i=$(a.target);if(i=i.is("a")?i:i.closest("a"),c=i.exists()?i.attr("href"):void 0,e=this.getHash(c)){for(a.preventDefault&&a.preventDefault(),f=0;f<this.targetResolvers.length&&(h=this.targetResolvers[f],!(g=h(e)));f++);g&&g.exists()&&(b||(b=g.closest(".jsLockedContainer"),b=b.exists()?b:$(window)),i.hasClass("jsHighlightOnly")?d.updateHash(e):(window.location.hash=e,this.scrollTo(g,b)))}},scrollTo:function(a,c){c=$(c);var d,f,g=$.isWindow(c.get(0))?$(document):c;d=c.height(),f=d*(1-b),e.scrollTo(c,a,-f,g)}}),module.define("AnchorLinkController",a),module.get("AnchorLinkController")}(),function(){"use strict";var a,b=module.require("settings"),c=module.require("UIController"),d=module.require("SimpleModal"),e=module.require("autocomplete"),f=b.getPageConfig("CONTENT_LANG"),g=b.getPageConfig("CONTENT_LANG_DIRECTION"),h=b.getPageConfig("LANGUAGE_API");a=c.extend({TEMPLATE_NAME:"LanguagePicker",forceOnlySL:!1,open:function(a){this.injector=a,this._draw()},onLanguageFilterClick:function(a,b){var c,d=this;b.controller.__updating||(c=function(a){b.state.optionHTML=b.controller.__renderOptionHTML(a),b.controller.autocomplete&&b.controller.autocomplete.loadOptions(),b.controller.__updating=!1},b.controller.__updating=!0,setTimeout(function(){var a=!!d.checked;b.controller.__listLanguages(a).then(c)},0))},_buildStateContext:function(){var a=this.forceOnlySL;return{onlySL:a,optionHTML:this.__listLanguages(a).then(this.__renderOptionHTML.bind(this)),numLanguages:this.__listLanguages(!1).then(function(a){return a.length})}},_injectHTML:function(a){var b;return this._super(a),this.container=a.find(".largeModalContent"),this.injector?this.injector(a):(b=new d(a,!0),b.updateSettings({afterShow:function(){a.find("input.jsAutoCompleteInput").focus()}}),void b.open())},_onFirstRender:function(){var a=this.container.find("select:first");e.init(a,{showFeatured:!0,direction:$("#pageConfig").data("content_lang_direction")}),this.autocomplete=a.data("autocomplete"),this.autocomplete.configureSelector(this.container,!0,!1),this.autocomplete.open(),a.on("autocomplete-option-selected",function(){$(this).closest("form").submit()})},_renderTemplate:function(a){var b=$("#templates .template.languagePicker").children().clone();return rivets.bind(b,a),this.__formalityPromise(b)},__buildLanguageContext:function(a){return a.name=a.name||"",a.vernacularName=a.vernacularName||"",a.altLabel="<span class='lang-%s' lang='%s' xml:lang='%s' dir='%s'>%s</span>".format(f,f,f,g,a.name),a.className="dir-%s lang-%s".format(a.direction,a.symbol),a.isSignLanguage?a.className+=" signLanguage":a.hasWebContent?a.className+=" hasWebContent":a.className+=" downloadOnly",a},__listLanguages:function(a){var b,c=this;return this.__cacheLanguageList?b=this.__formalityPromise(this.__cacheLanguageList):(b=$.getJSONCached(h),b=b.then(function(a){var b=_.map(a.languages,c.__buildLanguageContext);return c.__cacheLanguageList=b,b})),b.then(function(b){return a?_.filter(b,function(a){return a.isSignLanguage}):b})},__renderOptionHTML:function(a){return _.reduce(a,function(a,b){var c="<option ";return c+="data-icon=\"<span class='icon'></span>\" ",c+='data-alternative-spellings="'+b.altSpellings+'" ',c+='class="'+b.className+'" ',c+='value="'+b.symbol+'" ',c+='lang="'+b.symbol+'" ',c+='dir="'+b.direction+'" ',c+='xml:lang="'+b.symbol+'" ',b.symbol===f&&(c+='selected="selected" '),c+='data-alternative-label="'+b.altLabel+'">',c+=b.vernacularName,c+="</option>",a+=c},"")}}),module.define("LanguagePicker",a)}(),function(){"use strict";var a,b=[];a=Class.extend({init:function(a,b){this.owner=a,this.container=b,this.elems=[],this.plugins={}},close:function(){_.each(this.elems,function(a){a.fadeOut(function(){a.remove()})})},open:function(){var a,b,c,d=this.__buildMenu(),e=this.owner,f=e.outerWidth()||_.max(e.children().map(function(){
return $(this).outerWidth()})),g=e.offset();return d?(e.parent().append(d),a=g.left+f/2,b=g.top,c={top:b-d.outerHeight(),left:a-d.outerWidth()/2},d.offset(c),this.elems.push(d),!0):!1},__buildMenu:function(){var a=$("<div></div>"),b=this.__buildElem();return b?(a.addClass("contextMenuContainer"),a.append(b),a.append(this.__buildArrow()),a):void 0},__buildArrow:function(){var a=$("<div></div>");return a.addClass("contextMenuArrow"),a.addClass("bottom"),a},__buildElem:function(){var a,c=this,d=$("<div></div>");return d.addClass("contextMenu"),a=_.reduce(b,function(a,b){var e,f=b(c.owner);return f?(e=f.render(),e.click(function(){f.handleClick(),c.close()}),d.append(e),a+1):a},0),a?d:void 0},__buildRelativePosition:function(a,b,c){return c&&(a=this.__invertPosition(a),b=this.__invertPosition(b)),a+" "+b},__invertPosition:function(a){var b={top:"bottom",bottom:"top",center:"center",left:"right",right:"left"};return b[a]}}),a.registerPlugin=function(a){b.push(a)},module.define("ContextMenu",a)}(),function(){"use strict";var a,b=module.require("ContextMenu");a=Class.extend({init:function(a,b,c){this.player=a,this.track=b,this.start=c},handleClick:function(){this.player.getPlaylistIndex()!==this.track&&this.player.skipTo(this.track),this.player.setPosition(this.start)},render:function(){var a=$("<div></div>");return a.addClass("btn playAudio"),a}}),b.registerPlugin(function(b){var c=b.data("player"),d=b.data("track"),e=b.data("start");if(c)return new a(c,d,e)})}(),function(){"use strict";var a,b=module.require("SimpleModal");a=Class.extend({present:function(a){var c,d=$("<div />"),e=$("<h2 />"),f=$("<p />"),g=$("<a />"),h=$("<a />");d.addClass("modalConfirm"),e.html(_t("CMSPUBS.HdgInternalPublicationModal")),d.append(e),f.html(_t("CMSPUBS.MsgInternalPublicationModal")),d.append(f),g.addClass("button noArrow"),g.html(_t("CMSPUBS.BtnInternalPublicationModalCancel")),g.on("click",function(a){a.preventDefault(),b.close()}),d.append(g),h.addClass("button noArrow"),h.html(_t("CMSPUBS.BtnInternalPublicationModalDownload")),h.click(function(d){d.preventDefault(),c.updateSettings({afterClose:a}),b.close()}),d.append(h),c=new b(d,!0),c.updateSettings({closeOnEscapeKey:!1,closeOnOverlayClick:!1,maxWidth:400}),c.open()}}),a.shouldBePresented=function(a){return a.parents(".internalPublication").length>0},module.define("InternalPubModal",a)}(),function(){"use strict";var a={aspectRatio:1.3,defaultColorScheme:"jw",colorSchemes:{kr:["#511a49","#855f80","#ad94aa"],jw:["#2d446b","#4a6da7","#829ecb"]}};module.define("Chart.Settings",a)}(),function(a){"use strict";var b,c=module.require("Chart.Settings");b=Class.extend({DEFAULT_OPTIONS:{animation:!1,responsive:!0,showTooltips:!0,legend:!0,legendBorders:!1,legendSpaceBeforeText:20,legendSpaceBetweenTextHorizontal:20,barValueSpacing:1,barDatasetSpacing:1,graphTitleFontFamily:"'Helvetica Light', Helvetica, 'Droid Sans', Arial, Arial Unicode MS, sans-serif",graphTitleFontSize:17,graphTitleFontColor:"#65605e",graphTitleFontStyle:"200",graphTitleTextAlign:"left",graphTitleSpaceBefore:10,graphTitleSpaceAfter:5,graphSpaceAfter:0,legendBordersSpaceAfter:0,xAxisLabelSpaceAfter:0,footNoteSpaceAfter:0,spaceBottom:0,scaleFontColor:"#8C8C8C",scaleFontSize:13,scaleGridLineColor:"#ECECEA",scaleLineColor:"#ECECEA",scaleFontFamily:"'Helvetica Light', Helvetica, 'Droid Sans', Arial, Arial Unicode MS, sans-serif",xAxisFontColor:"#65605e",xAxisFontSize:14,xAxisFontFamily:"'Helvetica Light', Helvetica, 'Droid Sans', Arial, Arial Unicode MS, sans-serif",yAxisFontColor:"#65605e",yAxisFontSize:14,yAxisFontFamily:"'Helvetica Light', Helvetica, 'Droid Sans', Arial, Arial Unicode MS, sans-serif",legendFontColor:"#65605e",legendFontFamily:"'Helvetica Light', Helvetica, 'Droid Sans', Arial, Arial Unicode MS, sans-serif",maxLabelWidth:125},COLOR_SCHEMES:c.colorSchemes,DEFAULT_COLOR_SCHEME:c.defaultColorScheme,init:function(a,b){this.elem=a,this.options=b},destroy:function(){this.elem.empty()},_createCanvas:function(){return $("<canvas/>")},create:function(){var b;this.$canvas=this._createCanvas(),this.elem.append(this.$canvas),b=this.$canvas.get(0),b.height=b.width/this.getAspectRatio(),this.ctx=b.getContext("2d"),this.chart=new a(this.ctx)[this.chartType](this.getData(),this.buildOptions())},getAspectRatio:function(){return c.aspectRatio?c.aspectRatio:2},getColor:function(a){var b=this.options.data.length,c=this.getColorScheme().slice(0,b);return c[a%c.length]},getColorScheme:function(){var a=this.DEFAULT_COLOR_SCHEME,b=this.options.style;return b&&b.colorScheme&&this.COLOR_SCHEMES[b.colorScheme]&&(a=b.colorScheme),this.COLOR_SCHEMES[a]},getDomainLabels:function(){var a,b,c,d,e,f,g,h;if(this.labels)return this.labels;if(a=this.options.domain||{},b=this.options.data[0].values.length,c=$.extend(!0,{},this.options,this.DEFAULT_OPTIONS),a.labels)return this.labels=this.isHorizontal()?a.labels.map(this._getWrapLabelFunction(c),this):a.labels,this.isRTL()&&this.labels.reverse(),this.labels;if(!_.has(a,"min")||!_.has(a,"max"))return[];if(!a.visibleTicks&&_.has(a,"ticks")&&(a.visibleTicks=a.ticks),e=a.ticks||b,d=Math.floor((a.max-a.min)/(e-1)),this.labels=_.range(a.min,a.max+1,d),a.visibleTicks){for(f=Math.ceil(e/a.visibleTicks),g=[],h=0;e>h;h++)g[h]=h%f===0?this.labels[h]:"";this.labels=g}return this.isRTL()&&this.labels.reverse(),this.labels},buildOptions:function(a){var b,c,d;return b=$.extend(!0,{},this.DEFAULT_OPTIONS,a),this.buildScale(b),d=this.options.style||{},c=d.layout||"vertical",d.thousandSeparator&&(b.thousandSeparator=d.thousandSeparator),this.options.chartTitle&&(b.graphTitle=this.wrap(this.options.chartTitle,this._getTitleFont(b))),_.has(this.options,"domain")&&_.has(this.options.domain,"title")&&("vertical"===c?b.xAxisLabel=this.options.domain.title:b.yAxisLabel=this.options.domain.title),_.has(this.options,"range")&&(this.options.range.hide&&(b.scaleShowLabels=!1),_.has(this.options.range,"title")&&("vertical"===c?b.yAxisLabel=this.options.range.title:b.xAxisLabel=this.options.range.title)),b.yAxisRight=this.isRTL(),b.yAxisLeft=!this.isRTL(),_.has(this.options,"valueLabels")&&this.options.valueLabels.length&&(b.valueLabels=this.options.valueLabels.map(this._getWrapLabelFunction(b),this),this.isHorizontal()&&b.valueLabels.reverse(),b.inGraphDataTmpl="<%= config.valueLabels[v12] %>",b.inGraphDataShow=!0),b},buildScale:function(a){var b,c=this.options.range;c&&_.isNumber(c.max)&&(a.scaleOverride=!0,_.isNumber(c.ticks)||(c.ticks=this.options.data[0].values.length),_.isNumber(c.min)||(c.min=0),this.isRTL()&&this.isHorizontal()&&(b=c.min,c.min=c.max,c.max=b),a.scaleStartValue=c.min,a.scaleStepWidth=Math.round((c.max-c.min)/(c.ticks-1)),a.scaleSteps=c.ticks-1)},isHorizontal:function(){return!1},isRTL:function(){return this.options?this.options.RTL:!1},wrap:function(a,b,c){var d,e,f,g,h,i,j,k=(a||"").split(""),l="";if(c=c||this.$canvas.width(),this._getTextWidth(a,b)>c)for(d=0,e=0,f=this._getWhitespaceCharactersRegex(),i=0,j=k.length;j>i;i++)g=i+1===j,(f.test(k[i])||g)&&(h=k.slice(d,g?i+1:i).join(""),this._getTextWidth(h,b)>c&&(e>d?(l+=k.slice(d,e+1).join("")+"\n",d=e+1):(l+=h+(g?"":"\n"),d=i+1)),g&&d!==j&&(l+=k.slice(d).join("")),e=i);return l.length?l:a},_getTextWidth:function(a,b){var c,d=this.ctx.font;return this.ctx.font=b,c=this.ctx.measureText(a).width,this.ctx.font=d,c},_getTitleFont:function(a){return a.graphTitleFontSize?(a.graphTitleFontStyle?a.graphTitleFontStyle+" ":"200 ")+(a.graphTitleFontSize?"12px ":a.graphTitleFontSize+" px ")+(a.graphTitleFontFamily?a.graphTitleFontFamily:"Arial"):this.ctx.font},_getLabelFont:function(a){return a.xAxisFontSize?(a.xAxisFontStyle?a.xAxisFontStyle+" ":"200 ")+(a.xAxisFontSize?"12px ":a.xAxisFontSize+" px ")+(a.xAxisFontFamily?a.xAxisFontFamily:"Arial"):this.ctx.font},_getWhitespaceCharactersRegex:function(){return/[\u0009\u0020\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2008\u2009\u200A\u3000\u180E\u200B\u200C\u200D]/},_getWrapLabelFunction:function(a){var b=this;return function(c){return c?b.wrap(c,b._getLabelFont(a),a.maxLabelWidth):c}}}),module.define("ChartBase",b)}(window.Chart),function(a){"use strict";var b,c=module.require("ChartBase");b=c.extend({create:function(){var b,c;c={graphSubTitleSpaceAfter:5,graphTitleSpaceAfter:5},this.$canvas=this._createCanvas(),this.elem.append(this.$canvas),b=this.$canvas.get(0),b.height=b.width/this.getAspectRatio(),this.ctx=b.getContext("2d"),this.options.data.length>1?this.isHorizontal()?this.chart=new a(this.ctx).HorizontalStackedBar(this.getData(),this.buildOptions()):this.chart=new a(this.ctx).StackedBar(this.getData(),this.buildOptions(c)):this.isHorizontal()?this.chart=new a(this.ctx).HorizontalBar(this.getData(),this.buildOptions()):this.chart=new a(this.ctx).Bar(this.getData(),this.buildOptions(c))},getData:function(){if(this.data)return this.data;var a=this;return this.data={},this.options.domain=this.options.domain||{},this.options.domain.ticks=this.options.data[0].values.length,this.data.labels=this.getDomainLabels(),!a.isRTL()&&this.isHorizontal()&&this.data.labels.reverse(),this.data.datasets=this.options.data.map(function(b,c){var d,e,f=_.clone(b.values);for(d=c-1;d>=0;d--)for(e=0;e<f.length;e++)f[e]=f[e]-a.options.data[d].values[e],a.options.data[d+1].values[e]=f[e];return(a.isRTL()||a.isHorizontal())&&f.reverse(),{title:b.label,fillColor:a.getColor(c),data:f}}),this.data},isHorizontal:function(){return this.options&&this.options.style&&"horizontal"===this.options.style.layout}}),module.define("Chart.Bar",b)}(window.Chart),function(){"use strict";var a,b,c=module.require("ChartBase");b={bezierCurve:!1,datasetFill:!1},a=c.extend({init:function(a,b){this._super(a,b),this.chartType="Line"},buildOptions:function(){return this._super(b)},getData:function(){var a,b,c,d,e,f,g;if(this.data)return this.data;if(a=this,this.data={},this.data.labels=this.getDomainLabels(),_.has(this.options,"domain"))_.has(this.options.domain,"min")&&(this.data.xBegin=this.options.domain.min),_.has(this.options.domain,"max")&&(this.data.xEnd=this.options.domain.max);else{if(b=Number.MAX_VALUE,c=Number.MIN_VALUE,d=this.options.data,_.isNaN(parseFloat(this.data.labels[0])))for(e=0;e<d.length;e++)for(f=0;f<d[e].values.length;f++)g=d[e].values[f][0],b=b>g?g:b,c=g>c?g:c;else b=_.min(this.data.labels,parseInt),c=_.max(this.data.labels,parseInt);this.data.xBegin=b,this.data.xEnd=c}return this.data.datasets=this.options.data.map(function(b,c){var d=_.clone(b.values),e=_.pluck(d,0);return a.isRTL()&&(e=_.map(e,function(b){return a.data.xBegin+(a.data.xEnd-b)})),{title:b.label,strokeColor:a.getColor(c),pointColor:a.getColor(c),data:_.pluck(d,1),xPos:e}}),this.data}}),module.define("Chart.Line",a)}(),function(){"use strict";var a,b,c=module.require("ChartBase");b={inGraphDataShow:!0,inGraphDataAnglePosition:2,inGraphDataRadiusPosition:2,inGraphDataAlign:"center",inGraphDataVAlign:"middle",inGraphDataFontColor:"white",inGraphDataTmpl:"<%=v6 + '%'%>"},a=c.extend({init:function(a,b){this._super(a,b),this.chartType="Pie"},buildOptions:function(){return this._super(b)},getData:function(){if(this.data)return this.data;var a=this;return this.options.data=this.options.data||[],this.data=this.options.data.map(function(b,c){return{title:b.label,color:a.getColor(c),value:b.values[0]}}),this.data}}),module.define("Chart.Pie",a)}(),function(){"use strict";var a,b=module.require("Chart.Pie");a=b.extend({init:function(a,b){this._super(a,b),this.chartType="Doughnut"},getData:function(){if(this.data)return this.data;var a=this;return this.options.data=this.options.data||[],this.data=this.options.data.map(function(b,c){return{title:b.label,color:a.getColor(c),value:b.values[0]}}),this.data}}),module.define("Chart.Doughnut",a)}(),function(){"use strict";var a,b,c=module.require("Chart.Line"),d=module.require("Chart.Bar"),e=module.require("Chart.Pie"),f=module.require("Chart.Doughnut");b={series:{"default":c,line:c},bar:{"default":d,stacked:d},proportional:{"default":e,doughnut:f,pie:e}},a=Class.extend({init:function(a,c,d){var e,f;if(_.has(b,a)){if(e=$.extend(!0,{style:{subType:"default"}},d),f=b[a][e.style.subType],_.isUndefined(f))throw new Error("Chart subType ("+e.style.subType+") does not exist");this.chart=new f($("#"+c),e)}},create:function(){this.chart&&this.chart.create&&this.chart.create()}}),module.define("Chart",a)}(),function(){"use strict";var a,b=module.require("settings"),c=module.require("signal"),d="PUBS_VIEW_MODE",e="gridView",f="listView",g="selected";a=Class.extend({init:function(a,b){this.gridViewButton=a,this.listViewButton=b,this.view=$(a.data("target"))},start:function(){this.bindEventHandlers(),this.enableDefaultMode()},getViewSettingLocation:function(){return this.gridViewButton.data("setting")||d},setViewSetting:function(a){$.persistentData(this.getViewSettingLocation(),a)},getViewSetting:function(){return $.persistentData(this.getViewSettingLocation())},bindEventHandlers:function(){var a=_.bind(this.selectListView,this);this.gridViewButton.on("click",_.bind(this.selectGridView,this)),this.listViewButton.on("click",a),c.listen("EnableAccessibilityMode",a)},enableDefaultMode:function(){var a=this.getViewSetting();a===f||b.getPageConfig("ACCESSIBILITY_MODE")?this.selectListView():(a===e,this.selectGridView())},selectListView:function(){this.setViewSetting(f),this.view.removeClass(e).addClass(f),this.gridViewButton.removeClass(g),this.listViewButton.addClass(g)},selectGridView:function(){this.setViewSetting(e),this.view.removeClass(f).addClass(e),this.gridViewButton.addClass(g),this.listViewButton.removeClass(g)}}),module.define("ListViewSwitcher",a)}(),function(){"use strict";var a;a=function(){this.index=0,this.url="",this.thumburl="",this.title="",this.caption="",this.zoomSrc=""},a.prototype={styleFlag:""},a.canParseFrom=function(a){return a.find(".jsSlideImage").length},a.fromElement=function(b,c){var d=new a,e=c.find(".jsSlideImage");return d.index=b,d.url=e.attr("src"),d.thumburl=c.data("thumbnail"),d.title=c.find(".jsSlideTitle").html(),d.caption=c.find(".jsSlideCaption").html(),d.zoomSrc=e.data("zoom")||d.url,d},module.define("GalleryImage",a)}(),function(){"use strict";var a;a=function(){this.index=0,this.jsonurl="",this.thumburl="",this.title="",this.caption="",this.posterImage=""},a.prototype={styleFlag:"hasVideo"},a.canParseFrom=function(){return!1},a.fromElement=function(){return new a},module.define("GalleryVideo",a)}(),function(){"use strict";var a,b=module.require("GalleryImage"),c=module.require("GalleryVideo"),d=[c,b];a=function(a){var b,c=this;this.currentIndex=0,this.currentPage=0,this.slides=a,b=function(){return this.index===c.currentIndex},_.each(this.slides,function(a){a.isSelected=b,a.selectedUpdateFlag=!1}),$(document).keydown(function(a){var b={};b[$.ui.keyCode.LEFT]=c.prevSlide,b[$.ui.keyCode.RIGHT]=c.nextSlide,b[a.which]&&(b[a.which].apply(c),a.preventDefault())})},a.prototype={setCurrentIndex:function(a){a=Math.max(a,0),a=Math.min(a,this.slides.length-1),this.currentIndex!==a&&(this.currentIndex=a,_.each(this.slides,function(a){a.selectedUpdateFlag=!a.selectedUpdateFlag}),this._trigger("currentIndex:update"))},nextSlide:function(){this.setCurrentIndex(this.currentIndex+1)},prevSlide:function(){this.setCurrentIndex(this.currentIndex-1)},on:function(a,b){$(this).on(a,b)},_trigger:function(a){$(this).trigger(a)},off:function(a,b){$(this).off(a,b)}},a.parseSlideData=function(a){var b,c=$(a).find(".jsSlide");return b=function(a){return _.find(d,function(b){return b.canParseFrom(a)})},_.chain(c).map(function(a,c){var d=$(a),e=b(d);return e?e.fromElement(c,d):null}).filter(_.identity).value()},a.fromElement=function(b){return new a(a.parseSlideData(b))},module.define("GalleryCollection",a)}(),function(){"use strict";var a,b=module.require("UIController");a=b.extend({TEMPLATE_NAME:null,interactionEnabled:!1,model:null,render:function(){this._draw()},willBeDestroyed:function(){},_injectHTML:function(a){this._super(a),this.trigger("lifecycle:injectHTML")}}),module.define("MediaGallerySlide",a)}(),function(){"use strict";var a,b,c=module.require("MediaGallerySlide"),d="drag",e="pinch",f=200;b=c.extend({TEMPLATE_NAME:"gallery/MediaGalleryImageSlide",preferredImageField:"url",container:null,image:null,wrap:null,imageOrigin:null,lastDragX:null,lastDragY:null,pinchStartingDistance:null,pinchStartingScale:null,disableDrag:!1,disableZoom:!1,scale:1,minScale:1,originX:0,originY:0,getPreferredImage:function(){return this.model[this.preferredImageField]},_injectHTML:function(a){var b=this,c=function(a){return b.html.find(a).addBack(a)};this.html=a,this.container=c(".jsSlideView"),this.wrap=c(".jsImageWrap"),this.image=c(".jsImageWrap img"),this.image.error(function(){b.trigger("load:error")}),this.image.load(function(){b.trigger("load:success")}),this.interactionEnabled&&(this.image.load(function(){b.imageOrigin={top:0,left:b.image.offset().left},b.__centerImage()}),this.__attachEventHandlers()),this._super(a)},__resetImageStateData:function(){this.scale=1,this.minScale=1,this.originX=0,this.originY=0,this.imageOrigin={top:0,left:this.image.offset().left}},__applyTransform:function(a,b,c){var d="scale(%s) translate(%spx, %spx)";b=Math.round(b),c=Math.round(c),d=d.format(a,b,c),this.wrap.css({"-webkit-transform":d,"-moz-transform":d,transform:d})},__applyTransformOrigin:function(a,b){var c="%spx %spx";a=Math.round(a),b=Math.round(b),c=c.format(a,b),this.wrap.css({"-webkit-transform-origin":c,"-moz-transform-origin":c,"transform-origin":c})},__attachEventHandlers:function(){function b(){d.off("release",b),a=null}var c=this,d=this.image.hammer(),e=this.__handleDrag.bind(this),f=this.__handleDragStart.bind(this),g=this.__handlePinch.bind(this),h=this.__handleTouchStart.bind(this),i=this.zoomIn.bind(this);d.on("touchstart",h),d.on("dragstart",f),d.on("drag",e),d.on("doubletap",i),d.on("pinch",g),d.on("pinch",function(){d.on("release",b)}),$(window).resize(function(){c.__centerImage()})},__centerImage:function(){this.__setImageLayout(1,0,0)},__getNominalSize:function(){var a=(this.image.width()+this.image.height())/2;return a},__handleDrag:function(b){if(b.preventDefault(),b.gesture&&!this.disableDrag&&(!a||a===d)){var c=b.gesture.deltaX-this.lastDragX,e=b.gesture.deltaY-this.lastDragY;this.lastDragX=b.gesture.deltaX,this.lastDragY=b.gesture.deltaY,this.__pan(c,e),a=d,setTimeout(function(){a=null},f)}},__handleDragStart:function(){this.lastDragX=0,this.lastDragY=0},__handlePinch:function(b){if(b.preventDefault(),!this.disableZoom){var c,d,f,g,h,i=b.gesture.touches,j=b.gesture.center.pageX-this.imageOrigin.left,k=b.gesture.center.pageY-this.imageOrigin.top,l=this.__getNominalSize();if(2===i.length&&(!a||a===e)){if(c=Math.abs(i[0].pageX-i[1].pageX)*this.scale,d=Math.abs(i[0].pageY-i[1].pageY)*this.scale,c=Math.pow(c,2),d=Math.pow(d,2),f=Math.sqrt(c+d),void 0===this.pinchStartingDistance)return void(this.pinchStartingDistance=f);g=f-this.pinchStartingDistance,h=(l+g)/l,h+=this.pinchStartingScale-1,this.__zoom(h,j,k),a=e}}},__handleTouchStart:function(a){a.preventDefault(),this.pinchStartingDistance=void 0,this.pinchStartingScale=this.scale},zoomIn:function(a){if(a.preventDefault(),!this.disableZoom){var b,c,d=this.scale+.5*this.scale;a.gesture?(b=a.gesture.center.pageX-this.imageOrigin.left,c=a.gesture.center.pageY-this.imageOrigin.top):(b=this.wrap.width()/2,c=this.wrap.height()/2),this.__zoomTo(d,b,c)}},zoomOut:function(a){if(a.preventDefault(),!this.disableZoom){var b=this.scale-.5*this.scale,c=this.wrap.width()/2,d=this.wrap.height()/2;this.__zoomTo(b,c,d)}},__pan:function(a,b){var c=this.originX,d=this.originY;c+=a,d+=b,this.__setImageLayout(this.scale,c,d)},__zoom:function(a,b,c){var d,e,f,g,h,i,j,k;a=Math.max(this.minScale,a),d=b-this.originX,e=c-this.originY,f=d/this.scale,g=e/this.scale,h=f*a,i=g*a,j=b-h,k=c-i,this.__setImageLayout(a,j,k)},__setImageLayout:function(a,b,c){a=Math.max(this.minScale,a),this.scale=a,this.originX=b,this.originY=c,this.__updateImageTransforms()},__updateImageTransforms:function(){this.__applyTransform(this.scale,this.originX,this.originY),this.__applyTransformOrigin(this.originX,this.originY)},__zoomTo:function(a,b,c){var d,e=10,f=1/e,g=this.scale,h=a-g,i=0,j=this;(d=function(){i++;var a=h*$.easing.swing(f*i);j.__zoom(a+g,b,c),e>i&&setTimeout(d,10)})()}}),module.define("MediaGalleryImageSlide",b)}(),function(){"use strict";var a,b=module.require("settings"),c=module.require("MediaGallerySlide"),d=module.require("PubMediaResource"),e=module.require("VideoModal");a=c.extend({TEMPLATE_NAME:"gallery/MediaGalleryVideoSlide",__throttledVideoConstrainer:null,model:null,willBeDestroyed:function(){this._super(),$(window).off("resize",this.__throttledVideoConstrainer)},_injectHTML:function(a){this._super(a);var c=this.html.find(".jsVideoContainer").addBack(".jsVideoContainer"),f=new d(this.model.jsonurl),g=new e(f),h=this;f.setPosterImage(b.getSetting("VIDEO_BLANK_POSTER")),g.open(function(a){a=$(a),a.find("div.videoModal").addClass("embeddedVideo"),c.replaceWith(a),a.addClass("videoContainer"),h.__throttledVideoConstrainer=_.throttle(h._constrainVideo,100),$(window).on("resize",h.__throttledVideoConstrainer),h._constrainVideo()})},_constrainVideo:function(){var a=1.6,b=$(".jsSlideContainer"),c=b.width()/b.height()>a;c?$(".galleryVideoWrapper").addClass("jsShortVideo"):$(".galleryVideoWrapper").removeClass("jsShortVideo")}}),module.define("MediaGalleryVideoSlide",a)}(),function(){"use strict";var a,b=module.require("UIController"),c=module.require("settings"),d=window.sprintf,e=module.require("MediaGalleryImageSlide"),f=module.require("MediaGalleryVideoSlide"),g=module.require("GalleryVideo");a=b.extend({TEMPLATE_NAME:"gallery/MediaGallery",dataSource:null,preferredImageField:"url",currentSlide:null,carouselTransitionSpeed:500,containerElement:null,lookupScope:null,windowResizedFlag:-1,_onSelectedIndexUpdate:function(){},_onWindowResize:function(){},init:function(a,b){this.containerElement=a,this.lookupScope=a,this.dataSource=b},render:function(){this._draw()},bindEvents:function(){var a=this;$(window).resize(function(){a.windowResizedFlag=1===a.windowResizedFlag?2:1}),this._onSelectedIndexUpdate=function(){a.scrollCarouselToCurrent(!0),a.lookupScope.find(".jsCaptionContainer").each(function(a,b){var c=function(){$(b).scrollTop(0),$(b).off("didShow",c)};c(),$(b).is(":hidden")&&$(b).on("didShow",c)}),a.updateSlide()},this.dataSource.on("currentIndex:update",this._onSelectedIndexUpdate)},unbindEvents:function(){this.dataSource.off("currentIndex:update",this._onSelectedIndexUpdate),$(window).off("resize",this._onWindowResize),this.currentSlide&&this.currentSlide.willBeDestroyed()},_injectHTML:function(a){this._super(a),this.containerElement&&this.containerElement.append(a),this.bindEvents()},_onFirstRender:function(){this.trigger("firstRender:post"),this.prepareForDisplay()},prepareForDisplay:function(){this.scrollCarouselToCurrent(!1),this.windowResizedFlag=0,this.updateSlide()},updateSlide:function(){var a=this,b=this.createSlide(this._currentSlideData()),c=this.lookupScope.find(".jsSlideContainer").first();this.currentSlide&&this.currentSlide.willBeDestroyed(),this.currentSlide=null,b.preferredImageField=this.preferredImageField,b.on("lifecycle:injectHTML",function(){c.append(b.html),a.currentSlide=b,a.slideWasUpdated(),a.trigger("slide:rendered")}),b.on("load:success",function(){a.trigger("contentLoad:success")}),c.empty(),b.render()},createSlide:function(a){var b;return b=a instanceof g?new f:new e,b.model=a,b},slideWasUpdated:function(){},currentCaption:function(){return this._currentSlideData().caption},currentTitle:function(){return this._currentSlideData().title},currentIndexLabel:function(){return d(_t("CMSPUBS.LblImageOf"),this._currentSlideData().index+1,this.dataSource.slides.length)},_currentSlideData:function(){return this.dataSource.slides[this.dataSource.currentIndex]},goToFirstSlide:function(){this.dataSource.setCurrentIndex(0),this._scrollToPage(0,0)},nextSlide:function(a,b){b.controller.dataSource.nextSlide(),a.preventDefault()},prevSlide:function(a,b){b.controller.dataSource.prevSlide(),a.preventDefault()},nextPage:function(a,b){var c=b.controller;c._scrollToPage(c.dataSource.currentPage+1)},prevPage:function(a,b){var c=b.controller;c._scrollToPage(c.dataSource.currentPage-1)},scrollCarouselToCurrent:function(a){var b=0;(a===!0||void 0===a)&&(b=this.carouselTransitionSpeed),this._scrollToPage(this._carouselPageForItem(this.dataSource.currentIndex),b)},_scrollToPage:function(a,b){if(a=Math.max(a,0),a=Math.min(a,Math.max(this._carouselPageCount()-1,0)),a=isNaN(a)?0:a,isFinite(a)){this.dataSource.currentPage=a;var c=a*this._carouselPageOfItemsWidth();c=-c,this._moveCarouselToOffset(c,b)}},_moveCarouselToOffset:function(a,b){var d,e,f;this.lookupScope&&(d="left",e={},e.left=a,c.getSetting("IS_RTL")&&(d="right",e.right=a),f=this.lookupScope.find(".jsGalleryCarouselContent"),a!==parseInt(f.css(d))&&(void 0===b&&(b=this.carouselTransitionSpeed),f.stop(!0,!0),f.animate(e,b)))},_carouselItemsPerPage:function(){var a,b;if(this.lookupScope)return a=this.lookupScope.find(".jsGalleryCarouselContainer").outerWidth(),b=this.lookupScope.find(".galleryItem").outerWidth(),Math.floor(a/b)},_carouselPageOfItemsWidth:function(){if(this.lookupScope){var a=this.lookupScope.find(".galleryItem").outerWidth();return Math.floor(this._carouselItemsPerPage()*a)}},_carouselPageForItem:function(a){return Math.floor(a/this._carouselItemsPerPage())},_carouselPageCount:function(){return Math.ceil(this.dataSource.slides.length/this._carouselItemsPerPage())},isPrevNavDisabled:function(){return 0===this.dataSource.currentIndex},isNextNavDisabled:function(){return this.dataSource.currentIndex===this.dataSource.slides.length-1},isPrevCarouselDisabled:function(){return this.dataSource.currentPage<=0},isNextCarouselDisabled:function(){return this.dataSource.currentPage>=this._carouselPageCount()-1}}),module.define("MediaGallery",a)}(),function(){"use strict";var a,b=module.require("SimpleModal"),c=module.require("DialogUtils"),d=module.require("MediaGallery");a=d.extend({TEMPLATE_NAME:"gallery/MediaGalleryModal",preferredImageField:"zoomSrc",modal:null,zoomInAction:function(){},zoomOutAction:function(){},init:function(a){var b=$(document),c=this;this.dataSource=a,b.on("keypress",null,"+",function(a){c.zoomInAction(a)}),b.on("keypress",null,"-",function(a){c.zoomOutAction(a)})},open:function(){this.lookupScope=null,this.trigger("open:pre"),this._draw()},_injectHTML:function(a){var c=this;this._super(a),this.lookupScope=a,this.zoomInButton=a.find(".jsZoomIn"),this.zoomOutButton=a.find(".jsZoomOut"),this.modal=new b(a,!0),this.modal.open(),this.__attachEventHandlers(),this.modal.updateSettings({beforeClose:function(){c.trigger("close:pre"),c.unbindEvents()}})},createSlide:function(a){var b=this._super(a);return b.interactionEnabled=!0,b},slideWasUpdated:function(){if(this.__slideAllowsZoom()){var a=this.currentSlide.zoomIn.bind(this.currentSlide),b=this.currentSlide.zoomOut.bind(this.currentSlide);this.zoomInButton.off(),this.zoomOutButton.off(),this.zoomInButton.click(a),this.zoomOutButton.click(b),this.zoomInAction=a,this.zoomOutAction=b}this.__updateInteractionState()},currentCaption:function(){var a=this._super(),b=$("<div />");return b.html(a),c.addSourceFlags(b,"galleryDialog"),b.html()},__attachEventHandlers:function(){var a=this;this.lookupScope.find(".jsGalleryCaptionCloseBtn").click(function(b){a.toggleCaptionOverlay(),b.preventDefault()}),this.lookupScope.find(".jsGalleryCaptionBtn").click(function(b){a.toggleCaptionOverlay(),b.preventDefault()}),$(window).resize(function(){a.__updateInteractionState()})},toggleCaptionOverlay:function(){this.lookupScope.find(".jsGalleryCaptionOverlay").hasClass("jsHideCaption")?(this.lookupScope.find(".jsGalleryCaptionOverlay").removeClass("jsHideCaption"),this.lookupScope.find(".jsCaptionContainer").each(function(a,b){$(b).trigger("didShow")})):this.lookupScope.find(".jsGalleryCaptionOverlay").addClass("jsHideCaption"),this.__updateInteractionState()},__updateInteractionState:function(){!this.lookupScope.find(".jsGalleryCaptionOverlay").hasClass("jsHideCaption")&&this.__mobileStatusBarIsShowing()?(this.disableDrag=!0,this.disableZoom=!0):(this.disableDrag=!1,this.disableZoom=!this.__slideAllowsZoom())},__slideAllowsZoom:function(){return this.currentSlide.zoomIn&&this.currentSlide.zoomOut},__mobileStatusBarIsShowing:function(){return"block"===this.lookupScope.find(".jsGalStatusBar").css("display")}}),module.define("MediaGalleryModal",a)}(),function(){"use strict";var a,b=module.require("UIController"),c=module.require("Bible"),d=".navLinkNext:not(.disabled) a",e=".navLinkPrev:not(.disabled) a";a=b.extend({init:function(a){this.updateContainer(a),this.state={}},updateContainer:function(a){this.container=a},_buildStateContext:function(){return this.state},_injectHTML:function(a){this.html=a,this._showInContainer()},_showInContainer:function(){this.container.empty().append(this.html)},updatePrevNextLinks:function(a){if(a&&this.container){var b=this.container.find(e),c=this.container.find(d);a.hasPrevious&&this.updateLink(b,a.previous),a.hasNext&&this.updateLink(c,a.next),this.state.hasPrevious=a.hasPrevious,this.state.hasNext=a.hasNext}},updateLink:function(a,b){b.isBibleBook?a.attr("class","jsBibleBook").data("book",b.id).data("chapter",null):b.isBibleChapter?a.data("book",b.bookID).data("chapter",b.id).attr("class","jsBibleChapter").addClass(b.pageCSSClassNames):a.data("page-id",b.id).attr("class","jsBibleNavigation").addClass(b.pageCSSClassNames).addClass("pubSym-%s".format(c.PUB_SYMBOLS.NWTSTY)),a.attr("title",b.title),a.attr("href",b.url||"#")}}),module.define("Page",a)}(),$(function(){"use strict";function a(){return e.getSetting("IS_SMALL_LAYOUT")}function b(a){if(!a||!a.length)return 0;var b=0;return $(a).each(function(){b+=$(this).outerHeight(!0)}),b}function c(){var c,d,e=$(window).height(),f=0,g=a();$(".jsLockedChrome").filter(":visible").each(function(){f+=$(this).outerHeight(!0)}),c=e-f,$(".jsLockedContainer").each(function(){var a=c;d=$(this),a+=b(d.data("add-height")),a-=b(d.data("sub-height")),g&&(a+=b(d.data("mobile-add-height")),a-=b(d.data("mobile-sub-height"))),d.css("height",a)})}var d=module.require("signal"),e=module.require("settings");$(".jsLockedContainer").length&&($("html").addClass("jsLockedHeight"),$("#mobileNavTopBar").addClass("jsLockedChrome"),c(),d.listen("DOMReady",c),$(window).resize(_.throttle(c,100)),$("#regionMain").on("scroll",function(){$(this).scrollTop(0)}))}),function(){"use strict";var a={},b=module.require("settings");a.create=function(a){var c,d=b.getPageConfig("FINDER_BASE_LINK");return d="?"===d.substring(d.length-1)?d:d+"?",c=d+$.param(a)},module.define("FinderLink",a)}(),function(){"use strict";var a,b=module.require("Page"),c=module.require("signal"),d="sqr";a=b.extend({TEMPLATE_NAME:"MediaPage",init:function(a,b){this.updateContainer(a),this.state={bible:this._formatForDisplay(b)||{}}},draw:function(a){var b=this.drawn?this._redraw():this._draw(),d=this;return this.drawn&&(b=b.then(_.bind(this._showInContainer,this))),this.drawn=!0,b.then(function(){d.updatePrevNextLinks(a),c.send("DOMReady")})},setBible:function(a){a=this._formatForDisplay(a),this.state.bible=_.extend(this.state.bible,a||{})},_formatForDisplay:function(a){if(!a)return null;var b=function(a){var b=_.findWhere(a.images,{type:d});return b&&b.sizes?(b.src=_.chain(b.sizes).values().first().value(),void(a.image=b)):void(a.image=!1)};return _.each(a.greek,b),_.each(a.hebrew,b),a}}),a.HASH_URL="media",a.PAGE_ID="MediaPage",a.PAGE_TITLE=_t("CMSPUBS.HdgMedia"),module.define("MediaPage",a)}(),function(){"use strict";var a,b=module.require("Page"),c=".navLinkPrev",d=".navLinkNext";a=b.extend({onPageLoad:function(a){this.updatePrevNextLinks(a)},updatePrevNextLinks:function(a){if(a&&this.container){var b=this.container.find(c),e=this.container.find(d);a.hasPrevious?(_.each(b,_.bind(this.wrapLink,this)),this.updateLink(b.find("a"),a.previous)):this.unwrapLink(b),
a.hasNext?(_.each(e,_.bind(this.wrapLink,this)),this.updateLink(e.find("a"),a.next)):this.unwrapLink(e)}},wrapLink:function(a){if(a=$(a),a.is(".disabled")){var b=a.children(),c=$('<a href="#"></a>');c.html(b),a.html(c),a.removeClass("disabled")}},unwrapLink:function(a){a=$(a),a.is("disabled")||a.addClass("disabled").find("a").children().unwrap()}}),module.define("AdditionalPage",a)}(),function(){"use strict";var a,b,c=module.require("UIController"),d=module.require("settings"),e=module.require("signal"),f="StudyBible:changeChapter",g="StudyBible:changePage",h="StudyBible:changeBook",i="StudyBible:noChange",j=".sbJumperPanel",k=".sbJumperViews",l="open",m="closed",n=250;b=c.extend({TEMPLATE_NAME:"BibleJumper",init:function(a,b){this.state=a,this.state.selectedBook=a.selectedBook||this.getUnselectedBook(),this.state.selectedChapter=a.selectedChapter||this.getUnselectedChapter(),this.bookIndex=a.bookIndex,this.container=b},draw:function(){var a=this;return this._draw().then(function(){a.selectPageLocation(),e.send("DOMReady")})},open:function(){var a,b=this.container.find(j);d.getSetting("IS_MOBILE_LAYOUT")?(a={left:"0px"},b.css({opacity:1})):(a={opacity:1},b.css({left:"0px"})),b.removeClass(m).addClass(l).animate(a,n,"swing"),this.previousBook=this.getSelectedBook(),this.previousChapter=this.getSelectedChapter(),this._listenForResize(),this.setHeight(),this._openModalOverlay()},_listenForResize:function(){this._onResize=_.throttle(_.bind(this.setHeight,this),200),$(window).on("resize",this._onResize)},setHeight:function(){var a=$(document).height(),b=this.container.find(j);b.css({height:a-b.offset().top})},close:function(a){var b,c=this.container.find(j),e=-c.width()-80;b=d.getSetting("IS_MOBILE_LAYOUT")?{left:e+"px"}:{opacity:0},c.animate(b,n,"swing",function(){$(this).removeClass(l).addClass(m).css({left:e+"px",opacity:0})}),this._closeModalOverlay(),this._unbindEvents(),a&&(this.setSelectedBook(this.previousBook),this.setSelectedChapter(this.previousChapter))},_createModalOverlay:function(){a||(a=$("<div/>").addClass("jsSimpleModalOverlay").on("click",_.bind(this.close,this,!0)).appendTo("body"))},_openModalOverlay:function(){a||this._createModalOverlay(),a.animate({opacity:.5},n)},_closeModalOverlay:function(){a&&a.animate({opacity:0},n,function(){$(this).remove(),a=null})},getPageBookNum:function(){var a=$("article").data("booknum");return a?parseInt(a,10):null},getPageChapter:function(){var a=$("article").data("chapter");return a?""+a:null},getPageID:function(){return $("body").attr("id")},getUnselectedBook:function(){return{hasChapters:!1,hasAudio:!1,isPlaceholder:!0}},getUnselectedChapter:function(){return{id:null,title:null,isPlaceholder:!0}},selectBook:function(a,b,c){(this.getSelectedBookID()!==a||b)&&(this.setSelectedBookID(a),b?this.selectChapter(null):this.setSelectedChapter(null),(this.getSelectedBook()!==this.getUnselectedBook()||b)&&(!this.isBibleBookSelected()&&!this.selectedBookHasChapters()||b)&&e.send(g,{page:this.getSelectedBook(),hashLocation:c}))},getSelectedBookID:function(){return this.state.selectedBook?this.state.selectedBook.id:null},setSelectedBookID:function(a){this.setSelectedBook(this.findBook(a)||this.getUnselectedBook())},setSelectedBook:function(a){this.state.selectedBook=a||this.getUnselectedBook(),e.send(h,{book:this.state.selectedBook})},getSelectedBook:function(){return this.state.selectedBook},isSelectedBookID:function(a){var b=this.getSelectedBookID();return a=a?a.toString():a,b=b?b.toString():b,a===b},selectedBookHasChapters:function(){return this.getSelectedBook()&&this.getSelectedBook().hasChapters},selectChapter:function(a,b){(_.isNumber(a)||_.isString(a))&&(a=this.findChapter(a)),a&&this.getSelectedChapter().id===a.id||(this.setSelectedChapter(a),a?a.isBibleChapter?e.send(f,{book:this.getSelectedBook(),chapter:a.id,verseRange:b}):e.send(g,{page:a}):e.send(f,{book:this.getSelectedBook(),chapter:null,verseRange:b}))},findChapter:function(a,b){var c,d=b||this.getSelectedBook();return d&&(d.chapters||d.additionalPages)?(a=_.isNumber(a)?a.toString():a,c=(d.chapters||[]).concat(d.additionalPages),_.find(c,function(b){return b.id===a})):null},setSelectedChapter:function(a){this.state.selectedChapter=a||this.getUnselectedChapter()},getSelectedChapter:function(){return this.state.selectedChapter},getSelectedChapterID:function(){return this.state.selectedChapter?this.state.selectedChapter.id:null},isSelectedChapterID:function(a){var b=this.getSelectedChapterID();return a=a?a.toString():a,b=b?b.toString():b,a===b},isBibleBookSelected:function(){return this.state.selectedBook&&this.state.selectedBook.isBibleBook},findBook:function(a){return this.bookIndex?this.bookIndex[a]:null},openBookSelector:function(){this.chapterView.hide(),this.booksView.show(),this.pointer.css({left:this.selectedBookButton.position().left+20}),this.container.find(k).scrollTop(0)},openChapterSelector:function(){this.booksView.hide(),this.chapterView.show(),this.pointer.css({left:this.selectedChapterButton.position().left+this.selectedChapterButton.width()/2}),this.container.find(k).scrollTop(0)},_buildStateContext:function(){return this.state},_injectHTML:function(a){this.selectedBookButton=a.find(".sbJumperBook"),this.selectedChapterButton=a.find(".sbJumperChapter"),this.booksView=a.find("#sbJumperBooks"),this.chapterView=a.find("#sbJumperChapters"),this.pointer=a.find(".triangle"),this._bindEvents(),this.container.empty().append(a)},_bindEvents:function(){var a="%s .bibleBook, %s .bibleAdditionalPage".format(j,j),b="%s .chapter, %s .bookAdditionalPage".format(j,j);$(document).on("click",a,_.bind(this.onSelectBook,this)).on("click",b,_.bind(this.onSelectChapter,this)).on("click","#jumperShelf .close",_.bind(this.close,this,!0))},_unbindEvents:function(){$(window).off("resize",this._onResize)},onOpenSelectBook:function(a,b){var c=b.controller;a.preventDefault(),c.open(),c.openBookSelector()},onOpenSelectChapter:function(a,b){var c=b.controller;a.preventDefault(),$(a.currentTarget).hasClass("inactive")||(c.open(),c.openChapterSelector())},onSelectBook:function(a){var b=$(a.currentTarget).attr("data-book-id");a.preventDefault(),this.selectBook(b),this.isBibleBookSelected()||this.selectedBookHasChapters()?this.openChapterSelector():this.close()},onSelectChapter:function(a){var b=$(a.currentTarget).attr("data-chapter-id");a.preventDefault(),this.close(),this.selectChapter(b)},onBack:function(a,b){a.preventDefault(),b.controller.openBookSelector()},hasSelectedBook:function(){return!!this.getSelectedBook()&&this.getSelectedBook().title},selectPageLocation:function(){var a,b,c=this.getPageBookNum();c?(this.setSelectedBookID(c),b=this.findChapter(this.getPageChapter()),this.setSelectedChapter(b)):(a=this.getBookAndChapter(this.getPageID()),this.setSelectedBook(a.book),this.setSelectedChapter(a.chapter))},navigateToPage:function(a,b,c){var d=this.getBookAndChapter(a),e=d.book,f=d.chapter;return e||f?(this.isSelected(e,f)||(this.selectBook(e?e.id:null,!f&&b,c),this.selectChapter(f)),!0):!1},isSelected:function(a,b){var c=a?a.id:null,d=b?b.id:null;return c===this.getSelectedBookID()&&d===this.getSelectedChapterID()},getBookAndChapter:function(a){var b,c,d=_.keys(this.bookIndex);for(c=0;c<d.length;c++)if(b=this._findBookAndChapter(this.bookIndex[d[c]],a),b.book||b.chapter)return b;return{}},_findBookAndChapter:function(a,b){var c;return a.id===b?{book:a}:(c=this.findChapter(b,a),c?{book:a,chapter:c}:{})},findPage:function(a){var b=this.getBookAndChapter(a),c=b.book,d=b.chapter;return d?d:c},getState:function(){return{book:this.getSelectedBookID(),chapter:this.getSelectedChapterID()}},restoreState:function(a){if(a){var b=a.book===this.getSelectedBookID(),c=a.chapter===this.getSelectedChapterID(),d=!!a.book&&!a.chapter,f=b&&c;f&&e.send(i),this.selectBook(a.book,d&&!f),this.selectChapter(a.chapter)}},getSelectedPage:function(){var a=this.getSelectedChapter();return a&&!a.isPlaceholder?a:this.getSelectedBook()}}),module.define("BibleJumper",b)}(),function(){"use strict";var a,b=module.require("MediaPage"),c=module.require("insight"),d=1001070103;a=Class.extend({updateAnalytics:function(a,b,d){var e=this.buildPageID(b,d);c.updateAnalytics(a,e)},buildPageID:function(a,c){var d=!!a&&!a.isPlaceholder,e=!!c&&!c.isPlaceholder,f=d&&e&&a.isBibleBook&&c.isBibleChapter,g=!d&&!e,h=d&&a.id===b.PAGE_ID,i=d&&a.isBibleBook&&!e,j=d&&!a.isBibleBook&&!e,k=d&&e&&!c.isBibleChapter;return f?this.buildChapterPageID(a.id,c.id):g?this.getBibleReadingPageID():h?"%s-Page:MediaChooseBook".format(this.getBibleReadingPageID()):i?"%s-Book:%s-Page:BookLanding".format(this.getBibleReadingPageID(),a.id):j?a.id:k?c.id:void 0},buildChapterPageID:function(a,b){var c,d="";return c={Book:a,Chapter:b},a&&!b&&(c.Page="BookLanding"),_.each(c,function(a,b){a&&(d+="-%s:%s".format(b,a))}),"%s%s".format(this.getBibleReadingPageID(),d)},getBibleReadingPageID:function(){return"mid%s".format(d)},trackMediaGalleryOpen:function(a,b){if(b){var d="%s-Book:%s-Page:MediaGallery".format(this.getBibleReadingPageID(),b);c.updateAnalytics(a,d)}}}),module.define("StudyBibleInsight",a)}(),function(){"use strict";var a,b=module.require("UIController"),c=module.require("BibleVerseRangeCollection"),d=module.require("BibleVerseRangeRenderer"),e=module.get("ScrollHelper"),f=module.get("Navigation"),g=module.require("settings"),h=module.require("signal"),i=".readingPane";a=b.extend({TEMPLATE_NAME:"DefaultView",init:function(a,b){this.container=a,this.bookIndex=b||{},this.state={selectedRanges:[],url:!1}},_buildStateContext:function(){return this.state},_injectHTML:function(a){return this.html=a,this.container.empty().append(a),this.html},selectVerseRange:function(a){var b=new c(a,g.getPageConfig("PREFERRED_BIBLE")),e=new d(b);return this.clearContent(),this.lastPageID=null,e.render(!0).then(_.values).then(_.bind(this._selectRanges,this))},_selectRanges:function(a){var b=this.state.selectedRanges,c=this;b.length=0,b.push.apply(b,_.map(a,function(a){return a.hasBook=!!c.bookIndex[a.startBook],a}))},draw:function(a){return this.container=a||this.container,this._draw().then(_.bind(this.clearContent,this))},clearContent:function(){this.html.find(".jsContentContainer").empty(),this.state.selectedRanges=[],this.state.url=!1,this.lastPageID=null,this.state.pageCSSClasses=""},showContent:function(a,b,c){if(a){if(a.id===this.lastPageID)return void this._scrollToHash(c||"");var d,e=this,g="%s article".format(i);return d="#accessibilitySettingControl, .jsViewportPinWrapper, .articleFooterLinks, #copyright, .bibleNav",this.clearContent(),this.state.url=a.url,this.state.title=a.title,this.state.pageID=a.id,this.state.pageLinkClasses=b,this.state.pageCSSClasses=a.pageCSSClassNames||"",f.getHTML(a.url,g).then(function(b){b.find(d).remove(),e.html.find(".jsContentContainer").html(b.children()),e.lastPageID=a.id,e._scrollToHash(c||""),h.send("DOMReady")})}},selectPubLink:function(a,b,c){a===this.lastPageID?this._scrollToHash(b):c&&c()},_scrollToHash:function(a){var b,c=this.html.is(".jsLockedContainer")?this.html:this.html.find(".jsLockedContainer"),d=a.replace(/[^#]+#?/,"");d.length&&(b=this.html.find("#%s".format(d)),e.scrollTo(c,b))}}),module.define("DefaultView",a)}(),function(){"use strict";var a,b="114",c=module.get("Navigation"),d=module.require("DialogUtils"),e=module.require("signal"),f=".readingPane";a=Class.extend({draw:function(a,b,g){if(!b||!g)return $.when(!1);var h,i=this.findOverview(b,g),j="%s article".format(f),k=this;return i?(h="#accessibilitySettingControl, .jsViewportPinWrapper, .articleFooterLinks, #copyright, .bibleNav",c.getHTML(i.url,j).then(function(b){var c=k._getTemplate(b.children());c.find(h).remove(),a.empty().append(c),d.addSourceFlags(a,"panelDialog"),e.send("DOMReady")})):$.when(!1)},_getTemplate:function(a){var b=$('<div class="jsLockedContainer"></div>'),c=$('<div class="studyContainer"></div>');return b.data("mobile-add-height",".sbNavBar.jsLockedChrome"),c.html(a),b.html(c)},findOverview:function(a,c){var d=a.bookIndex[c];return d?_.find(d.additionalPages,function(a){return a.docClass===b}):null}}),module.define("OverviewView",a)}(),function(){"use strict";var a,b=module.require("Page"),c=module.require("settings"),d=module.require("FinderLink"),e=module.require("signal"),f=module.require("Bible"),g=module.require("url"),h=1001070103;a=b.extend({TEMPLATE_NAME:"ChapterPage",init:function(a,b){this.state={chapter:{}},this.updateContainer(a),b&&this.setChapter(b)},setChapter:function(a){this.html&&this.html.remove(),this.state={chapter:a},this.state.mailToLink=this.buildMailToLink(a)},buildMailToLink:function(a){if(a){var b,c="mailto:?body=%s%0a%0a%s%26&subject=%s",e=encodeURIComponent(this._decodeHTMLEntities(a.citation));return b=d.create({prefer:"content",docID:h,Book:a.bookID,Chapter:a.id,srcid:"share"}),c.format(e,encodeURIComponent(b),e)}},_decodeHTMLEntities:function(a){return $("<p></p>").html(a).text()},show:function(a,b,c,d){return this.setChapter(a),this.state.bookID=b,this.state.bookName=c,this.state.pubSymbol=d,this.state.chapter.audioURL=this.getAudioURL(),this.draw().then(function(){e.send("DOMReady")})},draw:function(){var a=this;return this._draw().then(function(){a.replaceXrefCharacters(a.state.chapter.crossReferences),a._overrideDefaultPageBehaviors(),a.updatePrevNextLinks(a.state.chapter)})},_overrideDefaultPageBehaviors:function(){this.container.find(".verseNum a, .chapterNum a").addClass("jsHighlightOnly"),this.container.find(".footnoteLink").addClass("jsNoDialog"),this.state.bookID&&this.container.find(".jsMediaPlayer").data("jsonurl",this.getAudioURL())},replaceXrefCharacters:function(a){var b,c,d;a&&a.length&&(b=_.indexBy(a,"id"),this.container.find(".xrefLink").each(function(){c=$(this),d=c.attr("id").replace(/[a-zA-Z]/g,""),b[d]&&c.html(b[d].referenceCharacter)}))},getAudioURL:function(){var a,b=c.getPageConfig("BIBLE_AUDIO_DATA_API");return b?(a=g.parse(b),a.query=_.extend(a.query||{},{pub:f.PUB_SYMBOLS.NWT,booknum:this.state.bookID,track:this.state.chapter.id}),g.build(a)):null}}),module.define("ChapterPage",a)}(),function(){"use strict";var a,b=module.require("BibleVerseRangeCollection"),c=module.require("BibleVerseRangeRenderer"),d=module.require("BibleVerseRange"),e=module.require("settings");a=Class.extend({fetched:!1,init:function(a){this.id=a.id,this.sourceVsID=a.sourceVsID,this.sourceCitation=a.sourceCitation,this.referenceCharacter=a.referenceCharacter,this.verses=_.map(a.targets,_.clone),this.targetVerses=b.toVerseRangeString(_.pluck(this.verses,"vs")),this.abbreviatedCitations=d.createCitation(this.verses,!0),this.pubSymbol=e.getPageConfig("PREFERRED_BIBLE")},fetch:function(){if(this.fetched)return $.when(!1);this.fetched=!0;var a=new b(this.targetVerses,this.pubSymbol),d=new c(a);return d.render(!0).then(_.bind(this._parseVerses,this)).then(function(){return!0})},_parseVerses:function(a){_.each(a,_.bind(this._updateVerse,this))},_updateVerse:function(a,b){var c=_.find(this.verses,function(a){return a.vs===b});c&&(c.content=a.content)}}),module.define("MarginalReference",a)}(),function(){"use strict";var a,b=module.require("UIController"),c=module.require("settings"),d=module.require("DialogUtils"),e=module.get("ScrollHelper"),f=c.getSetting("HIGHLIGHT_CLASS");a=b.extend({selected:!1,scrollPosition:0,init:function(a){this.state={chapter:this.getDefaultChapter()},a&&this.updateChapter(a)},setContainer:function(a){this.container=a},setSelected:function(a){this.selected=a,this[a?"onSelected":"onDeselected"]()},onSelected:function(){this.scrollToLastPosition()},onDeselected:function(){},_buildStateContext:function(){return this.state},_injectHTML:function(a){return d.addSourceFlags(a,"panelDialog"),this.html=a,this.container.append(a),this.html.on("tab:selected",_.bind(this.setSelected,this,!0)),this.html.on("tab:deselected",_.bind(this.setSelected,this,!1)),this.html},show:function(){this.html&&(this.html.trigger("tab:select"),this.html.addClass("current"),this.setSelected(!0))},draw:function(){return this._draw()},updateChapter:function(a){this.html&&this.html.remove(),this.state={chapter:this.toChapterFormat(a)}},toChapterFormat:function(){return{}},getDefaultChapter:function(){return{verses:[]}},getCurrentChapter:function(){return this.state.chapter||this.getDefaultChapter()},selectVerse:function(){},selectFootnote:function(){},selectBibleData:function(a,b,c){var d=a.format(b),e=this.html.find(d);return this.clearHighlights(),this.highlight(e),this.isSelected()&&e.is(":visible")&&!c&&this.scrollTo(e),e},selectCrossReference:function(a){var b=".xRef%s".format(a),c=this.html.find(b),d=c.find(".jsExpandCollapse"),e=d.data("collapseaction");this.isSelected()&&(d.each(function(){var a=$(this);a.hasClass(e)||a.click()}),this.scrollTo(c))},clearHighlights:function(){this.html.find("."+f).removeClass(f)},scrollTo:function(a){var b=this.container.closest(".jsLockedContainer"),c=this.container.find(".tabControls").height();e.scrollTo(b,a,a instanceof jQuery?-c:0),this.setLastScrollPosition(a)},onFetchReference:function(a,b){a.preventDefault(),b.reference&&b.reference.fetch()},isSelected:function(){return this.selected},setLastScrollPosition:function(a){this.scrollPosition=a},clearLastScrollPosition:function(){this.scrollPosition=0},scrollToLastPosition:function(){this.scrollTo(this.scrollPosition)},highlight:function(a){a.addClass(f)},clearHighlight:function(a){a.removeClass(f)},isHighlighted:function(a){return a.hasClass(f)}}),module.define("Tab",a)}(),function(){"use strict";var a,b=module.require("settings"),c=b.getSetting("HIGHLIGHT_CLASS"),d=b.getSetting("HIGHLIGHT_ADD_CLASS"),e=b.getSetting("HIGHLIGHT_VS_CONTENT_CLASS"),f=module.get("ScrollHelper");a=Class.extend({clearHighlights:function(a){var b=this.container.find(".%s, .%s, .%s".format(c,e,d));a&&(b=b.not(_.isArray(a)?a.join(","):a)),b.removeClass(c).removeClass(e).removeClass(d)},hideContents:function(){this.container.children().hide()},showContents:function(){this.container.children().show()},scrollTo:function(a){this.container&&f.scrollTo(this.container,a,-(this.container.height()/3))}}),module.define("Pane",a)}(),function(){"use strict";var a,b=module.require("Tab"),c=module.require("BibleVerseRange"),d=module.require("BibleVerseRangeCollection"),e=module.require("MarginalReference"),f=module.get("Navigation");a=b.extend({TEMPLATE_NAME:"DiscoveryTab",toChapterFormat:function(a){var b,c,d,e,f,g,h=this;return f=this.getDefaultChapter(),f.validRange=a.validRange,b=_.groupBy(a.crossReferences,"source"),c=_.groupBy(a.commentaries,"source"),d=_.groupBy(a.footnotes,"source"),e=this._groupMediaByVerse(f.validRange,a.multimedia,a.verses),f.titleNote=_.find(a.commentaries,function(a){return!!a.label}),f.hasTitleNote=!!f.titleNote,f.titleNote=f.titleNote||{},g=_.first(a.chapterOutlines),f.chapterOutline={content:g?g.content:null},f.verses=_.map(a.verses,function(a){var f=_.map(b[a.vsID],h._createCrossReference),g=c[a.vsID]||[],i=d[a.vsID]||[],j=e[a.vsID]||[],k=!!f.length,l=!!g.length,m=!!i.length,n=!!j.length;return{vsID:a.vsID,standardCitation:a.standardCitation||"",abbreviatedCitation:a.abbreviatedCitation||"",crossReferences:f,hasCrossReferences:k,studyNotes:g,hasStudyNotes:l,footnotes:i,hasFootnotes:m,media:_.map(j,function(a){return a.styleFlag="video"===a.type?"hasVideo":"",a}),hasMedia:n,hasContent:k||l||m||n}}),f},_groupMediaByVerse:function(a,b,e){var f={},g=new c(a),h=this;return _.each(e,function(a){f[a.vsID]=[]}),_.each(b,function(a){var b=d.splitRanges(a.source);b=h._findRangesInCurrentRange(b,g),_.each(b,function(b){var d,e,g=_.clone(a);d=b&&-1!==b.indexOf(c.VERSE_SEPARATOR),d&&(g.sourceStandardCitation=_.find(g.sourceStandardCitations,function(a){return a.vs===b}).standardCitation),e=new c(b).startRange,f[e].push(g)})}),f},_findRangesInCurrentRange:function(a,b){return _.filter(a,function(a){return b.isVerseRangeInRange(a)})},_createCrossReference:function(a){return new e(_.extend(a,{targets:a.targets}))},selectFootnote:function(a){var b=this.selectBibleData(".fn%s",a,!0);this.scrollTo(b.parents(".footnotes"))},selectVerse:function(a){var b=this.selectBibleData(".vs%s",a);this.setLastScrollPosition(b)},selectCrossReference:function(a){var b=".xRef%s".format(a),c=this.html.find(b);this.clearHighlights(),this.highlight(c),this._super.apply(this,arguments)},onClickExpander:function(a,b){var c=$(a.currentTarget),d=c.hasClass(c.data("collapseaction")),e=c.closest(".xRef");b.controller.onFetchReference(a,b),d?b.controller.clearHighlight(e):(b.controller.clearHighlights(),b.controller.highlight(e))},scrollToSelectedVerse:function(){var a,b,d,e,g,h=f.getCurrentHashValue(),i=this.getCurrentChapter().validRange;return h&&0!==h.length&&i?(a=c.isRange(h),b=new c(i),void(a&&b.isVerseRangeInRange(h)?(d=new c(h),e=d.startRange.replace(/[^0-9]/g,""),g=this.html.find(".vs%s".format(e)),this.scrollTo(g)):this.scrollToLastPosition())):void this.scrollToLastPosition()}}),module.define("DiscoveryTab",a)}(),function(){"use strict";var a,b=module.require("Tab"),c=module.require("settings"),d=c.getSetting("HIGHLIGHT_CLASS"),e=c.getSetting("HIGHLIGHT_VS_CONTENT_CLASS"),f=module.require("MarginalReference");a=b.extend({TEMPLATE_NAME:"MarginalReferenceTab",getDefaultChapter:function(){return{crossReferenceCategories:[]}},toChapterFormat:function(a){var b=this.getDefaultChapter();return b.crossReferenceCategories=this._buildCrossReferenceCategories(a.verses,a.crossReferences),b},_buildCrossReferenceCategories:function(a,b){var c,d={},e=_.indexBy(a,"vsID"),f=this;return _.each(b,function(a){var b=a.source;_.each(a.targets,function(c){var e=c.category.id,f=d[e]||{crossReferences:{}},g=b+a.referenceCharacter,h=f.crossReferences[g]||{targets:[]};h.referenceCharacter=a.referenceCharacter,h.source=b,h.targets.push(c),h.id=a.id,f.crossReferences[g]=h,f.label=f.label||c.category.label,d[e]=f})}),c=_.map(d,function(a){return{label:a.label,crossReferences:_.map(a.crossReferences,_.bind(f._createCrossReferenceGroup,f,e))}}),this._sortReferenceGroups(c)},_createCrossReferenceGroup:function(a,b){var c=a[b.source],d=b.targets;return new f({id:b.id,sourceVsID:c.vsID,sourceCitation:c?c.abbreviatedCitation:"",referenceCharacter:b.referenceCharacter,targets:d})},_sortReferenceGroups:function(a){var b=[_t("CMSPUBS.HdgMargClsParallelEvent"),_t("CMSPUBS.HdgMargClsQuotation")].reverse();return _.sortBy(a,function(a){return-1*_.indexOf(b,a.label)})},onHighlightAll:function(a,b){var c,d=$(a.currentTarget),e=b.controller,f=e.html.find(".jsHighlightAll");c=e._getAllReferenceIDs(d.parents(".xRefCategory").find(".xRef")),d.is(":checked")?(f.filter(":checked").not(d).click(),e.highlightAll(c),e.collapseAllExpanders(f.not(d).parents(".xRefCategory").find(".jsExpandCollapse"))):e.clearHighlights(c)},_getAllReferenceIDs:function(a){return _.map(a,function(a){return $(a).data("id")})},highlightAll:function(a){var b=this;_.each(a,function(a){b._findXRef(a).addClass(d)})},clearHighlights:function(a){var b=this;_.each(a,function(a){b._findXRef(a).removeClass(d)})},collapseAllExpanders:function(a){if(a.length){var b=a.data("collapseaction");a.filter(".%s".format(b)).click()}},selectVerse:function(a){var b='.xRef[data-vs-id="%s"]'.format(a),c=this.html.find(b),e=c.find(".jsExpandCollapse"),f=e.data("expandaction");this.isSelected()&&e.length&&(e.filter(".%s".format(f)).click(),c.addClass(d),this.scrollTo(c.eq(0)))},onDeselected:function(){if(this.html){var a=this.html.find(".jsExpandCollapse").data("collapseaction");this.html.find(".jsHighlightAll:checked").click(),this.html.find(".jsExpandCollapse.%s".format(a)).click()}},onExpandCollapseReference:function(a,b){var c,d,f=$(a.currentTarget),g=f.data("expandaction"),h=b.controller,i=f.parents(".xRef"),j=i.data("id"),k=h.html.find(".xRef%s".format(j)).not(i).find(".jsExpandCollapse");h.onFetchReference(a,b),f.hasClass(g)?(c=f.parents(".xRefCategory").find(".jsHighlightAll"),h.highlight(i),d=h.html.find(".jsHighlightAll:checked").not(c),d.length&&(d.click(),d=d.parents(".xRefCategory").find(".jsExpandCollapse").not(k).filter(function(a,b){return $(b).closest(".verse").find(".verseNum a.%s".format(e)).exists()}),h.collapseAllExpanders(d))):h.clearHighlight(i)},_findXRef:function(a){return $("#xreflink%s".format(a))}}),module.define("MarginalReferenceTab",a)}(),function(){"use strict";var a,b=module.require("Tab"),c=module.require("BibleVerseRange"),d=module.require("BibleTranslations");a=b.extend({TEMPLATE_NAME:"VerseComparisonTab",getDefaultChapter:function(){return{hasTranslations:!1,translations:[]}},toChapterFormat:function(a){var b,c=this;return a&&a.translations?a:(b=_.map(a,function(a,b){var d=_.first(a.verses)||{};return{vernacularFullName:a.editionData.vernacularFullName,content:c._filterVerseNum(d.content),standardCitation:a.citation,pubSymbol:b}}),{hasTranslations:!!b.length,translations:b})},_filterVerseNum:function(a){var b,c=$("<div></div>").html(a),d="&nbsp;";for(c.find(".verseNum,.chapterNum").remove(),b=c.html();0===b.indexOf(d);)b=b.substring(d.length);return b},selectVerse:function(a){var b=new c(a);return d.getParallelTranslations(b).then(_.bind(this.updateChapter,this))},updateChapter:function(a){this.state.chapter=_.extend(this.state.chapter,this.toChapterFormat(a))},deselectVerse:function(){this.updateChapter(this.getDefaultChapter())},selectCrossReference:function(){}}),module.define("VerseComparisonTab",a)}(),function(){"use strict";var a,b=module.require("Pane"),c=module.require("Bible"),d=module.get("Navigation"),e=module.require("settings"),f=module.require("MediaPage"),g=module.require("ChapterPage"),h=module.require("AdditionalPage"),i=e.getSetting("HIGHLIGHT_ADD_CLASS");a=b.extend({keepHighlights:!0,init:function(a){this.container=a,this.chapterPage=new g(a),this.mediaPage=new f(a),this.additionalPage=new h(a)},setBible:function(a){this.mediaPage.setBible(a)},updateContainer:function(a){this.container=a,this.chapterPage.updateContainer(a),this.mediaPage.updateContainer(a),this.additionalPage.updateContainer(a)},showChapter:function(a,b,c,d){return this.scrollTo(0),this.chapterPage.show(a,b,c,d)},selectCrossReference:function(a){var b=this._findXRef(a);this.keepHighlights||this.clearHighlights(),b.addClass(i)},deselectCrossReference:function(a){var b=this._findXRef(a);b.removeClass(i)},_findXRef:function(a){return this.container.find("#xreflink%s".format(a))},setKeepHighlights:function(a){this.keepHighlights=a},selectVerse:function(){this.keepHighlights?this.clearHighlights(".xrefLink"):this.clearHighlights()},selectFootnote:function(){this.keepHighlights?this.clearHighlights(".xrefLink"):this.clearHighlights()},showMediaPage:function(a){return this.scrollTo(0),this.mediaPage.draw(a)},_overrideDefaultPageBehaviors:function(){this.container.find(".jsBibleLink").addClass("jsNoDialog")},onPageLoad:function(a){this._overrideDefaultPageBehaviors(),this.container.find("a.pubSym-%s".format(c.PUB_SYMBOLS.NWTSTY)).addClass("jsNoScroll"),this.additionalPage.onPageLoad(a)},selectPubLink:function(a,b,c,f){if(e.getSetting("PAGE_ID")===b){var g=a.attr("href"),h=g?g.replace(/[^#]+#?/,""):"";h.length&&($(window).scrollTop(0),this.scrollTo(this.container.find("#%s".format(h))),d.updateHash(h,!1,f))}else c&&c()}}),module.define("ReadingPane",a)}(),function(){"use strict";var a,b=module.require("UIController"),c=module.require("DiscoveryTab"),d=module.require("MarginalReferenceTab"),e=module.require("VerseComparisonTab"),f=".tabContent";a=b.extend({TEMPLATE_NAME:"StudyTabs",init:function(a){this.container=a,this.discoveryTab=new c,this.marginalReferenceTab=new d,this.verseComparisonTab=new e,this.tabs=[this.discoveryTab,this.verseComparisonTab,this.marginalReferenceTab]},_injectHTML:function(a){return this.html=a,this.container.empty().append(a),this.html},setContainer:function(a){this.container=a},triggerTabEvent:function(a){$(this).find(f).trigger(a)},draw:function(){var a=this;return this._draw().then(function(){_.invoke(a.tabs,"setContainer",a.html.find(f)),_.invoke(a.tabs,"clearLastScrollPosition"),a._listenForScroll()}).then(function(){return $.when.apply($,_.invoke(a.tabs,"draw"))}).then(function(){a.discoveryTab.show()})},setChapter:function(a){this.discoveryTab.updateChapter(a),this.marginalReferenceTab.updateChapter(a),this.verseComparisonTab.deselectVerse()},show:function(){this.container.show()},hide:function(){this.container.hide()},selectVerse:function(a){a&&a.length&&_.invoke(this.tabs,"selectVerse",a)},selectFootnote:function(a){a&&a.length&&(this.discoveryTab.show(),_.invoke(this.tabs,"selectFootnote",a))},selectCrossReference:function(a){a&&a.length&&(this.marginalReferenceTab.isSelected()||this.discoveryTab.isSelected()||this.discoveryTab.show(),_.invoke(this.tabs,"selectCrossReference",a))},scrollToSelectedVerse:function(){this.discoveryTab.isSelected()?this.discoveryTab.scrollToSelectedVerse():_.each(this.tabs,function(a){a.isSelected()&&a.scrollToLastPosition()})},_listenForScroll:function(){var a=this.container.is(".jsLockedContainer")?this.container:this.container.find(".jsLockedContainer"),b=this;a.off("scroll").on("scroll",_.throttle(function(){b.updateSelectedTabScrollPosition($(this).scrollTop())},200))},updateSelectedTabScrollPosition:function(a){_.each(this.tabs,function(b){b.isSelected()&&b.setLastScrollPosition(a)})}}),module.define("StudyTabs",a)}(),function(){"use strict";var a,b=module.require("Pane"),c=module.require("StudyTabs"),d=module.require("DefaultView"),e=module.require("OverviewView"),f=module.require("Bible"),g=module.require("signal");a=b.extend({views:{tabs:"showStudyTabs",overview:"showOverview","default":"showDefaultView",hidden:"showHiddenView"},init:function(a){this.container=a,this.studyTabs=new c(a)},setContainer:function(a){this.container=a,this.studyTabs.setContainer(a)},setBible:function(a){this.bible=a},setBookID:function(a){this.bookID=a},open:function(){this.container.trigger("panel:open")},close:function(){this.container.trigger("panel:close")},show:function(){this.container.show()},hide:function(){this.container.hide()},showHiddenView:function(){return this.hide(),$.when(!0)},setChapter:function(a){this.studyTabs.setChapter(a)},showStudyTabs:function(){return this.studyTabs.draw()},showOverview:function(){return this.bible?(this.overviewView||(this.overviewView=new e),this.overviewView.draw(this.container,this.bible,this.bookID)):$.when(!1)},showDefaultView:function(){return this.bible?(this.defaultView||(this.defaultView=new d(this.container,this.bible.bookIndex)),this.defaultView.draw(this.container)):$.when(!1)},showView:function(a){a=a||"default",this.view===a&&this.resetView(a);var b=this.views[a]||this.views["default"],c=this[b];return this.show(),this.view=a,c.call(this).then(_.bind(this._addNavigationLinks,this)).then(_.bind(g.send,g,"DOMReady",this.container)).then(_.bind(this.scrollToSelectedVerse,this))},_addNavigationLinks:function(){this.container.find(".pubSym-%s".format(f.PUB_SYMBOLS.NWTSTY)).addClass("jsBibleNavigation")},resetView:function(a){"default"===a&&this.defaultView.clearContent()},selectBibleLink:function(a){"default"===this.view&&(this.defaultView.selectVerseRange(a),this.open())},selectPubLink:function(a,b,c){"default"===this.view&&(this.defaultView.selectPubLink(b,a.attr("href"),c),this.open())},openPubLink:function(a,b){"default"===this.view&&(this.defaultView.showContent(b,a.attr("class"),a.attr("href")),this.open())},selectVerse:function(a){this.open(),this.studyTabs.selectVerse(a)},selectFootnote:function(a){this.open(),this.studyTabs.selectFootnote(a)},selectCrossReference:function(a){this.open(),this.studyTabs.selectCrossReference(a)},scrollToSelectedVerse:function(){this.studyTabs.scrollToSelectedVerse()}}),module.define("StudyPane",a)}(),function(){"use strict";var a;a=Class.extend({init:function(a){this.range=a},parse:function(a){var b=a.ranges[this.range];return b?this.filterChapterContent(b):b},filterChapterContent:function(a){var b,c=_.indexBy(a.crossReferences,"id"),d=this,e=0;return b=function(){return e++},a.verses=_.map(a.verses,function(a){return a.content=d.removeHrefAttrs(a.content),
a.content=d.replaceXRefTags(a.content,c,b),a.content=d.replaceFootnoteTags(a.content),a}),a},replaceXRefTags:function(a,b,c){var d,e,f='<a class="xrefLink jsNoScroll" id="xreflink%s" href="#xref" data-target="%s">%s</a>',g=this;return a.replace(/<xref id="([0-9]+)">.*?<\/xref>/gi,function(a,h){return d=b[h],e=g.getCrossReferenceCharacter(_.isFunction(c)?c():c++),d&&(d.referenceCharacter=e),f.format(h,h,e)})},replaceFootnoteTags:function(a){var b='<a class="footnoteLink" id="footnotesource%s" data-anchor="#fn%s" href="#footnote">*</a>';return a.replace(/<fn id="([0-9]+)"><\/fn>/gi,function(a,c){return b.format(c,c)})},getCrossReferenceCharacter:function(a){var b=this.getCrossReferenceCharacters();return b[a%b.length]},getCrossReferenceCharacters:function(){return this.xrefCharacters||(this.xrefCharacters="abcdefghijklmnopqrstuvwxyz".split("")),this.xrefCharacters},removeHrefAttrs:function(a){var b=$("<div></div>").html(a);return b.find(".verseNum a,.chapterNum a").removeAttr("href"),b.html()}}),module.define("ChapterResponseParser",a)}(),function(){"use strict";var a,b,c=module.require("MediaPage");a=Class.extend({init:function(){this.bookIndex={},this.state={hebrew:[],greek:[]}},parse:function(a,b){return this.state=_.extend(b.editionData,this.state),this.state.books=_.map(_.keys(b.editionData.books),_.bind(this.createBook,this,b.editionData.books)),this.state.books=_.reject(this.state.books,_.isNull),this.state.additionalPages=_.map(b.additionalPages,_.bind(this.pageToBook,this)),this.state.hasHebrewBooks=!!this.state.hebrew.length,this.state.hasGreekBooks=!!this.state.greek.length,this.state.bookIndex=this.bookIndex,this.state.pubSymbol=a,this._addSyntheticPages(this.state),this.state},createBook:function(a,b){var c=a[b],d=parseInt(c.chapterCount,10),e=this;return 0===d?null:(b=parseInt(b,10),c=_.extend(c,{id:b,title:c.standardName,abbr:c.officialAbbreviation,type:b>=40?"greek":"hebrew",groupStyle:this.getBookGroupStyle(b),isBibleBook:!0,hasChapters:!0,hasAudio:c.hasAudio}),this.setPreviousAndNext(c),c.additionalPages=_.map(c.additionalPages,function(a){return e.pageToChapter(a.title,a,-1)}),c.hasAdditionalPages=!!c.additionalPages.length,c.chapters=this.createChapters(b,d),this.setBookIndex(c.id,c),this.state[c.type].push(c),c)},createChapters:function(a,b){var c,d,e=_.range(1,b+1),f=this;return _.map(e,function(b){return d=""+b,c={id:d,title:d,abbr:d,url:null,bookID:a,isBibleChapter:!0},f.setPreviousAndNext(c),c})},setBookIndex:function(a,b){this.bookIndex[a]=b},pageToBook:function(a){var b={url:a.url,title:a.title,abbr:a.title,id:a.pageID,isBibleBook:!1,additionalPages:[],pageID:a.pageID,hasAudio:!1,images:[],docClass:a.docClass,pageCSSClassNames:a.pageCSSClassNames,hasAdditionalPages:!1};return this.setPreviousAndNext(b),b.chapters=_.map(a.children,_.bind(this.pageToChapter,this,a.title)),b.hasChapters=!!b.chapters.length,this.setBookIndex(b.pageID,b),b},pageToChapter:function(a,b){var c={id:b.pageID,title:b.title,abbr:b.abbreviatedTitle,url:b.url,isBibleChapter:!1,pageCSSClassNames:b.pageCSSClassNames,docClass:b.docClass};return this.setPreviousAndNext(c),c},setPreviousAndNext:function(a){var b=["id","bookID","isBibleBook","isBibleChapter","url","title","pageCSSClassNames"];a.hasPrevious=!!this.previous,a.hasNext=!1,this.previous&&(a.previous=_.pick(this.previous,b),delete a.previous.previous,delete a.previous.next,this.previous.next=_.pick(a,b),delete this.previous.next.previous,delete this.previous.next.next,this.previous.hasNext=!0),this.previous=a},getBookGroupStyle:function(a){var c=_.find(b,function(b){return a>=b.min&&a<=b.max});return c?c.className:"normal"},_addSyntheticPages:function(a){var b={url:"#%s".format(c.HASH_URL),title:_t("CMSPUBS.HdgMedia"),abbr:_t("CMSPUBS.HdgMedia"),id:c.PAGE_ID,chapters:[],isBibleBook:!1,additionalPages:[],hasChapters:!1,pageID:c.PAGE_ID,pageCSSClassNames:a.pageCSSClassNames,hasAudio:!1};a.bookIndex[c.PAGE_ID]=b,this.setPreviousAndNext(b),a.additionalPages.push(b)}}),b=[{min:1,max:5,className:"colorThree"},{min:6,max:17,className:"colorOne"},{min:23,max:43,className:"colorThree"},{min:44,max:44,className:"colorOne"},{min:66,max:66,className:"colorThree"}],module.define("StudyBibleResponseParser",a)}(),function(){"use strict";var a,b=module.require("Bible"),c=module.require("BibleJumper"),d=module.require("ReadingPane"),e=module.require("StudyPane"),f=module.get("StudyBibleInsight"),g=module.require("BibleVerseRange"),h=module.require("StudyBibleResponseParser"),i=module.require("ChapterResponseParser"),j=module.require("BibleVerseRangeCollection"),k=module.require("MediaPage"),l=module.require("settings"),m=module.require("signal"),n=module.get("Navigation"),o=module.require("SimpleModal"),p=l.getSetting("HIGHLIGHT_CLASS"),q="#bibleText",r=".readingPane",s=".studyPane",t="#mobileStudyPane",u=$("#mobileStudyPaneHandle");a=Class.extend({loading:null,init:function(a,c,f,g){this.pubSymbol=a,this.bookName=c,this.bookID=f,this.chapterID=g,this.bible=new b(a),this.readingPane=new d($(r)),this.studyPane=new e($(this.getStudyPaneSelector())),this.moveStudyPane(),this.setPreserveHighlights(!0)},open:function(){var a=this.isBiblePage()&&this.chapterID,b=this;return this.fetchBible().then(function(c){var d,e;return b.bibleData=c,b.readingPane.setBible(c),b.studyPane.setBible(c),b.bindEventListeners(),a?(e={id:b.bookID,standardName:b.bookName},d=b.openChapter(e,b.chapterID,null,!0).then(_.bind(b.setPreserveHighlights,b,!1)),$.when(b._createBibleJumper(c),d)):b._createBibleJumper(c).then(_.bind(b._routeUsingHash,b))}).then(function(){a||(b.readingPane.onPageLoad(b.bibleJumper.getSelectedPage()),b.setPreserveHighlights(!1),b.updateStudyPaneView(),n.updateState(b.bibleJumper.getState()))})},_routeUsingHash:function(){var a,b=n.getCurrentHashValue(),c={};return c[k.HASH_URL]="_navigateToMediaPage",a=c[b],a&&this[a]?this[a].call(this):$.when(!1)},_navigateToMediaPage:function(){return this.bibleJumper.setSelectedBookID(k.PAGE_ID),this.updateAnalytics(!1),this.showMediaPage(this.bibleJumper.getSelectedBook())},_createBibleJumper:function(a){return this.bibleJumper=new c(a,$(".jsBibleJumper")),this.bibleJumper.draw().then(_.bind(this.bibleJumper.selectPageLocation,this.bibleJumper))},fetchBible:function(){var a,b=this;return this.loading||(a=new h,this.loading=$.getJSONCached(this.bible.getDataAPIURL()).then(_.bind(a.parse,a,this.getPubSymbol())).then(function(a){return b.state=a,a})),this.loading},fetchChapter:function(a){var b=this,c=new i(a.getID());return $.getJSONCached(a.getDataAPIURL()).then(_.bind(c.parse,c)).then(function(c){return c.id=a.start.chapter,_.extend(c,b.getChapter(a.start.book,c.id)||{})})},fetchMultimedia:function(a){return $.getJSONCached(this.bible.getMultimediaAPIURL(a||this.bookID)).then(function(a){return _.chain(a.ranges).values().first().value().multimedia})},getPubSymbol:function(){return this.pubSymbol},isBiblePage:function(){return!!$(q).length&&!!$("article").data("chapter")},getStudyPaneView:function(){return $("article").data("study-view")||"default"},updateStudyPaneView:function(){var a=this.getStudyPaneView();return"hidden"===a?($(r).addClass("fullPane"),u.hide()):($(r).removeClass("fullPane"),this.isMobile()&&u.show()),this.studyPane.showView(a)},loadPage:function(a,b){var c=this;return this.studyPane.hide(),this.readingPane.hideContents(),this.readingPane.scrollTo(0),n.swapContent(a,[r],!0,!0).then(_.bind(m.send,m,"ArticleLoaded")).done(function(){c.studyPane.show(),c.readingPane.updateContainer($(r)),c.readingPane.onPageLoad(c.bibleJumper.getSelectedPage()),c.updateStudyPaneView(),c.updateURL({urlString:a,hash:b,preserveHash:!1,state:c.bibleJumper.getState()}),m.send("PageLoaded")})},updateURL:function(a){return this.historyNavigationInProgress?void this.notifyHistoryNavigationStopped():void n.updateURL(a)},getChapter:function(a,b){if(!this.state||!this.state.bookIndex)return null;var c,d=this.state.bookIndex[a];return d&&d.chapters?(c=d.chapters[b-1],c||null):null},openChapter:function(a,b,c,d){var e,f=this,h=this.getPubSymbol();return this.bookID=a.id,this.chapterID=b,e=g.allForChapter(a.id,b,this.getPubSymbol()),this.studyPane.hide(),d||this.readingPane.hideContents(),this.fetchChapter(e).then(function(b){return f.studyPane.setChapter(b),f._updateChapterURLHash(e,c,b.link,d),n.updatePageTitle(f.createPageTitle(b.citation)),f.readingPane.showChapter(b,a.id,a.standardName,h)}).then(_.bind(m.send,m,"ArticleLoaded")).then(function(){return n.updatePageID("ChapterPage"),d||f.readingPane.showContents(),f.updateStudyPaneView()}).then(function(){f.studyPane.show(),m.send("PageLoaded",f.readingPane.container)})},_updateChapterURLHash:function(a,b,c,d){var e,f,h,i=n.getCurrentHashValue();return b&&b.length?(h=new g(b),void this.updateURL({urlString:c,hash:h.toRangeString(),preserveHash:d,state:this.bibleJumper.getState()})):(e=i&&i.length,f=e&&g.isRange(i)&&a.isVerseRangeInRange(i),f||(c=n.removeHash(c)),void this.updateURL({urlString:c,hash:f?i:!1,preserveHash:f,state:this.bibleJumper.getState(),overwriteHistory:d}))},showMediaPage:function(a){var b=this;return this.readingPane.showMediaPage(a).then(_.bind(m.send,m,"ArticleLoaded")).then(function(){b.readingPane.showContents(),b.updateStudyPaneView(),b.updateURL({urlString:b.bibleData.url,hash:k.HASH_URL,preserveHash:!1,state:b.bibleJumper.getState()}),n.updatePageID(k.PAGE_ID),n.updatePageTitle(b.createPageTitle(k.PAGE_TITLE)),b.bibleJumper.close()})},goHome:function(){return this.loadPage(this.bibleData.url)},restoreNavigationState:function(a){this.isReady()&&(this.historyNavigationInProgress=!0,this.bibleJumper.restoreState(a))},notifyHistoryNavigationStopped:function(){this.historyNavigationInProgress=!1},bindEventListeners:function(){var a="%s .chapterNum a, %s .verseNum a".format(r,r),c="%s .footnoteLink".format(r),d="%s .xrefLink".format(r),e="%s .jsBibleBook:not(.unavailable)".format(r),f="%s .xRef .jsExpandCollapse, %s .xRef .jsExpandCollapse".format(s,t),g=".jsBibleChapter",h=".pubSym-%s".format(b.PUB_SYMBOLS.NWTSTY),i="%s %s, %s %s, %s %s".format(r,h,s,h,t,h),j="%s .jsBibleLink:not(.xrefLink)".format(r),k="%s .jsHighlightAll, %s .jsHighlightAll".format(s,t),l="%s .tabContainer, %s .tabContainer".format(s,t);$(window).on("resize",_.throttle(_.bind(this.moveStudyPane,this),150)),$(document).on("click",a,_.bind(this.onSelect,this,"selectVerse")).on("click",c,_.bind(this.onSelect,this,"selectFootnote")).on("click",d,_.bind(this.onSelectCrossReference,this)).on("click",e,_.bind(this.onBibleBookClick,this)).on("click",f,_.bind(this.onExpandCollapseCrossReference,this)).on("click",i,_.bind(this.onPubLinkClick,this)).on("click",g,_.bind(this.onBibleChapterClick,this)).on("click",j,_.bind(this.onBibleLinkClick,this)).on("click",k,_.bind(this.onHighlightAllClick,this)).on("tab:selected",l,_.bind(this.onTabChange,this))},setSelectedBook:function(a){a&&this.studyPane.setBookID(a.id)},onTabChange:function(){var a=$("%s .tabContainer.current".format(this.getStudyPaneSelector()));this.preserveHighlights||this.clearHighlights(),this.readingPane.setKeepHighlights(a.hasClass("discoveryTab")?!1:!0)},setPreserveHighlights:function(a){this.preserveHighlights=a},clearHighlights:function(){this.studyPane.clearHighlights(),this.readingPane.clearHighlights()},onBibleBookClick:function(a){a.preventDefault();var b=$(a.currentTarget),c=b.data("book");this.bibleJumper.selectBook(c,!0)},onBibleLinkClick:function(a){a.preventDefault();var b=$(a.currentTarget);this.studyPane.selectBibleLink(""+b.data("targetverses"))},onBibleChapterClick:function(a){a.preventDefault();var b,c=$(a.currentTarget),d=c.data("verse"),e=c.data("book"),f=c.data("chapter");return o.close(),this.studyPane.close(),this.bibleJumper.isSelectedBookID(e)&&this.bibleJumper.isSelectedChapterID(f)?(this.studyPane.clearHighlights(),this.readingPane.clearHighlights(),d&&d.length&&(b=new g(d),n.updateHash(b.toRangeString(),!1,this.bibleJumper.getState())),m.send("PageLoaded",this.readingPane.container),void this.studyPane.scrollToSelectedVerse()):(this.bibleJumper.selectBook(e),void this.bibleJumper.selectChapter(f,d))},onPubLinkClick:function(a){a.preventDefault();var b,c=$(a.currentTarget),d=c.data("page-id"),e=c.attr("href"),f=c.hasClass("jsBibleNavigation"),g=c.is("%s a".format(s))||c.is("%s a".format(t)),h=!g&&c.is("%s a".format(r)),i=c.is("body.dc125 a"),j=d?this.bibleJumper.findPage(d):!1;return d&&j?(o.close(),f?void this.navigateToPage(j,c):g||i?(b=_.bind(this.navigateToPage,this,j,c),void this.studyPane.selectPubLink(c,d,b)):h?(b=_.bind(this.studyPane.openPubLink,this.studyPane,c,j),void this.readingPane.selectPubLink(c,d,b,this.bibleJumper.getState())):void 0):void(!e||c.hasClass("jsBibleBook")||c.hasClass("jsBibleChapter")||(window.location.href=e))},navigateToPage:function(a,b){if(l.getSetting("PAGE_ID")===a.id)return void this.readingPane.selectPubLink(b,a.id,!1,this.bibleJumper.getState());var c=b.attr("href"),d=n.getHashFromURL(c),e=this.bibleJumper.navigateToPage(a.id,!0,d);!e&&c&&(window.location.href=c),this.studyPane.close()},onSelect:function(a,b){var c=$(b.currentTarget),d=c.data("anchor")||"",e=d.replace(/[^0-9]/g,"");b.preventDefault(),this.readingPane[a](e),this.studyPane[a](e),c.addClass(p)},onSelectCrossReference:function(a){var b=$(a.currentTarget),c=this._getCrossReferenceID(b.attr("id"));a.preventDefault(),this.readingPane.clearHighlights(".xrefLink"),this.readingPane.selectCrossReference(c),this.studyPane.selectCrossReference(c)},onExpandCollapseCrossReference:function(a){var b=$(a.currentTarget),c=b.parents(".xRef"),d=c.data("id"),e=b.data("collapseaction"),f=$("%s .xRef%s".format(this.getStudyPaneSelector(),d)).not(c);b.hasClass(e)?this.readingPane.selectCrossReference(d):f.find(".jsExpandCollapse").hasClass(e)||this.readingPane.deselectCrossReference(d)},onMediaPageClick:function(){this.bibleJumper.selectMediaPage()},onHighlightAllClick:function(a){var b=$(a.currentTarget);b.is(":checked")&&(this.studyPane.close(),this.readingPane.clearHighlights(".xrefLink"))},_getCrossReferenceID:function(a){return a?a.replace(/[^0-9]/g,""):""},moveStudyPane:function(){var a=$(s),b=$(t),c=this.isMobile();!this.wasMobile&&c?(b.append(a.children().detach()),a.hide(),this.studyPane.setContainer(b)):this.wasMobile&&!c&&(a.append(b.children().detach()),a.show(),this.studyPane.setContainer(a)),this.wasMobile=c},isMobile:function(){return l.getSetting("IS_SMALL_LAYOUT")},getStudyPaneSelector:function(){return this.isMobile()?t:s},formatBibleVerseLinks:function(){var a=$(".jsBibleLink").not(".jsNoDialog");this.hideModalVerseLinks(a),this.overrideAudioInBibleVerseLinks(a)},overrideAudioInBibleVerseLinks:function(a){this.bibleData&&this.bibleData.bookIndex&&a.not(".jsBibleOverride").addClass("jsBibleOverride").each(function(){var a=$(this),c=a.data("bible");a.closest(r).exists()||c===b.PUB_SYMBOLS.NWTSTY&&a.data("bible",b.PUB_SYMBOLS.NWT)})},hideModalVerseLinks:function(a){if(this.bibleData&&this.bibleData.bookIndex){var b=this;a.not(".jsHiddenVerses").addClass("jsHiddenVerses").each(function(){var a,c,d=$(this),e=[];d.closest(r).exists()||(a=d.data("targetverses"),a&&(c=new j(a,b.getPubSymbol()),_.each(c.ranges,function(a){b.isBibleBookAvailable(a.start.book)||e.push(a.range)}),d.data("hide-link-ranges",j.toVerseRangeString(e))))})}},isBibleBookAvailable:function(a){return!!this.bibleData.bookIndex[a]},isReady:function(){return!!this.bibleJumper},createPageTitle:function(a){return this.bibleData&&this.bibleData.titleFormat?this.bibleData.titleFormat.format(a):""},getBibleReadingPageCSSClasses:function(){return this.bibleData?this.bibleData.pageCSSClassNames:""},getBasePageCSSClasses:function(){var a=this.getBibleReadingPageCSSClasses();return a.replace(/dc[0-9]+ ?/,"")},updateAnalytics:function(a){var b=this.bibleJumper.getSelectedBook(),c=this.bibleJumper.getSelectedChapter();f.updateAnalytics(a,b,c)},trackMediaGalleryOpen:function(a){a=a||this.bibleJumper.getSelectedBookID(),f.trackMediaGalleryOpen(n.getURL(),a)}}),a.EVENTS={CHANGE_CHAPTER_SIGNAL:"StudyBible:changeChapter",CHANGE_PAGE_SIGNAL:"StudyBible:changePage",MEDIA_PAGE_SIGNAL:"StudyBible:showMediaPage",CHANGE_BOOK_SIGNAL:"StudyBible:changeBook",NO_CHANGE_SIGNAL:"StudyBible:noChange"},module.define("StudyBible",a)}(),function(){"use strict";var a=module.require("signal"),b=$("body");b.hasClass("StudyBible")&&a.listen("DOMReady",function(){var a,b,c=$(".readingPane .jsViewportPin").not(".jsPinned");c.exists()&&(a=$("#article p.docNav"),b=a.find("a"),b.removeAttr("target").addClass("jsNoScroll"),c.exists()&&a.exists()&&(a.appendTo(c),c.addClass("jsPinned")))})}(),function(){"use strict";var a,b,c,d,e="current",f=module.require("signal");b=function(a){a.siblings("."+e).removeClass(e),a.addClass(e)},c=function(a){a.siblings("."+e).removeClass(e).trigger("tab:deselected"),a.addClass(e).trigger("tab:selected")},a=function(a){var d=$(this),e=d.data("tab-target"),f=$(e);a.preventDefault(),c(f),b(d)},d=function(){var a=$(this),d=a.data("tab-target"),f=$(d);a.addClass("jsHasSelectedListener"),f.on("tab:select",_.partial(b,a)),f.on("tab:select",_.partial(c,f)),f.hasClass(e)&&(b(a),c(f))},f.listen("DOMReady",function(){$(".jsTab").not(".jsHasSelectedListener").each(d)}),$(document).on("click",".jsTab",a)}(),function(){"use strict";$(document).ready(function(){$(".jsPanoElement").removeClass("jsPanoElement"),$("#jsPanoWdgtList").slippry({elements:"li",start:"random",controls:!1,pager:!1,captions:!1,transition:"fade",speed:800,pause:8e3,autoHover:!1})})}(),function(){"use strict";var a=module.require("ListViewSwitcher"),b=module.require("signal");b.listen("DOMReady",function(){$(".jsSelectGridView").each(function(){var b,c,d=$(this);d.data("has-view-switcher")||(d.data("has-view-switcher",!0),b=d.siblings(".jsSelectListView"),c=new a(d,b),c.start())})})}(),$(function(){"use strict";var a,b=$(".jsAutoSelectLocation");a=function(){var a,b=navigator.userLanguage||navigator.language||navigator.browserLanguage||navigator.systemLanguage,c=b?b.match(/([\w]+)\-([\w]+)/):!1;return!c||c.length<2?"":a=c[2].toUpperCase()}(),b.each(function(){var b,c=$(this).children();c.filter(":selected").val()||(b=c.filter("[data-iso2location!=][data-iso2location~="+a+"]"),b.exists()&&(b.prop("selected",!0),$(this).trigger("change")))})}),function(){"use strict";var a,b,c=500,d="jsToolTipActive",e="closeToolTips",f=module.require("signal");a=function(a,b){var g,h=!1,i=!0,j="click"===a.data("trigger");f.send(e),b.addClass(d),b.find("input:first").focus(),g=function(){h||i||b.removeClass(d)},f.listen(e,g),b.on("mouseenter focusin",function(){h=!0}),a.on("mouseenter focusin",function(){i=!0}),b.on("mouseleave focusout",function(){h=!1,j||setTimeout(g,c)}),a.on("mouseleave focusout",function(){i=!1,j||setTimeout(g,c)}),$(document).on("click",g)},b=function(b){b.preventDefault();var c=$(this),d=c.find("~ .jsToolTip:first");a(c,d)},$(document).on("mouseenter focusin",'.jsToolTipTrigger[data-trigger!="click"]',b),$(document).on("click",'.jsToolTipTrigger[data-trigger="click"]',b)}(),function(){"use strict";var a,b=module.require("signal"),c=module.require("settings");a=function(){var a,b,d,e,f,g,h,i=$(this),j=!1;i.data("viewport-pin")||(g=i.data("pin-container")?$(i.data("pin-container")):window,f=i.data("pin-beneath")?$(i.data("pin-beneath")):!1,i.data("viewport-pin",!0),i.wrap('<div class="jsViewportPinWrapper"></div>'),h=i.parent(),a=function(){var a,b,d,e=c.getSetting("IS_SMALL_LAYOUT");a=i.children(".excludePin:not(.jsAlwaysIncludeForPinHeight)"),b=_.reduce(a,function(a,b){return a+$(b).outerHeight(!0)},0),d=h.height()-b,h.height(d),i.width(e?"":i.width()),i.addClass("pinned"),f&&($("#regionMain").scrollTop(0),i.css({top:Math.ceil(f.offset().top+f.outerHeight())})),j=!0},b=function(){i.removeClass("pinned"),j=!1,h.height(""),i.width("")},d=function(){var c=i.children(":not(.error):visible:not(.excludePin)"),d=$(g).scrollTop(),e=h.offset().top,f=e>=d&&j,k=d>e&&!j;f||!c.exists()?b():k&&a()},$(g).on("scroll",d),d(),e=function(){j&&(b(),a()),d()},$(window).on("resize",_.throttle(e,100)),i.on("class:add:excludePin",e),i.on("class:remove:excludePin",e))},b.listen("DOMReady",function(){$(".jsViewportPin").each(a)})}(),$(function(){"use strict";var a,b,c,d,e,f,g,h="jsDisableSavedStates",i=module.require("url"),j=$("body").attr("id")||"",k=$.persistentData(j)||{};c=function(a){e(a,"collapseaction")},d=function(a){e(a,"expandaction")},e=function(a,b){a.preventDefault();var c=$(this),d=c.data("scope"),e=".jsExpandCollapse";d&&(e=d+" "+e),$(e).each(function(){var a=$(this),c=a.data(b);a.hasClass(c)&&$(a).click()})},f=function(a,b){var c,d=a.data("handle-root"),e=d?a.closest(d):a,f=".jsCollapsableBlock:first",g=e.nextAll(f),i=a.data("expandaction"),j=a.data("collapseaction"),k=a.hasClass(j),l=k?j:i,m=k?i:j,n=k?"slideUp":"slideDown",o=$("body").attr("id");g.length||(g=e.find(f)),b=b||200,g[n](b),a.removeClass(l).addClass(m),o&&!a.hasClass(h)&&(c=$.persistentData(o)||{},c[a.attr("id")]=m,$.persistentData(o,c))},$(document).on("click",".jsExpandAll",d).on("click",".jsCollapseAll",c),$(document).on("click",".jsExpandCollapse",function(a){a.preventDefault(),f($(this))}),g=i.parse().hash.query,g.accordion&&(k=$.extend(k,g.accordion));for(a in k)k.hasOwnProperty(a)&&(b=$("#"+a),b.length>0&&!b.hasClass(h)&&!b.hasClass(k[a])&&f(b,0))}),function(){"use strict";function a(a){e.updateAnalytics(a)}function b(a){var b=a.originalEvent&&a.originalEvent.state;if(b)return!q.length&&e&&e.isReady()?void c(b):void q.push(b)}function c(a){q.length||q.push(!1),e.restoreNavigationState(a)}function d(){var a=q.pop();e&&a&&(q=[],c(a))}var e,f=module.require("signal"),g=module.require("StudyBible"),h=module.require("Bible"),i=module.require("MediaPage"),j=module.get("Navigation"),k=module.require("settings"),l=module.require("GalleryCollection"),m=module.require("GalleryImage"),n=module.require("GalleryVideo"),o=module.require("MediaGalleryModal"),p=module.require("loadingIndicator"),q=[];$(document).ready(function(){var a=$("article"),b=a.data("booknum"),c=a.data("chapter"),f=a.data("bible-pub"),i=a.data("bookname");f===h.PUB_SYMBOLS.NWTSTY&&(p.open(),e=new g(f,i,b,c),e.open().then(d).then(p.close))}),f.listen(g.EVENTS.CHANGE_CHAPTER_SIGNAL,function(b){var c=e.getBasePageCSSClasses(),f=e.getBibleReadingPageCSSClasses(),g=j.getURL();return b.book&&!b.book.isPlaceholder||b.chapter?void(b.chapter&&p.open().then(function(){j.updatePageCSSClasses(c),e.openChapter(b.book,b.chapter,b.verseRange).then(_.partial(a,g)).then(d).then(p.close)})):void p.open().then(function(){j.updatePageCSSClasses(f),e.goHome().then(d).then(_.partial(a,g)).then(p.close)})}),f.listen(g.EVENTS.CHANGE_PAGE_SIGNAL,function(b){if(b.page&&b.page.url){var c=b.page.pageCSSClassNames||e.getBasePageCSSClasses(),f=j.getURL();p.open().then(function(){var g;return g=b.page.pageID===i.PAGE_ID?e.showMediaPage(b.page):e.loadPage(b.page.url,b.hashLocation),j.updatePageCSSClasses(c),g.then(d).then(_.partial(a,f)).then(p.close)})}}),f.listen(g.EVENTS.CHANGE_BOOK_SIGNAL,function(a){a.book&&e.setSelectedBook(a.book)}),f.listen("DOMReady",function(){e&&e.formatBibleVerseLinks()}),f.listen(g.EVENTS.NO_CHANGE_SIGNAL,function(){d(),e&&e.notifyHistoryNavigationStopped()}),$(window).on("popstate",b),f.listen("DOMReady",function(){$(document).off("click","div.jsGalleryToggle img, div.jsGalleryToggle a").on("click","div.jsGalleryToggle img, div.jsGalleryToggle a",function(a){var b=$(this).closest("div.jsGalleryToggle"),c=b.data("book-id");a.preventDefault(),p.open(),e.fetchMultimedia(c).then(function(a){var d,g,h,i,j=0;p.close(),d={image:function(a){var b=new m;return b.url=a.resource.zoom||a.resource.src,b.zoomSrc=b.url,b},video:function(a){var b=new n;return b.jsonurl=a.resource.src[0],b}},g=_.chain(a).map(function(a){if(_.has(d,a.type)){var b=d[a.type](a),c=$("<div></div>"),e=$("<h4></h4>");return c.append(a.caption),e.html(_t("CMSPUBS.HdgRelatedScriptures")),c.append(e),_.each(a.sourceStandardCitations,function(b,d){var e=$("<a></a>");e.addClass("jsBibleLink"),e.attr("data-bible",k.getPageConfig("PREFERRED_BIBLE")),e.attr("data-targetverses",b.vs),e.html(b.abbreviatedCitation),c.append(e),d<a.sourceStandardCitations.length-1&&c.append("; ")}),b.thumburl=a.thumbnail.src,b.title=a.label,b.caption=c.html(),b.mediaID=a.id,b}return null}).filter(_.identity).map(function(a,c){return a.index=c,a.mediaID===b.data("mediaid")&&(j=c),a}).value(),h=new l(g),h.setCurrentIndex(j),i=new o(h),i.on("slide:rendered",function(){f.send("DOMReady")}),e.trackMediaGalleryOpen(c),i.open()})})})}(),function(){"use strict";function a(){return $("<div></div>").addClass("expanderIcon jsExpandCollapse jsDisableSavedStates collapsed").data("expandaction","collapsed").data("collapseaction","expanded").data("handle-root",".L1")}function b(){return $('<a href="#"></a>').addClass("jsExpandAll").html(_t("CMSPUBS.LnkExpand")).data("scope",".readingPane")}function c(){return $('<a href="#"></a>').addClass("jsCollapseAll").html(_t("CMSPUBS.LnkCollapse")).data("scope",".readingPane")}function d(){$(".outline .jsBibleLink").addClass("jsNoPreload")}if($("body").hasClass("StudyBible")){var e=module.require("signal");$(document).ready(d),e.listen("DOMReady",d),e.listen("DOMReady",function(){var d=$(".StudyBible .outline").filter(":not(:has(.jsExpandCollapse))");d.exists()&&(d.find(".L1").each(function(){var b=$(this),c=b.find("> ul");c.exists()&&(b.find("> p").append(a()).addClass("expanderWrapper"),c.addClass("jsCollapsableBlock").hide())}),d.filter(":not(.partial)").each(function(){var a=$(this),d=$('<div class="expanderControls clearfix"></div>');d.append(c()).append(b()),a.prepend(d)}))})}}(),$(function(){"use strict";var a,b,c,d,e=module.require("ScriptureDialog"),f=module.require("BibleVerseRangeCollection"),g=module.require("signal");a=function(a){var b,c=a.split("#"),d=$.Deferred();return 2!==c.length?(d.reject(),d):(b=c.pop(),c=c.pop(),$.getCached(c,"html",!0).done(function(c){c=$(c);var e=$("<div></div>"),f=$("<a></a>").attr("href",a);e.addClass("ftnGlossaryTerm"),e.append("<h2>"+_t("CMSPUBS.HdgGlossaryTerm")+"</h2>"),e.append(c.find("#"+b).contents()),e.find("h3").has(".dt").wrapInner(f),e.find('a[target="_blank"]').removeAttr("target"),d.resolve(e)}),d)},b=function(){var a,b,c,d,g=$(this);g.addClass("jsHasModalListener"),d=function(){var a=g.data("hide-link-ranges")||"";return f.splitRanges(a)},a=g.data("targetverses"),b=new e(a,g.data("bible"),g.hasClass("xrefLink"),d),c=g.children(":first").is("strong")||g.parent().hasClass("themeScrp"),!g.hasClass("jsNoPreload")&&c&&b.load(),g.on("mouseover",function(){$(event.currentTarget).hasClass("jsNoDialog")||b.load()}),g.on("click",function(a){$(a.currentTarget).hasClass("jsNoDialog")||(a.preventDefault(),b.isOpen||(b.dialogClass=$(this).data("dialogsource"),b.open()))})},c=function(){var b,c,d,e=$(this),f=e.attr("href").replace(/.*#/,""),g=$("#"+f),h=$("<div></div>");e.hasClass("footnoteLink")?(b=_t("CMSPUBS.HdgFootnote"),c='a[href*="footnotesource"]',d="footnoteList"):e.hasClass("endnoteLink")&&(b=_t("CMSPUBS.HdgEndnote"),c='a[href*="endnotesource"]',d="endnoteList"),e.addClass("jsHasModalListener"),h.append(g.clone()),h.attr("title",b),h.find(c).hide(),h.addClass(d),h.find(".jsGlossaryLink").each(function(){var b=$(this),c=b.attr("href");a(c).done(function(a){h.append(a),b.replaceWith(b.contents())})}),e.on("click",function(a){var b=e.data("dialogsource");$(a.currentTarget).hasClass("jsNoDialog")||(a.preventDefault(),h.dialog({dialogClass:b,open:function(){$(".ui-widget-overlay").addClass(b)},closeText:_t("CMSPUBS.LnkCloseUppCase")}),h.parent().find(":button").first().focus())})},d=function(){var a=$("body.dc115 .jsBibleLink, body.BibleReadingPage #bibleChOutlineContainer .jsBibleLink");a.each(function(){$(this).removeAttr("target")}),$(".jsBibleLink").not(".jsNoDialog").not(".jsHasModalListener").not(a).each(b),$(".footnoteLink").not(".jsNoDialog").not(".jsHasModalListener").each(c),$(".endnoteLink").not(".jsNoDialog").not(".jsHasModalListener").each(c),$(".jsBibleLink, .footnoteLink").not(a).addClass("jsNoScroll"),$(".jsBibleLink, .endnoteLink").not(a).addClass("jsNoScroll")},d(),g.listen("DOMReady",d)}),function(){"use strict";var a,b,c,d=module.require("url"),e=module.require("settings"),f=module.require("signal"),g=module.require("ContextMenu"),h=e.getSetting("HIGHLIGHT_VS_CONTENT_CLASS"),i=/p\d+/;b=function(){$("."+h).removeClass(h)},a=function(a){var b,c,d,e,f,g,h,i,j,k=function(a){return $("*[id='%s'], *[class~='%s']".format(a,a))};if(a=a.split("-"),b=a.filter(function(a){return/^[pv]([0-9]+)$/.test(a)&&k(a).exists()}),b.length){if(1===b.length)c=k(b[0]);else for(d=b[0],e=b[1],f=parseInt(d.match(/\d+/)),g=parseInt(e.match(/\d+/)),i=d,c=k(d),h=f;g>h;h++)j=i.replace(h.toString(),(h+1).toString()),c=c.add(k(j)),i=j;return c}},c=function(){function a(a){var c=e.indexOf(a);e.splice(c,1),b(),a.close()}function c(){_.each(e,a)}function d(c){var d,f;return _.each(e,a),d=new g(c,$("body")),f=d.open(),f&&(b(),c.addClass(h),e.push(d)),f}var e=[];return $(window).hammer().on("click resize",c),{open:d,close:a,closeAll:c}}(),$("a[data-highlightrange]").each(function(){var a,b;a=$(this).data("highlightrange"),b=d.parse($(this).attr("href")),b.hash.path=a,b=d.build(b),$(this).attr("href",b)}),$("*[id^='p']").each(function(){var a=$(this),b=a.attr("id");b.match(i)&&a.addClass(b)}),module.get("AnchorLinkController").addTargetResolver(function(d){var e,g,j,k=a(d);return b(),c.closeAll(),k?(e=$(".verse"),g=$("#article *[class^=p]").filter(function(){return this.className.match(i)}),j=e.add(g),k.length<j.length&&k.addClass(h),f.listen("PageLoaded",function(){k.length<j.length&&(b(),k.addClass(h))}),k.filter(":first")):void 0}),f.listen("DOMReady",function(){var a,b;a=_.reduce(_.range(10),function(a,b){return a.concat("*[class^=p"+b+"]")},[".verse"]),a=a.join(","),b=$("#article").find(a),b=b.hammer({stop_browser_behavior:!1}),b.addClass("disableActiveState"),b.not(".jsHasHighlightListener").addClass("jsHasHighlightListener").on("click",function(b){var d=$(this),e=$(b.target);d.find(a).length>0||e.is("a")||e.closest("a").length>0||c.open(d)&&b.stopPropagation()})})}(),$(function(){"use strict";var a,b=module.require("ChildWindow");a=function(a){a.preventDefault();var c,d;d={resizable:$(this).data("resizable")?!0:null,scrollbars:$(this).data("scroll")?!0:null,width:$(this).data("width")||null,height:$(this).data("height")||null,menubar:$(this).data("menubar")?!0:null,toolbar:$(this).data("toolbar")?!0:null,location:$(this).data("location")?!0:null},c=new b,c.setURL($(this).attr("href")),c.setOptions(d),c.open()},$(document).on("click","a.jsPopup",a)}),$(function(){"use strict";$(document).on("click",".jsPrint",function(a){a.preventDefault(),window.print()})}),function(){"use strict";var a,b=module.require("settings"),c=module.require("signal");a=function(a){b.setPageConfig("ACCESSIBILITY_MODE",a),a?($("body").addClass("screenReaderMode"),c.send("EnableAccessibilityMode")):($("body").removeClass("screenReaderMode"),c.send("DisableAccessibilityMode"))},$(document).on("click",'#accessibilitySettingControl input[type="radio"]:checked',function(){var b=!!parseInt($(this).val(),10);a(b)}),$(function(){var c=b.getPageConfig("ACCESSIBILITY_MODE");$('#accessibilitySettingControl input[type="radio"][value="'+(c+0)+'"]').click(),a(c)})}(),function(){"use strict";var a,b,c,d,e="otherContentLang",f=module.require("settings"),g=module.get("Navigation");a=function(a){a.preventDefault();var b=$(this).children("option:selected"),c=b.data("url"),d=b.data("lang"),h=$.cookie("ckLang"),i=["#article","#pageConfig","#bibleTitleText"];return"null"===c||""===c?!1:(d&&$.cookie(e,d,{expires:null,path:"/"}),void g.swapContent(c,i).done(function(){h&&($.cookie("ckLang",h,{expires:null,path:f.getPageConfig("BASE_PATH")}),window.jworg.setContentAttributes())}))},b=function(a){a.preventDefault();var b=$(this),c=b.children(":selected").data("url"),d=b.data("contentswap");if(d=d.split(","),d=d.length?d:["#regionPrimaryNav","#regionMain","title"],
c&&c!==window.location.href){if(!(window.history&&"pushState"in window.history))return void(window.location.href=c);history.pushState("","",c),g.swapContent(c,d)}},c=function(){var a=$("#otherAvailLangsChooser"),b=$.cookie(e),c=d(b),g=f.getPageConfig("CONTENT_LANG"),h=!1,i=$("#otherLangRibbon");b&&c&&(a.find("option").each(function(a,c){var d=$(c).data("lang");h===!1&&d&&d===b&&(h=$(c))}),h&&g!==b&&(i.html(i.html().split("%%").join(c)),$(".yes",i).click(function(b){b.preventDefault();var c=a.data("autocomplete");c.selectOption(c.options.indexOf(h.val())),i.fadeOut()}),$(".no",i).click(function(a){a.preventDefault(),$.removeCookie(e,{path:"/"}),i.fadeOut()}),i.fadeIn()))},d=function(a){var b=$("#otherAvailLangsChooser"),c=b.find('[data-lang="%s"]'.format(a));return c?c.html():!1},$(document).on("change",".jsReplaceContent",b),$(document).on("change","#otherAvailLangsChooser",a),c()}(),$(function(){"use strict";var a,b,c,d,e="open",f="leftPanel",g="mobileUnderlay",h=50,i=module.require("signal"),j=module.require("LanguagePicker"),k=module.require("SimpleModal"),l=$("#mobileNavTopBar .mobileMenu"),m=$("#mobileNavShelf .close"),n=$("#mobileNavTopBar .mobileSearch"),o=$("#mobileSearchForm .close"),p=$("#mobileNavTopBar .mobileLang"),q=$("#mobileLangShelf .close"),r=$("#mobileNav .jsExpandNav"),s=$("#mobileTOCHandle"),t=$("#mobileStudyPaneHandle"),u=$("#mobileNav, #mobileNavShelf"),v=$("#mobileLang, #mobileLangShelf"),w=$("#mobileSearchForm"),x=$("#mobileTOC"),y=$("#mobileStudyPane"),z=[];$(document).on("change","select.jsSubmitOnChange",function(a){a.preventDefault(),$(this.form).submit()}),$(document).on("click",".jsChooseSiteLanguage, .jsChooseSignLanguage",function(a){var b=$(this),c=new j;a.preventDefault(),c.forceOnlySL=b.hasClass("jsChooseSignLanguage"),c.open()}),b=function(){var a=$("#"+g);return a.exists()||(a=$("<div></div>"),a.attr("id",g),$("body").append(a),$("#regionMain").height(screen.height-50)),a},c=function(){var a=$("#"+g);a.exists()&&(a.remove(),$("#regionMain").height(""))},a=function(a,d,g){function j(){var a=Math.max(document.documentElement.clientWidth,window.innerWidth||0);g.width(a-h)}var m,n=!1,o={events:$({})};return m=_.throttle(j,50),$(window).resize(m),k.registerResizeListener(m),o.isOpen=!1,o.animationProperty=function(){var a=g.hasClass(f),b=$("body").hasClass("dir-rtl");return a=b?!a:a,a?"left":"right"}(),o.trigger=function(a){this.events.trigger(a,this)},o.animate=function(a,b){var c={};c[this.animationProperty]=b,a.animate(c)},o.open=function(){_.each(z,function(a){a.close()}),this.isOpen||(b().click(this.close.bind(this)),a.addClass(e),this.animate(g,0),this.isOpen=!0,j(),this.trigger("open"),i.send("mediaPause")),n||(n=!0,this.trigger("first-open")),l&&l.attr("title",_t("CMSPUBS.LnkHideMenu"))},o.close=function(){c(),this.isOpen&&(a.removeClass(e),this.animate(g,"-100%"),this.isOpen=!1,this.trigger("close")),l&&l.attr("title",_t("CMSPUBS.LnkShowMenu"))},o.toggle=function(){this.isOpen?this.close():this.open()},a.click(o.toggle.bind(o)),d&&d.click(o.close.bind(o)),g.on("panel:toggle",o.toggle.bind(o)),g.on("panel:open",o.open.bind(o)),g.on("panel:close",o.close.bind(o)),z.push(o),o},a(l,m,u),a(p,q,v).events.on("first-open",function(){var a=new j;a.open(function(){a.container.removeClass("largeModalContent"),$("#mobileLang").html(a.container),$("#mobileLangShelf").append(a.container.find("p.jsLanguageCount"))})}),a(n,o,w),d=function(b,c){function d(){f.isOpen&&b.css(f.animationProperty,c.width())}var e,f=a(b,null,c);return f.events.on("open",function(a,d){var e=c.width();d.animate(b,e)}).on("close",function(a,c){c.animate(b,0)}),e=_.throttle(d,50),$(window).on("resize",e),k.registerResizeListener(e),f},d(t,y),d(s,x),$("#mobileNav .jsCollapsableBlock").hide(),r.click(function(){var a="expanded",b=$(this),c=b.parents(".mobileNavLink").next(".jsCollapsableBlock"),d=b.hasClass(a);d?(b.removeClass(a),b.attr("title",_t("CMSPUBS.LnkOpenUppCase")),c.stop().slideUp()):(b.addClass(a),b.attr("title",_t("CMSPUBS.LnkCloseUppCase")),c.stop().slideDown())}),r.filter(".jsPreExpand").click()}),function(){"use strict";var a,b,c,d,e,f=".jsDownload:not(.disabled)",g=".jsTourBrochureDownload:not(.disabled)",h=module.require("signal"),i=module.require("browser"),j=module.require("PubMediaResource"),k=module.require("DownloadModal"),l=module.require("BibleModal"),m=module.require("TourBrochureModal"),n=module.require("VideoModal"),o=module.require("VideoBibleModal"),p=module.require("InternalPubModal");i.supportsTemplating()&&(e=function(a,b){p.shouldBePresented(a)?(new p).present(b):b()},a=function(a){var b,c,e,f,g=$("body"),h=$(this),i=h.data("jsonurl"),k=h.data("page-id");if(!g.hasClass("signLanguage")||g.hasClass("publications")||!h.hasClass("jsVideoModal")||!h.hasClass("jsCoverDoc")){if(a.preventDefault(),f=h.data("preselect"),h.hasClass("jsVideoBible"))return c=h.data("books"),e=new o(c,i),void e.open();b=new j(i),b.setPageID(k),d(b,h,f)}},b=function(a){for(var b=a.parent();0===b.find(".relatedImage:first").length&&0!==b.parent().length;)b=b.parent();return b.find(".relatedImage:first img").attr("src")||b.find(".relatedImage:first").data("src")||""},c=function(){var a=$(this),b=a.data("jsonurl");$.getJSONCached(b).done(function(b){0===b.files.length&&a.remove()})},d=function(a,c,d){var f;c.hasClass("jsTourBrochureDownload")?f=new m(a):c.hasClass("jsBible")?f=new l(a,d):c.hasClass("jsVideoModal")?(f=new n(a),f.setCoverDocURL(c.data("coverurl")),f.setTitle(c.data("onpagetitle")),f.setAutoPlay(!0)):f=new k(a,d),f.setCoverImage(b(c)),f.setDefaultPubName($(".onPageTitle").html()),e(c,function(){f.open()})},$(document).on("click",f,a),$(document).on("click",g,a),h.listen("DOMReady",function(){$(g).each(c)}))}(),function(){"use strict";var a,b=module.require("PubMediaResource"),c=module.require("VideoModal"),d=module.require("VideoBibleModal"),e=module.require("signal");a=function(){var a,e,f,g=$(this),h=g.data("page-id"),i=g.data("style"),j=$("body").hasClass("jsBibleModal"),k=g.data("jsonurl");j?(f=g.data("books"),e=new d(f,k)):(a=new b(k),a.setPageID(h),e=new c(a)),e.open(function(a){a=$(a),a.find("div.videoModal").addClass("embeddedVideo").addClass(i),g.replaceWith(a)})},e.listen("DOMReady",function(){$(".jsIncludeVideo").not(".jsHasVideo").addClass("jsHasVideo").each(a)})}(),$(function(){"use strict";var a,b=module.require("PubMediaResource"),c=module.require("DownloadModal"),d=module.require("BibleModal");a=function(a,b){var e;e=$("body").hasClass("jsBibleModal")?new d(a):new c(a),e.setCoverImage($(".cvr img").attr("src")),a.getPubName().then(function(a){document.title=a}),e.open(function(a){b.replaceWith(a),a.find(".jsLanguageTab:first").click()})},$(".jsIncludeDownloadModal").each(function(){var c=$(this),d=new b(c.data("jsonurl"));a(d,c)})}),function(){"use strict";var a,b,c;a=function(a){a.preventDefault();var c=$(this);$(".jsPublicationFilterContainer").length>1&&b(c)},b=function(a){var b,d,e=a.closest("form"),f=$(e).attr("action")+"json/filters/",g=$(e).serialize();d=$(a).parent(".jsPublicationFilterContainer").nextAll(".jsPublicationFilterContainer").find(".jsPublicationFilter"),d.each(function(){var a=$(this).data("filtertype");a&&(b=f+a+"/?"+g,$.getJSONCached(b).done(function(a){var b=$("#"+a.id);c(b,a.choices)}))})},c=function(a,b){a=$(a);var c,d,e,f,g=0,h=a.children(":selected").val();if(a.children().remove(),0===b.length)return a.closest(".jsPublicationFilterContainer").hide(),0;for(a.closest(".jsPublicationFilterContainer").show(),e=0;e<b.length;e++)d=b[e],c=$(document.createElement("option")),c.val(d.optionValue),c.html(d.optionName),c.val()===h&&(g=e,c.prop("selected",!0)),a.append(c);return f=a.data("autocomplete"),f&&(f.clearOptionCache(),f.loadOptions()),g},$(document).on("change",".jsPublicationFilter",a)}(),$(function(){"use strict";var a=module.require("settings"),b=module.require("browser");b.supportsTemplating()&&$(".jsDownload:not(.jsVideoModal.jsCoverDoc)").each(function(){var b=$(this),c=b.attr("href"),d=b.hasClass("jsBible")||b.hasClass("jsVideoBible");c=c.split("?")[1],c+="&isBible="+(d?1:0),c=a.getSetting("DOWNLOAD_WINDOW_URL")+"?"+c,b.attr("href",c)})}),function(){"use strict";var a,b=",";a=function(){var a,c,d,e=$(this),f=e.data("toggle-class"),g=e.data("toggle-target"),h=$(g);for(f=f.replace(" ","").split(b),a=0;a<f.length;a++)if(c=f[a],h.hasClass(c)){d=f[a+1]||f[0];break}d||(d=f[0]),h.removeClass(c),h.addClass(d)},$(document).on("click",".jsToggleOnClick",a),$(document).on("mouseenter mouseleave",".jsToggleOnHover",a)}(),function(){"use strict";var a,b;a=function(){var a=$(this),b=a.parents(".filterOptions").has(".filterSubOptions").children('input[type="checkbox"]'),c=b.parents(".filterOptions").find('.filterSubOptions input[type="checkbox"]'),d=c.filter(":checked").length===c.length;b.prop("checked",d)},b=function(){var a=$(this),b=a.parents(".filterOptions").find('.filterSubOptions input[type="checkbox"]');b.prop("checked",a.prop("checked"))},$(document).on("change",'.jsToggleSubOptions .filterOptions:has(.filterSubOptions) > input[type="checkbox"]',b),$(document).on("change",'.jsToggleSubOptions .filterSubOptions input[type="checkbox"]',a)}(),function(){"use strict";function a(){$(".jsRespImg").each(function(){var a=$(this);d(a)})}var b,c,d,e=module.require("signal");b=function(a,b){var d="lg",e="lg",f=c();return f?(f>=801?d="lg":f>=460?d="md":f>=241?d="sm":f>0&&240>=f&&(d="xs"),e=d,("cnt"===a.data("img-type")||"sub"===a.data("img-type"))&&(b.hasClass("threequarter")?e="xs"===d?"sm":"md":b.hasClass("half")?e="xs"===d?"xs":"sm":b.hasClass("quarter")?e="xs":"xs"===d?e="sm":"lg"!==d&&(e="md")),e):e},c=function(){var a=$(window).width();return screen&&(a=Math.max(a,screen.width,screen.height)),a},d=function(a){var c,d,e=$("<img />"),f=a.getAttributes("data-img-size-",!0),g=a.data("zoom"),h="";return $.each(a.getAttributes("data-img-att-",!0),function(a,b){e.attr(a,b)}),d=b(a,e),$.each(["xs","sm","md","lg"],function(a,b){return f.hasOwnProperty(b)&&(h=f[b]),b===d?!1:void 0}),"lsr"!==a.data("img-type")&&"sqr"!==a.data("img-type")||$("body").hasClass("PublicationArticle")||(g=""),e.data("zoom",g),e.attr("src",h),g&&!a.parents("a").exists()?(c=$("<a />"),c.addClass("zoom"),c.attr("href",g),c.attr("target","_blank"),c.append(e),void a.replaceWith(c)):void a.replaceWith(e)},e.listen("DOMReady",a)}(),$(function(){"use strict";$(".jsRandomImg").each(function(){var a=$(this),b=$("<img />"),c=a.getAttributes("data-img-",!0,!1),d=0;c.length&&(d=Math.floor(Math.random()*c.length),b.attr("src",c[d]),a.replaceWith(b))})}),$(function(){"use strict";var a,b=module.require("ImageModal");a=function(a){var c=$(this).find("img"),d=c.data("zoom")||c.attr("src"),e=new b(d);a.preventDefault(),e.open()},$(document).on("click","a.zoom",a)}),function(){"use strict";var a,b,c=".wide",d="jsOpenTable",e="jsCloseTable",f="popped",g=module.require("signal"),h=$("<div></div>"),i=$("<p></p>"),j=$("<p></p>");a=function(){var a=$(this).closest(c);a.find("."+d).hide(),a.find("."+e).show(),a.addClass(f)},b=function(){var a=$(this).closest(c);a.find("."+d).show(),a.find("."+e).hide(),a.removeClass(f)},h.addClass("wideControls"),i.addClass("openPopout").addClass(d).html(_t("CMSPUBS.LnkEnlargeScroll")).appendTo(h),j.addClass("collapsePopout").addClass(e).html(_t("CMSPUBS.LnkCloseUppCase")).hide().appendTo(h),g.listen("DOMReady",function(){$(c).each(function(){$(this).closest(".StudyBible").exists()||$(this).prepend(h.clone())})}),$(document).on("click","."+d,a).on("click","."+e,b)}(),function(a,b){"use strict";var c=module.require("signal"),d=module.require("autocomplete");c.listen("DOMReady",function(){var a=b("select.jsAutoComplete");a.each(function(){var a=b(this),c=a.data("max-columns")||4,e=a.hasClass("jsShowFeatured");d.init(a,{maxColumns:c,showFeatured:e})})})}(window,jQuery),$(function(){"use strict";var a,b,c,d="HAS_DISMISSED_TOU_NOTICE",e=!1;c=function(){b.slideUp(function(){b.remove()}),$.persistentData(d,!0)},a=function(){var a=$("<p></p>"),d=$(".termsLinks a.jsTermsOfUse").clone(),e=$("<button></button>");b=$("<div></div>"),a.html(_t("CMSPUBS.MsgUpdatedTermsAlert")+" "),a.append(d),e.html(_t("CMSPUBS.LnkCloseUppCase")),e.addClass("closeAlert").addClass("jsCloseModal"),b.addClass("TOUNotice"),b.append(e),b.append(a),b.hide(),$("body").append(b),b.slideDown(),e.one("click",c),d.one("click",c)},e&&!$.persistentData(d)&&setTimeout(a,1e3)}),function(){"use strict";var a,b=module.require("signal"),c=module.require("StreamingController");a=function(){$(".jsMediaPlayer").not(".jsMediaPlayerLoaded").not(".jsMediaPlayerLoading").addClass("jsMediaPlayerLoading").each(function(){var a=$(this),b=a.data("jsonurl");c.from_url(b,a)})},b.listen("DOMReady",function(){a()})}(),function(){"use strict";var a,b=module.require("signal");a=function(){$("body").removeClass("noJS").addClass("yesJS")},b.listen("DOMReady",function(){a(),$(".hideObj, .showObj, .jsHide").each(function(){var a=$(this);!function(){var b=a.css("display");a.css("display",b),a.removeClass("hideObj").removeClass("showObj").removeClass("jsHide")}()})})}(),$(function(){"use strict";var a,b,c="BibleNavigationPinIsDisabled",d="unpinned",e="excludePin",f=$(".jsBibleNav .jsPinToggle"),g=module.require("settings");b=function(a){var b=a.closest(".jsBibleNav"),f=b.next(".jsViewportPinWrapper").children(".jsViewportPin");b.prependTo(f),b.removeClass(e),a.removeClass(d),g.setPageConfig(c,!1)},a=function(a){var b=a.closest(".jsBibleNav"),f=b.closest(".jsViewportPinWrapper");b.addClass(e),b.insertBefore(f),a.addClass(d),g.setPageConfig(c,!0)},f.click(function(){var c=$(this);c.hasClass(d)?b(c):a(c)}),g.getPageConfig(c)&&a(f)}),function(){"use strict";var a,b="[data-json-schema]",c=module.require("Chart"),d=module.require("settings"),e=module.require("signal"),f=d.getSetting("IS_RTL"),g="jsChart";a=function(){var a,b=$(this),d=b.data("json-id"),e=b.data("json-schema"),h=b.data("json-config"),i=b.data("json-payload");d&&e&&h&&i&&(a=$.extend(!0,{RTL:f},h,i),b.children().hide(),b.append('<div id="'+d+'" class="'+g+'" />'),new c(e,d,a).create())},Modernizr.canvas&&e.listen("DOMReady",function(){$(b).each(a)})}(),function(a,b){"use strict";var c,d,e,f,g=module.require("settings");b("html").hasClass("ie8")||(c=module.require("signal"),d=module.require("MediaGallery"),e=module.require("GalleryCollection"),f=module.require("MediaGalleryModal"),c.listen("DOMReady",function(){b(".jsMediaGallery").each(function(c,h){var i,j,k;h=b(h),i=e.fromElement(h.find(".jsGalleryDataSource").first()),j=new d(h,i),j.on("firstRender:post",function(){b(".jsGalleryDataSource").css("display","none"),j.goToFirstSlide(),h.find(".jsGalleryFullscreenBtn").on("click",function(){var a=new f(i);a.on("close:pre",function(){j.prepareForDisplay()}),a.open()})}),k=function(){var a=this.lookupScope.find(".jsSlideContainer"),b=this.lookupScope.find(".jsDisplayArea"),c=g.getSetting("IMAGE_GALLERY_IMAGE_RATIO"),d=a.width()*c;b.height(d),a.find("img").css("max-height",d+"px")}.bind(j),j.on("slide:rendered",k),b(a).resize(function(){k()}),j.render()})}))}(window,jQuery),function(){"use strict";var a,b,c=module.require("SimpleModal"),d=$("#templates .template.preDisplayVerification").children(),e=$("body").attr("id"),f=e+"-verified";d.length&&($.persistentData(f)||(b=d.clone(),b.find(".jsYes").on("click",function(a){a.preventDefault(),$.persistentData(f,!0),c.close()}),a=new c(b,!0),a.updateSettings({closeOnEscapeKey:!1,closeOnOverlayClick:!1,maxWidth:400}),a.open()))}(),function(){"use strict";var a,b=module.require("signal"),c="textView",d="imageView",e="selected",f=".jsSelectTextView",g=".jsSelectImageView";a=function(){var a,b,g=$(this),h=g.siblings(f);g.data("has-view-switcher")||(g.data("has-view-switcher",!0),b=function(){var a=$(g.data("target"));g.addClass(e),h.removeClass(e),a.removeClass(c).addClass(d)},a=function(){var a=$(h.data("target"));h.addClass(e),g.removeClass(e),a.removeClass(d).addClass(c)},g.on("click",b),h.on("click",a),$("body.preferHTMLOverSubImg").length>0?a():b())},b.listen("DOMReady",function(){$(g).each(a)})}(),function(){"use strict";var a,b=module.require("signal"),c=".jsCurrentYear";a=function(){var a=new Date,b=a.getFullYear();$(this).html(b)},b.listen("DOMReady",function(){$(c).each(a)})}(),function(){"use strict";var a,b=module.require("signal"),c=module.require("FinderLink"),d=".jsFinderLink",e=["docid","prefer","pub","issue"];a=function(){var a,b,d=$(this);b=_.reduce(e,function(a,b){return d.data(b)&&(a[b]=d.data(b)),a},{}),a=c.create(b),d.attr("href",a)},b.listen("DOMReady",function(){$(d).each(a)})}(),function(){"use strict";var a,b=$("html").hasClass("ie8"),c="IE8LastShownTimestamp",d=864e5;b&&(a=function(){var a,b=$.now(),e=$.persistentData(c);(!e||b-d>e)&&($.persistentData(c,b),a=_t("CMSPUBS.IE8Alert"),a=a.replace(/\\n/g,"\n"),window.alert(a))},$(document).ready(a))}(),function(){"use strict";var a,b,c,d,e,f,g=module.require("signal"),h=module.require("settings"),i=".announcementsAccordion .countBadge",j=$("body").hasClass("dc143"),k=$("body").hasClass("WhatsNewPage"),l=$("body").hasClass("news");(j||k)&&(a=function(a){return a+"-"+h.getPageConfig("WT_LANG")+"-ReadStatus"},b=function(){var b=a($("body").attr("id"));c(b)||$.persistentData(b,"read")},c=function(a){return"read"===$.persistentData(a)},d=function(){var b=a($(this).data("html-id"));c(b)||($(this).addClass("jsUnread"),$(this).find("a").prepend('<span class="unread"></span>'))},e=function(){$(".jsAnnouncement").removeClass("jsUnread"),$(".unread").remove()},f=function(){var a=$(".jsUnread").length;a>0?($(i).text(a.toString()),$(i).css("display","block")):$(i).css("display","none")},g.listen("DOMReady",function(){j&&!l?b():k&&($(".jsAnnouncement").each(d),f())}),$(window).on("pageshow",function(a){k&&a.originalEvent.persisted&&(e(),$(".jsAnnouncement").each(d),f())}))}(),function(){"use strict";function a(){return"mid1001070103"===$("body").attr("id")}if($("body").hasClass("StudyBible")){var b,c,d,e=module.require("MediaPage"),f=module.require("signal"),g="<span></span>";c=$(g).addClass("tocIcon"),d=$(g).addClass("pageName").html(_t("CMSPUBS.HdgMedia")),b=$("<a></a>").attr("href",window.location.href).attr("data-page-id",e.PAGE_ID).addClass($("body").attr("class")).addClass("appendix jsBibleNavigation jsMediaPageLink").append(c).append(d),f.listen("DOMReady",function(){if(a()){var c=$(".jsStudyBibleAddPages");c.find(".jsMediaPageLink").exists()||c.append(b)}})}}(),function(){"use strict";var a,b,c,d,e,f,g=$("body"),h=["mid1001061173","mid1001061175"],i=module.require("settings");g.hasClass("BiblePublicationArticle")&&-1!==h.indexOf(g.attr("id"))&&(a=$("#article p.docNav"),b=a.find("a"),c=$(".jsViewportPin"),d=$("#article h2"),e=module.get("AnchorLinkController"),b.removeAttr("target"),c.exists()&&a.exists()&&a.appendTo(c),d.each(function(){var a=$(this),b=$("<a></a>").html(a.html()),c=a.next();a.html(b),a.addClass("jsExpandCollapse").addClass("viewHdgCollapse").data("expandaction","viewHdgCollapse").data("collapseaction","viewHdgExpand"),b.append($("<span></span>").addClass("accordionSprite")),c.addClass("jsCollapsableBlock").hide()}),f=function(a){var b,c,d=$("#"+a),f=i.getSetting("HIGHLIGHT_VS_CONTENT_CLASS");if(d.exists()&&(c=d.is("h2")?d.next("ul,.pGroup"):d.closest("ul,.pGroup"),b=c.prev("h2"),c.exists()&&b.exists()))return b.filter(".viewHdgCollapse").click(),c.promise().done(function(){e.scrollTo(d)}),$("."+f).removeClass(f),d.addClass(f),d},e.addTargetResolver(f))}(),$(function(){"use strict";if($("body").hasClass("SearchPage")){var a=module.require("url"),b=$("#insightAnalytics").data("search_id"),c=parseInt(a.parse().query.s||0,10);$("#SearchResultsList > div").each(function(){var d=$(this);d.find("a").each(function(){var e=$(this),f=e.attr("href");f=a.parse(f),f.hash.query.insight=f.hash.query.insight||{},f.hash.query.insight=$.extend(f.hash.query.insight,{search_id:b,search_result_index:c+d.index()}),f=a.build(f),e.attr("href",f)})}),$(".pagination .links a").each(function(){var c=$(this),d=c.attr("href");d=a.parse(d),d.hash.query.insight=d.hash.query.insight||{},d.hash.query.insight.search_id=b,d=a.build(d),c.attr("href",d)})}}),function(){"use strict";rivets.formatters.length=function(a){return a.length},rivets.formatters.addOne=function(a){return a+1},rivets.formatters["!"]=function(a){return!a},rivets.formatters["default"]=function(a,b){return null===a||_.isUndefined(a)?b:a},rivets.formatters.concat=function(){var a=Array.prototype.slice.call(arguments);return _.reduce(a,function(a,b){return a+" "+b},"")},rivets.formatters.strfmt=function(a,b){return b.format(a)}}(),function(){"use strict";rivets.binders["update-gallery-index"]={publishes:!0,bind:function(a){var b=this,c=$(a);this.callback=function(){var a=c.data("item-index");b.view.models.controller.dataSource.setCurrentIndex(a)},$(a).on("click",this.callback)},unbind:function(a){$(a).off("click",this.callback)},routine:function(a,b){$(a).data("item-index",b)}},rivets.binders.addclass=function(a,b){b&&$(a).addClass(b)},rivets.binders["responsive-image"]=function(a,b){$(a).addClass("jsRespImg"),_.each(b,function(b,c){$(a).attr("data-img-size-"+c,b)})},rivets.binders["data-*"]=function(a,b){var c;return this.type&&(c=this.type.replace("data-",""),$(a).data(c,b)),void 0!==b?a.setAttribute(this.type,""+b):a.removeAttribute(this.type)}}(),function(){"use strict";function a(a,b,c){"string"==typeof c&&_.each(c.split(" "),function(c){a.trigger("class:"+b+":"+c,a)})}var b=$.fn.addClass,c=$.fn.removeClass;$.fn.addClass=function(c){var d=b.apply(this,arguments);return a(this,"add",c),d},$.fn.removeClass=function(b){var d=c.apply(this,arguments);return a(this,"remove",b),d}}();
//# sourceMappingURL=cms.js.map