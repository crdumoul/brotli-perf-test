/*! 25-11-2015 */

function fsSceConfig($sceDelegateProvider){$sceDelegateProvider.resourceUrlWhitelist(["self","http://www*.jetblue.com/**","https://www*.jetblue.com/**"])}BookerWrapper=angular.module("BookerWrapper").controller("Booker",["$scope","$rootScope","$timeout","BookerConfig","jbOverlayFactory","AirportData","$filter","$window","$sce",function($scope,$rootScope,$timeout,BookerConfig,jbOverlayFactory,AirportData,$filter,$window,$sce){function setSchedExtDate(){scheduleExtDate&&new Date(scheduleExtDate.month+"/"+scheduleExtDate.day+"/"+scheduleExtDate.year)>new Date&&(tempdate=new Date(scheduleExtDate.month+"/"+scheduleExtDate.day+"/"+scheduleExtDate.year)),$scope.scheduleExtDate=tempdate}function defaultCal(){this.date=null,this.isOpen=!1,this.options={startingDay:0,showWeeks:!1,showButtonBar:!1},this.minDate=new Date,this.maxDate=$scope.scheduleExtDate,this.extDate=$filter("date")($scope.scheduleExtDate,"MMMM d, yyyy"),this.extDate.split(" ")[0].length>4&&(this.extDate=this.extDate.split(" ").slice(0,1).toString().substr(0,3)+". "+this.extDate.split(" ").slice(1).join(" "))}function multicitySelections(){$scope.clearTripLine=function(id){$scope["toSelectedObj"+id]=$.extend({},defaultObj),$scope["fromSelectedObj"+id]=$.extend({},defaultObj),$scope.MC["fromResult"+id]="",$scope["fromSelectedObj"+id].label="",$scope["fromSelectedObj"+id].code="",$scope.MC["toResult"+id]="",$scope["toSelectedObj"+id].label="",$scope["toSelectedObj"+id].code="",$scope["departCal"+parseInt(id)].date=null,$scope.mcDateError["departCal"+parseInt(id)]=!1},$scope.departCal1=new defaultCal,$scope.departCal2=new defaultCal,$scope.departCal3=new defaultCal,$scope.departCal4=new defaultCal,$scope.thirdTripLine=$scope.fourthTripLine="disabled_line",$scope.openMultiDepartCalendar=function($event,id){switch($event.preventDefault(),$event.stopPropagation(),id){case 1:$scope.departCal2.isOpen=!1,$scope.departCal3.isOpen=!1,$scope.departCal4.isOpen=!1;break;case 2:$scope.departCal1.isOpen=!1,$scope.departCal3.isOpen=!1,$scope.departCal4.isOpen=!1;break;case 3:$scope.departCal1.isOpen=!1,$scope.departCal2.isOpen=!1,$scope.departCal4.isOpen=!1;break;case 4:$scope.departCal1.isOpen=!1,$scope.departCal2.isOpen=!1,$scope.departCal3.isOpen=!1}$scope["departCal"+id].isOpen=!$scope["departCal"+id].isOpen},$scope.$watch("departCal1.date",function(newVal,oldVal){$(".clndr2 .active").removeClass("active"),$(".clndr3 .active").removeClass("active"),$(".clndr4 .active").removeClass("active"),newVal&&($scope.departCal2.minDate=newVal,$scope.departCal3.minDate=newVal,$scope.departCal4.minDate=newVal,$scope.departCal2.date<$scope.departCal1.date&&($scope.departCal2.date=null,$scope.departCal3.date=null,$scope.departCal4.date=null))}),$scope.$watch("departCal2.date",function(newVal,oldVal){$(".clndr1 .active").removeClass("active"),$(".clndr2 .active").removeClass("active"),$(".clndr4 .active").removeClass("active"),newVal&&($scope.departCal3.minDate=newVal,$scope.departCal4.minDate=newVal,$scope.departCal3.date<$scope.departCal2.date&&($scope.departCal3.date=null,$scope.departCal4.date=null))}),$scope.$watch("departCal3.date",function(newVal,oldVal){$(".clndr1 .active").removeClass("active"),$(".clndr2 .active").removeClass("active"),$(".clndr4 .active").removeClass("active"),newVal&&($scope.departCal4.minDate=newVal,$scope.departCal4.date<$scope.departCal3.date&&($scope.departCal4.date=null))}),$scope.$watchCollection("[departCal3.date, MC.fromResult3, MC.toResult3]",function(newVal,oldVal){"undefined"!=typeof $scope.departCal3.date&&null!==$scope.departCal3.date||""!==$scope.MC.fromResult3&&"undefined"!=typeof $scope.MC.fromResult3||""!==$scope.MC.toResult3&&"undefined"!=typeof $scope.MC.toResult3?$scope.thirdTripLine="":$scope.thirdTripLine="disabled_line"}),$scope.$watchCollection("[departCal4.date, MC.fromResult4, MC.toResult4]",function(newVal,oldVal){"undefined"!=typeof $scope.departCal4.date&&null!==$scope.departCal4.date||""!=$scope.MC.fromResult4&&"undefined"!=typeof $scope.MC.fromResult4||""!=$scope.MC.toResult4&&"undefined"!=typeof $scope.MC.toResult4?$scope.fourthTripLine="":$scope.fourthTripLine="disabled_line"}),$scope.format="MM-dd-yyyy",$scope.fromLAirports1=$scope.fromLAirports2=$scope.fromLAirports3=$scope.fromLAirports4=$scope.toLAirports1=$scope.toLAirports2=$scope.toLAirports3=$scope.toLAirports4=AirportData.StationList({format:"suggestion"}),$scope.fromPAirports1=$scope.fromPAirports2=$scope.fromPAirports3=$scope.fromPAirports4=$scope.toPAirports1=$scope.toPAirports2=$scope.toPAirports3=$scope.toPAirports4=AirportData.StationList({filter:$scope.citySelector.filter,sort:"ASC",group:"region",regionOptions:{flatten:["United States"]}}),$scope.fromSelectedObj1={},$scope.toSelectedObj1={},$scope.fromSelectedObj2={},$scope.toSelectedObj2={},$scope.fromSelectedObj3={},$scope.toSelectedObj3={},$scope.fromSelectedObj4={},$scope.toSelectedObj4={},$.extend($scope.fromSelectedObj1,defaultObj),$.extend($scope.toSelectedObj1,defaultObj),$.extend($scope.fromSelectedObj2,defaultObj),$.extend($scope.toSelectedObj2,defaultObj),$.extend($scope.fromSelectedObj3,defaultObj),$.extend($scope.toSelectedObj3,defaultObj),$.extend($scope.fromSelectedObj4,defaultObj),$.extend($scope.toSelectedObj4,defaultObj),$scope.onMultiFromSelection=function(label,code,id){var region;label&&(code||(code=AirportData.Station(label).Code),region=getRegionName(code),$scope["toLAirports"+id]=AirportData.StationList({filter:$scope.citySelector.filter.concat([{destination:code}]),format:"suggestion"}),$scope["toPAirports"+id]=AirportData.StationList({filter:$scope.citySelector.filter.concat([{destination:code}]),sort:"ASC",group:"region",regionOptions:{flatten:["United States"]}}),$scope["fromSelectedObj"+id].label=label,$scope["fromSelectedObj"+id].code=code,$scope["fromSelectedObj"+id].region=region,$scope.MC["fromResult"+id]=label,$scope.mcCityError["fromResult"+id]="",region?angular.forEach($scope["toPAirports"+id],function(regionitem){regionitem.region==region?regionitem.selected=!0:regionitem.selected=!1,angular.forEach(regionitem,function(region){angular.forEach(regionitem.countries,function(country){angular.forEach(country.airports,function(airport){airport.Code==code?airport.selected=!0:airport.selected=!1})})})}):(angular.forEach($scope["toPAirports"+id],function(regionitem){regionitem.selected=!1}),$scope["toPAirports"+id][0].selected=!0),$scope.setRouteFlags())},$scope.onMultiToSelection=function(label,code,id){var region;label&&(code||(code=AirportData.Station(label).Code),region=getRegionName(code),$scope["fromLAirports"+id]=AirportData.StationList({filter:$scope.citySelector.filter.concat([{destination:code}]),format:"suggestion"}),$scope["fromPAirports"+id]=AirportData.StationList({filter:$scope.citySelector.filter.concat([{destination:code}]),sort:"ASC",group:"region",regionOptions:{flatten:["United States"]}}),$scope["toSelectedObj"+id].label=label,$scope["toSelectedObj"+id].code=code,$scope["toSelectedObj"+id].region=region,$scope.MC["toResult"+id]=label,$scope.mcCityError["toResult"+id]="",region?angular.forEach($scope["fromPAirports"+id],function(regionitem){regionitem.region==region?regionitem.selected=!0:regionitem.selected=!1,angular.forEach(regionitem,function(region){angular.forEach(regionitem.countries,function(country){angular.forEach(country.airports,function(airport){airport.Code==code?airport.selected=!0:airport.selected=!1})})})}):(angular.forEach($scope["fromPAirports"+id],function(regionitem){regionitem.selected=!1}),$scope["fromPAirports"+id][0].selected=!0),$scope.setRouteFlags())},$scope.onMultiFromClear=function(id){},$scope.onMultiToClear=function(id){},$scope.resetMultiODOptions=function(id){$scope["toLAirports"+id]=AirportData.StationList({filter:$scope.citySelector.filter,format:"suggestion"}),$scope["toPAirports"+id]=AirportData.StationList({filter:$scope.citySelector.filter,sort:"ASC",group:"region",regionOptions:{flatten:["United States"]}}),$scope["fromLAirports"+id]=AirportData.StationList({filter:$scope.citySelector.filter,format:"suggestion"}),$scope["fromPAirports"+id]=AirportData.StationList({filter:$scope.citySelector.filter,sort:"ASC",group:"region",regionOptions:{flatten:["United States"]}}),angular.forEach($scope["toPAirports"+id],function(regionitem){regionitem.selected=!1,angular.forEach(regionitem,function(region){angular.forEach(regionitem.countries,function(country){angular.forEach(country.airports,function(airport){airport.selected=!1})})})}),angular.forEach($scope["fromPAirports"+id],function(regionitem){regionitem.selected=!1,angular.forEach(regionitem,function(region){angular.forEach(regionitem.countries,function(country){angular.forEach(country.airports,function(airport){airport.selected=!1})})})}),angular.forEach($scope["fromPAirports"+id],function(regionitem){regionitem.selected=!1}),$scope["fromPAirports"+id][0].selected=!0,angular.forEach($scope["toPAirports"+id],function(regionitem){regionitem.selected=!1}),$scope["toPAirports"+id][0].selected=!0},$scope.mcCityError={fromResult1:"",toResult1:"",fromResult1:"",toResult2:""},$scope.mcDateError={departCal1:"",departCal2:""},$scope.checkMCDate=function(model){setTimeout(function(){$scope.mcDateError[model]="",isInvalidDate($scope[model].date)&&($scope.mcDateError[model]=BookerConfig.errorMessages.GENERIC_DATE_ERROR)},0)},$scope.hideMCCityError=function(model,id){$scope.mcCityError[model]=""},$scope.checkMCCity=function(model,id){$scope.mcCityError[model]="";var value=$scope.MC[model],showError=!1;value&&(model.indexOf("from")>=0?(showError=$scope["fromSelectedObj"+id].label!=value,""==$scope.MC["toResult"+id]&&$scope.resetMultiODOptions(id)):(showError=$scope["toSelectedObj"+id].label!=value,""==$scope.MC["fromResult"+id]&&$scope.resetMultiODOptions(id))),$scope.MC[model]&&value&&!showError||($scope.mcCityError[model]=BookerConfig.errorMessages.GENERIC_CITY_ERROR)}}function saveSearch(searchType){if($scope.fromSelectedObj.label&&$scope.fromSelectedObj.code&&searchType&&"MC"!=$scope.itinerarySelect){var searchObj={key:searchType,value:{fromLabel:$scope.fromSelectedObj.label,fromCode:$scope.fromSelectedObj.code,toLabel:$scope.toSelectedObj.label,toCode:$scope.toSelectedObj.code,departDate:$scope.departCal.date,returnDate:$scope.returnCal.date,intineraryType:$scope.itinerarySelect,adultCount:"getaways"==$scope.searchType?$scope.passenger.getawaysAdults:$scope.passenger.flightsAdults,minorCount:"getaways"==$scope.searchType?$scope.passenger.getawaysMinors:$scope.passenger.flightsMinors,infantCount:"getaways"==$scope.searchType?$scope.passenger.getawaysInfants:$scope.passenger.flightsInfants,fare:$scope.currency}};"getaways"==$scope.searchType&&$scope.passenger.getawaysMinors>0&&(searchObj.value.minorAges=$scope.getawayMinorAge),storageLib.setCookie(searchObj)}$.map($scope.config.searchTypes.types,function(el,i){return el.value==$scope.searchType?el.legacyCookie:void 0})}function isInvalidDate(inputDate){return!inputDate||isNaN(inputDate.getTime())||inputDate.getTime()<0}function isInvalidMinorAge(age){return!(/^\d{1,2}$/.test(age)&&age>=BookerConfig.CONSTANTS.MIN_MINOR_AGE&&age<=BookerConfig.CONSTANTS.MAX_MINOR_AGE)}function isValidAirport(inputLabel,regionsArray){return!!AirportData.Station(inputLabel)}function checkSeasonalFlights(){if(dayOfWeekRoutes&&seasonalRoutes){var fromCode,toCode,dailyLookup,seasonalLookup;return fromCode=$scope.fromSelectedObj.code,toCode=$scope.toSelectedObj.code,seasonalLookup=[],$(seasonalRoutes).map(function(key,route){(route[0]==fromCode&&route[1]==toCode||route[1]==fromCode&&route[0]==toCode)&&seasonalLookup.push(route)}),dailyLookup=[],$(dayOfWeekRoutes).map(function(key,route){(route[0]==fromCode&&route[1]==toCode||route[1]==fromCode&&route[0]==toCode)&&dailyLookup.push(route)}),seasonalLookup.length?BookerConfig.errorMessages.SEASONAL_ITINERARY:dailyLookup.length?BookerConfig.errorMessages.DAYS_OF_WEEK_ITINERARY:""}}var storageLib,key,getRegionName;key={left:37,up:38,right:39,down:40,enter:13,esc:27,tab:9},$rootScope.getBookerInfo=function(){return{flight_type:$scope.itinerarySelect,from_field:$scope.fromSelectedObj.code,from_field_full:$scope.fromSelectedObj.label,to_field:$scope.toSelectedObj.code,to_field_full:$scope.toSelectedObj.label,fare_display:$scope.currency,adult_count:$scope.passenger.flightsAdults,minor_count:$scope.passenger.flightsMinors,infant_count:$scope.passenger.flightsInfants,departDate:$scope.departCal.date,returnDate:$scope.returnCal.date}},$scope.showErrors=!1,$scope.showWarnings=!1,$scope.getawayMinorAge={},$scope.errorMessages=[],$scope.warningMessages=[],$scope.seasonalFlightMsg="",$scope.isSeasonalFlight=!1,$scope.citySelectorFooterText="",$scope.MC={},$scope.promo||($scope.promo=""),$scope.type="homepage",$scope.config={},$.extend($scope.config,BookerConfig),$scope.$watch("type",function(){$.extend(!0,$scope,BookerConfig.scopeDefaults.all),$scope.type&&BookerConfig.scopeDefaults[$scope.type]&&$.extend(!0,$scope,BookerConfig.scopeDefaults[$scope.type]),setFlexDefault(),$scope.initAirportData(),$scope.$emit("BOOKER_CONTROLLER_LOADED")}),"undefined"==typeof storageLib&&(storageLib=jbStorageLib.init(),storageLib.setMaxCount("recentSearchesFlight",BookerConfig.CONSTANTS.RECENT_SEARCHES_FLIGHT_MAX_COUNT),storageLib.setMaxCount("recentSearchesGetAways",BookerConfig.CONSTANTS.RECENT_SEARCHES_GETAWAY_MAX_COUNT)),$scope.initAirportData=function(){var odTypeLookup;odTypeLookup={homepage:{flights:"ALL",getaways:"GETAWAYS"},mini:{flights:"ALL"},multicity:{flights:"ALL"},bff:{flights:"BFF"},vacations:{getaways:"GETAWAYS"}},AirportData.init({odType:odTypeLookup[$scope.type][$scope.searchType],success:function(){$scope.fromLAirports=$scope.toLAirports=AirportData.StationList({format:"suggestion",filter:$scope.citySelector.filter}),$scope.fromPAirports=$scope.toPAirports=AirportData.StationList({sort:"ASC",group:"region",regionOptions:{flatten:["United States"]},filter:$scope.citySelector.filter});var defaultObj={label:"",code:"",region:"United States"};$scope.fromSelectedObj&&$scope.fromSelectedObj.code||($scope.fromSelectedObj={},$.extend($scope.fromSelectedObj,defaultObj)),$scope.toSelectedObj&&$scope.toSelectedObj.code||($scope.toSelectedObj={},$.extend($scope.toSelectedObj,defaultObj)),$scope.populateFromInit(),"multicity"==$scope.type&&multicitySelections()},error:function(){$scope.$emit("OD API FAILURE")}})},$scope.setAdditionalProducts=function(type){if($scope.additionalProducts=[],BookerConfig[type].additionalProducts&&BookerConfig[type].additionalProducts.length>0)for(var j=0;j<BookerConfig[type].additionalProducts.length;j++)$scope.additionalProducts.push({model:1,options:$scope.formatAdditionalProducts(BookerConfig[type].additionalProducts[j])})},$scope.formatAdditionalProducts=function(prod){for(var vals=prod.validAmounts,options=[],i=0;i<vals.length;i++){var option={};1==vals[i]?option.name=vals[i]+" "+prod.labels.singular:option.name=vals[i]+" "+prod.labels.plural,option.value=vals[i],options.push(option)}return options},$scope.redemption="tb"==$scope.currency?"true":"false",$scope.$watch("searchType",function(){$scope.initAirportData(),$scope.setAdditionalProducts($scope.searchType),$scope.updatePassengerOptions(),$scope.onSearchTypeChange(),$(window).trigger("BOOKER_SEARCHTYPE_CHANGE")});var viewportContent=void 0;$scope.$on("JBOVERLAY_HIDDEN",function(){window.navigator.appVersion.indexOf("Mobile")>0&&void 0!=viewportContent&&$('[name="viewport"]').attr("content",viewportContent)}),$scope.openModal=function($event,src,text){var h,w,defaultH=600,defaultW=850;window.navigator.appVersion.indexOf("Mobile")>0&&void 0!=$('[name="viewport"]').attr("content")&&(viewportContent=$('[name="viewport"]').attr("content"),$('[name="viewport"]').attr("content","")),h=$window.innerHeight<defaultH?.75*$window.innerHeight:defaultH,h+="px",w=$window.innerWidth<defaultW?.75*$window.innerWidth:defaultW,w+="px",src&&(jbOverlayFactory.init({title:text,template:src,height:h,width:w}),jbOverlayFactory.show(),$event.preventDefault());var triggeredBy=$event.target;$rootScope.$on("JBOVERLAY_HIDDEN",function(){(triggeredBy||"undefined"!=typeof triggeredBy)&&$($event.target).focus()})},setFlexDefault=function(){$scope.config.flexibleSearch.enabled&&"homepage"==$scope.type?$scope.flexSearchOptIn=$scope.config.flexibleSearch.optInDefaultValue:$scope.flexSearchOptIn=!1},setSchedExtDate(),$scope.departCal=new defaultCal,$scope.returnCal=new defaultCal,$scope.openDepartCalendar=function($event){$event.preventDefault(),$event.stopPropagation(),$scope.departDateError="",$scope.returnCal.isOpen=!1,$scope.departCal.isOpen=!$scope.departCal.isOpen},$scope.openReturnCalendar=function($event){$event.preventDefault(),$event.stopPropagation(),$scope.returnDateError="",$scope.departCal.isOpen=!1,$scope.returnCal.isOpen=!$scope.returnCal.isOpen},$scope.$watch("returnCal.date",function(newVal,oldVal){$scope.returnDateError=""}),$scope.$watch("departCal.date",function(newVal,oldVal){$scope.departDateError="",$(".clndr2 .active").removeClass("active"),newVal&&"undefined"!=newVal&&!isInvalidDate(newVal)&&($scope.returnCal.minDate=newVal,$scope.returnCal.date<$scope.returnCal.minDate&&($scope.returnCal.date=""))}),$scope.format="MM-dd-yyyy",getRegionName=function(airportCode){var regionCode,regionName="";return airportCode&&AirportData.Station(airportCode)&&(regionCode=AirportData.Station(airportCode).RegionCodes[0],regionName=AirportData.regions[regionCode].Name),regionName};var defaultObj={label:"",code:"",region:"United States"};$scope.isInterlineRoute="false",$scope.isSharedMarketRoute="false",$scope.setRouteFlags=function(){var lookup;if(lookup=AirportData.Route($scope.fromSelectedObj.code,$scope.toSelectedObj.code),isMCInterline=!!$scope.fromSelectedObj1&&!!$scope.toSelectedObj1&&!!AirportData.Route($scope.fromSelectedObj1.code,$scope.toSelectedObj1.code),lookup&&"MC"!=$scope.itinerarySelect){var twoBlueCities=!!AirportData.Station($scope.fromSelectedObj.code).IsBlueCity&&!!AirportData.Station($scope.toSelectedObj.code).IsBlueCity;$scope.isInterlineRoute=lookup.i?"true":"false",$scope.isSharedMarketRoute=lookup.i&&twoBlueCities?"true":"false"}else if(isMCInterline&&"MC"==$scope.itinerarySelect){var allBlueCities=!!AirportData.Station($scope.fromSelectedObj1.code).IsBlueCity&&!!AirportData.Station($scope.toSelectedObj1.code).IsBlueCity;isMCInterline=AirportData.Route($scope.fromSelectedObj1.code,$scope.toSelectedObj1.code).i,allBlueCities=allBlueCities&&!!AirportData.Station($scope.fromSelectedObj2.code).IsBlueCity&&!!AirportData.Station($scope.toSelectedObj2.code).IsBlueCity,isMCInterline=isMCInterline||!!AirportData.Route($scope.fromSelectedObj2.code,$scope.toSelectedObj2.code).i,AirportData.Station($scope.fromSelectedObj3.code)&&AirportData.Station($scope.fromSelectedObj3.code)&&(allBlueCities=allBlueCities&&!!AirportData.Station($scope.fromSelectedObj3.code).IsBlueCity&&!!AirportData.Station($scope.toSelectedObj3.code).IsBlueCity,isMCInterline=isMCInterline||!!AirportData.Route($scope.fromSelectedObj3.code,$scope.toSelectedObj3.code).i),AirportData.Station($scope.fromSelectedObj4.code)&&AirportData.Station($scope.fromSelectedObj4.code)&&(allBlueCities=allBlueCities&&!!AirportData.Station($scope.fromSelectedObj4.code).IsBlueCity&&!!AirportData.Station($scope.toSelectedObj4.code).IsBlueCity,isMCInterline=isMCInterline||!!AirportData.Route($scope.fromSelectedObj4.code,$scope.toSelectedObj4.code).i),$scope.isInterlineRoute=isMCInterline?"true":"false",$scope.isSharedMarketRoute=isMCInterline&&allBlueCities?"true":"false"}},$scope.onFromSelection=function(label,code){var region;label&&(code||(code=AirportData.Station(label).Code),region=getRegionName(code),$scope.toLAirports=AirportData.StationList({filter:$scope.citySelector.filter.concat([{destination:code}]),format:"suggestion"}),$scope.fromSelectedObj={label:label,code:code,region:region},$scope.fromResult=label,$scope.toPAirports=AirportData.StationList({filter:$scope.citySelector.filter.concat([{destination:code}]),sort:"ASC",group:"region",regionOptions:{flatten:["United States"]}}),$scope.toLAirports.length||($scope.toLAirports=AirportData.StationList({filter:$scope.citySelector.filter,format:"suggestion"})),$scope.toPAirports.length||($scope.toPAirports=AirportData.StationList({filter:$scope.citySelector.filter,sort:"ASC",group:"region",regionOptions:{flatten:["United States"]}})),region?angular.forEach($scope.fromPAirports,function(regionitem){regionitem.region==region?regionitem.selected=!0:regionitem.selected=!1,angular.forEach(regionitem,function(region){angular.forEach(regionitem.countries,function(country){angular.forEach(country.airports,function(airport){airport.Code==code?airport.selected=!0:airport.selected=!1})})})}):(angular.forEach($scope.toPAirports,function(regionitem){regionitem.selected=!1}),$scope.fromPAirports[0].selected=!0),$scope.setRouteFlags(),"string"==typeof $scope.toSelectedObj.label&&$scope.toSelectedObj.label.length>0&&$scope.checkReturnCity())},$scope.onToSelection=function(label,code){var region;label&&(code||(code=AirportData.Station(label).Code),region=getRegionName(code),$scope.fromLAirports=AirportData.StationList({filter:$scope.citySelector.filter.concat([{origin:code}]),format:"suggestion"}),$scope.toSelectedObj={label:label,code:code,region:region},$scope.toResult=label,$scope.fromPAirports=AirportData.StationList({filter:$scope.citySelector.filter.concat([{origin:code}]),sort:"ASC",group:"region",regionOptions:{flatten:["United States"]}}),region?angular.forEach($scope.toPAirports,function(regionitem){regionitem.region==region?regionitem.selected=!0:regionitem.selected=!1,angular.forEach(regionitem,function(region){angular.forEach(regionitem.countries,function(country){angular.forEach(country.airports,function(airport){airport.Code==code?airport.selected=!0:airport.selected=!1})})})}):(angular.forEach($scope.toPAirports,function(regionitem){regionitem.selected=!1}),$scope.toPAirports[0].selected=!0),$scope.setRouteFlags(),"string"==typeof $scope.fromSelectedObj.label&&$scope.fromSelectedObj.label.length>0&&$scope.checkDepartCity())},$scope.onFromClear=function(){""==$scope.toResult&&$scope.resetODOptions()},$scope.onToClear=function(){""==$scope.fromResult&&$scope.resetODOptions()},$scope.resetODOptions=function(){$scope.toLAirports=AirportData.StationList({filter:$scope.citySelector.filter,format:"suggestion"}),$scope.toPAirports=AirportData.StationList({filter:$scope.citySelector.filter,sort:"ASC",group:"region",regionOptions:{flatten:["United States"]}}),$scope.fromLAirports=AirportData.StationList({filter:$scope.citySelector.filter,format:"suggestion"}),$scope.fromPAirports=AirportData.StationList({filter:$scope.citySelector.filter,sort:"ASC",group:"region",regionOptions:{flatten:["United States"]}}),angular.forEach($scope.toPAirports,function(regionitem){regionitem.selected=!1,angular.forEach(regionitem,function(region){angular.forEach(regionitem.countries,function(country){angular.forEach(country.airports,function(airport){airport.selected=!1})})})}),angular.forEach($scope.fromPAirports,function(regionitem){regionitem.selected=!1,angular.forEach(regionitem,function(region){angular.forEach(regionitem.countries,function(country){angular.forEach(country.airports,function(airport){airport.selected=!1})})})}),angular.forEach($scope.fromPAirports,function(regionitem){regionitem.selected=!1}),$scope.fromPAirports[0].selected=!0,angular.forEach($scope.toPAirports,function(regionitem){regionitem.selected=!1}),$scope.toPAirports[0].selected=!0},$scope.setDefaultPassengers=function(){var itinTypes,passengerGroups;$scope.passenger={},itinTypes=$.map($scope.config.searchTypes.types,function(el){return el.value}),passengerGroups=$.map(itinTypes,function(el){return $scope.config[el].ageGroups}),$.each(passengerGroups,function(i,el){$scope.passenger[el.id]=el.defaultAmount}),$scope.passengerError=""},$scope.setDefaultPassengers(),$scope.passengerIterable={},$scope.updatePassengerOptions=function(){var ageGroups,activeAgeGroups,infantGroups,itinTypes,noinfants,oneinfant,twoinfants,threeinfants,passengerCount,passengerCountLookup;noinfants=[{name:"0 Lap Infants (Under 2)",value:0}],oneinfant=[{name:"0 Lap Infants (Under 2)",value:0},{name:"1 Lap Infant",value:1}],twoinfants=[{name:"0 Lap Infants (Under 2)",value:0},{name:"1 Lap Infant",value:1},{name:"2 Lap Infants",value:2}],threeinfants=[{name:"0 Lap Infants (Under 2)",value:0},{name:"1 Lap Infant",value:1},{name:"2 Lap Infants",value:2},{name:"3 Lap Infants",value:3}],$scope.passengerIterable={},jQuery.each($scope.passenger,function(k,v){v>0&&($scope.passengerIterable[k]=new Array(parseInt(v)))}),itinTypes=$.map($scope.config.searchTypes.types,function(el){return el.value}),ageGroups=$.map(itinTypes,function(el){return el?$scope.config[el].ageGroups:void 0}),infantGroups=$.map(ageGroups,function(el){return"INF"==el.bookingGroup?el:void 0}),$scope.passengerError="",$.each(infantGroups,function(i,el){var parentgroup=$scope.passenger[el.id.replace("Infants","Adults")],childgroup=$scope.passenger[el.id];parentgroup>=childgroup&&(0===parentgroup?el.options=noinfants:1==parentgroup?el.options=oneinfant:2==parentgroup?el.options=twoinfants:el.options=threeinfants)}),activeAgeGroups=$.map($scope.config[$scope.searchType||$scope.config.searchTypes.defaultType].ageGroups,function(el){return el.ticketable?el.id:void 0}),passengerCountLookup=$.map(activeAgeGroups,function(el){return $scope.passenger[el]}),passengerCount=0;for(var i=0;i<passengerCountLookup.length;i++)passengerCount+=passengerCountLookup[i];$scope.passengerCount=passengerCount,"flights"==$scope.searchType?($scope.passenger.flightsAdults||$scope.passenger.flightsMinors||($scope.passengerError=BookerConfig.errorMessages.NO_PASSENGER_ERROR),$scope.passenger.flightsAdults<$scope.passenger.flightsInfants&&($scope.passengerError=BookerConfig.errorMessages.TOO_MANY_LAP_INFANTS),$scope.passengerCount>$scope.config.CONSTANTS.GUESTLIMIT&&($scope.passengerError=BookerConfig.errorMessages.TOO_MANY_PASSENGERS)):"getaways"==$scope.searchType&&($scope.passenger.getawaysAdults||$scope.passenger.getawaysMinors||($scope.passengerError=BookerConfig.errorMessages.NO_PASSENGER_ERROR),$scope.passenger.getawaysAdults<$scope.passenger.getawaysInfants&&($scope.passengerError=BookerConfig.errorMessages.TOO_MANY_LAP_INFANTS),$scope.passengerCount>$scope.config.CONSTANTS.GUESTLIMIT&&($scope.passengerError=BookerConfig.errorMessages.TOO_MANY_PASSENGERS))},$scope.updatePassengerOptions(),angular.forEach($scope.passenger,function(value,key){$scope.$watch(function(){return $scope.passenger[key]},function(){$scope.updatePassengerOptions()})}),$(window).bind("BOOKER_PASSENGERSELECT_CHANGE",function(){$scope.updatePassengerOptions(),$scope.$apply()}),$("body").delegate(".passengerSelect select","change",function(){$(window).trigger("BOOKER_PASSENGERSELECT_CHANGE")}),$scope.onSearchTypeChange=function(){$scope.itinerarySelect="RT","flights"===$scope.searchType?$scope.recentSearches=storageLib.getCookie("recentSearchesFlight"):$scope.recentSearches=storageLib.getCookie("recentSearchesGetAways")},$scope.populateFromInit=function(){var thisairport,cookieval,defaultIATA=BookerConfig.CONSTANTS.REPOPULATION_FALLBACK_AIRPORT_IATA;if(cookieval="false"==$.cookie("base_airport")?!1:$.cookie("base_airport")?$.cookie("base_airport"):!1,$scope.recentSearches=storageLib.getCookie("recentSearchesFlight")||[],$scope.onFromSelection(),$scope.onToSelection(),"string"==typeof $scope.fromSelectedObj.label&&$scope.fromSelectedObj.label.length>0&&"string"==typeof $scope.fromSelectedObj.code&&$scope.fromSelectedObj.code.length>0)return $scope.onFromSelection($scope.fromSelectedObj.label,$scope.fromSelectedObj.code),void("string"==typeof $scope.toSelectedObj.label&&$scope.toSelectedObj.label.length>0&&"string"==typeof $scope.toSelectedObj.code&&$scope.toSelectedObj.code.length>0&&$scope.onToSelection($scope.toSelectedObj.label,$scope.toSelectedObj.code));if($scope.recentSearches.length){var tempFrom=AirportData.Station($scope.recentSearches[0].fromCode);$scope.onFromSelection(tempFrom.DefaultDisplayName,$scope.recentSearches[0].fromCode)}else cookieval?AirportData.Station(cookieval)&&(thisairport=AirportData.Station(cookieval),$timeout(function(){$scope.onFromSelection(thisairport.DefaultDisplayName,cookieval)})):"undefined"!=typeof jbGeoLocationImpl&&jbGeoLocationImpl&&(jQuery(jbGeoLocationImpl).bind("GEO_LOCATION_JSON_LOADED",function(e,location){"string"==typeof $scope.fromSelectedObj.label&&$scope.fromSelectedObj.label.length>0&&"string"==typeof $scope.fromSelectedObj.code&&$scope.fromSelectedObj.code.length>0||("string"==typeof location.Code?(thisairport=AirportData.Station(location.Code),$timeout(function(){$scope.onFromSelection(thisairport.DefaultDisplayName,location.Code)})):(thisairport=AirportData.Station(defaultIATA),$timeout(function(){$scope.onFromSelection(thisairport.DefaultDisplayName,defaultIATA)})))}),jQuery(jbGeoLocationImpl).trigger("GEO_LOCATION_JSON_REQUESTED"));$scope.$emit("BOOKER_SCOPE_REINITIALIZE")},$scope.setDateValues=function(searchObj){var date=new Date;date.setHours(0,0,0,0),new Date(searchObj.departDate).getTime()>=date.getTime()&&("bff"==$scope.type?($scope.departCal.date=new Date(searchObj.departDate),$scope.departCal.date instanceof Date&&new Date(searchObj.returnDate)>=$scope.departCal.date&&($scope.returnCal.date=new Date(searchObj.returnDate))):$timeout(function(){$scope.departCal.date=new Date(searchObj.departDate),$scope.departCal.date instanceof Date&&new Date(searchObj.returnDate)>=$scope.departCal.date&&($scope.returnCal.date=new Date(searchObj.returnDate))}))},$rootScope.setFormValues=function(searchObj){if(searchObj&&searchObj.fromLabel&&searchObj.fromCode&&searchObj.toLabel&&searchObj.toCode&&searchObj.departDate){var tempFrom=AirportData.Station(searchObj.fromCode);$scope.onFromSelection(tempFrom.DefaultDisplayName,searchObj.fromCode);var tempTo=AirportData.Station(searchObj.toCode);$scope.onToSelection(tempTo.DefaultDisplayName,searchObj.toCode),$scope.itinerarySelect=searchObj.intineraryType,$scope.setDateValues(searchObj)}searchObj.fare&&($scope.currency=searchObj.fare);var prefix="flights";"getaways"==$scope.searchType&&(prefix="getaways"),("getaways"==$scope.searchType&&searchObj.adultCount>0||"getaways"!=$scope.searchType)&&($scope.passenger[prefix+"Adults"]=searchObj.adultCount),$scope.updatePassengerOptions(),$scope.passenger[prefix+"Minors"]=searchObj.minorCount,$scope.passenger[prefix+"Infants"]=searchObj.infantCount,$scope.updatePassengerOptions(),void 0!=searchObj.minorAges&&"getaways"==$scope.searchType&&($scope.getawayMinorAge=searchObj.minorAges),$scope.checkAllFields(),$(window).trigger("BOOKER_RECENTSEARCH_POPULATE")},$scope.isrsDisplayed=!1,$scope.rsDisplayMenu=function(length){$scope.isrsDisplayed=!$scope.isrsDisplayed,$(".sbactive").focus(),$scope.isrsDisplayed?($(".options .option").removeClass("focus"),$scope.rsopen="sbactive"):$scope.rsopen="",$("cityselector input[type=text]").blur()};var getKeyboardEventResult=function(keyEvent){return window.event?keyEvent.keyCode:keyEvent.which};$scope.onKeyDownR=function($event){var onKeyDownResult=getKeyboardEventResult($event);$scope.recentSearches.length&&((onKeyDownResult===key.down||onKeyDownResult===key.right||onKeyDownResult===key.enter)&&($scope.isrsDisplayed?($($event.target).find(".option").removeClass("focus"),$($event.target).find(".option").first().addClass("focus").focus()):$scope.rsDisplayMenu()),(onKeyDownResult===key.tab||onKeyDownResult===key.esc)&&$scope.isrsDisplayed&&$scope.rsDisplayMenu())},$scope.onOptionKeyDown=function($event){var onKeyDownResult=getKeyboardEventResult($event);if(onKeyDownResult===key.down||onKeyDownResult===key.right){if($event.preventDefault(),0===$($event.target).next().length)return;$($event.target).closest(".options").find(".option").removeClass("focus"),$($event.target).next().addClass("focus"),$($event.target).next().focus()}if((onKeyDownResult===key.up||onKeyDownResult===key.left)&&($event.preventDefault(),
$scope.isrsDisplayed)){if($($event.target).prev().hasClass("options_header"))return;$($event.target).closest(".options").find(".option").removeClass("focus"),$($event.target).prev().addClass("focus"),$($event.target).prev().focus()}},$scope.onKeyDownCalendarIcon=function($event){var onKeyDownResult=getKeyboardEventResult($event);onKeyDownResult===key.enter&&($event.currentTarget.className.indexOf("jbbkr-foreground-sprite-depart")>-1?$scope.openDepartCalendar($event):$event.currentTarget.className.indexOf("jbbkr-foreground-sprite-arrive")>-1&&$scope.openReturnCalendar($event))},$scope.onKeyDownCalendarInput=function($event){var onKeyDownResult=getKeyboardEventResult($event);onKeyDownResult===key.enter&&("jbBookerCalendarDepart"==$event.currentTarget.id?$scope.openDepartCalendar($event):"jbBookerCalendarReturn"==$event.currentTarget.id&&$scope.openReturnCalendar($event))},$scope.rsInit=function(){$(document).bind("click",function(event){$(".recentSearches").find(event.target).length>0||($scope.isrsDisplayed=!1,$scope.rsopen="")})},$rootScope.bookerFormCheck=function($event){var erroMsg,warnMsg,seasonalFlightMsg,submitForm,modal,i,l,ignoreDate="date"==$event.ignore;if(erroMsg=seasonalFlightMsg=warnMsg="",submitForm=!0,modal=jbOverlayFactory,$scope.setRouteFlags(),"MC"!=$scope.itinerarySelect){if($scope.fromResult&&isValidAirport($scope.fromResult,$scope.fromPAirports)||(erroMsg+=BookerConfig.errorMessages.DEPART_CITY_ERROR+"\n",$scope.departCityError=BookerConfig.errorMessages.DEPART_CITY_ERROR),$scope.toResult&&isValidAirport($scope.toResult,$scope.toPAirports)||(erroMsg+=BookerConfig.errorMessages.ARRIVAL_CITY_ERROR+"\n",$scope.returnCityError=BookerConfig.errorMessages.ARRIVAL_CITY_ERROR),isInvalidDate($scope.departCal.date)&&!ignoreDate&&(erroMsg+=BookerConfig.errorMessages.DEPART_DATE_ERROR+"\n",$scope.departDateError=BookerConfig.errorMessages.DEPART_DATE_ERROR),"RT"!=$scope.itinerarySelect||ignoreDate||isInvalidDate($scope.returnCal.date)&&(erroMsg+=BookerConfig.errorMessages.RETURN_DATE_ERROR+"\n",$scope.returnDateError=BookerConfig.errorMessages.RETURN_DATE_ERROR),"getaways"==$scope.searchType&&$scope.passengerIterable.getawaysMinors&&$scope.passengerIterable.getawaysMinors.length>1)for(l=$scope.passengerIterable.getawaysMinors.length,i=1;l+1>i;i++)(!$scope.getawayMinorAge[i]||isInvalidMinorAge(Number($scope.getawayMinorAge[i])))&&(erroMsg+=BookerConfig.errorMessages.INVALID_CHILD_AGE+" "+i+" "+BookerConfig.errorMessages.MINOR_AGE_RESTRICTION+"\n")}else $scope.MC.fromResult1&&isValidAirport($scope.MC.fromResult1,$scope.fromPAirports1)||(erroMsg+=BookerConfig.errorMessages.DEPART_CITY_ERROR+" 1.\n",$scope.checkMCCity("fromResult1",1)),$scope.MC.fromResult2&&isValidAirport($scope.MC.fromResult2,$scope.fromPAirports2)||(erroMsg+=BookerConfig.errorMessages.DEPART_CITY_ERROR+" 2.\n",$scope.checkMCCity("fromResult2",2)),($scope.MC.toResult3&&!$scope.MC.fromResult3||$scope.MC.fromResult3&&!isValidAirport($scope.MC.fromResult3,$scope.fromPAirports3))&&(erroMsg+=BookerConfig.errorMessages.DEPART_CITY_ERROR+" 3.\n",$scope.checkMCCity("fromResult3",3)),($scope.MC.toResult4&&!$scope.MC.fromResult4||$scope.MC.fromResult4&&!isValidAirport($scope.MC.fromResult4,$scope.fromPAirports4))&&(erroMsg+=BookerConfig.errorMessages.DEPART_CITY_ERROR+" 4.\n",$scope.checkMCCity("fromResult4",4)),$scope.MC.toResult1&&isValidAirport($scope.MC.toResult1,$scope.toPAirports1)||(erroMsg+=BookerConfig.errorMessages.ARRIVAL_CITY_ERROR+" 1.\n",$scope.checkMCCity("toResult1",1)),$scope.MC.toResult2&&isValidAirport($scope.MC.toResult2,$scope.toPAirports2)||(erroMsg+=BookerConfig.errorMessages.ARRIVAL_CITY_ERROR+" 2.\n",$scope.checkMCCity("toResult2",2)),($scope.MC.fromResult3&&!$scope.MC.toResult3||$scope.MC.toResult3&&!isValidAirport($scope.MC.toResult3,$scope.toPAirports3))&&(erroMsg+=BookerConfig.errorMessages.ARRIVAL_CITY_ERROR+" 3.\n",$scope.checkMCCity("toResult3",3)),($scope.MC.fromResult4&&!$scope.MC.toResult4||$scope.MC.toResult4&&!isValidAirport($scope.MC.toResult4,$scope.toPAirports4))&&(erroMsg+=BookerConfig.errorMessages.ARRIVAL_CITY_ERROR+" 4.\n",$scope.checkMCCity("toResult4",4)),!ignoreDate&&isInvalidDate($scope.departCal1.date)&&(erroMsg+=BookerConfig.errorMessages.DEPART_DATE_ERROR+" 1.\n",$scope.checkMCDate("departCal1")),!ignoreDate&&isInvalidDate($scope.departCal2.date)&&(erroMsg+=BookerConfig.errorMessages.DEPART_DATE_ERROR+" 2.\n",$scope.checkMCDate("departCal2")),!ignoreDate&&$scope.MC.fromResult3&&$scope.MC.toResult3&&isInvalidDate($scope.departCal3.date)&&(erroMsg+=BookerConfig.errorMessages.DEPART_DATE_ERROR+" 3.\n",$scope.checkMCDate("departCal3")),!ignoreDate&&$scope.MC.fromResult4&&$scope.MC.toResult4&&isInvalidDate($scope.departCal4.date)&&(erroMsg+=BookerConfig.errorMessages.DEPART_DATE_ERROR+" 4.\n",$scope.checkMCDate("departCal4"));"flights"!=$scope.searchType||$scope.passenger.flightsAdults||$scope.passenger.flightsMinors||(erroMsg+=BookerConfig.errorMessages.NO_PASSENGER_ERROR+"\n"),"flights"==$scope.searchType&&$scope.passenger.flightsAdults<$scope.passenger.flightsInfants&&(erroMsg+=BookerConfig.errorMessages.TOO_MANY_LAP_INFANTS+"\n"),$scope.passengerCount>$scope.config.CONSTANTS.GUESTLIMIT&&(erroMsg+=BookerConfig.errorMessages.TOO_MANY_PASSENGERS+"\n");var today=function(date){if(date instanceof Date){var today=new Date;return date.getDate()==today.getDate()&&date.getMonth()==today.getMonth()&&date.getYear()==today.getYear()}return!1},longTrip=function(start,end){return start instanceof Date&&end instanceof Date?(end-start)/1e3/60/60/24>=28:!1},shortTrip=function(start,end){return start instanceof Date&&end instanceof Date?1>(end-start)/1e3/60/60/24:!1};if(erroMsg||"bff"==$scope.type||"MC"==$scope.itinerarySelect)erroMsg||"MC"!=$scope.itinerarySelect||!ignoreDate&&today($scope.departCal1.date)&&(warnMsg+=BookerConfig.warningMessages.TODAYS_DATE+"\n");else{!ignoreDate&&"OW"!=$scope.itinerarySelect&&longTrip($scope.departCal.date,$scope.returnCal.date)&&(warnMsg+=BookerConfig.warningMessages.LONG_TRIP+"\n"),!ignoreDate&&"OW"!=$scope.itinerarySelect&&shortTrip($scope.departCal.date,$scope.returnCal.date)&&(warnMsg+=BookerConfig.warningMessages.SHORT_TRIP+"\n");var departCountry=AirportData.Station($scope.fromSelectedObj.code),destinationCountry=AirportData.Station($scope.toSelectedObj.code);if(departCountry&&destinationCountry&&"OW"==$scope.itinerarySelect&&departCountry.CountryCode!=destinationCountry.CountryCode){var warn=!0;if(BookerConfig.countryExceptions[departCountry.Code]||BookerConfig.countryExceptions[destinationCountry.Code]){var depC=BookerConfig.countryExceptions[departCountry.Code]?BookerConfig.countryExceptions[departCountry.Code]:departCountry.CountryCode,destC=BookerConfig.countryExceptions[destinationCountry.Code]?BookerConfig.countryExceptions[destinationCountry.Code]:destinationCountry.CountryCode;warn=depC!=destC}warn&&(warnMsg+=BookerConfig.warningMessages.OW_INTERNATIONAL+"\n")}!ignoreDate&&today($scope.departCal.date)&&(warnMsg+=BookerConfig.warningMessages.TODAYS_DATE+"\n")}return seasonalFlightMsg+=checkSeasonalFlights($scope.fromResult,$scope.toResult),erroMsg?($scope.errorMessages=erroMsg.split("\n"),$scope.showErrors=!0,$scope.focusThis=!0,$scope.isSeasonalFlight=!1,submitForm=!1,$event.preventDefault()):seasonalFlightMsg&&"bff"!=$scope.type?($scope.seasonalFlightMsg=seasonalFlightMsg,$scope.isSeasonalFlight=!0,$scope.showErrors=!0,$scope.focusThis=!0,submitForm=!1,$event.preventDefault()):warnMsg?($scope.showErrors=!1,$scope.errorMessages=[],$scope.warningMessages=warnMsg.split("\n"),$scope.showWarnings=!0,$scope.focusThis=!0,submitForm=!1,$event.preventDefault()):"getaways"==$scope.searchType?($scope.submitVacationsHandler(),submitForm=!1,$event.preventDefault()):$scope.flexSearchOptIn?($scope.handleBFFRedirect(),submitForm=!1):"getaways"==$scope.searchType||$scope.passenger.flightsAdults||!$scope.passenger.flightsMinors||$scope.acceptUMNR||(submitForm=!1,showUMNR(modal,$event)),submitForm},$scope.acceptUMNR=!1;var showUMNR=function(modal,event){modal.init({title:BookerConfig.errorMessages.UNACCOMPANIED_MINOR_TITLE,template:"/includes/modules/booker_refresh/dist/partials/_umnrresolution.html",triggerEvent:event}),modal.show(),$rootScope.$on("resolveUMNR",function(event,data){$scope.acceptUMNR=!0,"bff"!=$scope.type&&$scope.saveAndSubmit(!0)})};$scope.continueSubmit=function($event){var modal=jbOverlayFactory,submit=!0;$scope.showWarnings=!1,$scope.warningMessages=[],"getaways"==$scope.searchType||$scope.passenger.flightsAdults||!$scope.passenger.flightsMinors||$scope.acceptUMNR?$scope.saveAndSubmit(submit):(submit=!1,showUMNR(modal,$event))},$scope.handleSubmit=function($event){"jbBookerCalendarDepart"==document.activeElement.id?$scope.openDepartCalendar($event):"jbBookerCalendarReturn"==document.activeElement.id?$scope.openReturnCalendar($event):(submitForm=$rootScope.bookerFormCheck($event),submitForm&&$scope.saveAndSubmit(submitForm))},$scope.submitVacationsHandler=function(){$scope.getawaysInfantList=[];for(var infantslookup=$scope.passenger.getawaysInfants;infantslookup>0;)$scope.getawaysInfantList.push("infant"+infantslookup),infantslookup--;$scope.getawaysMinorsList=[];for(var minorslookup=$scope.passenger.getawaysMinors;minorslookup>0;)$scope.getawaysMinorsList.push({name:"child_age"+minorslookup,value:$scope.getawayMinorAge[minorslookup]}),minorslookup--;var getawaysForm=$(".getawaysform");"tb"===$scope.currency?getawaysForm.attr("action",$scope.config.getaways.form.redemptionAction).attr("method",$scope.config.getaways.form.redemptionMethod):getawaysForm.attr("action",getawaysForm.attr("data-forward-action")),saveSearch("recentSearchesGetAways");try{$scope.$apply(),$(".getawaysform").submit()}catch(e){}},$scope.handleBFFRedirect=function(){saveSearch("recentSearchesFlight");var bffstring="";bffstring+="?",bffstring+="origin="+$scope.fromSelectedObj.code+"&",bffstring+="destination="+$scope.toSelectedObj.code+"&",bffstring+="departure="+$filter("date")($scope.departCal.date,"dd-MM-yyyy"),$scope.passenger.flightsAdults&&(bffstring+="&adult="+$scope.passenger.flightsAdults),$scope.passenger.flightsMinors&&(bffstring+="&kid="+$scope.passenger.flightsMinors),$scope.passenger.flightsInfants&&(bffstring+="&infant="+$scope.passenger.flightsInfants),"tb"==$scope.currency&&(bffstring+="&fare=POINTS"),window.location=$scope.config.flexibleSearch.baseURL+bffstring},$scope.resolveChildrenAsUMNR=function(){$("#jbBooker-groups-UNN").val($scope.passenger.flightsMinors),$scope.passenger.flightsMinors=0,setTimeout(function(){$scope.saveAndSubmit(!0)},10)},$scope.resolveChildrenAsAdult=function(){$scope.passenger.flightsAdults=$scope.passenger.flightsMinors,$scope.passenger.flightsMinors=0,setTimeout(function(){$scope.saveAndSubmit(!0)},10)},$scope.departDateError="",$scope.returnDateError="",$scope.departCityError="",$scope.returnCityError="",$scope.passengerError="",$scope.checkDepartDate=function(){setTimeout(function(){$scope.departDateError="",isInvalidDate($scope.departCal.date)&&($scope.departDateError=BookerConfig.errorMessages.DEPART_DATE_ERROR),$scope.$apply()},0)},$scope.checkReturnDate=function(){setTimeout(function(){$scope.returnDateError="","RT"==$scope.itinerarySelect&&(isInvalidDate($scope.returnCal.date)&&($scope.returnDateError=BookerConfig.errorMessages.RETURN_DATE_ERROR),$scope.$apply())},0)},$scope.checkDepartCity=function(){$scope.departCityError="",$scope.fromResult&&isValidAirport($scope.fromResult,$scope.fromPAirports)||($scope.departCityError=BookerConfig.errorMessages.DEPART_CITY_ERROR)},$scope.hideDepartCityError=function(){$scope.departCityError=""},$scope.checkReturnCity=function(){$scope.returnCityError="",$scope.toResult&&isValidAirport($scope.toResult,$scope.toPAirports)||($scope.returnCityError=BookerConfig.errorMessages.ARRIVAL_CITY_ERROR)},$scope.hideReturnCityError=function(){$scope.returnCityError=""},$scope.clearInlineMsg=function(){"RT"!==$scope.itinerarySelect&&($scope.returnDateError="")},$scope.checkAllFields=function(){$scope.updatePassengerOptions(),$scope.departCal.date&&$scope.checkDepartDate(),$scope.departCal.date&&$scope.checkReturnDate(),$scope.checkDepartCity(),$scope.checkReturnCity(),$scope.clearInlineMsg()},$scope.saveAndSubmit=function(isToSubmit){if(isToSubmit=isToSubmit||!1,isToSubmit&&"getaways"!=$scope.searchType){saveSearch("recentSearchesFlight"),$scope.showErrors=!1;try{$(".jbBooker form").attr("action",$(".jbBooker form").attr("data-forward-action")).submit()}catch(e){}}else isToSubmit&&"getaways"==$scope.searchType&&$scope.submitVacationsHandler()},$scope.closeErrors=function(){$scope.showErrors=!1,$scope.showWarnings=!1,setTimeout(function(){$(".inline_error:visible").each(function(){return""!=$(this).text()?($(this).closest(".formcontrol, .calendar_wrapper, .passengerSelect").find("input[type=text], .jbSelectLabel:first:visible").focus(),!1):void 0})},10)},$scope.toTrusted=function(html_code){return $sce.trustAsHtml(html_code)},$scope.$on("OD API FAILURE",function(){$scope.fatalAppError=!0})}]).directive("booker",function(){return{restrict:"E",replace:!0,templateUrl:"/includes/modules/booker_refresh/dist/partials/booker.html"}}).directive("focusMe",function($timeout){return{scope:{trigger:"=focusMe"},link:function(scope,element){scope.$watch("trigger",function(value){value===!0&&(element[0].focus(),scope.trigger=!1)})}}}).controller("UnaccompaniedMinorCtrl",["$scope","$rootScope","BookerConfig","jbOverlayFactory","$timeout",function($scope,$rootScope,BookerConfig,jbOverlayFactory,$timeout){var attrs=jbOverlayFactory.getAttributes();$scope.msg=BookerConfig.errorMessages.UNACCOMPANIED_MINOR_CONFIRM,$scope.accepted=function(){$rootScope.$broadcast("resolveUMNR",attrs.triggerEvent),closeModal()},$scope.rejected=function(){closeModal()};var closeModal=function(){jbOverlayFactory.hide()}}]).directive("ageFilter",function(){return{require:"ngModel",link:function(scope,element,attr,ngModelCtrl){function fromUser(text){var transformedInput=parseInt(text),transformedInputText=transformedInput+"";if(transformedInputText!==text&&transformedInput<=scope.maxAge)ngModelCtrl.$setViewValue(transformedInputText),ngModelCtrl.$render();else if((transformedInputText!==text||transformedInput>scope.maxAge)&&void 0!==text){for(;transformedInput>scope.maxAge;)transformedInput=Math.floor(transformedInput/10);transformedInputText=""+transformedInput,"NaN"==transformedInputText&&(transformedInputText=""),ngModelCtrl.$setViewValue(transformedInputText),ngModelCtrl.$render()}return transformedInputText}scope.maxAge=attr.maxAge,ngModelCtrl.$parsers.push(fromUser)}}}),angular.module("BookerWrapper").run(["$templateCache",function($templateCache){"use strict";$templateCache.put("/includes/modules/booker_refresh/dist/partials/_umnrresolution.html",'<div class="umnrResolution" ng-controller="UnaccompaniedMinorCtrl"><div>{{msg}}</div><div class="buttons"><div class="yes dialog_btn" ng-click="accepted()">OK</div><div class="no dialog_btn" ng-click="rejected()">Cancel</div></div></div>'),$templateCache.put("/includes/modules/booker_refresh/dist/partials/booker.html",'<div class="jbBooker {{type}}"><form data-forward-action="{{config[searchType].form.action}}" method="{{config[searchType].form.method}}" novalidate><input type="hidden" name="lang" value="en" id="jbBookerLang"><input type="hidden" name="pos" value="JETBLUE" id="jbBookerPOS"><input type="hidden" name="flexibleSearch" value="TRUE" id="jbBookerFlexSearch"><input type="hidden" name="searchType" value="NORMAL"><div class="searchSelect" ng-show="type==\'homepage\'||type==\'standalone\'"><ul><li ng-repeat="type in config.searchTypes.types"><input id="jbBookerSearchType{{type.name}}" type="radio" value="{{type.value}}" ng-model="$parent.searchType" name="jbBookerSearchType" ng-change="onSearchTypeChange()"><label for="jbBookerSearchType{{type.name}}" class="piejs" ng-class="{checked:$parent.searchType === type.value}">{{type.label}}</label></li></ul></div><div class="recentSearches" ng-init="rsInit()" ng-hide="itinerarySelect == \'MC\'"><div class="select {{rsopen}}" tabindex="0" ng-keydown="onKeyDownR($event)"><div class="label" ng-click="rsDisplayMenu(recentSearches.length || 0)" ng-class="{no_searches: !recentSearches.length}"><span class="visuallyhidden">click to see recent searches</span>{{recentSearches.length || 0}} recent searches</div><div class="options piejs" ng-show="isrsDisplayed"><div class="options_header" ng-click="rsDisplayMenu()">{{recentSearches.length || 0}} recent searches <span class="upArrow"></span></div><a href="javascript:void(0)" ng-keydown="onOptionKeyDown($event)" class="option" ng-repeat="search in recentSearches" ng-click="setFormValues(search); rsDisplayMenu();">{{search.fromCode}} &gt; {{search.toCode}}, {{search.departDate | date:"MM-dd-yyyy"}}</a></div></div></div><div class="itinerarySelect" ng-show="searchType == \'flights\'"><ul><li ng-class="( itinerarySelect == type.value )?\'selected_opt\':\'\'" ng-repeat="type in config.flights.itineraries.types" ng-hide="($parent.type != \'multicity\' && type.value == \'MC\') || searchType != \'flights\' "><input type="radio" ng-model="$parent.itinerarySelect" id="jbBookerItin{{type.value}}" value="{{type.value}}" name="journeySpan" ng-change="$parent.clearInlineMsg()"><label class="fir" for="jbBookerItin{{type.value}}"><span class="labelimgholder"><img class="radioUnchecked" src="/includes/modules/booker_refresh/src/assets/radio-btn-unchecked.png"><img class="radioFir" src="/includes/modules/booker_refresh/src/assets/radio-btn-checked.png"></span><span class="labeltextholder ng-binding">{{type.label}}</span></label></li><li ng-show="type != \'multicity\' && type!=\'bff\' && searchType == \'flights\'"><a href="{{config.multicityLink.url}}" class="type_multicity" alt="{{config.multicityLink.alt}}">{{config.multicityLink.text}}<span class="foreground-sprite-linkarrow linkrightarrow"><img src="//www2.jetblue.com/includes/modules/booker_refresh/src/assets/rgt-arrow.png" alt="{{config.multicityLink.alt}}"></span></a></li><li ng-show="config[searchType].terms" class="terms"><a class="{{config[searchType].terms.class}}" href="{{config[searchType].terms.url}}">{{config[searchType].terms.text}}<span class="foreground-sprite-linkarrow linkrightarrow"><img src="//www2.jetblue.com/includes/modules/booker_refresh/src/assets/rgt-arrow.png"></span></a></li></ul></div><div class="itinerarySelect {{type}}" ng-show="searchType == \'getaways\'"><ul><li ng-repeat="currencyObj in config.getaways.currencies" ng-if="type !== \'vacations\'" ng-class="( $parent.$parent.currency == currencyObj.valueEnum )?\'selected_opt\':\'\'"><input id="jbBookerCurrency-getaways-{{$index}}" name="jbBookerCurrency-getaways" ng-click="print(currency)" ng-model="$parent.$parent.currency" type="radio" ng-value="currencyObj.valueEnum"><label class="fir" for="jbBookerCurrency-getaways-{{$index}}"><span class="labelimgholder"><img class="radioUnchecked" src="/includes/modules/booker_refresh/src/assets/radio-btn-unchecked.png"><img class="radioFir" src="/includes/modules/booker_refresh/src/assets/radio-btn-checked.png"></span><span class="labeltextholder ng-binding">{{currencyObj.name}}</span></label></li><li ng-show="config[searchType].terms" class="terms"><a class="{{config[searchType].terms.class}}" href="{{config[searchType].terms.url}}">{{config[searchType].terms.text}} <span class="foreground-sprite-linkarrow linkrightarrow"><img src="//www2.jetblue.com/includes/modules/booker_refresh/src/assets/rgt-arrow.png"></span></a></li></ul></div><div class="clear_fix"></div><div ng-show="errors.length > 0"><ul><li ng-repeat="error in errors" ng-class="{error: error.status == \'error\', warn: error.status == \'warn\' }"></li></ul></div><div class="originDestinationSelect" ng-hide="itinerarySelect==\'MC\'"><div class="formcontrol" ng-class="{error_input_box: departCityError}"><div id="jbBookerDepartError" class="inline_error" ng-show="departCityError||returnCityError">{{departCityError}}</div><label class="hidden" for="jbBookerDepart" id="jbBookerDepartLabel">Departure city</label><div class="clear-fix"></div><cityselector class="auto" ng-model="fromResult" click-activation="true" list-data="fromLAirports" popup-data="fromPAirports" suggestion-type="from" on-type="onFromCityType" on-select="onFromSelection" on-clear="onFromClear" selected-object="fromSelectedObj" attr-inputclass="DepartBox" attr-inputalttext="Select departure city" attr-labelid="jbBookerDepartLabel" attr-errorlabelid="jbBookerDepartError" attr-inputid="jbBookerDepart" action-taken-function="hideDepartCityError()" footer-text="citySelectorFooterText"></cityselector><input type="hidden" name="origin" value="{{fromSelectedObj.code}}" ng-if="itinerarySelect!=\'MC\'"></div><div class="formcontrol" ng-class="{error_input_box: returnCityError}"><div id="jbBookerArriveError" class="inline_error" ng-show="departCityError||returnCityError">{{returnCityError}}</div><label id="jbBookerArriveLabel" class="hidden" for="jbBookerArrive">Arrival city</label><div class="clear-fix"></div><cityselector class="auto" ng-model="toResult" click-activation="true" list-data="toLAirports" on-type="onToCityType" popup-data="toPAirports" suggestion-type="to" on-select="onToSelection" on-clear="onToClear" selected-object="toSelectedObj" attr-inputclass="ArriveBox" attr-inputalttext="Select Arrival city" attr-labelid="jbBookerArriveLabel" attr-errorlabelid="jbBookerArriveError" attr-inputid="jbBookerArrive" action-taken-function="hideReturnCityError()" footer-text="citySelectorFooterText"></cityselector><input type="hidden" name="destination" value="{{toSelectedObj.code}}" ng-if="itinerarySelect!=\'MC\'" ng-required="true"></div><input type="hidden" ng-value="isInterlineRoute" name="roundTripFaresFlag"><input type="hidden" ng-value="isSharedMarketRoute" name="sharedMarket"></div><div class="dateSelect" ng-hide="itinerarySelect==\'MC\'"><label class="hidden" for="jbBookerCalendarDepart" id="jbBookerDepartDateLabel">Departure date</label><div class="calendar_wrapper" ng-class="{cal_active: departCal.isOpen}"><div class="inline_error" id="jbBookerDepartDateError" ng-show="departDateError||returnDateError">{{departDateError}}</div><div class="clear-fix"></div><div class="clndr clndr1 formcontrol" ng-class="{error_input_box: departDateError}"><span tabindex="0" ng-keydown="onKeyDownCalendarIcon($event)" class="input-group-btn cal-btn cal-btn-depart btn-default jbbkr-foreground-sprite-depart jbbkr-calendar-depart" ng-click="openDepartCalendar($event)"><img src="/includes/modules/booker_refresh/src/assets/form-btn-sp.png" alt="Departure date selector. Click to open"></span> <input aria-labelledby="jbBookerDepartDateLabel jbBookerDepartDateError" type="text" autocomplete="off" id="jbBookerCalendarDepart" placeholder="Depart date: {{format|uppercase}}" class="form-control" datepicker-popup="{{format}}" ng-model="departCal.date" journey-type="departing" extdate="{{departCal.extDate}}" is-open="departCal.isOpen" type="depart" datepicker-options="departCal.options" min="departCal.minDate" max-date="departCal.maxDate" close-text="Close" ng-keydown="onKeyDownCalendarInput($event)"></div></div><label class="hidden" for="jbBookerCalendarReturn" id="jbBookerReturnLabel" ng-hide="itinerarySelect==\'OW\'">Return date</label><div class="calendar_wrapper" ng-class="{cal_active: returnCal.isOpen}"><div class="inline_error" id="jbBookerReturnError" ng-show="departDateError||returnDateError">{{returnDateError}}</div><div class="clear-fix"></div><div class="clndr clndr2 formcontrol" ng-hide="itinerarySelect==\'OW\'" ng-class="{error_input_box: returnDateError}"><span ng-keydown="onKeyDownCalendarIcon($event)" tabindex="0" class="input-group-btn cal-btn cal-btn-arrive btn-default jbbkr-foreground-sprite-arrive jbbkr-calendar-arrive" ng-click="openReturnCalendar($event)"><img src="/includes/modules/booker_refresh/src/assets/form-btn-sp.png" alt="Return date selector. Click to open"></span> <input aria-labelledby="jbBookerReturnLabel jbBookerReturnError" type="text" autocomplete="off" id="jbBookerCalendarReturn" placeholder="Return date: {{format|uppercase}}" class="form-control" ng-model="returnCal.date" journey-type="returning" extdate="{{returnCal.extDate}}" is-open="returnCal.isOpen" datepicker-popup="{{format}}" min="returnCal.minDate" max-date="returnCal.maxDate" datepicker-options="returnCal.options" close-text="Close" ng-keydown="onKeyDownCalendarInput($event)"></div></div><input type="hidden" name="departureDate" value="{{ departCal.date | date:\'yyyy-MM-dd\' }}" ng-if="itinerarySelect!=\'MC\'"> <input type="hidden" name="returnDate" value="{{ returnCal.date | date:\'yyyy-MM-dd\' }}" ng-if="itinerarySelect!==\'OW\'"></div><div class="multicityItin" ng-if="itinerarySelect==\'MC\'"><div class="city_selector_wrapper"><div class="mc_pre_number"><div class="piejs">1</div><span>&nbsp;</span></div><div class="formcontrol"><div class="inline_error" id="mcFromCity1Error" ng-show="mcCityError.fromResult1">{{mcCityError.fromResult1}}</div><label for="jbBookerDepart1" id="mcFromCity1Label" class="visuallyhidden">Departure city for leg 1</label><div class="clear-fix"></div><cityselector action-taken-function="hideMCCityError(\'fromResult1\', 1)" blur-function="" class="auto" ng-model="MC.fromResult1" click-activation="true" list-data="fromLAirports" popup-data="fromPAirports1" on-select="onMultiFromSelection" on-clear="onMultiFromClear(1)" selected-object="fromSelectedObj1" attr-inputalttext="Departure city for leg 1" attr-inputclass="DepartBox" attr-inputid="jbBookerDepart1" id="1" attr-labelid="mcFromCity1Label" attr-errorlabelid="mcFromCity1Error" footer-text="citySelectorFooterText"></cityselector></div><div class="formcontrol"><div class="inline_error" id="mcToCity1Error" ng-show="mcCityError.toResult1">{{mcCityError.toResult1}}</div><label for="jbBookerArrive1" id="mcToCity1Label" class="visuallyhidden">Arrival city for leg 1</label><div class="clear-fix"></div><cityselector blur-function="" action-taken-function="hideMCCityError(\'toResult1\', 1)" class="auto" ng-model="MC.toResult1" click-activation="true" list-data="toLAirports1" attr-inputalttext="Arrival city for leg 1" popup-data="toPAirports1" on-select="onMultiToSelection" on-clear="onMultiToClear(1)" selected-object="toSelectedObj1" attr-inputclass="ArriveBox" attr-inputid="jbBookerArrive1" id="1" attr-labelid="mcToCity1Label" attr-errorlabelid="mcToCity1Error" footer-text="citySelectorFooterText"></cityselector></div><div class="calendar_wrapper" ng-class="{cal_active: departCal1.isOpen}"><div class="inline_error" id="mcDepartDate1Error" ng-show="mcDateError.departCal1">{{mcDateError.departCal1}}</div><label for="jbBookerCalendarDepart1" id="mcDepartDate1Label" class="visuallyhidden">Departure date for leg 1</label><div class="clear-fix"></div><div class="clndr clndr1 formcontrol"><span tabindex="0" ng-keydown="$event.keyCode === 13 && openMultiDepartCalendar($event, 1)" class="input-group-btn cal-btn-depart cal-btn btn-default jbbkr-foreground-sprite-depart jbbkr-calendar-depart" ng-click="openMultiDepartCalendar($event, 1); mcDateError.departCal1=\'\';"><img src="/includes/modules/booker_refresh/src/assets/form-btn-sp.png" alt="Departure date leg 1 selector"></span> <input type="text" ng-blur="" autocomplete="off" aria-labeledby="mcDepartDate1Label mcDepartDate1Error" id="jbBookerCalendarDepart1" placeholder="Depart date: {{format|uppercase}}" class="form-control" datepicker-popup="{{format}}" ng-model="departCal1.date" journey-type="departing" extdate="{{departCal1.extDate}}" is-open="departCal1.isOpen" datepicker-options="departCal1.options" min="departCal1.minDate" max-date="departCal1.maxDate" close-text="Close"></div></div></div><div class="city_selector_wrapper"><div class="mc_pre_number"><div class="piejs">2</div><span>&nbsp;</span></div><div class="formcontrol"><div class="inline_error" id="mcFromCity2Error" ng-show="mcCityError.fromResult2">{{mcCityError.fromResult2}}</div><label for="jbBookerDepart2" id="mcFromCity2Label" class="visuallyhidden">Departure city for leg 2</label><div class="clear-fix"></div><cityselector blur-function="" action-taken-function="hideMCCityError(\'fromResult2\', 2)" class="auto" ng-model="MC.fromResult2" click-activation="true" list-data="fromLAirports2" attr-inputalttext="Departure city for leg 2" popup-data="fromPAirports2" on-select="onMultiFromSelection" on-clear="onMultiFromClear(2)" selected-object="fromSelectedObj2" attr-inputclass="DepartBox" attr-inputid="jbBookerDepart2" id="2" attr-labelid="mcFromCity2Label" attr-errorlabelid="mcFromCity2Error" footer-text="citySelectorFooterText"></cityselector></div><div class="formcontrol"><div class="inline_error" id="mcToCity2Error" ng-show="mcCityError.toResult2">{{mcCityError.toResult2}}</div><label for="jbBookerDepart2" id="mcToCity2Label" class="visuallyhidden">Arrival city for leg 2</label><div class="clear-fix"></div><cityselector blur-function="" action-taken-function="hideMCCityError(\'toResult2\', 2)" class="auto" ng-model="MC.toResult2" click-activation="true" list-data="toLAirports2" attr-inputalttext="Arrival city for leg 2" popup-data="toPAirports2" on-select="onMultiToSelection" on-clear="onMultiToClear(2)" selected-object="toSelectedObj2" attr-inputid="jbBookerArrive2" id="2" attr-inputclass="ArriveBox" attr-labelid="mcToCity2Label" attr-errorlabelid="mcToCity2Error" footer-text="citySelectorFooterText"></cityselector></div><div class="calendar_wrapper" ng-class="{cal_active: departCal2.isOpen}"><div class="inline_error" id="mcDepartDate2Error" ng-show="mcDateError.departCal2">{{mcDateError.departCal2}}</div><label for="jbBookerCalendarDepart2" id="mcDepartDate2Label" class="visuallyhidden">Departure date for leg 2</label><div class="clear-fix"></div><div class="clndr clndr2 formcontrol"><span tabindex="0" ng-keydown="$event.keyCode === 13 && openMultiDepartCalendar($event, 2)" class="input-group-btn cal-btn-depart cal-btn btn-default jbbkr-foreground-sprite-depart jbbkr-calendar-depart" ng-click="openMultiDepartCalendar($event, 2);mcDateError.departCal2=\'\';"><img src="/includes/modules/booker_refresh/src/assets/form-btn-sp.png" alt="Departure date leg 2 selector"></span> <input type="text" ng-blur="checkMCDate(\'departCal2\')" autocomplete="off" id="jbBookerCalendarDepart2" placeholder="Depart date: {{format|uppercase}}" class="form-control" datepicker-popup="{{format}}" ng-model="departCal2.date" journey-type="departing" is-open="departCal2.isOpen" datepicker-options="departCal2.options" min="departCal2.minDate" max-date="departCal2.maxDate" aria-labeledby="mcDepartDate2Label mcDepartDate2Error" extdate="{{departCal2.extDate}}" close-text="Close"></div></div></div><div class="city_selector_wrapper"><div class="mc_pre_number" ng-class="thirdTripLine"><div class="piejs">3</div><span class="optional_text">{{config.legends.optionalText}}</span> <a href="javascript:void(0)" class="clear_entry" ng-click="clearTripLine(3)">{{config.legends.clearEntry}}</a></div><div class="formcontrol"><div class="inline_error" id="mcFromCity3Error" ng-show="mcCityError.fromResult3">{{mcCityError.fromResult3}}</div><label for="jbBookerDepart3" id="mcFromCity3Label" class="visuallyhidden">Departure city for leg 3</label><div class="clear-fix"></div><cityselector class="auto" attr-labelid="mcFromCity3Label" attr-errorlabelid="mcFromCity3Error" ng-model="MC.fromResult3" click-activation="true" list-data="fromLAirports3" popup-data="fromPAirports3" on-select="onMultiFromSelection" on-clear="onMultiFromClear(3)" selected-object="fromSelectedObj3" attr-inputclass="DepartBox" attr-inputid="jbBookerDepart3" id="3" action-taken-function="hideMCCityError(\'fromResult3\', 3)" attr-inputalttext="Departure city for leg 3" footer-text="citySelectorFooterText"></cityselector></div><div class="formcontrol"><div class="inline_error" id="mcToCity3Error" ng-show="mcCityError.toResult3">{{mcCityError.toResult3}}</div><label for="jbBookerDepart3" id="mcToCity3Label" class="visuallyhidden">Arrival city for leg 3</label><div class="clear-fix"></div><cityselector class="auto" attr-labelid="mcToCity3Label" attr-errorlabelid="mcToCity3Error" ng-model="MC.toResult3" click-activation="true" list-data="toLAirports3" popup-data="toPAirports3" on-select="onMultiToSelection" on-clear="onMultiToClear(3)" selected-object="toSelectedObj3" attr-inputclass="ArriveBox" attr-inputid="jbBookerArrive3" id="3" action-taken-function="hideMCCityError(\'toResult3\', 3)" attr-inputalttext="Arrival city for leg 3" footer-text="citySelectorFooterText"></cityselector></div><div class="calendar_wrapper" ng-class="{cal_active: departCal3.isOpen}"><div class="inline_error" id="mcDepartDate3Error" ng-show="mcDateError.departCal3">{{mcDateError.departCal3}}</div><label for="jbBookerCalendarDepart3" id="mcDepartDate3Label" class="visuallyhidden">Departure date for leg 3</label><div class="clear-fix"></div><div class="clndr clndr3 formcontrol"><span tabindex="0" ng-keydown="$event.keyCode === 13 && openMultiDepartCalendar($event, 3)" class="input-group-btn cal-btn-depart cal-btn btn-default jbbkr-foreground-sprite-depart jbbkr-calendar-depart" ng-click="openMultiDepartCalendar($event, 3)"><img src="/includes/modules/booker_refresh/src/assets/form-btn-sp.png" alt="Departure date leg 3 selector"></span> <input type="text" autocomplete="off" id="jbBookerCalendarDepart" placeholder="Depart date: {{format|uppercase}}" class="form-control" datepicker-popup="{{format}}" ng-model="departCal3.date" journey-type="departing" is-open="departCal3.isOpen" datepicker-options="departCal3.options" min="departCal3.minDate" max-date="departCal3.maxDate" aria-labeledby="mcDepartDate3Label mcDepartDate3Error" extdate="{{departCal3.extDate}}" close-text="Close"></div></div></div><div class="city_selector_wrapper"><div class="mc_pre_number" ng-class="fourthTripLine"><div class="piejs">4</div><span class="optional_text">{{config.legends.optionalText}}</span> <a href="javascript:void(0)" class="clear_entry" ng-click="clearTripLine(4)">{{config.legends.clearEntry}}</a></div><div class="formcontrol"><div class="inline_error" id="mcFromCity4Error" ng-show="mcCityError.fromResult4">{{mcCityError.fromResult4}}</div><label for="jbBookerDepart4" id="mcFromCity4Label" class="visuallyhidden">Departure city for leg 4</label><div class="clear-fix"></div><cityselector class="auto" attr-labelid="mcFromCity4Label" attr-errorlabelid="mcFromCity4Error" ng-model="MC.fromResult4" click-activation="true" list-data="fromLAirports4" popup-data="fromPAirports4" on-select="onMultiFromSelection" on-clear="onMultiFromClear(4)" selected-object="fromSelectedObj4" attr-inputclass="DepartBox" attr-inputid="jbBookerDepart4" id="4" action-taken-function="hideMCCityError(\'fromResult4\', 4)" attr-inputalttext="Departure city for leg 4" footer-text="citySelectorFooterText"></cityselector></div><div class="formcontrol"><div class="inline_error" id="mcToCity4Error" ng-show="mcCityError.toResult4">{{mcCityError.toResult4}}</div><label for="jbBookerDepart4" id="mcToCity4Label" class="visuallyhidden">Arrival city for leg 4</label><div class="clear-fix"></div><cityselector class="auto" attr-labelid="mcToCity4Label" attr-errorlabelid="mcToCity4Error" ng-model="MC.toResult4" click-activation="true" list-data="toLAirports4" popup-data="toPAirports4" on-select="onMultiToSelection" on-clear="onMultiToClear(4)" selected-object="toSelectedObj4" attr-inputclass="ArriveBox" attr-inputid="jbBookerArrive4" id="4" action-taken-function="hideMCCityError(\'toResult4\', 4)" attr-inputalttext="Arrival city for leg 4" footer-text="citySelectorFooterText"></cityselector></div><div class="calendar_wrapper" ng-class="{cal_active: departCal4.isOpen}"><div class="inline_error" id="mcDepartDate4Error" ng-show="mcDateError.departCal4">{{mcDateError.departCal4}}</div><label for="jbBookerCalendarDepart4" id="mcDepartDate4Label" class="visuallyhidden">Departure date for leg 4</label><div class="clear-fix"></div><div class="clndr clndr4 formcontrol"><span tabindex="0" ng-keydown="$event.keyCode === 13 && openMultiDepartCalendar($event, 4)" class="input-group-btn cal-btn-depart cal-btn btn-default jbbkr-foreground-sprite-depart jbbkr-calendar-depart" ng-click="openMultiDepartCalendar($event, 4)"><img src="/includes/modules/booker_refresh/src/assets/form-btn-sp.png" alt="Departure date leg 4 selector"></span> <input type="text" autocomplete="off" id="jbBookerCalendarDepart" placeholder="Depart date: {{format|uppercase}}" class="form-control" datepicker-popup="{{format}}" ng-model="departCal4.date" journey-type="departing" is-open="departCal4.isOpen" datepicker-options="departCal4.options" min="departCal4.minDate" max-date="departCal4.maxDate" aria-labeledby="mcDepartDate4Label mcDepartDate4Error" extdate="{{departCal4.extDate}}" close-text="Close"></div></div></div><input type="hidden" name="originDestinationOptions[0].originPoint" value="{{fromSelectedObj1.code}}"> <input type="hidden" name="originDestinationOptions[1].originPoint" value="{{fromSelectedObj2.code}}"> <input type="hidden" name="originDestinationOptions[2].originPoint" value="{{fromSelectedObj3.code}}"> <input type="hidden" name="originDestinationOptions[3].originPoint" value="{{fromSelectedObj4.code}}"> <input type="hidden" name="originDestinationOptions[0].destinationPoint" value="{{toSelectedObj1.code}}"> <input type="hidden" name="originDestinationOptions[1].destinationPoint" value="{{toSelectedObj2.code}}"> <input type="hidden" name="originDestinationOptions[2].destinationPoint" value="{{toSelectedObj3.code}}"> <input type="hidden" name="originDestinationOptions[3].destinationPoint" value="{{toSelectedObj4.code}}"> <input type="hidden" name="departureDate" value="{{departCal1.date | date: \'yyyy-MM-dd\'}}" ng-if="itinerarySelect==\'MC\'"> <input type="hidden" name="originDestinationOptions[0].departureDate" value="{{departCal1.date | date: \'yyyy-MM-dd\'}}"> <input type="hidden" name="originDestinationOptions[1].departureDate" value="{{departCal2.date | date: \'yyyy-MM-dd\'}}"> <input type="hidden" name="originDestinationOptions[2].departureDate" value="{{departCal3.date | date: \'yyyy-MM-dd\'}}"> <input type="hidden" name="originDestinationOptions[3].departureDate" value="{{departCal4.date | date: \'yyyy-MM-dd\'}}"></div><div class="clear-fix mc-extra-pad"></div><div class="passengerSelect" ng-hide="type == \'changeFlights\'" ng-class="{ getaways  : searchType == \'getaways\' }"><div tabindex="0" class="inline_error passanger_error" ng-show="passengerError">{{passengerError}}</div><div><div ng-repeat="group in config[searchType].ageGroups" class="ageGroups"><label for="jbBookerGroup-{{$index}}" class="hidden">{{group.name}} <span class="description">({{group.description}})</span></label><div jb-select id="jbBookerGroup-{{$index}}" myarialabel="Passengers." ng-model="$parent.passenger[group.id]" ng-options="group.options" class="passengerGroup" name="{{ [\'numAdults\', \'numChildren\', \'numInfants\'][$index] }}"></div><div class="ageEnumeration minor_list_wrapper ageGroupEnumOptions" ng-if="group.ageEnumerationRequired && $parent.passenger[group.id] > 0 " class=""><div class="minor_list_inner" id="{{\'minor_count_\'+$parent.passengerIterable[group.id].length}}"><label for="booker-{{group.id}}-enum">Ages:</label><div ng-repeat="item in $parent.passengerIterable[group.id] track by $index" class="option"><input type="text" age-filter max-age="{{config.CONSTANTS.MAX_MINOR_AGE}}" spellcheck="false" autocorrect="off" autocapitalize="off" autocorrect="off" autocomplete="off" id="booker-{{group.id}}-enum-{{$index+1}}" placeholder="{{group.labels.singular}} {{$index+1}}" ng-model="$parent.getawayMinorAge[$index+1]" pattern="/^[0-9]+$/;" max="group.maximumAge" required></div></div></div></div><div class="hotel_room" ng-show="config[searchType].additionalProducts" ng-repeat="product in additionalProducts"><label for="jbBooker{{SearchType}}additionalProducts{{name}}"></label><div jb-select myarialabel="Hotel options" ng-options="product.options" ng-model="product.model" id="jbBooker{{SearchType}}additionalProducts{{name}}"></div></div><div ng-show="type == \'vacations\' " class="passengerAdjacentLink"><a href="{{config.vacationsServices.url}}" alt="{{config.vacationsServices.alt}}">{{config.vacationsServices.text}}</a></div></div></div><div class="currencySelect {{type}}" ng-class="{noFlex: !(config.flexibleSearch.enabled && type==\'homepage\' && searchType == \'flights\')}" ng-show="searchType !== \'getaways\'"><ul><li ng-class="( $parent.$parent.currency == currencyObj.valueEnum )?\'selected_opt\':\'\'" ng-if="(searchType == \'flights\') && (type !== \'vacations\') &&  itinerarySelect!=\'MC\'" ng-repeat="currencyObj in config.flights.currencies"><input id="jbBookerCurrency-flights-{{$index}}" name="jbBookerCurrency-flights" ng-model="$parent.$parent.currency" type="radio" ng-value="currencyObj.valueEnum"><label class="fir" for="jbBookerCurrency-flights-{{$index}}"><span class="labelimgholder"><img class="radioUnchecked" src="/includes/modules/booker_refresh/src/assets/radio-btn-unchecked.png"><img class="radioFir" src="/includes/modules/booker_refresh/src/assets/radio-btn-checked.png"></span><span class="labeltextholder ng-binding">{{currencyObj.name}}</span></label></li><input type="hidden" name="jbBookerCurrency-flights" value="{{mcCurrency}}" ng-if="itinerarySelect==\'MC\'"> <input type="hidden" name="refundable" value="{{currency == \'refundable\'}}"><li ng-repeat="currencyObj in config.getaways.currencies" ng-if="type == \'vacations\'" ng-class="( $parent.$parent.currency == currencyObj.valueEnum )?\'selected_opt\':\'\'"><input id="jbBookerCurrency-getaways-{{$index}}" name="jbBookerCurrency-getaways" ng-model="$parent.$parent.currency" type="radio" ng-value="currencyObj.valueEnum"><label class="fir" for="jbBookerCurrency-getaways-{{$index}}"></label><label for="jbBookerCurrency-getaways-{{$index}}">{{currencyObj.name}}</label></li><li ng-show="type == \'vacations\'"><a href="{{config[searchType].terms.url}}" alt="{{config[searchType].terms.alt}}">{{config[searchType].terms.text}}</a></li><li ng-show=" type == \'vacations\'" class="nonstopOption" ng-class="{checked:nonstop}"><input type="checkbox" id="nonstopcheck" ng-model="nonstop"><label class="fir" for="nonstopcheck"></label><label for="nonstopcheck"><span class="visuallyhidden">Show only</span>Nonstop flights</label><input type="hidden" name="nonstop" value="nonstop" ng-if="nonstop == true"></li></ul><input type="hidden" name="fareFamily" value="{{ currency == \'tb\' ? \'TRUEBLUE\' : refundable ? \'REFUNDABLE\' : \'LOWESTFARE\' }}"> <input type="hidden" name="fareDisplay" value="{{ currency == \'tb\' ? \'points\' : refundable ? \'refundable\' : \'lowest\' }}"></div><hr class="hr_divider_lg" ng-hide="type != \'multicity\'"><div ng-show="config.flexibleSearch.enabled && type==\'homepage\' && searchType == \'flights\'" class="flexsearch" ng-class="{checked: flexSearchOptIn}"><input type="checkbox" id="jbBookerFlexSearchOption" name="jbBookerFlexSearch" ng-model="flexSearchOptIn"><label for="jbBookerFlexSearchOption" class="fir"></label><label for="jbBookerFlexSearchOption">{{config.flexibleSearch.optInText}}</label></div><div class="additionalInfo"><ul><li ng-repeat="link in config.additionalInfo.links"><a href="{{link.url}}" ng-click="openModal($event, bwconfig.additionalInfo.links[link.class]? (bwconfig.additionalInfo.links[link.class].modalContent) : link.modalContent, link.modalHeaderText)"><span class="{{link.class}} {{link.classSpan}}"><img src="{{link.imgsrc}}" alt="" class="booker-additionalInfo-{{$index}}"></span>{{link.text}}</a></li></ul></div><div class="promo_code_box" ng-if="promoVisible"><label>Have a promo code?</label><input type="text" placeholder="Enter code here" name="promoCode" ng-model="promo" spellcheck="false" autocorrect="off" autocapitalize="off" autocorrect="off" autocomplete="off"></div><br ng-show="promoVisible" class="clear-fix"><input class="piejs" type="submit" ng-hide="type==\'bff\'" value="{{itinerarySelect==\'MC\'? config.submit.textPlural : config.submit.text}}" ng-click="handleSubmit($event)"><div focus-me="focusThis" tabindex="-1" class="form_errors_overlay" ng-show="showErrors||fatalAppError || showWarnings"><div class="error_top"><h1 class="error_heading" ng-hide="!fatalAppError && (isSeasonalFlight|| !errorMessages.length)">Oops!</h1><button class="error_close_button piejs" ng-click="closeErrors()" tabindex="0" ng-hide="fatalAppError">&times;<span class="visuallyhidden">Close error message</span></button></div><div class="fallbackerrormessage" ng-hide="isSeasonalFlight||errorMessages.length||showWarnings">It looks like something has gone wrong here. Please try refreshing the page or contact 1-800-JETBLUE if the issue persists.</div><div class="error_wrapper" ng-hide="isSeasonalFlight"><div class="error_message_container"><div class="error_message" ng-repeat="errorMessage in errorMessages" ng-bind="errorMessage"></div></div></div><div class="error_wrapper" ng-hide="isSeasonalFlight||errorMessages.length"><div class="warning_message_container"><div class="error_message warn_message" ng-repeat="warningMessage in warningMessages" ng-bind="warningMessage"></div></div></div><div class="error_wrapper" ng-show="isSeasonalFlight"><div class="error_heading"><h2></h2></div><div class="error_message_container"><div class="error_message_single" ng-bind-html="toTrusted(seasonalFlightMsg)"></div></div></div><div class="cta clear-fix" ng-if="isSeasonalFlight||errorMessages.length||showWarnings"><button class="ok_button piejs" ng-click="closeErrors()" ng-hide="isSeasonalFlight || (!errorMessages.length && showWarnings)"><span class="visuallyhidden">Return to Form</span>OK</button> <span class="continue_button" ng-show="isSeasonalFlight||(showWarnings && !errorMessages.length)"><input type="button" class="piejs" ng-click="continueSubmit($event)" value="{{isSeasonalFlight ? \'CONTINUE\' : \'OK\'}}"></span></div></div><div class="clear-fix"></div></form><div ng-if="searchType==\'getaways\'"><form class="getawaysform" name="form_arc_packages" data-forward-action="{{config.getaways.form.action}}" method="{{config.getaways.form.method}}"><input type="hidden" name="search" value="true"> <input type="hidden" name="air1" value="true"> <input type="hidden" name="room1" value="true"> <input type="hidden" name="car1" value="false"> <input type="hidden" name="roundtrip" value="{{(itinerarySelect == \'RT\') ? true:false}}"> <input type="hidden" name="area2" value="{{toSelectedObj.code}}"> <input type="hidden" name="time1" value="0"> <input type="hidden" name="adults" value="{{passenger.getawaysAdults}}"> <input type="hidden" name="children" value="{{passenger.getawaysMinors}}"> <input type="hidden" name="dynamic_children" value="{{passenger.getawaysMinors}}"> <input type="hidden" name="area1" value="{{fromSelectedObj.code}}"> <input type="hidden" name="serviceclass" value="coach"> <input type="hidden" name="num_rooms" value="{{additionalProducts[0].model}}"> <input type="hidden" name="infants_in_lap" value="{{passenger.getawaysInfants}}"> <input type="hidden" name="date1" value="{{departCal.date | date:\'MM/dd/yyyy\'}}"> <input type="hidden" name="date2" value="{{returnCal.date | date:\'MM/dd/yyyy\'}}"> <input type="hidden" name="event" value="LOGIN_SEARCH"> <input type="hidden" name="nav" value="{{currency == \'tb\' ? \'Redeem\' : \'default\'}}"> <input type="hidden" name="origin" value="http://www.jetblue.com/getaways/error.asp"><div ng-repeat="obj in getawaysMinorsList"><input type="hidden" name="{{obj.name}}" value="{{obj.value}}"></div><div ng-repeat="obj in getawaysInfantList"><input type="hidden" name="{{obj}}" value="in_lap"></div></form></div></div>'),
$templateCache.put("/includes/modules/booker_refresh/dist/partials/modal.faq.html",'<div id="faq-modal" class="modal"><div class="header"><div class="header-inner"><h3>FAQs</h3><div class="context-switch"><a class="close-btn" href="javascript:void(0);">Close</a></div></div></div><div class="body"><div class="body-inner"><h4>Infants</h4><p>A child between the ages of three days old until their second birthday is considered a lap child and does not need to pay for a seat. Customers traveling with lap children are required to call 1-800-JETBLUE (538-2583), hearing or speech impaired: TTY/TDD 1-800-336-5530, after booking their flight to provide JetBlue with the name and birth date of the lap child. While infants are not subject to a fare, they may be assessed U.S. and foreign taxes and fees when traveling internationally, depending on the destination. Get more information about <a href="//help.jetblue.com/SRVS/CGI-BIN/webisapi.dll?New,Kb=askBlue,case=obj(2327)">traveling with an infant</a>.</p><h4>Unaccompanied minors</h4><p>An unaccompanied minor is a child between the ages of five and under 14 years traveling alone. There is a $100 fee each way, for each unaccompanied minor traveling on JetBlue. Get information about <a href="//help.jetblue.com/SRVS/CGI-BIN/webisapi.dll?New,Kb=askBlue,case=obj(675)">drop off and pick up information</a>.</p><h4>JetPaws &#8482; Pet Program</h4><p>As part of the <a href="//www.jetblue.com/travel/pets/">JetPaws&#8482; Pet Program</a>, JetBlue gladly accepts small cats and dogs in the aircraft cabin on both domestic and international flights (no other animals are allowed). There is a non-refundable pet fee of $100 each way. To book your pet, please call 1-800-JETBLUE (538-2583). Customers with hearing or speech impairments can call our toll-free TTY/TDD telephone number, 1-800-336-5530. See a <a href="//help.jetblue.com/SRVS/CGI-BIN/webisapi.dll?New,Kb=askBlue,case=obj(2032)">complete list of requirements for traveling with a pet</a>. Get more information about <a href="//help.jetblue.com/SRVS/CGI-BIN/webisapi.dll?New,Kb=askBlue,case=obj(1095)">traveling with a certified service animal or emotional support animal</a>.</p><h4>Checked baggage requirements</h4><p>Customers will be charged a $35 fee when checking a second bag. Get more information about <a href="//help.jetblue.com/SRVS/CGI-BIN/webisapi.dll?New,Kb=askBlue,case=obj(634)">checked baggage weight, size and other requirements</a>.</p><h4>8+ travelers?</h4><p>Book up to 7 people at a time online or call 1-800-JETBLUE (538-2583), hearing or speech impaired: TTY/TDD 1-800-336-5530.</p><p style="padding-bottom: 30px">Traveling with 10+ people? Please <a href="//help.jetblue.com/SRVS/CGI-BIN/webisapi.dll/,/?St=247,E=0000000000050375899,K=6715,Sxi=14,Case=obj(378395)">click here</a>.</p></div></div></div>')}]),angular.module("jbBootstrapClndr",["jbClndrTpls","ui.bootstrap.datepicker"]),angular.module("jbClndrTpls",["template/datepicker/datepicker.html","template/datepicker/day.html","template/datepicker/month.html","template/datepicker/popup.html","template/datepicker/year.html"]),angular.module("ui.bootstrap.dateparser",[]).service("dateParser",["$locale","orderByFilter",function($locale,orderByFilter){function isValid(year,month,date){return 1===month&&date>28?29===date&&(year%4===0&&year%100!==0||year%400===0):3===month||5===month||8===month||10===month?31>date:!0}this.parsers={};var formatCodeToRegex={yyyy:{regex:"\\d{4}",apply:function(value){this.year=+value}},yy:{regex:"\\d{2}",apply:function(value){this.year=+value+2e3}},y:{regex:"\\d{1,4}",apply:function(value){this.year=+value}},MMMM:{regex:$locale.DATETIME_FORMATS.MONTH.join("|"),apply:function(value){this.month=$locale.DATETIME_FORMATS.MONTH.indexOf(value)}},MMM:{regex:$locale.DATETIME_FORMATS.SHORTMONTH.join("|"),apply:function(value){this.month=$locale.DATETIME_FORMATS.SHORTMONTH.indexOf(value)}},MM:{regex:"0[1-9]|1[0-2]",apply:function(value){this.month=value-1}},M:{regex:"[1-9]|1[0-2]",apply:function(value){this.month=value-1}},dd:{regex:"[0-2][0-9]{1}|3[0-1]{1}",apply:function(value){this.date=+value}},d:{regex:"[1-2]?[0-9]{1}|3[0-1]{1}",apply:function(value){this.date=+value}},EEEE:{regex:$locale.DATETIME_FORMATS.DAY.join("|")},EEE:{regex:$locale.DATETIME_FORMATS.SHORTDAY.join("|")}};this.createParser=function(format){var map=[],regex=format.split("");return angular.forEach(formatCodeToRegex,function(data,code){var index=format.indexOf(code);if(index>-1){format=format.split(""),regex[index]="("+data.regex+")",format[index]="$";for(var i=index+1,n=index+code.length;n>i;i++)regex[i]="",format[i]="$";format=format.join(""),map.push({index:index,apply:data.apply})}}),{regex:new RegExp("^"+regex.join("")+"$"),map:orderByFilter(map,"index")}},this.parse=function(input,format){if(!angular.isString(input))return input;format=$locale.DATETIME_FORMATS[format]||format,this.parsers[format]||(this.parsers[format]=this.createParser(format));var parser=this.parsers[format],regex=parser.regex,map=parser.map,results=input.match(regex);if(results&&results.length){for(var dt,fields={year:1900,month:0,date:1,hours:0},i=1,n=results.length;n>i;i++){var mapper=map[i-1];mapper.apply&&mapper.apply.call(fields,results[i])}return isValid(fields.year,fields.month,fields.date)&&(dt=new Date(fields.year,fields.month,fields.date,fields.hours)),dt}}}]),angular.module("ui.bootstrap.position",[]).factory("$position",["$document","$window",function($document,$window){function getStyle(el,cssprop){return el.currentStyle?el.currentStyle[cssprop]:$window.getComputedStyle?$window.getComputedStyle(el)[cssprop]:el.style[cssprop]}function isStaticPositioned(element){return"static"===(getStyle(element,"position")||"static")}var parentOffsetEl=function(element){for(var docDomEl=$document[0],offsetParent=element.offsetParent||docDomEl;offsetParent&&offsetParent!==docDomEl&&isStaticPositioned(offsetParent);)offsetParent=offsetParent.offsetParent;return offsetParent||docDomEl};return{position:function(element){var elBCR=this.offset(element),offsetParentBCR={top:0,left:0},offsetParentEl=parentOffsetEl(element[0]);offsetParentEl!=$document[0]&&(offsetParentBCR=this.offset(angular.element(offsetParentEl)),offsetParentBCR.top+=offsetParentEl.clientTop-offsetParentEl.scrollTop,offsetParentBCR.left+=offsetParentEl.clientLeft-offsetParentEl.scrollLeft);var boundingClientRect=element[0].getBoundingClientRect();return{width:boundingClientRect.width||element.prop("offsetWidth"),height:boundingClientRect.height||element.prop("offsetHeight"),top:elBCR.top-offsetParentBCR.top,left:elBCR.left-offsetParentBCR.left}},offset:function(element){var boundingClientRect=element[0].getBoundingClientRect();return{width:boundingClientRect.width||element.prop("offsetWidth"),height:boundingClientRect.height||element.prop("offsetHeight"),top:boundingClientRect.top+($window.pageYOffset||$document[0].documentElement.scrollTop),left:boundingClientRect.left+($window.pageXOffset||$document[0].documentElement.scrollLeft)}},positionElements:function(hostEl,targetEl,positionStr,appendToBody){var hostElPos,targetElWidth,targetElHeight,targetElPos,positionStrParts=positionStr.split("-"),pos0=positionStrParts[0],pos1=positionStrParts[1]||"center";hostElPos=appendToBody?this.offset(hostEl):this.position(hostEl),targetElWidth=targetEl.prop("offsetWidth"),targetElHeight=targetEl.prop("offsetHeight");var shiftWidth={center:function(){return hostElPos.left+hostElPos.width/2-targetElWidth/2},left:function(){return hostElPos.left},right:function(){return hostElPos.left+hostElPos.width}},shiftHeight={center:function(){return hostElPos.top+hostElPos.height/2-targetElHeight/2},top:function(){return hostElPos.top},bottom:function(){return hostElPos.top+hostElPos.height}};switch(pos0){case"right":targetElPos={top:shiftHeight[pos1](),left:shiftWidth[pos0]()};break;case"left":targetElPos={top:shiftHeight[pos1](),left:hostElPos.left-targetElWidth};break;case"bottom":targetElPos={top:shiftHeight[pos0](),left:shiftWidth[pos1]()};break;default:targetElPos={top:hostElPos.top-targetElHeight,left:shiftWidth[pos1]()}}return targetElPos}}}]),angular.module("ui.bootstrap.datepicker",["ui.bootstrap.dateparser","ui.bootstrap.position"]).constant("datepickerConfig",{formatDay:"d",formatMonth:"MMMM",formatYear:"yyyy",formatDayHeader:"EEE",formatDayTitle:"MMMM yyyy",formatMonthTitle:"yyyy",datepickerMode:"day",minMode:"day",maxMode:"year",showWeeks:!1,startingDay:0,yearRange:.83,min:null,maxDate:null}).controller("DatepickerController",["$scope","$attrs","$parse","$interpolate","$timeout","$log","dateFilter","datepickerConfig",function($scope,$attrs,$parse,$interpolate,$timeout,$log,dateFilter,datepickerConfig){var self=this,ngModelCtrl={$setViewValue:angular.noop};this.modes=["day","month","year"],self.date&&null!==self.date||(self.date=new Date),angular.forEach(["formatDay","formatMonth","formatYear","formatDayHeader","formatDayTitle","formatMonthTitle","minMode","maxMode","showWeeks","startingDay","yearRange"],function(key,index){self[key]=angular.isDefined($attrs[key])?8>index?$interpolate($attrs[key])($scope.$parent):$scope.$parent.$eval($attrs[key]):datepickerConfig[key]}),angular.forEach(["min","maxDate"],function(key){$attrs[key]?$scope.$parent.$watch($parse($attrs[key]),function(value){self[key]=value?new Date(value):null,self.refreshView()}):self[key]=datepickerConfig[key]?new Date(datepickerConfig[key]):null}),$scope.datepickerMode=$scope.datepickerMode||datepickerConfig.datepickerMode,$scope.uniqueId="datepicker-"+$scope.$id+"-"+Math.floor(1e4*Math.random()),self.activeDate=angular.isDefined($attrs.initDate)?$scope.$parent.$eval($attrs.initDate):new Date,$scope.back=!0,$scope.forward=!0,this.updateArrowKeyVisibility=function(){var minMonth,maxMonth,selectedMonth=self.activeDate.getMonth();self.min&&(minMonth=self.min.getMonth(),minMonth===selectedMonth?$scope.back=!1:$scope.back=!0),self.maxDate&&(maxMonth=self.maxDate.getMonth(),selectedMonth===maxMonth?$scope.forward=!1:$scope.forward=!0)},this.updateArrowKeyVisibility(),$scope.isActive=function(dateObject){return 0===self.compare(dateObject.date,self.activeDate)?($scope.activeDateId=dateObject.uid,!0):!1},$scope.isActiveDay=function(dateObject){return dateObject.date.getMonth()===self.activeDate.getMonth()},$scope.isActiveRow=function(rowObject){var activeDays=0;return angular.forEach(rowObject,function(dateObject){$scope.isActiveDay(dateObject)&&activeDays++}),activeDays>0},this.init=function(ngModelCtrl_){ngModelCtrl=ngModelCtrl_,ngModelCtrl.$render=function(){self.render()}},this.render=function(){if(ngModelCtrl.$modelValue){var date=new Date(ngModelCtrl.$modelValue),isValid=!isNaN(date);isValid?this.activeDate=date:$log.error('Datepicker directive: "ng-model" value must be a Date object, a number of milliseconds since 01.01.1970 or a string representing an RFC2822 or ISO 8601 date.'),ngModelCtrl.$setValidity("date",isValid)}this.refreshView()},this.refreshView=function(){if(this.element){this._refreshView();var date=ngModelCtrl.$modelValue?new Date(ngModelCtrl.$modelValue):null;ngModelCtrl.$setValidity("date-disabled",!date||this.element&&!this.isDisabled(date))}},this.createDateObject=function(date,format){var model=ngModelCtrl.$modelValue?new Date(ngModelCtrl.$modelValue):null;return{date:date,label:dateFilter(date,format),selected:model&&0===this.compare(date,model),disabled:this.isDisabled(date),current:0===this.compare(date,new Date)}},this.isDisabled=function(date){return this.min&&this.compare(date,this.min)<0||this.maxDate&&this.compare(date,this.maxDate)>0||$attrs.dateDisabled&&$scope.dateDisabled({date:date,mode:$scope.datepickerMode})},this.split=function(arr,size){for(var arrays=[];arr.length>0;)arrays.push(arr.splice(0,size));return arrays},$scope.select=function(date,dtObj){if(!dtObj||!dtObj.disabled)if($scope.datepickerMode===self.minMode){var dt=ngModelCtrl.$modelValue?new Date(ngModelCtrl.$modelValue):new Date(0,0,0,0,0,0,0);dt.setFullYear(date.getFullYear(),date.getMonth(),date.getDate()),ngModelCtrl.$setViewValue(dt),ngModelCtrl.$render()}else self.activeDate=date,$scope.datepickerMode=self.modes[self.modes.indexOf($scope.datepickerMode)-1]},$scope.move=function(direction){var year=self.activeDate.getFullYear()+direction*(self.step.years||0),month=self.activeDate.getMonth()+direction*(self.step.months||0);self.activeDate.setFullYear(year,month,1),self.refreshView()},$scope.toggleMode=function(direction){direction=direction||1,$scope.datepickerMode===self.maxMode&&1===direction||$scope.datepickerMode===self.minMode&&-1===direction||($scope.datepickerMode=self.modes[self.modes.indexOf($scope.datepickerMode)+direction])},$scope.keys={13:"enter",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",9:"tab"};var focusElement=function(){$timeout(function(){self.element[0].focus(),$(self.element).find(".cal_date_value.active").closest("td").focus()},0,!1)};$scope.$on("datepicker.focus",function(){self.compare(self.activeDate,self.min)>=0||(self.activeDate=new Date(self.min)),self.refreshView(),focusElement()}),$scope.$on("GO_TO_MONTH",function($event,value){self.activeDate.getMonth()!=value&&(self.activeDate.setMonth(value),self.activeDate.setYear(void 0!=self.min&&value<self.min.getMonth()?self.min.getFullYear()+1:self.min.getFullYear()),self.activeDate.setDate(1)),self.refreshView(),$timeout(function(){$(self.element).find(".cal_date_value.active").closest("td").focus()},10,!1)}),$scope.keydown=function(evt){var key=$scope.keys[evt.which];if(key||(key=$scope.keys[evt.keyCode]),key&&!evt.shiftKey&&!evt.altKey)if(evt.preventDefault(),evt.stopPropagation(),"enter"===key||"space"===key){if(self.isDisabled(self.activeDate))return;$scope.select(self.activeDate),focusElement()}else!evt.ctrlKey||"up"!==key&&"down"!==key?"pageup"===key&&$scope.forward?($scope.move(1),focusElement()):"pagedown"===key&&$scope.back?($scope.move(-1),focusElement()):"tab"===key?$(".JumpTo:visible .jbSelectLabel").focus():(self.handleKeyDown(key,evt),self.refreshView()):($scope.toggleMode("up"===key?1:-1),focusElement())}}]).directive("datepicker",function(){return{restrict:"EA",replace:!0,templateUrl:"template/datepicker/datepicker.html",scope:{datepickerMode:"=?",dateDisabled:"&"},require:["datepicker","?^ngModel"],controller:"DatepickerController",link:function(scope,element,attrs,ctrls){var datepickerCtrl=ctrls[0],ngModelCtrl=ctrls[1];ngModelCtrl&&datepickerCtrl.init(ngModelCtrl)}}}).directive("daypicker",["dateFilter",function(dateFilter){return{restrict:"EA",replace:!0,templateUrl:"template/datepicker/day.html",require:"^datepicker",link:function(scope,element,attrs,ctrl){function getDates(startDate,n){var dates=new Array(n),current=new Date(startDate),i=0;for(current.setHours(12);n>i;)dates[i++]=new Date(current),current.setDate(current.getDate()+1);return dates}function getISO8601WeekNumber(date){var checkDate=new Date(date);checkDate.setDate(checkDate.getDate()+4-(checkDate.getDay()||7));var time=checkDate.getTime();return checkDate.setMonth(0),checkDate.setDate(1),Math.floor(Math.round((time-checkDate)/864e5)/7)+1}scope.showWeeks=ctrl.showWeeks,ctrl.step={months:1},ctrl.element=element;ctrl._refreshView=function(){var year=ctrl.activeDate.getFullYear(),month=ctrl.activeDate.getMonth(),firstDayOfMonth=new Date(year,month,1),difference=ctrl.startingDay-firstDayOfMonth.getDay(),numDisplayedFromPreviousMonth=difference>0?7-difference:-difference,firstDate=new Date(firstDayOfMonth);numDisplayedFromPreviousMonth>0&&firstDate.setDate(-numDisplayedFromPreviousMonth+1);for(var noOfRowsInCalendar=6,days=getDates(firstDate,7*noOfRowsInCalendar),i=0;7*noOfRowsInCalendar>i;i++)days[i]=angular.extend(ctrl.createDateObject(days[i],ctrl.formatDay),{secondary:days[i].getMonth()!==month,uid:scope.uniqueId+"-"+i});scope.labels=new Array(7);for(var j=0;7>j;j++)scope.labels[j]={single:(days[j].date+"").slice(0,1),abbr:dateFilter(days[j].date,ctrl.formatDayHeader),full:dateFilter(days[j].date,"EEEE")};if(scope.title=dateFilter(ctrl.activeDate,ctrl.formatDayTitle),scope.rows=ctrl.split(days,7),scope.showWeeks){scope.weekNumbers=[];for(var weekNumber=getISO8601WeekNumber(scope.rows[0][0].date),numWeeks=scope.rows.length;scope.weekNumbers.push(weekNumber++)<numWeeks;);}ctrl.updateArrowKeyVisibility()},ctrl.compare=function(date1,date2){return Math.floor((new Date(date1.getFullYear(),date1.getMonth(),date1.getDate())-new Date(date2.getFullYear(),date2.getMonth(),date2.getDate()))/864e5)},ctrl.handleKeyDown=function(key,evt){var date=ctrl.activeDate.getDate(),dateChange=!1;"left"===key&&ctrl.compare(ctrl.activeDate,ctrl.min)>0?(date-=1,dateChange=!0):"up"===key&&ctrl.compare(ctrl.activeDate,ctrl.min)>6?(date-=7,dateChange=!0):"right"===key&&ctrl.compare(ctrl.maxDate,ctrl.activeDate)>0?(date+=1,dateChange=!0):"down"===key&&ctrl.compare(ctrl.maxDate,ctrl.activeDate)>6&&(date+=7,dateChange=!0),dateChange&&(ctrl.activeDate.setDate(date),setTimeout(function(){$(ctrl.element).find(".cal_date_value.active").closest("td").focus()},10))},ctrl.refreshView()}}}]).constant("datepickerPopupConfig",{datepickerPopup:"yyyy-MM-dd",currentText:"Today",clearText:"Clear",closeText:"Done",closeOnDateSelection:!0,appendToBody:!1,showButtonBar:!1}).directive("datepickerPopup",["$compile","$parse","$document","$position","dateFilter","dateParser","datepickerPopupConfig",function($compile,$parse,$document,$position,dateFilter,dateParser,datepickerPopupConfig){return{restrict:"EA",require:"ngModel",scope:{isOpen:"=?",currentText:"@",clearText:"@",closeText:"@",dateDisabled:"&",journeyType:"@",extdate:"@"},link:function(scope,element,attrs,ngModel){function cameltoDash(string){return string.replace(/([A-Z])/g,function($1){return"-"+$1.toLowerCase()})}function isValidDate(dateString){if(!/^\d{2}-\d{2}-\d{4}$/.test(dateString))return!1;var parts=dateString.split("-"),day=parseInt(parts[1],10),month=parseInt(parts[0],10),year=parseInt(parts[2],10);if(1e3>year||year>3e3||0==month||month>12)return!1;var monthLength=[31,28,31,30,31,30,31,31,30,31,30,31];return(year%400==0||year%100!=0&&year%4==0)&&(monthLength[1]=29),day>0&&day<=monthLength[month-1]}function parseDate(viewValue){if(viewValue){if(angular.isDate(viewValue)&&!isNaN(viewValue))return ngModel.$setValidity("date",!0),viewValue;if(angular.isString(viewValue)){if(!isValidDate(viewValue))return void ngModel.$setValidity("date",!1);var date=dateParser.parse(viewValue,dateFormat)||new Date(viewValue);return isNaN(date)?void ngModel.$setValidity("date",!1):(ngModel.$setValidity("date",!0),date)}return void ngModel.$setValidity("date",!1)}return ngModel.$setValidity("date",!0),null}var dateFormat,closeOnDateSelection=angular.isDefined(attrs.closeOnDateSelection)?scope.$parent.$eval(attrs.closeOnDateSelection):datepickerPopupConfig.closeOnDateSelection,appendToBody=angular.isDefined(attrs.datepickerAppendToBody)?scope.$parent.$eval(attrs.datepickerAppendToBody):datepickerPopupConfig.appendToBody;scope.showButtonBar=angular.isDefined(attrs.showButtonBar)?scope.$parent.$eval(attrs.showButtonBar):datepickerPopupConfig.showButtonBar,scope.getText=function(key){return scope[key+"Text"]||datepickerPopupConfig[key+"Text"]},attrs.$observe("datepickerPopup",function(value){dateFormat=value||datepickerPopupConfig.datepickerPopup,ngModel.$render()});var popupEl=angular.element("<div datepicker-popup-wrap><div datepicker></div></div>");popupEl.attr({"ng-model":"date","ng-change":"dateSelection()"});var datepickerEl=angular.element(popupEl.children()[0]);attrs.datepickerOptions&&angular.forEach(scope.$parent.$eval(attrs.datepickerOptions),function(value,option){datepickerEl.attr(cameltoDash(option),value)}),scope.calendarOptions=[],scope.goToMonth=(new Date).getMonth();var months=["January","February","March","April","May","June","July","August","September","October","November","December"],updateMonthOptions=function(){if(scope.min&&scope.maxDate){var start=scope.min.getMonth(),year=scope.min.getFullYear(),end=scope.maxDate.getMonth();start>end&&(end=12+end);var changeGoToMonth=!0;scope.calendarOptions=[];for(var i=start;end>=i;i++){var adjustedYear=year;i>11&&adjustedYear++,i%12==scope.goToMonth&&(changeGoToMonth=!1),scope.calendarOptions.push({name:months[i%12]+" "+adjustedYear,value:i%12})}changeGoToMonth&&(scope.goToMonth=start)}};scope.$watch("goToMonth",function(value){scope.$broadcast("GO_TO_MONTH",value)}),angular.forEach(["min","maxDate"],function(key){attrs[key]&&(scope.$parent.$watch($parse(attrs[key]),function(value){scope[key]=value,updateMonthOptions()}),datepickerEl.attr(cameltoDash(key),key))}),attrs.dateDisabled&&datepickerEl.attr("date-disabled","dateDisabled({ date: date, mode: mode })"),ngModel.$parsers.unshift(parseDate),scope.dateSelection=function(dt){angular.isDefined(dt)&&(scope.date=dt),ngModel.$setViewValue(scope.date),ngModel.$render(),closeOnDateSelection&&(scope.isOpen=!1,element[0].focus())},element.bind("input change keyup",function(){scope.$apply(function(){scope.date=ngModel.$modelValue})}),element.bind("click",function($event){scope.isOpen=!0}),ngModel.$render=function(){var date=ngModel.$viewValue?dateFilter(ngModel.$viewValue,dateFormat):"";element.val(date),scope.date=parseDate(ngModel.$modelValue)};var documentClickBind=function(event){scope.isOpen&&event.target!==element[0]&&scope.$apply(function(){scope.isOpen=!1})},keydown=function(evt,noApply){scope.keydown(evt)};element.bind("keydown",keydown),scope.keydown=function(evt){27===evt.which?(evt.preventDefault(),evt.stopPropagation(),scope.close()):40!==evt.which||scope.isOpen?8!==evt.which&&46!==evt.which||!scope.isOpen?9===evt.which&&(scope.isOpen=!1):scope.isOpen=!1:scope.isOpen=!0},scope.$watch("isOpen",function(value){value?(scope.$broadcast("datepicker.focus"),scope.position=appendToBody?$position.offset(element):$position.position(element),scope.position.top=scope.position.top+element.prop("offsetHeight"),$document.bind("click",documentClickBind)):$document.unbind("click",documentClickBind)}),scope.select=function(date){if("today"===date){var today=new Date;angular.isDate(ngModel.$modelValue)?(date=new Date(ngModel.$modelValue),date.setFullYear(today.getFullYear(),today.getMonth(),today.getDate())):date=new Date(today.setHours(0,0,0,0))}scope.dateSelection(date)},scope.close=function(){scope.isOpen=!1,element[0].focus()};var $popup=$compile(popupEl)(scope);appendToBody?$document.find("body").append($popup):element.after($popup),scope.$on("$destroy",function(){$popup.remove(),element.unbind("keydown",keydown),$document.unbind("click",documentClickBind)})}}}]).directive("datepickerPopupWrap",function(){return{restrict:"EA",replace:!0,transclude:!0,templateUrl:"template/datepicker/popup.html",link:function(scope,element,attrs){element.bind("click",function(event){event.preventDefault(),event.stopPropagation()})}}}).service("placeholderSniffer",["$document",function($document){this.emptyClassName="empty",this.hasPlaceholder=function(){var test=$document[0].createElement("input");return void 0!==test.placeholder}}]).directive("placeholder",["$timeout","$document","$interpolate","$animate","placeholderSniffer","$filter",function($timeout,$document,$interpolate,$animate,placeholderSniffer,$filter){if(placeholderSniffer.hasPlaceholder())return{};var documentListenersApplied=!1,supportsAnimatePromises=parseFloat(angular.version.full)>=1.3;return{restrict:"A",require:"?ngModel",priority:110,link:function(scope,elem,attrs,ngModel){function updateValue(e){var val=elem.val();elem.hasClass(emptyClassName)&&val&&val===text||conditionalDefer(function(){setValue(val)})}function conditionalDefer(callback){callback()}function setValue(val){val||0===val||domElem===document.activeElement?(elem.removeClass(emptyClassName),elem.val($filter("date")(val,attrs.datepickerPopup))):(elem.addClass(emptyClassName),elem.val(is_pwd?"":text)),is_pwd&&(updatePasswordPlaceholder(),asyncUpdatePasswordPlaceholder())}function getValue(){return ngModel?scope.$eval(attrs.ngModel)||"":getDomValue()||""}function getDomValue(){var val=elem.val();return val===attrs.placeholder&&(val=""),val}function changePlaceholder(value){elem.hasClass(emptyClassName)&&elem.val()===text&&elem.val(""),text=value,updateValue()}function setAttrUnselectable(elmn,enable){enable?elmn.attr("unselectable","on"):elmn.removeAttr("unselectable")}function setupPasswordPlaceholder(){clone=angular.element('<input type="text" value="'+text+'"/>'),stylePasswordPlaceholder(),clone.addClass(emptyClassName).addClass(hiddenClassName).bind("focus",hidePasswordPlaceholderAndFocus),domElem.parentNode.insertBefore(clone[0],domElem);for(var watchAttrs=[attrs.ngDisabled,attrs.ngReadonly,attrs.ngRequired,attrs.ngShow,attrs.ngHide],i=0;i<watchAttrs.length;i++)watchAttrs[i]&&scope.$watch(watchAttrs[i],asyncUpdatePasswordPlaceholder)}function updatePasswordPlaceholder(){stylePasswordPlaceholder(),isNgHidden()?clone.addClass(hiddenClassName):elem.hasClass(emptyClassName)&&domElem!==document.activeElement?showPasswordPlaceholder():hidePasswordPlaceholder()}function asyncUpdatePasswordPlaceholder(){supportsAnimatePromises?$animate.addClass(elem,"").then(updatePasswordPlaceholder):$animate.addClass(elem,"",updatePasswordPlaceholder)}function stylePasswordPlaceholder(){clone.val(text).attr("class",elem.attr("class")||"").attr("style",elem.attr("style")||"").prop("disabled",elem.prop("disabled")).prop("readOnly",elem.prop("readOnly")).prop("required",elem.prop("required")),setAttrUnselectable(clone,"on"===elem.attr("unselectable"))}function showPasswordPlaceholder(){elem.addClass(hiddenClassName),clone.removeClass(hiddenClassName)}function hidePasswordPlaceholder(){clone.addClass(hiddenClassName),elem.removeClass(hiddenClassName)}function hidePasswordPlaceholderAndFocus(){hidePasswordPlaceholder(),domElem.focus()}function isNgHidden(){var hasNgShow="undefined"!=typeof attrs.ngShow,hasNgHide="undefined"!=typeof attrs.ngHide;return hasNgShow||hasNgHide?hasNgShow&&!scope.$eval(attrs.ngShow)||hasNgHide&&scope.$eval(attrs.ngHide):!1}if(attrs.datepickerOptions){"undefined"!=typeof attrs.datepickerPopup&&(ngModel.$formatters.push(function(val){return $filter("date")(val,attrs.datepickerPopup)}),ngModel.$parsers.push(function(val){return new Date(val)}));var clone,orig_val=getValue(),domElem=elem[0],elemType=domElem.nodeName.toLowerCase(),isInput="input"===elemType||"textarea"===elemType,is_pwd="password"===attrs.type,text=attrs.placeholder,emptyClassName=placeholderSniffer.emptyClassName,hiddenClassName="ng-hide";isInput&&(attrs.$observe("placeholder",function(newValue){changePlaceholder(newValue)}),is_pwd&&setupPasswordPlaceholder(),setValue(orig_val),elem.bind("focus",function(){elem.hasClass(emptyClassName)&&(elem.val(""),elem.removeClass(emptyClassName),domElem.select())}),elem.bind("blur",updateValue),ngModel||elem.bind("change",function(){changePlaceholder($interpolate(elem.attr("placeholder"))(scope))}),ngModel&&(ngModel.$render=function(){setValue(ngModel.$viewValue),domElem!==document.activeElement||elem.val()||domElem.select()}),documentListenersApplied||($document.on("selectstart",function(e){var elmn=angular.element(e.target);elmn.hasClass(emptyClassName)&&elmn.prop("disabled")&&e.preventDefault()}),documentListenersApplied=!0))}}}}]),angular.module("template/datepicker/datepicker.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/datepicker/datepicker.html",'<div ng-switch="datepickerMode" role="application" ng-keydown="keydown($event)">\n  <daypicker ng-switch-when="day" tabindex="0"></daypicker>\n  <monthpicker ng-switch-when="month" tabindex="0"></monthpicker>\n  <yearpicker ng-switch-when="year" tabindex="0"></yearpicker>\n</div>')}]),angular.module("template/datepicker/day.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/datepicker/day.html",'<table class=\'calendar\' role="grid" aria-labelledby="{{uniqueId}}-title" aria-activedescendant="{{activeDateId}}">\n  <thead>\n    <tr>\n      <th><div class="pull-left" ng-show="back" ng-click="move(-1)" tabindex="-1"> <span class="foreground-sprite-calendarback calendarbackarrow"><img src="//www2.jetblue.com/img/calendar-arrow-sp.png" alt=""/></span></div></th>\n      <th colspan="{{5 + showWeeks}}"><div id="{{uniqueId}}-title" role="heading" aria-live="assertive" aria-atomic="true" type="button" class="cal_month_name btn btn-default btn-sm" tabindex="-1" style="width:100%;"><strong>{{title}}</strong></div></th>\n      <th><div ng-show="forward" class="pull-right" ng-click="move(1)" tabindex="-1"><span class="foreground-sprite-calendarforward calendarforwardarrow"><img src="//www2.jetblue.com/img/calendar-arrow-sp.png" alt=""/></span></div></th>\n    </tr>\n    <tr>\n      <th ng-show="showWeeks" class="text-center"></th>\n      <th scope="col" ng-repeat="label in labels track by $index" class="text-center"><small aria-label="{{label.full}}">{{label.single}} <span class="visuallyhidden" aria-hidden="true">{{label.full}}</span> </small></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr ng-repeat="row in rows track by $index" ng-if="isActiveRow(row)">\n      <td ng-show="showWeeks" class="text-center h6"><em>{{ weekNumbers[$index] }}</em></td>\n      <td tabindex="-1" ng-repeat="dt in row track by dt.date" class="text-center" role="gridcell" id="{{dt.uid}}" aria-disabled="{{!!dt.disabled}}">\n    <div type="button" style="width:100%;" class="cal_date_value btn btn-default btn-sm" ng-class="{\'btn-info\': dt.selected, active: isActive(dt)} " ng-if="isActiveDay(dt)" ng-click="select(dt.date, dt)" ng-disabled="dt.disabled"><span ng-class="{\'text-muted\': dt.secondary, \'text-info\': dt.current, \'disabled\': dt.disabled}">{{dt.label}}</span></div>\n      </td>\n    </tr>\n  </tbody>\n</table>\n')}]),angular.module("template/datepicker/month.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/datepicker/month.html",'<table role="grid" aria-labelledby="{{uniqueId}}-title" aria-activedescendant="{{activeDateId}}">\n  <thead>\n    <tr>\n      <th><button type="button" class="btn btn-default btn-sm pull-left" ng-click="move(-1)" tabindex="-1"><i class="glyphicon glyphicon-chevron-left"></i></button></th>\n      <th><button id="{{uniqueId}}-title" role="heading" aria-live="assertive" aria-atomic="true" type="button" class="btn btn-default btn-sm" ng-click="toggleMode()" tabindex="-1" style="width:100%;"><strong>{{title}}</strong></button></th>\n      <th><button type="button" class="btn btn-default btn-sm pull-right" ng-click="move(1)" tabindex="-1"><i class="glyphicon glyphicon-chevron-right"></i></button></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr ng-repeat="row in rows track by $index">\n      <td ng-repeat="dt in row track by dt.date" class="text-center" role="gridcell" id="{{dt.uid}}" aria-disabled="{{!!dt.disabled}}">\n        <button type="button" style="width:100%;" class="btn btn-default" ng-class="{\'btn-info\': dt.selected, active: isActive(dt)}" ng-click="select(dt.date)" ng-disabled="dt.disabled" tabindex="-1"><span ng-class="{\'text-info\': dt.current}">{{dt.label}}</span></button>\n      </td>\n    </tr>\n  </tbody>\n</table>\n')}]),angular.module("template/datepicker/popup.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/datepicker/popup.html",'<div class="dropdown-menu" ng-style="{display: (isOpen && \'block\') || \'none\', top: (position.top-4)+\'px\'}" ng-keydown="keydown($event)"><ul>\n <li class=\'outer_header_wrapper\'><div class=\'outer_header\'>Choose your {{journeyType}} flight</div></li>\n <li ng-transclude></li>\n <li ng-if="showButtonBar">\n   <span class="btn-group">\n     <button type="button" class="btn btn-sm btn-info" ng-click="select(\'today\')">{{ getText(\'current\') }}</button>\n     <button type="button" class="btn btn-sm btn-danger" ng-click="select(null)">{{ getText(\'clear\') }}</button>\n   </span>\n   <button type="button" class="btn btn-sm btn-success pull-right" ng-click="close()">{{ getText(\'close\') }}</button>\n </li>\n</ul>\n<div class=\'onsale\'> <p>Flights available for sale through: <br> {{extdate|date}}</p></div>\n<div class=\'jumpTo clear-fix\'>Jump to:'+"<div jb-select myarialabel=\"Jump to month.\" mode='jumpTo' ng-options='calendarOptions' ng-model='goToMonth'></div>\n</div><div class='ieFixMask'></div></div>");
}]),angular.module("template/datepicker/year.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/datepicker/year.html",'<table role="grid" aria-labelledby="{{uniqueId}}-title" aria-activedescendant="{{activeDateId}}">\n  <thead>\n    <tr>\n      <th><button type="button" class="btn btn-default btn-sm pull-left" ng-click="move(-1)" tabindex="-1"><i class="glyphicon glyphicon-chevron-left"></i></button></th>\n      <th colspan="3"><button id="{{uniqueId}}-title" role="heading" aria-live="assertive" aria-atomic="true" type="button" class="btn btn-default btn-sm" ng-click="toggleMode()" tabindex="-1" style="width:100%;"><strong>{{title}}</strong></button></th>\n      <th><button type="button" class="btn btn-default btn-sm pull-right" ng-click="move(1)" tabindex="-1"><i class="glyphicon glyphicon-chevron-right"></i></button></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr ng-repeat="row in rows track by $index">\n      <td ng-repeat="dt in row track by dt.date" class="text-center" role="gridcell" id="{{dt.uid}}" aria-disabled="{{!!dt.disabled}}">\n        <button type="button" style="width:100%;" class="btn btn-default" ng-class="{\'btn-info\': dt.selected, active: isActive(dt)}" ng-click="select(dt.date)" ng-disabled="dt.disabled" tabindex="-1"><span ng-class="{\'text-info\': dt.current}">{{dt.label}}</span></button>\n      </td>\n    </tr>\n  </tbody>\n</table>\n')}]);var jbOverlay=angular.module("jbOverlayModule",[]).factory("jbOverlayFactory",["$rootScope","$timeout",function($rootScope,$timeout){var self={};return self.init=function(args,cb){!args||!args.template&&!args.content,cb=cb||function(){},self.attributes=$.extend(!0,{template:"",innerHTML:"Pass in some content",title:"",height:"400px",width:"600px",cancellable:!0},args),$(".jb-overlay-cont").css({height:self.attributes.height,width:self.attributes.width}),self.cb=cb,$rootScope.$broadcast("JBOVERLAY_INIT")},self.initChild=function(args){!args||!args.content,self.childAttributes=$.extend(!0,{childContent:"No information available.",childTitle:""},args),$rootScope.$broadcast("JBOVERLAY_CHILD_INIT")},self.hide=function(){$(".jb-overlay-holder").hide(),$("html").removeClass("disableTouchScroll"),$rootScope.$broadcast("JBOVERLAY_HIDDEN")},self.show=function(){$(".jb-overlay-close").attr("tabindex","0"),$timeout(function(){$(".jb-overlay-title").focus()},10),$(".jb-overlay-holder").fadeIn("fast"),$("html").addClass("disableTouchScroll"),$(".jb-overlay-cont").css({"margin-left":$(".jb-overlay-cont").width()*-.5,"margin-top":$(".jb-overlay-cont").height()*-.5})},self.showChild=function(){$(".jb-overlay-child-holder").fadeIn("fast"),$(".jb-overlay-child-holder").css({"z-index":"2000"}),$(".jb-overlay-child-cont").css({"margin-left":$(".jb-overlay-child-cont").width()*-.5,"margin-top":$(".jb-overlay-child-cont").height()*-.5}),$(".jb-overlay-cont").css({"z-index":"-2"})},self.hideChild=function(){$(".jb-overlay-child-holder").hide(),$(".jb-overlay-cont").css({"z-index":""})},self.getAttributes=function(){return self.attributes},self.getChildAttributes=function(){return self.childAttributes},self}]).controller("jbOverlayCtrl",function($scope,$rootScope,$compile,$http,jbOverlayFactory){function compileLayout(layout,plain){$scope.innerHTML=layout,plain&&$scope.$apply(),jbOverlayFactory.cb(),jbOverlayFactory.cb=function(){}}$scope.randomID="jbo"+(new Date).getTime(),$scope.close=function(){jbOverlayFactory.hide()},$scope.btnKeyClose=function($event){13==$event.keyCode&&$scope.close()},$scope.handleKeydown=function($event){27==$event.keyCode&&$scope.cancellable&&$scope.close()},$scope.closeChild=function(){jbOverlayFactory.hideChild()},$rootScope.$on("JBOVERLAY_INIT",function(){angular.extend($scope,jbOverlayFactory.getAttributes()),""===$scope.template?compileLayout("<div>{{content}}</div>",!0):compileLayout($scope.template)}),$rootScope.$on("JBOVERLAY_CHILD_INIT",function(){angular.extend($scope,jbOverlayFactory.getChildAttributes()),$scope.$apply()}),$scope.$on("$destroy",function(){})}).directive("jbOverlay",function($http,$compile){return{restrict:"C",transclude:!0,template:'<div id="{{randomID}}" class="jb-overlay-holder" ng-controller="jbOverlayCtrl" ng-keydown="handleKeydown($event)"><div class="jb-overlay-bg" ng-click="close()"></div><div class="jb-overlay-cont piejs" style="position:relative"><h2 tabindex="0" class="jb-overlay-title">{{title}}</h2><div class="jb-overlay-close piejs" ng-click="close()" ng-keydown="btnKeyClose($event)"><span class="visuallyhidden">Close Dialog</span>&times;</div><div class="jb-overlay-body piejs"><div ng-include="innerHTML"> </div></div></div><div class="jb-overlay-child"></div></div>',link:function(scope,element,attrs){}}}).directive("jbOverlayChild",function($http,$compile){return{restrict:"C",transclude:!0,template:'<div id="{{randomID}}" class="jb-overlay-child-holder" style="position:absolute;"><div class="jb-overlay-child-cont" style="position:relative"><div class="jb-overlay-child-title">{{childTitle}}</div><div class="jb-overlay-child-close piejs" ng-click="closeChild()">&times;</div><div class="jb-overlay-child-body" >{{childContent}}</div></div></div>',link:function(scope,element,attrs){}}});angular.module("cityselector",[]).directive("cityselector",["$timeout",function($timeout){return{restrict:"E",scope:{searchParam:"=ngModel",airports:"=listData",onType:"=onType",onSelect:"=onSelect",onClear:"=onClear",suggestionType:"@",regions:"=popupData",selectedObject:"=",id:"=",blurFunction:"&",actionTakenFunction:"&",footerText:"="},controller:["$rootScope","$scope","AirportData","$timeout","$sce","$filter",function($rootScope,$scope,AirportData,$timeout,$sce,$filter){$scope.selectedIndex=-1,$scope.popupVisible=!1,$scope.focusInputCity=!1,$scope.airportData=AirportData,$scope.setIndex=function(i){$scope.selectedIndex=parseInt(i)},this.setIndex=function(i){$scope.setIndex(i),$scope.$apply()},$scope.getIndex=function(i){return $scope.selectedIndex},$scope.footerText=$sce.trustAsHtml($scope.footerText||""),$scope.autocompleteSelectedItemText="",$scope.autocompleteHelperTexts=[];var watching=!0;$scope.SEARCH_MIN_STRING_LEN=3,$scope.completing=!1,$scope.isFocused=!1,$scope.$watch("searchParam",function(newValue,oldValue){$scope.actionTakenFunction(),oldValue===newValue||!newValue||"undefined"!=typeof oldValue&&newValue&&newValue.length<$scope.SEARCH_MIN_STRING_LEN&&newValue.length>oldValue.length||("undefined"!=typeof oldValue&&oldValue!==newValue&&newValue&&newValue.length>=$scope.SEARCH_MIN_STRING_LEN&&($scope.isFocused=!0),"string"==typeof newValue&&0===newValue.length&&$scope.onClear&&$scope.onClear(),watching&&"undefined"!=typeof $scope.searchParam&&null!==$scope.searchParam&&($scope.completing=!0,$scope.searchFilter=$scope.searchParam,$(".static-list").removeClass("active"),$scope.selectedIndex=-1),$scope.searchParam&&$scope.searchParam.length<$scope.SEARCH_MIN_STRING_LEN&&($scope.select(),$scope.setIndex(-1)),$scope.searchParam.length>=$scope.SEARCH_MIN_STRING_LEN&&$scope.autocompleteHelperTexts.push($filter("filter")($scope.airports,$scope.searchParam).length>0?{text:function(){var count=$filter("filter")($scope.airports,$scope.searchParam).length;return 1===count?" 1 option":count+" options "}()+" available.  Use up and down keys to navigate."}:{text:"No matches found for "+$scope.searchParam}),$filter("filter")($scope.airports,$scope.searchParam).length>1&&($scope.selectedIndex=-1),$scope.onType&&$scope.onType($scope.searchParam))}),this.preSelect=function(suggestion){watching=!1,$scope.$apply(),watching=!0},$scope.preSelect=this.preSelect,this.preSelectOff=function(){watching=!0},$scope.preSelectOff=this.preSelectOff,$scope.select=function(label,code){$scope.closeOverlay(),label&&($scope.searchParam=label,$scope.searchFilter=label,$scope.onSelect&&$scope.onSelect(label,code,$scope.id)),watching=!1,$scope.completing=!1,$scope.isFocused=!1,setTimeout(function(){watching=!0},50),$scope.setIndex(-1),$scope.checkValidity()};var getKeyboardEventResult=function(keyEvent){return window.event?keyEvent.which:keyEvent.keyCode};$scope.airportsAnchorLinks=$(".airports-list-container a"),$scope.onSelectKey=function(event,label,code){var index,eventTarget;eventTarget="undefined"!=typeof event.target?event.target:event.srcElement;var onKeyDownResult=getKeyboardEventResult(event);13===onKeyDownResult?$scope.select(label,code):37===onKeyDownResult?$(".region-list-container").find(".region-item.active").focus():38===onKeyDownResult?(index=$.inArray(eventTarget,$scope.airportsAnchorLinks),index>0&&$($scope.airportsAnchorLinks[index-1]).focus()):40===onKeyDownResult&&(index=$.inArray(eventTarget,$scope.airportsAnchorLinks),index<$scope.airportsAnchorLinks.length-1&&$($scope.airportsAnchorLinks[index+1]).focus()),9!=onKeyDownResult&&(event.preventDefault(),event.stopImmediatePropagation())},$scope.closeOverlay=function(){$scope.popupVisible=!1,$("html").removeClass("overlay-open"),$timeout(function(){$("#"+$scope.attrs.inputid).focus()},10)},$scope.showPopUp=function($event){if($scope.popupVisible)return!1;$scope.actionTakenFunction(),$scope.popupVisible=!0,$scope.$apply();var windowHeight=window.innerHeight,popupHeight=$("cityselector .overlayContainer").height();if(windowHeight>popupHeight){var margin=Math.floor((windowHeight-popupHeight)/2);$("cityselector .overlayContainer").css("margin-top",margin+"px")}$scope.autocompleteSelectedItemText="",$scope.autocompleteHelperTexts=[],$("html").addClass("overlay-open"),$scope.completing=!1,$timeout(function(){$(".airport_popup_title").focus()},10),$(".airports-list-container li.selected a").append("<span class='visuallyhidden'>Current selection</span>")},$scope.showPopUpFromKeyPress=function($event){var onKeyDownResult=getKeyboardEventResult($event);13==onKeyDownResult&&($event.preventDefault(),$event.stopImmediatePropagation(),$scope.showPopUp())},$scope.checkValidity=function(){setTimeout(function(){$scope.blurFunction&&"function"==typeof $scope.blurFunction&&$scope.blurFunction()},0)},$scope.suggestionSorter=function(sortObj){var isBoundaryMatch,isLazyMatch,isBlue,isMAC,needle,stack,boundarypattern,lazypattern,cityListLength,adjustments,adjIndex=0;if("undefined"==$scope.searchParam)return needle=$scope.searchParam.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),stack=sortObj.needle.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),labelstack=sortObj.label.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),boundarypattern=new RegExp("\\b"+needle,"gi"),startpattern=new RegExp("^"+needle,"gi"),lazypattern=new RegExp(needle,"gi"),isBlue=sortObj.isBlueCity,isMAC=sortObj.isMAC,cityListLength=$scope.airports.length,isStringMatch=labelstack.match(startpattern),isBoundaryMatch=stack.match(boundarypattern),isLazyMatch=stack.match(lazypattern),adjustments={iatamatch:5*cityListLength,isBlue:10*cityListLength,startmatch:2*cityListLength,macMatch:4,boundarymatch:2,stringmatch:1},sortObj&&needle&&sortObj.value.toLowerCase()==needle.toLowerCase()&&(adjIndex-=adjustments.iatamatch),isStringMatch&&(adjIndex-=adjustments.startmatch),isBoundaryMatch?adjIndex-=adjustments.boundarymatch:isLazyMatch&&(adjIndex-=adjustments.stringmatch),isMAC||(adjIndex-=adjustments.macMatch),isBlue&&(adjIndex-=adjustments.isBlue),adjIndex}}],link:function(scope,element,attrs,$filter,$window){var attr="",key={left:37,up:38,right:39,down:40,enter:13,esc:27,tab:9,space:32},getKeyboardEventResult=function(keyEvent){return"undefined"!==keyEvent.which?keyEvent.which:keyEvent.keyCode};scope.attrs={placeholder:"","class":"",id:"",inputclass:"",inputid:"",inputalttext:"",labelid:"",errorlabelid:""};for(var a in attrs)attr=a.replace("attr","").toLowerCase(),0===a.indexOf("attr")&&(scope.attrs[attr]=attrs[a]);angular.element(document).bind("keydown",function(e){var keycode=getKeyboardEventResult(e);scope.popupVisible&&keycode==key.esc&&(scope.closeOverlay(),scope.$apply(),$("#"+scope.attrs.inputid).focus())}),angular.element($(element[0]).find(".flight_button_from_foreground, .viewCity a")).bind("click",function(){scope.showPopUp()}).bind("keydown",function($event){var thiskey=getKeyboardEventResult($event);(thiskey===key.space||thiskey===key.enter)&&($event.preventDefault(),$event.stopPropagation(),scope.showPopUp())}),angular.element(element[0].firstChild).bind("keydown",function(ev){var eventKey,index,l,caller;switch(eventKey="undefined"!=typeof ev.which?ev.which:ev.keyCode,caller="undefined"!=typeof ev.srcElement?ev.srcElement:ev.target,l=$(element).find(".airport_list li").length,eventKey){case key.down:if($(element).find(".static-list").removeClass("active"),index=scope.getIndex()+1,-1>index)index=l-1;else{if(2==l&&0==index){scope.setIndex(index),scope.preSelectOff(),scope.autocompleteHelperTexts.push({text:angular.element(angular.element(this).find("li")[index]).text()}),$(element).find(".static-list:first").addClass("active"),scope.$apply();break}if(index>=1&&index!==l){scope.setIndex(index),scope.preSelectOff(),scope.autocompleteHelperTexts.push({text:angular.element(angular.element(this).find("li")[index]).text()}),index==l-2?$(element).find(".static-list:first").addClass("active"):index==l-1&&$(element).find(".static-list:last").addClass("active"),scope.$apply();break}if(index===l||0==index&&l>0){index=0,scope.setIndex(index),scope.preSelectOff(),scope.autocompleteHelperTexts.push({text:angular.element(angular.element(this).find("li")[index]).text()}),2==l&&$(element).find(".static-list:first").addClass("active"),scope.$apply();break}}scope.setIndex(index),-1!==index&&scope.preSelect(angular.element(angular.element(this).find("li")[index]).text()),scope.$apply();break;case key.up:if($(element).find(".static-list").removeClass("active"),index=scope.getIndex()-1,-1>=index&&(index=l-1),-1>index)index=l-1;else{if(2==l&&0==index){scope.setIndex(index),scope.preSelectOff(),scope.autocompleteHelperTexts.push({text:angular.element(angular.element(this).find("li")[index]).text()}),$(element).find(".static-list:first").addClass("active"),scope.$apply();break}if(index>=1&&index!==l){scope.setIndex(index),scope.preSelectOff(),scope.autocompleteHelperTexts.push({text:angular.element(angular.element(this).find("li")[index]).text()}),index==l-2?$(element).find(".static-list:first").addClass("active"):index==l-1&&$(element).find(".static-list:last").addClass("active"),scope.$apply();break}if(index===l||0==index&&l>0){index=0,scope.setIndex(index),scope.preSelectOff(),scope.autocompleteHelperTexts.push({text:angular.element(angular.element(this).find("li")[index]).text()}),2==l&&$(element).find(".static-list:first").addClass("active"),scope.$apply();break}}scope.setIndex(index),-1!==index&&scope.preSelect(angular.element(angular.element(this).find("li")[index]).text()),scope.$apply();break;case key.enter:if(-1==caller.className.indexOf("flight_button_from_foreground")&&ev.preventDefault(),$(".airport_list .active").hasClass("viewCity")){scope.showPopUp();break}if($(".airport_list .active").hasClass("whereWeJet")){window.location.href=$(".airport_list .whereWeJet a").attr("href");break}scope.setIndex(-1),scope.autocompleteSelectedItemText=angular.element(angular.element(this).find("li")[index]).text(),scope.autocompleteHelperTexts.push({text:angular.element(angular.element(this).find("li")[index]).text()}),scope.select($($(".airport_list .active a").get(0)).clone().children().remove().end().text()),scope.isFocused=!1,scope.$apply(),$timeout(function(){scope.blurFunction()});break;case key.esc:$(element).find(".static-list").removeClass("active"),scope.select(),scope.setIndex(-1),scope.$apply(),scope.autocompleteSelectedItemText="",scope.autocompleteHelperTexts=[],ev.preventDefault()}}),$($(angular.element(element[0].firstChild)).find("input[type=text]")).bind("click focus",function(){$(this).val().length>=scope.SEARCH_MIN_STRING_LEN&&(scope.completing=!0,scope.searchParam=scope.searchFilter=$(this).val()),scope.airportData.Station(scope.searchParam)?scope.isFocused=!1:scope.isFocused=!0,setTimeout(function(){scope.$apply()},10)}),$($(angular.element(element[0].firstChild)).find("input[type=text]")).bind("blur",function(){setTimeout(function(){scope.blurFunction(),scope.completing=!1,scope.isFocused=!1,scope.$apply()},250);$(this).closest(".autocomplete").find("a, div")}),$(document).click(function(e){return $(e.target).hasClass("body_overlay")&&scope.closeOverlay(),$(e.target).hasClass("airport_suggestion")?void 0:$(e.target).hasClass("autocomplete_input")?void($(e.target).val().length<scope.SEARCH_MIN_STRING_LEN&&(scope.completing=!1,scope.$apply())):(scope.completing=!1,void scope.$apply())});var cities=".airports-list-container .city";$(cities+" a").live("focus",function(){$(cities).removeClass("selected"),$(this).parent().addClass("selected")})},templateUrl:"/template/cityselector/cityselector.html"}}]).directive("suggestion",function(){return{restrict:"E",require:"^cityselector",scope:{},link:function(scope,element,attrs,autoCtrl){element.bind("mouseenter",function(){autoCtrl.preSelect(attrs.val),autoCtrl.setIndex(attrs.index)}),element.bind("mouseleave",function(){autoCtrl.preSelectOff()})}}}).directive("hoverClass",function(){return{restrict:"A",scope:{hoverClass:"@"},link:function(scope,element){element.on("mouseenter",function(){angular.element(element[0].parentElement.childNodes).removeClass(scope.hoverClass),element.addClass(scope.hoverClass)}),element.on("mouseleave",function(){element.removeClass(scope.hoverClass)})}}}).directive("regionTabs",function($timeout){return{restrict:"A",scope:{items:"=regionTabs"},transclude:!0,controller:["$scope",function($scope){$scope.selectTab=function(tab){angular.forEach($scope.items,function(tab){tab.active=!1}),tab.active=!0,$(".region-list-container").find(".region-item.active").attr("tabindex",0).siblings("a").attr("tabindex",-1),$timeout(function(){},10)};var preSort=["United States","Caribbean & Central America","South America"];$scope.regionSort=function(region){for(var i=0;i<preSort.length;i++)if(region.region==preSort[i])return i;return region.region}}],templateUrl:"/template/cityselector/cityselector.regiontabs.html",link:function(scope,element,attrs){angular.forEach(scope.items,function(tab){"boolean"==typeof tab.selected&&tab.selected===!0?tab.active=!0:tab.active=!1,tab.region.length>19&&tab.region.match(" ").length?tab.doubleLine="double-region-line":tab.doubleLine=""}),0===scope.items.filter(function(el){return el.active}).length&&(scope.items[0].active=!0),$timeout(function(){$(".region-list-container").find(".region-item.active").attr("tabindex",0).siblings("a").attr("tabindex",-1)},10),scope.keydown=function($event,tab){var key={left:37,up:38,right:39,down:40,enter:13,esc:27,tab:9,space:32};($event.keyCode===key.right||$event.keyCode===key.tab&&!$event.shiftKey)&&$timeout(function(){$(".airports-list-container div:visible").removeClass("active selected"),$(".airports-list-container div:visible ul li ul li:first").addClass("selected").find("a").focus()}),$event.keyCode===key.down?$($event.target.nextElementSibling).focus():$event.keyCode===key.up?$($event.target.previousElementSibling).focus():($event.keyCode===key.enter||$event.keyCode===key.space)&&scope.selectTab(tab)}}}}).directive("regionAirportList",function($compile){return{restrict:"A",require:"^regionTabs",transclude:!0,link:function(scope,element,attrs){if("United States"==scope.region.region?element.addClass("isUS"):(element.addClass("notUS"),2==scope.region.countries.length?element.addClass("twoCountries"):1==scope.region.countries.length&&element.addClass("oneCountry")),"undefined"!=typeof Modernizr&&!Modernizr.csscolumns||navigator.userAgent.toLowerCase().indexOf("safari/")>-1&&-1==navigator.userAgent.toLowerCase().indexOf("chrome/")){var cLength,Nc1,Nc2,Nc3,extraElements,template,countries,airports,i,noOfColumns=3;if(airportLiTemplate='<li ng-repeat="airport in country.airports track by $index "class="popupLinks {{\'city \'+ isSearched(airport.DefaultDisplayName)}}" ng-class="{jetblue :airport.IsBlueCity, partner :!airport.IsBlueCity, mac: airport.IsMACCode, selected:airport.selected  }"hover-class="active" ><img ng-src="{{airport.IsBlueCity && \'/includes/modules/booker_refresh/src/assets/city-lrg-disc-orange.png\' || \'/includes/modules/booker_refresh/src/assets/city-lrg-disc-grey.png\'}}" alt=""><a href="javascript:void(0)"ng-keydown="keydown($event, airport)" ng-click="select(airport)">{{airport.DefaultDisplayName}}<span class="visuallyhidden">{{airport.IsBlueCity ?"Jetblue city": "Partner city"}}</span></a></li>',"United States"!=scope.region.region){switch(template='<div class="region noCSSColumns" ng-hide="!region.active"><div class="description-wrapper"><ul class="city-desc clearfix" style="display: block;"><li class="first"><h3>Cities</h3></li><li><span>JetBlue city</span></li><li class="partner"><span>Partner city</span></li></ul></div><div class="region-wrap"><div class="left"><ul ng-repeat="country in regionArray1"><li><h3 class="country">{{country.country}}</h3><ul class="country-list">'+airportLiTemplate+'</ul></li></ul></div><div class="middle"><ul ng-repeat="country in regionArray2"><li><h3 class="country">{{country.country}}</h3><ul class="country-list">'+airportLiTemplate+'</ul></li></ul></div><div class="right"><ul ng-repeat="country in regionArray3"><li><h3 class="country">{{country.country}}</h3><ul class="country-list">'+airportLiTemplate+"</ul></li></ul></div></div></div>",cLength=scope.region.countries.length,countries=scope.region.countries,Nc1=Nc2=Nc3=Math.floor(cLength/noOfColumns),extraElements=cLength%noOfColumns){case 1:++Nc1;break;case 2:++Nc1,++Nc2}for(scope.regionArray1=[],scope.regionArray2=[],scope.regionArray3=[],i=0;cLength>i;i++)Nc1>0?(scope.regionArray1.push(scope.region.countries[i]),Nc1--):Nc2>0?(scope.regionArray2.push(scope.region.countries[i]),Nc2--):Nc3>0&&(scope.regionArray3.push(scope.region.countries[i]),Nc3--)}else{switch(template='<div class="region noCSSColumns" ng-hide="!region.active"><div class="description-wrapper"><ul class="city-desc clearfix" style="display: block;"><li class="first"><h3>Cities</h3></li><li><span>JetBlue city</span></li><li class="partner"><span>Partner city</span></li></ul></div><div class="region-wrap"><div class="left"><ul class="country-list"><li ng-repeat="airport in itemArray1"class="popupLinks {{\'city \'+ isSearched(airport.DefaultDisplayName)}}" ng-class="{jetblue :airport.IsBlueCity , partner :!airport.IsBlueCity, mac: airport.IsMACCode, selected:airport.selected  }" hover-class="active" ><img ng-src="{{airport.IsBlueCity && \'/includes/modules/booker_refresh/src/assets/city-lrg-disc-orange.png\' || \'/includes/modules/booker_refresh/src/assets/city-lrg-disc-grey.png\'}}" alt=""><a href="javascript:void(0)"ng-keydown="keydown($event, airport)" ng-click="select(airport)"ng-bind="airport.DefaultDisplayName"></a></li></ul></div><div class="middle"><ul class="country-list"><li ng-repeat="airport in itemArray2"class="popupLinks {{\'city \'+ isSearched(airport.DefaultDisplayName)}}" ng-class="{jetblue :airport.IsBlueCity , partner :!airport.IsBlueCity, mac: airport.IsMACCode, selected:airport.selected  }" hover-class="active" ><img ng-src="{{airport.IsBlueCity && \'/includes/modules/booker_refresh/src/assets/city-lrg-disc-orange.png\' || \'/includes/modules/booker_refresh/src/assets/city-lrg-disc-grey.png\'}}" alt=""><a href="javascript:void(0)"ng-keydown="keydown($event, airport)" ng-click="select(airport)"ng-bind="airport.DefaultDisplayName"></a></li></ul></div><div class="right"><ul class="country-list"><li ng-repeat="airport in itemArray3"class="popupLinks {{\'city \'+ isSearched(airport.DefaultDisplayName)}}" ng-class="{jetblue :airport.IsBlueCity , partner :!airport.IsBlueCity, mac: airport.IsMACCode, selected:airport.selected  }" hover-class="active" ><img ng-src="{{airport.IsBlueCity && \'/includes/modules/booker_refresh/src/assets/city-lrg-disc-orange.png\' || \'/includes/modules/booker_refresh/src/assets/city-lrg-disc-grey.png\'}}" alt=""><a href="javascript:void(0)"ng-keydown="keydown($event, airport)" ng-click="select(airport)"ng-bind="airport.DefaultDisplayName"></a></li></ul></div></div></div>',aLength=scope.region.countries[0].airports.length,airports=scope.region.countries[0].airports,Nc1=Nc2=Nc3=Math.floor(aLength/noOfColumns),extraElements=aLength%noOfColumns){case 1:++Nc1;break;case 2:++Nc1,++Nc2}for(scope.itemArray1=scope.itemArray2=scope.itemArray3={},scope.itemArray1=[],scope.itemArray2=[],scope.itemArray3=[],i=0;i<aLength;i++)Nc1>0?(scope.itemArray1.push(airports[i]),Nc1--):Nc2>0?(scope.itemArray2.push(airports[i]),Nc2--):Nc3>0&&(scope.itemArray3.push(airports[i]),Nc3--)}element.replaceWith($compile(template)(scope))}},controller:["$scope",function($scope){$scope.select=function(airport){$scope.$parent.$parent.$parent.select(airport.DefaultDisplayName,airport.Code)},$scope.keydown=function($event,airport){var cityIndex,cityArray,hilightClass,selectedItem,key={left:37,up:38,right:39,down:40,enter:13,esc:27,tab:9,space:32};$event.keyCode===key.left&&$(".region-list-container").find(".region-item.active").focus(),cityArray=$(".city:visible"),hilightClass="selected",selectedItem=$(".city."+hilightClass+":visible"),cityIndex=cityArray.index(selectedItem),$event.keyCode===key.down?($(".airports-list-container .city").removeClass(hilightClass),cityIndex++,cityIndex>cityArray.length-1&&(cityIndex=0),$(cityArray[cityIndex]).find("a").focus(),$(cityArray[cityIndex]).addClass("selected"),$event.preventDefault()):$event.keyCode===key.up?($(".airports-list-container .city").removeClass(hilightClass),cityIndex--,0>cityIndex&&(cityIndex=cityArray.length-1),$(cityArray[cityIndex]).find("a").focus(),$(cityArray[cityIndex]).addClass("selected"),$event.preventDefault()):$event.keyCode===key.enter||$event.keyCode===key.space?($event.preventDefault(),$scope.select(airport),$("#"+$scope.attrs.inputid).focus()):$event.keyCode!==key.tab||$event.shiftKey?$event.keyCode===key.tab&&$event.shiftKey&&($(".region-list-container").find(".region-item.active").focus(),$event.preventDefault()):($(".airport_popup_title").focus(),$event.preventDefault())}}],template:'<div ng-transclude ng-hide="!region.active"></div>',replace:!0}}),angular.module("cityselector").run(["$templateCache",function($templateCache){"use strict";$templateCache.put("/template/cityselector/cityselector.html",'<div class="autocomplete {{ attrs.class }}" id="{{ attrs.id }}" ng-class="{focused : isFocused}"><div class="input_wrapper"><span class="visuallyhidden">Use arrow keys to select drop menu options</span> <a href="javascript:void(0)" class="flight_button_from_foreground"><span class="foreground-sprite-cityfrombtn frombtnimg {{attrs.inputclass}}"><img src="/includes/modules/booker_refresh/src/assets/form-btn-sp.png" alt="{{attrs.inputalttext}}"></span></a> <input type="text" aria-labelledby="{{ attrs.labelid }} {{ attrs.errorlabelid }}" autocomplete="off" autocorrect="off" ng-model="searchParam" cityformatter="" placeholder="{{ attrs.placeholder }}" class="{{ attrs.inputclass }} autocomplete_input" id="{{ attrs.inputid }}" ng-blur="checkValidity()"> <span aria-atomic="true" role="status" aria-live="assertive" aria-relevant="additions" class="visuallyhidden"><span ng-repeat="item in autocompleteHelperTexts" ng-class="{\'ng-cloak\' : !$last }">{{item.text}}</span></span><div class="clearfix"></div></div><div class="suggestions_wrapper" ng-if="isFocused"><ul class="airport_list"><li class="airport_suggestion" ng-if="completing" ng-show="suggestions.length > 0" ng-repeat="suggestion in $parent.suggestions = (airports | filter:{needle:searchFilter}| orderBy:suggestionSorter) track by $index" index="{{ $index }}" val="{{ suggestion.value }}" ng-class="{ active: ($index === selectedIndex), blueCity : suggestion.isBlueCity, partnerCity : !suggestion.isBlueCity, mac: suggestion.IsMACCode || suggestion.isMAC }" ng-mousedown="select(suggestion.label, suggestion.value)" hover-class="active"><div><img ng-src="{{suggestion.isBlueCity && \'/includes/modules/booker_refresh/src/assets/city-lrg-disc-orange.png\' || \'/includes/modules/booker_refresh/src/assets/city-lrg-disc-grey.png\'}}" alt=""><a ng-mousedown="select(suggestion.label, suggestion.value)">{{suggestion.label}}<span ng-if="!suggestion.IsMACCode && !suggestion.isMAC" class="visuallyhidden">{{suggestion.isBlueCity ?"Jetblue city": "Partner city"}}</span></a></div></li><li class="airport_suggestion viewCity static-list" hover-class="active" ng-click="showPopUp($event)"><div><a tabindex="-1" href="javascript:void(0)">See full city list</a></div></li><li class="airport_suggestion static-list whereWeJet" hover-class="active"><div><a tabindex="-1" href="/wherewejet/">Where we jet<span class="visuallyhidden">opens new window</span></a></div></li></ul><ul class="city-desc" ng-if="!!searchParam && searchParam.length >= SEARCH_MIN_STRING_LEN && suggestions.length > 0"><li class="first"><img src="/includes/modules/booker_refresh/src/assets/city-lrg-disc-orange.png" alt="">JetBlue City</li><li class="partner"><img src="/includes/modules/booker_refresh/src/assets/city-lrg-disc-grey.png" alt="">Partner City</li></ul></div></div><div class="body_overlay" ng-show="popupVisible"><div tabindex="-1" class="overlayContainer" ng-if="popupVisible"><div class="airport_popup_cont"><h2 tabindex="0" class="airport_popup_title piejs">Select a region and a city below</h2><a href="javascript:void(0)" class="airport_popup_close piejs" ng-click="closeOverlay()">&#215;<span class="visuallyhidden">Close City Selector Dialog</span></a></div><div id="airports-list-wrapper" ng-class="{hasFooter : !!footerText }"><div><div region-tabs="regions"><div class="airports-list-container"><div ng-repeat="region in regions" region-airport-list="regions"><div class="description-wrapper"><ul class="city-desc clearfix" style="display: block"><li class="first"><h3>Cities</h3></li><li><img src="/includes/modules/booker_refresh/src/assets/city-lrg-disc-orange.png" alt=""><span>JetBlue city</span></li><li class="partner"><img src="/includes/modules/booker_refresh/src/assets/city-lrg-disc-grey.png" alt=""><span>Partner city</span></li></ul></div><div class="region-wrap"><ul ng-repeat="country in region.countries"><li><h3 class="country">{{country.country}}</h3><ul class="country-list"><li ng-repeat="airport in country.airports track by $index" class="popupLinks {{\'city \'+ isSearched(airport.DefaultDisplayName)}}" ng-class="{jetblue :airport.IsBlueCity, partner :!airport.IsBlueCity, mac: airport.IsMACCode, selected:airport.selected }" hover-class="active"><img ng-src="{{airport.IsBlueCity && \'/includes/modules/booker_refresh/src/assets/city-lrg-disc-orange.png\' || \'/includes/modules/booker_refresh/src/assets/city-lrg-disc-grey.png\'}}" alt=""> <a href="javascript:void(0)" ng-keydown="keydown($event, airport)" ng-click="select(airport)">{{airport.DefaultDisplayName}}<span ng-if="!airport.IsMACCode" class="visuallyhidden">{{airport.IsBlueCity ?"Jetblue city": "Partner city"}}</span></a></li></ul></li></ul></div></div></div></div></div><p class="footerText" ng-bind-html="footerText"></p></div></div></div>'),$templateCache.put("/template/cityselector/cityselector.regiontabs.html",'<div class="region-tabs" role="tablist"><div class="region-list-container"><div class="region-label">Region</div><a href="javascript:void(0)" ng-repeat="item in items | orderBy:regionSort track by $index" class="region-item {{item.doubleLine}}" ng-class="{active : item.active}" ng-keydown="keydown($event,item)" ng-click="selectTab(item)" hover-class="hover">{{item.region}}<span class="visuallyhidden">Currently selected region</span></a></div><div class="country-list-holder" ng-transclude></div></div>')}]);var jbStorageLib=function(){function storeValue(key,count){function _addNewItem(option){var objectToStore,maxHistoryCount,successFlag=!1;return option&&option.key&&option.value&&(maxHistoryCount=maxCount[option.key]||3,localStorage[option.key]?(objectToStore=JSON.parse(localStorage[option.key]),objectToStore.values.length===objectToStore.maxCount&&objectToStore.values.shift()):(objectToStore={},
objectToStore.maxCount=maxHistoryCount,objectToStore.values=[]),objectToStore.values.push(option.value),localStorage[option.key]=JSON.stringify(objectToStore),successFlag=!0),successFlag}function _getItem(key){var responseObject={};return localStorage[key]&&"undefined"!=typeof localStorage[key]&&(responseObject=JSON.parse(localStorage[key]).values.reverse()),responseObject}function _setMaxCount(key,count){key&&count&&(maxCount[key]=count)}function _readCookie(type){var historyCookie,cookies=document.cookie.split(";");if(null===cookies)return[];for(var i=0;i<cookies.length;i++)if(jQuery.trim(cookies[i].substr(0,cookies[i].indexOf("=")))==type)try{historyCookie=decodeURIComponent(cookies[i].substr(cookies[i].indexOf("=")+1))}catch(e){historyCookie=void 0}return void 0===historyCookie||"undefined"===historyCookie?[]:JSON.parse(historyCookie)}function _addNewCookie(option){option&&option.key&&option.value&&(storeHistory=function(currentEntry,type){var cookie,cookies=_readCookie(type);cookie=[currentEntry],maxCount[type]||_setMaxCount(type,1);for(var i=0;i<cookies.length;i++)cookie.length<maxCount[type]&&cookie.push(cookies[i]);var cookieStr=encodeURIComponent(JSON.stringify(cookie)),expireDate=new Date;expireDate.setDate(expireDate.getDate()+1e3),document.cookie=type+"="+cookieStr+"; path=/; domain=jetblue.com;expires="+expireDate.toUTCString()},storeHistory(option.value,option.key))}var maxCount={};return{set:_addNewItem,setCookie:_addNewCookie,get:_getItem,getCookie:_readCookie,setMaxCount:_setMaxCount}}function initJBStorageLib(){return instance||(instance=new storeValue),instance}var instance,publicInstance={};return publicInstance.init=initJBStorageLib,publicInstance}();BookerWrapper=angular.module("BookerWrapper").controller("Checkin",["$scope","$timeout","CheckinConfig","AirportData","jbOverlayFactory","$rootScope",function($scope,$timeout,CheckinConfig,AirportData,jbOverlayFactory,$rootScope){function isInvalidName(name){return!/^[a-zA-Z ]*$/.test(name)||"undefined"==typeof name||name.length<1}var getSelectedRegionContries,getRegionName;AirportData.init(),getRegionName=function(airportCode){var regionCode,regionName="";return airportCode&&AirportData.Station(airportCode)&&(regionCode=AirportData.Station(airportCode).RegionCodes[0],regionName=AirportData.regions[regionCode].Name),regionName},getSelectedRegionContries=function(regions,region){return $.map(regions,function(el){return el.region===region?el.countries:void 0})},$scope.showToolTip=function($event){jbOverlayFactory.init({title:CheckinConfig.PNRExample.headerText,template:"/includes/modules/booker_refresh/components/checkin/dist/partials/PNRExample.html",image:CheckinConfig.PNRExample.image},null),jbOverlayFactory.show(),$event.preventDefault();var triggeredBy=$event.target;$rootScope.$on("JBOVERLAY_HIDDEN",function(){(triggeredBy||"undefined"!=typeof triggeredBy)&&setTimeout(function(){$($event.target).focus()},20)})},$scope.ciconfig={},$.extend($scope.ciconfig,CheckinConfig),$scope.citySelectorFooter="",$scope.fromLAirports=AirportData.StationList({format:"suggestion",filter:[{blueCity:!0},{macCode:!1}]}),$scope.fromPAirports=AirportData.StationList({sort:"ASC",group:"region",regionOptions:{flatten:["United States"]},filter:[{blueCity:!0},{macCode:!1}]});var defaultObj={label:"",code:"",region:"United States",countries:getSelectedRegionContries($scope.fromPAirports,"United States")};$scope.fromSelectedObj={},$.extend($scope.fromSelectedObj,defaultObj),$scope.errors=[],$scope.onFromSelection=function(label,code){code||(code=AirportData.Station(label),"object"==typeof code&&code.Code&&(code=code.Code)),label&&code&&($scope.fromSelectedObj.label=label,$scope.fromSelectedObj.code=code,$scope.fromSelectedObj.region=getRegionName(code),$scope.fromSelectedObj.countries=getSelectedRegionContries($scope.fromPAirports,$scope.fromSelectedObj.region),$scope.fromResult=label)},$scope.onFromCityType=function(typedthings){},$scope.firstNameError="",$scope.lastNameError="",$scope.PNRError="",$scope.checkFirstName=function(){$scope.firstNameError="",isInvalidName($scope.firstName)&&($scope.firstNameError=$scope.ciconfig.messages.errors.INVALID_FIRST_NAME)},$scope.checkLastName=function(){$scope.lastNameError="",isInvalidName($scope.lastName)&&($scope.lastNameError=$scope.ciconfig.messages.errors.INVALID_LAST_NAME)},$scope.checkDepartCity=function(){$scope.departCityError="",(!$scope.fromSelectedObj.code||""===$scope.fromSelectedObj.code||$scope.fromSelectedObj.code.length<3)&&($scope.departCityError=$scope.ciconfig.messages.errors.INVALID_DEPARTURE)},$scope.hideDepartCityError=function(){$scope.departCityError=""},$scope.checkPNR=function(){$scope.PNRError="",("undefined"==typeof $scope.pnr||$scope.pnr.length<6||$scope.pnr.length>7||!$scope.pnr.match(/^[a-z0-9]+$/i))&&($scope.PNRError=$scope.ciconfig.messages.errors.INVALID_PNR)},$scope.handleSubmit=function(){var form=$(".jbCheckin form");if($scope.cierrors=[],("undefined"==typeof $scope.pnr||$scope.pnr.length<6||$scope.pnr.length>7||!$scope.pnr.match(/^[a-z0-9]+$/i))&&($scope.cierrors.push($scope.ciconfig.messages.errors.INVALID_PNR),$scope.PNRError=$scope.ciconfig.messages.errors.INVALID_PNR),(!$scope.fromSelectedObj.code||""===$scope.fromSelectedObj.code||$scope.fromSelectedObj.code.length<3)&&($scope.cierrors.push($scope.ciconfig.messages.errors.INVALID_DEPARTURE),$scope.departCityError=$scope.ciconfig.messages.errors.INVALID_DEPARTURE),isInvalidName($scope.firstName)&&($scope.cierrors.push($scope.ciconfig.messages.errors.INVALID_FIRST_NAME),$scope.firstNameError=$scope.ciconfig.messages.errors.INVALID_FIRST_NAME),isInvalidName($scope.lastName)&&($scope.cierrors.push($scope.ciconfig.messages.errors.INVALID_LAST_NAME),$scope.lastNameError=$scope.ciconfig.messages.errors.INVALID_LAST_NAME),$scope.cierrors.length)return $scope.errors=$scope.cierrors,$scope.showErrors=!0,void setTimeout(function(){$(".errors-wrapper").focus()},10);var checkinReqParams="";checkinReqParams+="recordLocator="+$scope.pnr,checkinReqParams+="&departureCity="+$scope.fromSelectedObj.code,checkinReqParams+="&firstName="+$scope.firstName,checkinReqParams+="&lastName="+$scope.lastName,form.attr("action",form.attr("data-forward-action")+"?"+checkinReqParams);try{form.submit()}catch(e){EL.catcher("error in checkin submit")}},$scope.closeErrors=function(){$scope.showErrors=!1;var firstError=$(".jbCheckin form .inline_error:visible").first().attr("id");$(".jbCheckin form [aria-labelledby]").each(function(a,b){$(b).attr("aria-labelledby").indexOf(firstError)>=0&&$(b).focus()})}}]).directive("replaceFilter",function(){return{require:"ngModel",link:function(scope,element,attr,ngModelCtrl){function fromUser(text){var newText=text.replace(regEx,"");return newText!=text?(ngModelCtrl.$setViewValue(newText),ngModelCtrl.$render(),newText):text}var regEx=new RegExp(attr.replaceFilter,"g");ngModelCtrl.$parsers.push(fromUser)}}}).directive("checkin",function(){return{restrict:"E",replace:!0,templateUrl:"/includes/modules/booker_refresh/components/checkin/dist/partials/checkin.html"}}),BookerWrapper=angular.module("BookerWrapper").controller("FlightStatus",["$scope","$rootScope","$timeout","$filter","FlightStatusConfig","AirportData","$sce",function($scope,$rootScope,$timeout,$filter,FlightStatusConfig,AirportData,$sce){$scope.fsconfig={},$.extend($scope.fsconfig,FlightStatusConfig),$scope.$watch("type",function(){$scope.type&&FlightStatusConfig.scopeDefaults.all&&$.extend(!0,$scope.fsconfig,FlightStatusConfig.scopeDefaults.all),$scope.$emit("FLIGHT_STATUS_LOADED")});var getSelectedRegionContries,getRegionName;AirportData.init(),getRegionName=function(airportCode){var regionCode,regionName="";return airportCode&&AirportData.Station(airportCode)&&(regionCode=AirportData.Station(airportCode).RegionCodes[0],regionName=AirportData.regions[regionCode].Name),regionName},getSelectedRegionContries=function(regions,region){return $.map(regions,function(el){return el.region===region?el.countries:void 0})},$scope.lookupdays=[],$scope.setLookupDays=function(){var today=new Date,yesterday=new Date;yesterday.setDate(yesterday.getDate()-1);var tomorrow=new Date;tomorrow.setDate(tomorrow.getDate()+1);var lookupdays=[{name:"Yesterday, "+$filter("date")(yesterday,"EEEE MMMM dd"),value:$filter("date")(yesterday,"MM/dd/yyyy")},{name:"Today, "+$filter("date")(today,"EEEE MMMM dd"),value:$filter("date")(today,"MM/dd/yyyy")},{name:"Tomorrow, "+$filter("date")(tomorrow,"EEEE MMMM dd"),value:$filter("date")(tomorrow,"MM/dd/yyyy")}];$scope.lookupdays=lookupdays},$scope.setLookupDays(),$scope.flightDate=$scope.lookupdays[1].name,$scope.flightStatusSearchType="byCities",$scope.fromResult="",$scope.fromLAirports=$scope.toLAirports=AirportData.StationList({filter:[{blueCity:!0},{macCode:!1}],format:"suggestion"}),$scope.fromPAirports=$scope.toPAirports=AirportData.StationList({filter:[{blueCity:!0},{macCode:!1}],sort:"ASC",group:"region",regionOptions:{flatten:["United States"]}});var defaultObj={label:"",code:"",region:"United States",countries:getSelectedRegionContries($scope.fromPAirports,"United States")};$scope.fromSelectedObj={},$scope.toSelectedObj={},$.extend($scope.fromSelectedObj,defaultObj),$.extend($scope.toSelectedObj,defaultObj),$rootScope.FSSelectFrom=function(code){AirportData.Station([code])&&$scope.onFromSelection(AirportData.Station([code]).DefaultDisplayName,code)},$rootScope.FSSelectTo=function(code){AirportData.Station([code])&&$scope.onToSelection(AirportData.Station([code]).DefaultDisplayName,code)},$rootScope.FSSelectDate=function(date){$scope.flightDate=$filter("date")(new Date(date),"MM/dd/yyyy")},$rootScope.ByFlightNumber=function(type,flightNum){$scope.flightStatusSearchType=type,$scope.lookupNumber=flightNum},$scope.onFromSelection=function(label,code){var region;label&&(code||(code=AirportData.Station(label).Code),region=getRegionName(code),$scope.toLAirports=AirportData.StationList({filter:[{destination:code},{blueCity:!0},{macCode:!1}],format:"suggestion"}),$scope.fromSelectedObj={label:label,code:code,region:region},$scope.fromResult=label,$scope.toPAirports=AirportData.StationList({filter:[{destination:code},{blueCity:!0},{macCode:!1}],sort:"ASC",group:"region",regionOptions:{flatten:["United States"]}}),region?angular.forEach($scope.fromPAirports,function(regionitem){regionitem.region==region?regionitem.selected=!0:regionitem.selected=!1,angular.forEach(regionitem,function(region){angular.forEach(regionitem.countries,function(country){angular.forEach(country.airports,function(airport){airport.Code==code?airport.selected=!0:airport.selected=!1})})})}):(angular.forEach($scope.toPAirports,function(regionitem){regionitem.selected=!1}),$scope.fromPAirports[0].selected=!0))},$scope.onToSelection=function(label,code){var region;label&&(code||(code=AirportData.Station(label).Code),region=getRegionName(code),$scope.fromLAirports=AirportData.StationList({filter:[{origin:code},{blueCity:!0},{macCode:!1}],format:"suggestion"}),$scope.toSelectedObj={label:label,code:code,region:region},$scope.toResult=label,$scope.fromPAirports=AirportData.StationList({filter:[{origin:code},{blueCity:!0},{macCode:!1}],sort:"ASC",group:"region",regionOptions:{flatten:["United States"]}}),region?angular.forEach($scope.toPAirports,function(regionitem){regionitem.region==region?regionitem.selected=!0:regionitem.selected=!1,angular.forEach(regionitem,function(region){angular.forEach(regionitem.countries,function(country){angular.forEach(country.airports,function(airport){airport.Code==code?airport.selected=!0:airport.selected=!1})})})}):(angular.forEach($scope.toPAirports,function(regionitem){regionitem.selected=!1}),$scope.toPAirports[0].selected=!0))},$scope.onFromCityType=function(typedthings){},$scope.onToCityType=function(typedthings){},$scope.departCityError="",$scope.returnCityError="",$scope.flighNoError="",$scope.lookupNumber="",$scope.checkDepartCity=function(){$scope.departCityError="",(!$scope.fromSelectedObj.code||""===$scope.fromSelectedObj.code||$scope.fromSelectedObj.code.length<3)&&($scope.departCityError=$scope.fsconfig.messages.errors.INVALID_DEPARTURE)},$scope.hideDepartCityErrors=function(){$scope.departCityError=""},$scope.checkReturnCity=function(){$scope.returnCityError="",(!$scope.toSelectedObj.code||""===$scope.toSelectedObj.code||$scope.toSelectedObj.code.length<3)&&($scope.returnCityError=$scope.fsconfig.messages.errors.INVALID_ARRIVAL)},$scope.hideReturnCityErrors=function(){$scope.returnCityError=""},$scope.checkFlighNo=function(){$scope.flighNoError="",$scope.lookupNumber&&""!==$scope.lookupNumber&&$scope.lookupNumber.match(/^[a-z0-9]+$/i)||($scope.flighNoError=$scope.fsconfig.messages.errors.INVALID_FLIGHT_NUMBER)},$scope.isMaxLength=function($event){var inputlenght=$scope.lookupNumber.length;inputlenght>4&&$event.preventDefault()},$scope.handleSubmit=function(){var form=$(".jbFlightStatus form"),reqParams="";if($scope.fserrors=[],"byCities"==$scope.flightStatusSearchType?((!$scope.fromSelectedObj.code||""===$scope.fromSelectedObj.code||$scope.fromSelectedObj.code.length<3)&&($scope.fserrors.push($scope.fsconfig.messages.errors.INVALID_DEPARTURE+"\n"),$scope.departCityError=$scope.fsconfig.messages.errors.INVALID_DEPARTURE),(!$scope.toSelectedObj.code||""===$scope.toSelectedObj.code||$scope.toSelectedObj.code.length<3)&&($scope.fserrors.push($scope.fsconfig.messages.errors.INVALID_ARRIVAL),$scope.returnCityError=$scope.fsconfig.messages.errors.INVALID_ARRIVAL)):"byFlightNumber"==$scope.flightStatusSearchType&&($scope.lookupNumber&&""!==$scope.lookupNumber&&$scope.lookupNumber.match(/^[a-z0-9]+$/i)||($scope.fserrors.push($scope.fsconfig.messages.errors.INVALID_FLIGHT_NUMBER),$scope.flighNoError=$scope.fsconfig.messages.errors.INVALID_FLIGHT_NUMBER)),$scope.fserrors.length)return $scope.errors=$scope.fserrors,$scope.showErrors=!0,void setTimeout(function(){$(".jbFlightStatus .errors-wrapper").focus()},10);reqParams+="FlightDate="+encodeURIComponent($scope.flightDate.replace(/\b0(?=\d)/g,"")),reqParams+="&FlightNum="+($scope.lookupNumber||""),reqParams+="&FlightOrgn="+($scope.fromSelectedObj.code||""),reqParams+="&FlightDestn="+($scope.toSelectedObj.code||""),reqParams+="&FlightStatusType="+($scope.flightStatusSearchType||""),reqParams+="&fs_from_field="+($scope.fromSelectedObj.label.replace(/(\s)/gi,"+").replace(/(\,)/gi,"%2C").replace(/(\()/gi,"%28").replace(/(\))/gi,"%29")||""),reqParams+="&fs_to_field="+($scope.toSelectedObj.label.replace(/(\s)/gi,"+").replace(/(\,)/gi,"%2C").replace(/(\()/gi,"%28").replace(/(\))/gi,"%29")||""),reqParams+="&flight_number_field="+($scope.lookupNumber||""),reqParams+="&departure_date="+encodeURIComponent($scope.flightDate.replace(/\b0(?=\d)/g,"")),form.attr("action",form.attr("data-forward-action")+"?"+reqParams);try{form.submit()}catch(e){}},$scope.closeErrors=function(){$scope.showErrors=!1;var firstError=$(".jbFlightStatus form .inline_error:visible").first().attr("id");$(".jbFlightStatus form [aria-labelledby]").each(function(a,b){$(b).attr("aria-labelledby").indexOf(firstError)>=0&&$(b).focus()})},$scope.partnerAirlineText=$scope.fsconfig.messages.citySelector.FOOTER_TEXT_PARTNER_AIRLINES}]).config(fsSceConfig).directive("flightstatus",function(){return{restrict:"E",replace:!0,templateUrl:"/includes/modules/booker_refresh/components/flightstatus/dist/partials/flightstatus.html"}}),fsSceConfig.$inject=["$sceDelegateProvider"];var jbSelect=angular.module("jbSelectModule",[]).directive("jbSelect",function($compile){return{restrict:"A",template:'<div role="application" aria-label="{{myarialabel}} {{findValue()}}" class="dropdown jbSelectContainer " ng-class="{JumpTo : jumpTo, open:active, disabled:disabled}"><select style="display:none" name="{{name}}" ng-model="ngModel" ng-options="option.value as option.name for option in ngOptions"> </select><div tabindex="0" ng-blur="closeOnBlur()" ng-touchstart="toggleOpen()"  ng-mousedown="toggleOpen()" ng-keydown="keydown($event)" class="jbSelectLabel" >{{findValue()}}<span class="jbSelectArrowSprite upDownArrow"><img src="/includes/modules/booker_refresh/components/jbSelect/src/up-dwn-arrows.png"></span></div><ol ng-keydown="keydown($event)" class="jbDropdownList piejs"> <!--<li class="selected" ng-if="jumpTo"><div>{{selected}}</div></li>--><li ng-blur="closeOnBlur()"  tabindex="-1" ng-class="{focused : focusIndex == $index}" ng-mouseover="hover($index)" ng-touchstart="updateModel(option.value)" ng-mousedown="updateModel(option.value)"ng-repeat="option in ngOptions"><div>{{option.name}}</div></li> </ol></div>',scope:{ngModel:"=",ngOptions:"="},controller:function($scope,$window){$scope.active=!1,$scope.focusSelect=function(){$($scope.element).find(".jbSelectLabel").focus()};var key={up:38,down:40,enter:13,space:32,esc:27,tab:9};$scope.keydown=function($event){if($event.keyCode===key.up)$scope.focusIndex=0===$scope.focusIndex?$scope.ngOptions.length-1:($scope.focusIndex-1)%$scope.ngOptions.length,$($scope.element).find("li:nth("+$scope.focusIndex+")").focus();else if($event.keyCode===key.down)$scope.active?$scope.focusIndex=($scope.focusIndex+1)%$scope.ngOptions.length:$scope.open(),$($scope.element).find("li:nth("+$scope.focusIndex+")").focus();else if($event.keyCode===key.space||$event.keyCode===key.enter)$scope.active?$scope.updateModel($scope.ngOptions[$scope.focusIndex].value):$scope.open();else if($event.keyCode===key.esc)$scope.close();else{if($scope.findNextIndexMatch($event.keyCode)===!1)return;$scope.focusIndex=$scope.findNextIndexMatch($event.keyCode)}$event.preventDefault()},$scope.hover=function(index){$scope.focusIndex=index},$scope.open=function(){$scope.selected!==$scope.findValue()&&($scope.selected=""),$scope.disabled!==!0&&($scope.focusIndex=$scope.focusIndex||0,$scope.active=!0)},$scope.close=function($event){$scope.active=!1},$scope.closeOnBlur=function($event){setTimeout(function(){0===$($scope.element).find("li:focus").length&&($scope.active=!1,$scope.$apply())},10)},$scope.toggleOpen=function(){$scope.active?$scope.close():$scope.open()},$scope.updateModel=function(val){$scope.ngModel=val,$scope.selected=$scope.findValue(),setTimeout(function(){$scope.jumpTo?$($scope.element).closest(".dropdown-menu").find(".cal_date_value").first().closest("td").focus():$scope.focusSelect()},10),$scope.close()},$scope.findValue=function(){if($scope.ngOptions)for(var i=0;i<$scope.ngOptions.length;i++)if($scope.ngOptions[i]&&$scope.ngOptions[i].value==$scope.ngModel)return $scope.ngOptions[i].name;return $scope.ngModel},$scope.findNextIndexMatch=function(needle){var matches=[];return matches=$scope.ngOptions.reduce(function(prev,el,index,arr){var matcher=String.fromCharCode(needle).replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");return el.name.match(new RegExp("^"+matcher,"gi"))&&(el.index=index,prev.push(el)),prev},[]),0===matches.length?!1:1===matches.length?matches[0].index:matches[matches.length-1].index===$scope.focusIndex?matches[0].index:matches.filter(function(el){return el.index>$scope.focusIndex})[0].index}},link:function(scope,element,attrs){scope.name=attrs.name,scope.mode=attrs.mode?attrs.mode:"default",scope.jumpTo=attrs.mode&&"jumpTo"===attrs.mode?!0:!1,scope.selected="",scope.disabled="true"==attrs.ngDisabled,scope.myarialabel=attrs.myarialabel,scope.disabled?scope.myarialabel+=" (Cannot be modified)":scope.myarialabel+=" (Use Up and Down Arrow Keys to Navigate)",scope.element=element,scope.$watch(function(scope){return scope.$eval(attrs.compile)},function(value){element.html(value),$compile(element.contents())(scope)})}}});angular.module("AirportDataProvider",[]).service("AirportData",["$http","$rootScope",function($http,$rootScope){var airportData=this,odAPIFailure=!1;return this.init=function(config,cb){return"undefined"!=typeof config?"function"!=typeof config.success&&"function"==typeof cb&&(config.success=cb):config={},config.odType=config.odType||!1,config.format=config.format||!1,this.__getODData({type:config.odType,format:config.format}),odAPIFailure?(jQuery(window).trigger("OD API FAILURE"),config.error&&"function"==typeof config.error&&config.error.call(),!1):("function"==typeof config.success&&config.success.call(),!0)},this.StationList=function(config){var model=airportData.airportArray;if(config=config||{},"undefined"!=typeof model){if("boolean"==typeof config.keepEmptyStations&&config.keepEmptyStations||(model=model.filter(function(el){var keepable=airportData.__getDestinationsFromOrigin(el.Code)!==!1&&airportData.__getOriginsFromDestination(el.Code)!==!1;return keepable})),config.filter instanceof Array&&$.each(config.filter,function(i,el){if("string"==typeof el.origin)model=model.filter(function(k,v){return $.inArray(k.Code,airportData.__getOriginsFromDestination(el.origin))>-1?k:void 0});else if("string"==typeof el.destination)model=model.filter(function(k,v){return $.inArray(k.Code,airportData.__getDestinationsFromOrigin(el.destination))>-1?k:void 0});else if("string"==typeof el.region){var filteredRegionCode="";$.each(airportData.regions,function(k,v){el.region==v.Name&&(filteredRegionCode=k)}),model=model.filter(function(k,v){return $.inArray(filteredRegionCode,k.RegionCodes)>-1?k:void 0})}else if("string"==typeof el.country)model=model.filter(function(k,v){return k.CountryName===el.country?k:void 0});else if("boolean"==typeof el.blueCity)model=model.filter(function(k,v){return k.IsBlueCity===el.blueCity?k:void 0});else if("boolean"==typeof el.macCode)model=model.filter(function(k,v){return k.IsMACCode===el.macCode?k:void 0});else if("undefined"!=typeof el.iata){var filter=el.iata;if("string"==typeof el.iata&&(filter=filter.split(" ")),!filter instanceof Array)return!1;model=model.filter(function(k,v){return-1==$.inArray(k.Code,filter)?k:void 0})}}),config.format){if("suggestion"===config.format)return model=airportData.__getSuggestionsFromAirports(model);"IATA"===config.format&&(model=$.map(model,function(el,i){return el.Code}))}return"undefined"!=typeof config&&"undefined"!=typeof model&&config.sort&&(model=model.sort(function(a,b){if("region"===config.group&&a.RegionCodes[0]!==b.RegionCodes[0]){if("US"===a.RegionCodes[0])return"DESC"===config.sort?1:-1;if("US"===b.RegionCodes[0])return"DESC"===config.sort?-1:1;var aRegionName=airportData.regions[a.RegionCodes[0]].Name,bRegionName=airportData.regions[b.RegionCodes[0]].Name;if(bRegionName>aRegionName)return"DESC"===config.sort?1:-1;if(aRegionName>bRegionName)return"DESC"===config.sort?-1:1}if(("country"===config.group||"region"===config.group)&&a.CountryCode!==b.CountryCode){if(a.CountryName<b.CountryName)return"DESC"===config.sort?1:-1;if(a.CountryName>b.CountryName)return"DESC"===config.sort?-1:1}return a.DefaultDisplayName<b.DefaultDisplayName?"DESC"===config.sort?1:-1:a.DefaultDisplayName>b.DefaultDisplayName?"DESC"===config.sort?-1:1:0})),config.group&&(("country"==config.group||"region"==config.group)&&(model=airportData.__groupAirportsByCountry(model)),"region"==config.group&&(model=airportData.__groupCountriesByRegion(model,config.regionOptions))),model}},this.Station=function(input,config){if("undefined"==typeof input)return!1;if("undefined"!=typeof airportData.airportLookup[input])return airportData.airportLookup[input];if("undefined"!=typeof airportData.labelLookup[input])return airportData.airportLookup[airportData.labelLookup[input]];if("undefined"!=typeof config&&"boolean"==typeof config.fuzzy&&config.fuzzy){var displayNames=airportData.__getLabelLookup(),fuzzyLookup=!1;return $.each(displayNames,function(displayName){if(displayName.toUpperCase().indexOf(input.toUpperCase())>-1){if(fuzzyLookup!==!1)return fuzzyLookup=!1,!1;fuzzyLookup=airportData.Station(displayName)}}),fuzzyLookup}return!1},this.Route=function(originIATA,destinationIATA){return"undefined"==typeof originIATA||"undefined"==typeof destinationIATA?!1:airportData.__getRouteProperties(originIATA,destinationIATA)},this.__assertLoadedODData=function(type){function odTypeIsLoaded(type){return"undefined"==typeof window["od"+type]?!1:window["od"+type]}var odData,validODTypes=["DEALS","JBONLY","BFF","FLIGHTSTATUS","GETAWAYS","ALL"];if("string"==typeof type)odData=odTypeIsLoaded(type),"undefined"!=typeof odData.Error&&(odData=!1);else for(var i=validODTypes.length-1;i>=0&&(odData=odTypeIsLoaded(validODTypes[i]),"undefined"!=typeof odData.Error&&(odData=!1),!odData);i--);return odData},this.__getODData=function(config){var odData=airportData.__assertLoadedODData(config.type);odData?(airportData.__setAirports(odData,config.format),airportData.__setRoutePairs(odData,config.format),airportData.__setRegions(odData,config.format),airportData.__setCountries(odData,config.format),airportData.__setLabelLookup(odData,config.format)):($rootScope.$broadcast("OD API FAILURE"),odAPIFailure=!0)},this.__setAirports=function(data,options){"object"==typeof options&&"object"==typeof options.copyAirports&&$.each(options.copyAirports,function(key,value){"string"==typeof value?data.Airports[key]=data.Airports[value]:"function"==typeof value&&(data.Airports[key]=value.call())}),this.airportArray=$.map(data.Airports,function(el){return el.isBlueCity=el.IsBlueCity,el.label=el.DefaultDisplayName,el.needle=[el.Name,el.DefaultDisplayName].join(" "),el.value=el.Code,el}),this.airportLookup=data.Airports},this.__setRoutePairs=function(data,options){var stack=[];stack=data.RouteSets,"object"==typeof options&&"object"==typeof options.copyRoutes&&$.each(options.copyRoutes,function(key,value){"string"==typeof value?stack[key]=stack[value]:"function"==typeof value&&(stack[key]=value.call())}),$.each(stack,function(originkey,originobj){$.each(originobj.DestinationCodes,function(index,destinationCode){"undefined"!=typeof data.RouteSets[destinationCode]&&(data.RouteSets[destinationCode].OriginCodes=data.RouteSets[destinationCode].OriginCodes||[],data.RouteSets[destinationCode].OriginCodes.push(originkey))})}),this.routePairs=stack},this.__setCountries=function(data){this.countries=data.Countries},this.__setRegions=function(data){this.regions=data.Regions},this.__setLabelLookup=function(data){airportData.labelLookup={},$.each(airportData.airportLookup,function(k,v){airportData.labelLookup[v.DefaultDisplayName]=v.Code})},this.__getAirports=function(){return this.airports},this.__getRoutePairs=function(){return this.routePairs},this.__getCountries=function(){return this.countries},this.__getRegions=function(){return this.regions},this.__getLabelLookup=function(){return this.labelLookup},this.__getOriginsFromDestination=function(IATA){return"undefined"!=typeof airportData.__getRoutePairs()[IATA]&&"undefined"!=typeof airportData.__getRoutePairs()[IATA].OriginCodes?airportData.__getRoutePairs()[IATA].OriginCodes:!1},this.__getDestinationsFromOrigin=function(IATA){return"undefined"!=typeof airportData.__getRoutePairs()[IATA]&&"undefined"!=typeof airportData.__getRoutePairs()[IATA].DestinationCodes?airportData.__getRoutePairs()[IATA].DestinationCodes:!1},this.__getSuggestionsFromAirports=function(airports){function alphaSortAirports(a,b){return a.DefaultDisplayName<b.DefaultDisplayName?-1:a.DefaultDisplayName>b.DefaultDisplayName?1:0}function suggestionByCityModel(airport){return{label:airport.DefaultDisplayName,needle:[airport.DefaultDisplayName,airport.City,airport.Code,airport.CountryName].join(" "),value:airport.Code,isBlueCity:airport.IsBlueCity,isMAC:!1,basis:"city"}}function suggestionByMACModel(airport){var childMACCodeArray=airport.ChildrenMACCodes.map(function(airportCode){return[airportCode,airportData.Station(airportCode).City,airportData.Station(airportCode).DefaultDisplayName].join(" ")});return{label:airport.DefaultDisplayName,needle:[airport.DefaultDisplayName,airport.Code,childMACCodeArray.join(" ")].join(" "),value:airport.Code,isBlueCity:airport.IsBlueCity,isMAC:!0,basis:"MAC"}}function partnerCitySuggestionModel(airport){return{label:airport.DefaultDisplayName,needle:[airport.DefaultDisplayName,airport.City,airport.Code,airport.CountryName].join(" "),value:airport.Code,isBlueCity:airport.IsBlueCity,isMAC:!1,basis:"partner"}}if(airports){var alphaSortedAirports=[],suggestionsByCity=[],suggestionsByMAC=[],partnerCitySuggestions=[];return alphaSortedAirports=airports.sort(alphaSortAirports),$.each(alphaSortedAirports,function(airportIndex,airport){!airport.IsMACCode&&airport.IsBlueCity&&suggestionsByCity.push(suggestionByCityModel(airport)),airport.IsMACCode&&suggestionsByMAC.push(suggestionByMACModel(airport)),airport.IsBlueCity||partnerCitySuggestions.push(partnerCitySuggestionModel(airport))}),suggestionsByCity.concat(suggestionsByMAC,partnerCitySuggestions)}},this.__groupAirportsByCountry=function(model){var countryIndexReference={};if("undefined"!=typeof model)return model.reduce(function(countries,airport,index){"undefined"==typeof countryIndexReference[airport.CountryCode]&&(countryIndexReference[airport.CountryCode]=countries.length,countries.push({country:airportData.countries[airport.CountryCode].Name,airports:[]}));var countryIndex=countryIndexReference[airport.CountryCode];return countries[countryIndex].airports.push(airport),countries},[])},this.__groupCountriesByRegion=function(model,regionOptions){var regionIndexReference={};if("undefined"!=typeof model){var groupedByRegion=model.reduce(function(regions,country,countryIndex){var countryData=airportData.countries[country.airports[0].CountryCode];return countryData.RegionCodes.forEach(function(regionCode){airportData.regions[regionCode].Name;"undefined"==typeof regionIndexReference[regionCode]&&(regionIndexReference[regionCode]=regions.length,regions.push({region:airportData.regions[regionCode].Name,Countries:[],countries:[]}));var regionIndex=regionIndexReference[regionCode];regions[regionIndex].Countries.push(country),regions[regionIndex].countries.push(country)}),regions},[]);return regionOptions&&regionOptions.flatten&&(groupedByRegion=airportData.__flattenRegions(groupedByRegion,regionOptions.flatten)),groupedByRegion}},this.__flattenRegions=function(model,regionsToFlatten){if("undefined"!=typeof model){var flattenedRegions=[];return model.forEach(function(region){if(-1!==regionsToFlatten.indexOf(region.region)){var flattenedAirports=region.countries.reduce(function(flattenedCountries,country){return flattenedCountries.concat(country.airports)},[]);flattenedAirports.sort(function(a,b){return a.DefaultDisplayName<b.DefaultDisplayName?"undefined"!=typeof config&&"DESC"===config.sort?1:-1:a.DefaultDisplayName>b.DefaultDisplayName?"undefined"!=typeof config&&"DESC"===config.sort?-1:1:void 0});var flattenedRegion=[{airports:flattenedAirports,country:region.region}];flattenedRegions.push({region:region.region,Countries:flattenedRegion,countries:flattenedRegion})}else flattenedRegions.push(region)}),flattenedRegions}},this.__getRouteProperties=function(originIATA,destinationIATA){var stack,needle,props,res;return stack=airportData.__getRoutePairs(),"undefined"==typeof stack[originIATA]?!1:(stack=stack[originIATA],needle="undefined"!=typeof stack.DestinationCodes?stack.DestinationCodes.indexOf(destinationIATA):-1,0>needle?!1:(res={origin:originIATA,destination:destinationIATA},props="undefined"!=typeof stack.DestinationProperties?stack.DestinationProperties[needle]:{},res=$.extend(res,props)))},airportData}]);var jbPie=angular.module("jbPieModule",[]).directive("piejs",function(){return{restrict:"C",link:function(scope,element,attr){function applyPIE(args){window.PIE&&"function"==typeof PIE.attach&&PIE.attach(element[0])}applyPIE(),scope.$on("$destroy",function(){window.PIE&&"function"==typeof PIE.detach&&PIE.detach(element[0])})}}});!function(angular,document,undefined){"use strict";angular.module("ng.shims.placeholder",[]).service("placeholderSniffer",["$document",function($document){this.emptyClassName="empty",this.hasPlaceholder=function(){var test=$document[0].createElement("input");return void 0!==test.placeholder}}]).directive("placeholder",["$timeout","$document","$interpolate","$animate","placeholderSniffer",function($timeout,$document,$interpolate,$animate,placeholderSniffer){if(placeholderSniffer.hasPlaceholder())return{};var documentListenersApplied=!1,supportsAnimatePromises=parseFloat(angular.version.full)>=1.3;
return{restrict:"A",require:"?ngModel",priority:110,link:function(scope,elem,attrs,ngModel){function updateValue(e){var val=elem.val();elem.hasClass(emptyClassName)&&val&&val===text||conditionalDefer(function(){setValue(val)})}function conditionalDefer(callback){document.documentMode<=11?$timeout(callback,0):callback()}function setValue(val){val||0===val||domElem===document.activeElement?(elem.removeClass(emptyClassName),elem.val(val)):(elem.addClass(emptyClassName),elem.val(is_pwd?"":text)),is_pwd&&(updatePasswordPlaceholder(),asyncUpdatePasswordPlaceholder())}function getValue(){return ngModel?scope.$eval(attrs.ngModel)||"":getDomValue()||""}function getDomValue(){var val=elem.val();return val===attrs.placeholder&&(val=""),val}function changePlaceholder(value){elem.hasClass(emptyClassName)&&elem.val()===text&&elem.val(""),text=value,updateValue()}function setAttrUnselectable(elmn,enable){enable?elmn.attr("unselectable","on"):elmn.removeAttr("unselectable")}function setupPasswordPlaceholder(){clone=angular.element('<input type="text" value="'+text+'"/>'),stylePasswordPlaceholder(),clone.addClass(emptyClassName).addClass(hiddenClassName).bind("focus",hidePasswordPlaceholderAndFocus),domElem.parentNode.insertBefore(clone[0],domElem);for(var watchAttrs=[attrs.ngDisabled,attrs.ngReadonly,attrs.ngRequired,attrs.ngShow,attrs.ngHide],i=0;i<watchAttrs.length;i++)watchAttrs[i]&&scope.$watch(watchAttrs[i],asyncUpdatePasswordPlaceholder)}function updatePasswordPlaceholder(){stylePasswordPlaceholder(),isNgHidden()?clone.addClass(hiddenClassName):elem.hasClass(emptyClassName)&&domElem!==document.activeElement?showPasswordPlaceholder():hidePasswordPlaceholder()}function asyncUpdatePasswordPlaceholder(){supportsAnimatePromises?$animate.addClass(elem,"").then(updatePasswordPlaceholder):$animate.addClass(elem,"",updatePasswordPlaceholder)}function stylePasswordPlaceholder(){clone.val(text).attr("class",elem.attr("class")||"").attr("style",elem.attr("style")||"").prop("disabled",elem.prop("disabled")).prop("readOnly",elem.prop("readOnly")).prop("required",elem.prop("required")),setAttrUnselectable(clone,"on"===elem.attr("unselectable"))}function showPasswordPlaceholder(){elem.addClass(hiddenClassName),clone.removeClass(hiddenClassName)}function hidePasswordPlaceholder(){clone.addClass(hiddenClassName),elem.removeClass(hiddenClassName)}function hidePasswordPlaceholderAndFocus(){hidePasswordPlaceholder(),domElem.focus()}function isNgHidden(){var hasNgShow="undefined"!=typeof attrs.ngShow,hasNgHide="undefined"!=typeof attrs.ngHide;return hasNgShow||hasNgHide?hasNgShow&&!scope.$eval(attrs.ngShow)||hasNgHide&&scope.$eval(attrs.ngHide):!1}var clone,orig_val=getValue(),domElem=elem[0],elemType=domElem.nodeName.toLowerCase(),isInput="input"===elemType||"textarea"===elemType,is_pwd="password"===attrs.type,text=attrs.placeholder,emptyClassName=placeholderSniffer.emptyClassName,hiddenClassName="ng-hide";isInput&&(attrs.$observe("placeholder",function(newValue){changePlaceholder(newValue)}),is_pwd&&setupPasswordPlaceholder(),setValue(orig_val),elem.bind("focus",function(){elem.hasClass(emptyClassName)&&(elem.val(""),elem.removeClass(emptyClassName),domElem.select())}),elem.bind("blur",updateValue),ngModel||elem.bind("change",function(){changePlaceholder($interpolate(elem.attr("placeholder"))(scope))}),ngModel&&(ngModel.$render=function(){setValue(ngModel.$viewValue),domElem!==document.activeElement||elem.val()||domElem.select()}),documentListenersApplied||($document.on("selectstart",function(e){var elmn=angular.element(e.target);elmn.hasClass(emptyClassName)&&elmn.prop("disabled")&&e.preventDefault()}),documentListenersApplied=!0))}}}])}(window.angular,window.document),function(){"use strict";var _bugsnag;angular.module("angular-bugsnag",[]).config(["$provide",function($provide){$provide.provider({bugsnag:function(){_bugsnag=Bugsnag;var _beforeNotify,_self=this;this.noConflict=function(){return _bugsnag=Bugsnag.noConflict(),_self},this.apiKey=function(apiKey){return _bugsnag.apiKey=apiKey,_self},this.releaseStage=function(releaseStage){return _bugsnag.releaseStage=releaseStage,_self},this.notifyReleaseStages=function(notifyReleaseStages){return _bugsnag.notifyReleaseStages=notifyReleaseStages,_self},this.appVersion=function(appVersion){return _bugsnag.appVersion=appVersion,_self},this.user=function(user){return _bugsnag.user=user,_self},this.projectRoot=function(projectRoot){return _bugsnag.projectRoot=projectRoot,_self},this.endpoint=function(endpoint){return _bugsnag.endpoint=endpoint,_self},this.metaData=function(metaData){return _bugsnag.metaData=metaData,_self},this.autoNotify=function(autoNotify){return _bugsnag.autoNotify=autoNotify,_self},this.beforeNotify=function(beforeNotify){return _beforeNotify=beforeNotify,_self},this._testRequest=function(testRequest){return _bugsnag.testRequest=testRequest,_self},this.$get=["$injector",function($injector){return _beforeNotify&&(_bugsnag.beforeNotify=angular.isString(_beforeNotify)?$injector.get(_beforeNotify):$injector.invoke(_beforeNotify)),_bugsnag}]},$exceptionHandler:function(){this.$get=["$log","bugsnag",function($log,bugsnag){return function(exception,cause){$log.error.apply($log,arguments);try{bugsnag.fixContext(),angular.isString(exception)?bugsnag.notify(exception):bugsnag.notifyException(exception)}catch(e){$log.error(e)}}}]}})}]).run(["bugsnag","$location","$rootScope",function(bugsnag,$location,$rootScope){bugsnag.fixContext=function(){bugsnag.context=$location.url()},$rootScope.$on("$locationChangeSuccess",bugsnag.refresh||angular.noop)}])}();
//# sourceMappingURL=components.map