var UserVar={MapKey:"AmowNsVsJ4HTBQJvG2tx3T3IJkeLBfMjwxFfLWx8Ngum6VkACf8XZKOghfBw_eoi",SDSAccessID:"53b7a46be2ea4c5dad6ae080825a7784",DataSourceName:"eddiebauer",EntityTypeName:"eddiebauerstores"};function capitaliseFirstLetter(a){return a.charAt(0).toUpperCase()+a.slice(1);}var StoreLocator={map:null,mapDirections:null,mapStoreZoom:null,mapPreDir:null,mapCenterLatitude:39.571822,mapCenterLongitude:-99.667969,selectedProjectShape:null,autozoom:false,autozoomed:false,MapKey:UserVar.MapKey,SDSURL:"//spatial.virtualearth.net/REST/v1/data/"+UserVar.SDSAccessID+"/"+UserVar.DataSourceName+"/"+UserVar.EntityTypeName+"?spatialFilter=",SDSNearbyRadius:100,Locations:null,PageSize:0,Boundaries:null,CurrentItemNumer:0,InitializeFlag:true,Distance:0,DrivingInstSelected:0,StoreZoomSeleced:0,BackButtonPageFrom:"",MainMapFlag:true,SearchedLocation:null,OptionsQuery:null,KmToMiles:0.621371192,MilesToKm:1.609344,SearchedLocationDet:{Address:"",PrimaryCity:"",State:"",PostalCode:"",Latitude:"",Longitude:""},DirectionPreWayPoint:null,DirectionPrePos:null,itineraryItems:null,DirectionFirstWP:null,DirectionLastWP:null,DirectionResult:null,SetViewFlag:false,SearchString:null,ZipFlag:0,Initialize:function(){StoreLocator.options={credentials:StoreLocator.MapKey,center:new Microsoft.Maps.Location(StoreLocator.mapCenterLatitude,StoreLocator.mapCenterLongitude),mapTypeId:Microsoft.Maps.MapTypeId.road,zoom:4,enableClickableLogo:false,enableSearchLogo:false};StoreLocator.map=null;StoreLocator.map=new Microsoft.Maps.Map(document.getElementById("dvMapContainer"),StoreLocator.options);StoreLocator.Locations=null;StoreLocator.CurrentItemNumer=0;StoreLocator.SearchedLocation=null;jQuery("#dvInfobox").mouseover(function(a){StoreLocator.ShowInfoBox();});jQuery("#dvInfobox").mouseout(function(a){StoreLocator.HideInfoBox();});StoreLocator.HandleInputEnterKey();StoreLocator.FetchQueryString();StoreLocator.TOU();},FetchQueryString:function(){var h=[],g;var e=window.location.href.slice(window.location.href.indexOf("?")+1).split("&");var c="";var d="";var b="";if(e.length>0){for(var f=0;f<e.length;f++){g=e[f].split("=");if(g[0].toLowerCase()=="postalcode"){c=g[1].replace(/[+]/g," ").replace("%20"," ");}if(g[0].toLowerCase()=="footertxtcity"){d=g[1].replace(/[+]/g," ").replace("%20"," ");}if(g[0].toLowerCase()=="footerstate_province"){b=g[1].replace(/[+]/g," ").replace("%20"," ");}}if(c==""&&d==""&&b==""){}else{if(c!=""){jQuery("#txtZipcode").val(c);StoreLocator.GoToLocation(c.replace("%20"," "));}else{if(d!=""&&b!=""){var a=d+", "+b;jQuery("#State_Province").val(b.replace("%20"," "));jQuery("#txtCity").val(d.replace("%20"," "));StoreLocator.GoToLocation(a);}else{if(b==""){StoreLocator.SearchString="";StoreLocator.NoRecordsFound();}else{if(d==""){jQuery("#State_Province").val(b.replace("%20"," "));StoreLocator.SearchString=", "+document.getElementById("State_Province").options[document.getElementById("State_Province").selectedIndex].text;StoreLocator.NoRecordsFound();}}}}}}},HandleInputEnterKey:function(){jQuery("#txtZipcode").on("keypress",function(a){if(a.which==13){a.preventDefault();StoreLocator.RemoveErrorTooltips();StoreLocator.SearchByZip();}});jQuery("#txtCity").on("keypress",function(a){if(a.which==13){a.preventDefault();StoreLocator.RemoveErrorTooltips();StoreLocator.SearchByCity();}});},SearchByZip:function(){var a=jQuery("#txtZipcode").val();var c=/[^0-9]/g;var b=/[a-z][0-9][a-z](-| |)[0-9][a-z][0-9]/i;if(a!=""&&(!c.test(a)||b.test(a))){jQuery("#txtCity").val("");jQuery("#State_Province").val("");if(StoreLocator.ZipFlag==1){jQuery("#Postal_state").toggleClass("Postal_state_error","Postal_state");StoreLocator.ZipFlag=0;}StoreLocator.GoToLocation(a);}else{jQuery("#txtZipcode").parent().append('<div class="error-tooltip">'+'<img class="left" src="/static/img/tooltip-arrow.png" alt="" />'+'<p class="left">Please enter a zip code or postal code.</p>'+'<span class="clear-break"></span>'+"</div>");jQuery("#Postal_state").toggleClass("Postal_state_error");StoreLocator.ZipFlag=1;}},TOU:function(){jQuery(".col-2").append('<div class="TOU"><a href="https://www.microsoft.com/maps/product/terms.html" target="_blank" rel="nofollow">Bing Maps TOU</a></div>');},SearchByCity:function(){var b=capitaliseFirstLetter(jQuery("#txtCity").val());var a=document.getElementById("State_Province").options[document.getElementById("State_Province").selectedIndex].text;if(StoreLocator.ZipFlag==1){jQuery("#Postal_state").toggleClass("Postal_state_error","Postal_state");StoreLocator.ZipFlag=0;}if(b==""&&a=="Select One"){$("#txtCity, #State_Province").addClass("error-field");jQuery("#txtCity").parent().append('<div class="error-tooltip">'+'<img class="left" src="/static/img/tooltip-arrow.png" alt="" />'+'<p class="left">Please enter a City and select a State or Province.</p>'+'<span class="clear-break"></span>'+"</div>");return;}else{if(b==""&&a!=""){$("#txtCity").addClass("error-field");jQuery("#txtCity").parent().append('<div class="error-tooltip">'+'<img class="left" src="/static/img/tooltip-arrow.png" alt="" />'+'<p class="left">Please enter a City.</p>'+'<span class="clear-break"></span>'+"</div>");return;}else{if(b!=""&&a=="Select One"){$("#State_Province").addClass("error-field");jQuery("#State_Province").parent().append('<div class="error-tooltip">'+'<img class="left" src="/static/img/tooltip-arrow.png" alt="" />'+'<p class="left">Please select a State or Province.</p>'+'<span class="clear-break"></span>'+"</div>");return;}}}jQuery("#txtZipcode").val("");var c=b+", "+a;StoreLocator.GoToLocation(c);},RemoveErrorTooltips:function(){$(".error-tooltip").remove();$("input, select").removeClass("error-field");},RadiusChanged:function(){StoreLocator.RemoveErrorTooltips();if(StoreLocator.SearchString==null||StoreLocator.SearchString==""){var a=jQuery("#txtCity").val();var b=jQuery("#State_Province").val();if(a!=""||b!=""){StoreLocator.SearchString=a+", "+b;}else{if(jQuery("#txtZipcode").val()!=""){StoreLocator.SearchString=capitaliseFirstLetter(jQuery("#txtZipcode").val());}else{StoreLocator.SearchByCity();return;}}}StoreLocator.GoToLocation(StoreLocator.SearchString);},GoToLocation:function(a){StoreLocator.autozoom=true;StoreLocator.InitializeFlag=false;StoreLocator.SearchString=a;geocodeRequest="//dev.virtualearth.net/REST/v1/Locations/"+a+"?output=json&key="+StoreLocator.MapKey;jQuery.ajax({url:geocodeRequest,type:"get",dataType:"jsonp",jsonp:"jsonp",success:StoreLocator.GeoCodeSuccess,error:StoreLocator.NoRecordsFound});},ShowError:function(){var a="<div class='error' id='dbMError'>There was some error. Please try again.</div>";jQuery("#dvMessage").html(a);},GeoCodeSuccess:function(d,g){if(d&&d.resourceSets&&d.resourceSets.length>0&&d.resourceSets[0].resources&&d.resourceSets[0].resources.length>0){var e=-1;for(var f=0;f<=d.resourceSets[0].resources.length-1;f++){if(d.resourceSets[0].resources[f].confidence.toLowerCase()=="high"){e=f;break;}}if(e>-1){var b=d.resourceSets[0].resources[e].bbox;var a=Microsoft.Maps.LocationRect.fromLocations(new Microsoft.Maps.Location(b[0],b[1]),new Microsoft.Maps.Location(b[2],b[3]));var c=d.resourceSets[0].resources[e].point;var h={latitude:c.coordinates[0],longitude:c.coordinates[1]};StoreLocator.SearchedLocation=h;StoreLocator.Boundaries=a;StoreLocator.SetViewFlag=true;StoreLocator.GetLocationsNearCenter();}else{StoreLocator.NoRecordsFound();}}else{StoreLocator.NoRecordsFound();}},NoRecordsFound:function(){jQuery("#dvMessage").empty();var a="<p class='error' id='dbMError'>No results were found for "+StoreLocator.SearchString+" within a "+jQuery("#Radius").val()+" mile radius<br />"+"<span class='results_error_msg'>Please double-check that you entered your search correctly, or try expanding the search radius.</span></p>";jQuery("#dvMessage").html(a);rl=jQuery("#dvResults");rl.empty();jQuery("#storelocator_billboard_1").show();StoreLocator.map.entities.clear();},GetLocationsNearCenter:function(){StoreLocator.map.entities.clear();StoreLocator.selectedProjectShape=null;var b=StoreLocator.map.getCenter();
var c={centerLat:b.Latitude,centerLong:b.Longitude};var d=parseFloat(jQuery("#Radius").val())*StoreLocator.MilesToKm;var a=StoreLocator.SDSURL+"nearby("+StoreLocator.SearchedLocation.latitude+","+StoreLocator.SearchedLocation.longitude+","+d+")";a+="&$select=EntityID,Name,AddressLine,Latitude,Longitude,PrimaryCity,SubDivision,PostalCode,Phone,StoreHours,StoreType,__Distance";a+="&$orderby=PostalCode";a+="&key="+StoreLocator.MapKey+"&$format=json";jQuery.ajax({url:a,type:"GET",dataType:"jsonp",jsonp:"jsonp",success:StoreLocator.LocationsFetchSuccess,error:StoreLocator.NoRecordsFound});},LocationsFetchSuccess:function(a,b){if(b!="success"){StoreLocator.NoRecordsFound();}else{StoreLocator.Locations=[];StoreLocator.Replot(a);}},sortByDistance:function(d,c){if(d.__Distance==c.__Distance){return 0;}return d.__Distance>c.__Distance?1:-1;},Replot:function(c){if(c.d.results.length>0){jQuery("#dvMessage").empty();jQuery("#dvMessage").append("Good news. The following stores are within a "+jQuery("#Radius").val()+" mile radius of "+StoreLocator.SearchString+".");jQuery("#storelocator_billboard_1").hide();for(i=0;i<c.d.results.length;i++){var a=c.d.results[i];var b=i+1;a.LocationNumber=b;if(!a.__Distance&&StoreLocator.SearchedLocation!=null){a.__Distance=StoreLocator.CalcDistance((StoreLocator.SearchedLocation.latitude),(StoreLocator.SearchedLocation.longitude),a.Latitude,a.Longitude);}StoreLocator.Locations.push(a);}(StoreLocator.Locations).sort(StoreLocator.sortByDistance);StoreLocator.CurrentItemNumer=0;StoreLocator.PopulateGrid();}else{StoreLocator.NoRecordsFound();}},PopulateGrid:function(){StoreLocator.autozoom=true;var s='<div class="searchresults">';var e=parseInt(StoreLocator.CurrentItemNumer,0);rl=jQuery("#dvResults");rl.empty();var r=0;if(StoreLocator.PageSize==0){r=StoreLocator.Locations.length-1;}else{r=(e+(StoreLocator.PageSize-1));}if(r>StoreLocator.Locations.length){r=StoreLocator.Locations.length-1;}var h=null;if(StoreLocator.SearchedLocation!=null){h=(StoreLocator.SearchedLocation.latitude)+","+(StoreLocator.SearchedLocation.longitude);}StoreLocator.map.entities.clear();var v=[];for(i=e;i<=r;i++){var b=StoreLocator.Locations[i];var g=i+1;StoreLocator.Distance=0;var a=new Microsoft.Maps.Location(b.Latitude,b.Longitude);v.push(a);var f="";var k="";var n="";if(StoreLocator.Locations[i].StoreType.toLowerCase()=="outlet"){f="/static/img/pin_graphic_outlet.gif";k="subcol1-outlet";n='<div class="left subcol4" valign="top">'+"<dl>"+"<dd>"+'<span class="outlet">OUTLET'+'<span class="notavailable"><br>First Ascent<br>Not Available'+"</span>"+"</span>"+"</dd>"+"</dl>"+"</div>";}else{if(StoreLocator.Locations[i].StoreType.toLowerCase()=="afa"){f="/static/img/pin_graphic.gif";k="subcol1";n="<div class='left subcol4'>"+"<dl>"+"<dd>"+"<span title='First Ascent Available' class='afa'></span>"+"</dd>"+"</dl>"+"</div>";}else{f="/static/img/pin_graphic.gif";k="subcol1";n="<div class='left subcol4'>"+"<dl>"+"<dd>"+'<span class="outlet">'+'<span class="notavailable">'+"</span>"+"</span>"+"</dd>"+"</dl>"+"</div>";}}var d={icon:f,width:31,height:40,text:g+"",zIndex:1000,typeName:"pushpin"};var m=new Microsoft.Maps.Pushpin(a,d);m._id="pushpin_"+i;Microsoft.Maps.Events.addHandler(m,"click",StoreLocator.pushpinClicked);Microsoft.Maps.Events.addHandler(m,"mouseover",StoreLocator.pushpinMouseOver);Microsoft.Maps.Events.addHandler(m,"mouseout",StoreLocator.pushpinMouseOut);StoreLocator.map.entities.push(m);var l={Location:b,LocationNumber:g,IconElementId:"pushpin_"+g,text:g};var o=b.Latitude+","+b.Longitude;var u=(b.__Distance)*StoreLocator.KmToMiles;var t=(b.StoreHours).split(" ~ ");var c="";for(iCtrStHrs=0;iCtrStHrs<t.length;iCtrStHrs++){c+=t[iCtrStHrs]+"<br />";}b.Accessibity="";if(b.SubDivision.indexOf("ON")!=-1){b.Accessibity="<dl class='accessibility'><a href='/storelocator/gadgets/Eddie Bauers Ontario Accessible Customer Service Plan.pdf' target='_blank' class='links'><dd>Accessible Customer</dd><dd>Service Plan</dd><dd>(PDF 410K)</dd></a></dl>";}var j="<div class='searchItem clearfix'>"+"<div class='left "+k+"'>"+"<a href='javascript:void(0)'  onclick=\"StoreLocator.OpenDirections('"+(i)+"');\">"+(i+1)+"</a>"+"</div>"+"<div class='left subcol2'>"+"<dl>"+"<dt><a href='javascript:void(0)'  onclick=\"StoreLocator.OpenDirections('"+(i)+"');\">"+b.Name+"</a></dt>"+"<dd>"+b.AddressLine+"</dd>"+"<dd>"+b.PrimaryCity+", "+b.SubDivision+"  "+b.PostalCode+"</dd>"+"<dd>"+b.Phone+"</dd>"+"<dd><a href='javascript:void(0)'  onclick=\"StoreLocator.OpenDirections('"+(i)+"');\" class='directions'>Get Directions</a></dd>"+"</dl>"+"</div>"+"<div class='left subcol3'>"+"<dl>"+"<dt>"+"<span class='openhours'>"+c+"</span>"+"</dt>"+"</dl>"+b.Accessibity+"</div>"+n+"</div><hr />";s+=j;}var p;if(StoreLocator.autozoom&&StoreLocator.Locations.length>0&&StoreLocator.SetViewFlag==true){StoreLocator.autozoomed=true;if(StoreLocator.Locations.length>1){var q=new Microsoft.Maps.LocationRect.fromLocations(v);p=StoreLocator.map.getOptions();p.bounds=q;p.bounds.height=p.bounds.height*1.2;p.bounds.width=p.bounds.width*1.2;}else{if(StoreLocator.Locations.length==1){p=StoreLocator.map.getOptions();p.center=v[0];}}StoreLocator.map.setView(p);}StoreLocator.autozoom=false;s+="</table>";rl.append(s);},pushpinClicked:function(a){var b=a.target.getId();var c=parseFloat(b.substring(8));StoreLocator.OpenDirections(c);},pushpinMouseOver:function(c){StoreLocator.HideInfoBox();var l=c.target.getId();index=parseFloat(l.substring(8));var j=StoreLocator.Locations[index];var b=j.StoreType;var a="";var d;var f="";if(b=="Outlet"){a='<span class="outlet">Outlet</span><br />';f="<br><br>";}else{if(b=="AFA"){a='<span class="afacss">First Ascent Available</span><br />';f="";}}var g=a+'<a href="javascript:void(0);" onclick="StoreLocator.OpenDirections(\''+index+"')\">"+j.Name+"</a>";var h=j.AddressLine+"<br>"+j.PrimaryCity+", "+j.SubDivision+"  "+j.PostalCode+"<br>"+j.Phone+"<br>Latitude: "+j.Latitude+"<br>Longitude: "+j.Longitude+f;var k=StoreLocator.map.tryLocationToPixel(new Microsoft.Maps.Location(j.Latitude,j.Longitude),Microsoft.Maps.PixelReference.page);jQuery("#dvPushPinTitle").empty();jQuery("#dvPushPinTitle").append(g);jQuery("#dvPushPinBody").empty();jQuery("#dvPushPinBody").append(h);jQuery("#dvInfobox").attr("style","position: absolute; visibility: visible; top: "+(k.y-163)+"px; left: "+(k.x+11)+"px; opacity: 1;");jQuery("#dvEro-beak").attr("style","top: 121px;");jQuery("#dvInfobox").show();jQuery("#dvPushPinTitle").show();},pushpinMouseOut:function(a){StoreLocator.HideInfoBox();},HideInfoBox:function(){jQuery("#dvInfobox").hide();},ShowInfoBox:function(){jQuery("#dvInfobox").show();},OpenDirections:function(b){var a=StoreLocator.Locations[b];var c="?storelatitude="+a.Latitude+"&storelongitude="+a.Longitude+"&storename="+a.Name+"&storeaddress="+a.AddressLine+"&storecity="+a.PrimaryCity+"&storepostalcode="+a.PostalCode+"&storehours="+a.StoreHours+"&storephone="+a.Phone+"&storesubdivision="+a.SubDivision+"&storeStoreType="+a.StoreType;showModal(null,null,"/modals/storelocator/store-locator-frame.jsp"+c,605,900,true,"10%",null,null);},CalcDistance:function(l,d,k,c){var j=Math.PI*l/180;var h=Math.PI*k/180;var b=Math.PI*d/180;var a=Math.PI*c/180;var g=d-c;var f=Math.PI*g/180;var e=Math.sin(j)*Math.sin(h)+Math.cos(j)*Math.cos(h)*Math.cos(f);e=Math.acos(e);e=e*180/Math.PI;e=e*60*1.1515;return e;}};