(function(b){b.EndecaSearchSuggestor=function(d,c){this._active=true;this._options=c;this._lastValue="";this._element=d;this._container=b('<div id="headSearchTypeAheadHolder" class="'+this._options.containerClass+'" />');this._timeOutId;this._hideTimeOutId;this._selectedIndex=-1;var e=this;b("#headSearchForm").append(this._container);d.keydown(function(f){switch(f.keyCode){case 38:if(e._active){e.moveToPrev();}else{e.show();}break;case 40:if(e._active){e.moveToNext();}else{e.show();}break;case 9:e.hide();break;case 13:if(e._active&&e._selectedIndex!=-1){f.preventDefault();e.selectItem();return false;}break;case 27:if(e._active){e.hide();}break;default:e.handleRequest();}});d.blur(function(f){});};b.EndecaSearchSuggestor.prototype.moveToPrev=function(){if(this._selectedIndex==-1){this._selectedIndex=0;}else{if(this._selectedIndex==0){return;}this._selectedIndex--;}b(".dimResult",this._container).parent().each(function(c){b("a",b(".dimResult",this._container)).removeClass("acselected");});b(b(".dimResult",this._container).get(this._selectedIndex)).next().find("a:first").removeClass("acselected");b(b(".dimResult",this._container).get(this._selectedIndex)).find("a:first").addClass("acselected");};b.EndecaSearchSuggestor.prototype.moveToNext=function(){if(this._selectedIndex==-1){this._selectedIndex=0;}else{if(this._selectedIndex==b(".dimResult",this._container).size()-1){return;}this._selectedIndex++;}b(".dimResult",this._container).parent().each(function(c){b("a",b(".dimResult",this._container)).removeClass("acselected");});b(b(".dimResult",this._container).get(this._selectedIndex)).prev().find("a:first").removeClass("acselected");b(b(".dimResult",this._container).get(this._selectedIndex)).find("a:first").addClass("acselected");};b.EndecaSearchSuggestor.prototype.selectItem=function(){if(this._selectedIndex==-1){return;}var c=b("a",b(".dimResult",this._container).get(this._selectedIndex)).attr("href");document.location.href=c;};b.EndecaSearchSuggestor.prototype.hide=function(){this._container.hide();this._active=false;};b.EndecaSearchSuggestor.prototype.show=function(){if(this._container.is(":hidden")){this.setPosition();this._container.show();this._active=true;this._selectedIndex=-1;}};b.EndecaSearchSuggestor.prototype.handleRequest=function(){var c=this;this._selectedIndex=-1;var d=function(){var e=b.trim(c._element.val());if(e!=c._lastValue){if(e.length>=3){c.requestData();}else{c.hide();}}c._lastValue=e;};if(this._timeOutId){clearTimeout(this._timeOutId);}this._timeOutId=setTimeout(d,this._options.delay);};b.EndecaSearchSuggestor.prototype.requestData=function(){var d=this;var c=b.ajax({url:d.composeUrl(),dataType:"json",data:b("#searchScopeValue").serialize(),async:true,success:function(e){d.showSearchResult(e);}});};b.EndecaSearchSuggestor.prototype.composeUrl=function(){var d=this._options.autoSuggestServiceUrl;var c=b.trim(this._element.val());if(d.indexOf("?")==-1){d+="?";}else{d+="&";}d+="Dy=1&collection="+this._options.collection+"&Ntt="+c+"*"+"&Nr=AND(P_Is_Active:1,P_Is_Display:1,NOT(P_Is_EobOnly:1),NOT(Clearance))&reqType=typeAhead";return d;};b.EndecaSearchSuggestor.prototype.showSearchResult=function(d){var c=this.processSearchResult(d);if(c!=null){this._container.html(c);this.bindEventHandler();if($.trim($("ul.ut-flyout").html())==""){this.hide();}else{this.show();}}else{this.hide();}};b.EndecaSearchSuggestor.prototype.processSearchResult=function(h){var g=null;var f=null;var e=null;var c=h.products;var d=h.contents[0];e=this.generateHtmlContent(d,c);return e;};function a(e,c,d){if(c!=d){while(e.indexOf(c)>-1){e=e.replace(c,d);}}return e;}b.EndecaSearchSuggestor.prototype.generateHtmlContent=function(p,H){var x=null;var o=null;var q=null;if(p!=null){q=b('<ul class="ut-flyout result-item-list" />');var s=b.trim(this._element.val());q.append(b(this.highlightMatched(s)));x=p.autoSuggest;if(x!=null&&x.length>0){for(var k=0;k<x.length;k++){var t=x[k];if(t!=null&&t["@type"]=="DimensionSearchAutoSuggestItem"){var l=t.dimensionSearchGroups;if(l!=null&&l.length>0){for(var n=0;n<l.length;n++){var v=l[n];if(v!=null&&v.dimensionSearchValues!=null&&v.dimensionSearchValues.length>0&&v.dimensionName=="product.category"){var E="";var r=0;for(var k=0;k<v.dimensionSearchValues.length;k++){var h=v.dimensionSearchValues[k];if(h.ancestors!=null&&h.ancestors.length>0){var z=true;var u=h.ancestors[0].label;var A=h.ancestors[0].label;}else{var u=h.label;var A=h.label;}var G=h.label;var y="";var D=h.contentPath+h.navigationState;D=a(D,"+","-");D=D.substring(0,D.indexOf("?"));if(u.toLowerCase().indexOf("men")>=0||u.toLowerCase().indexOf("women")>=0){if(h.ancestors!=null&&h.ancestors.length>0){y=u+G;if(E.indexOf(y)<0){r=r+1;E=E+y+"|";q.append('<li class="dimResult"><a href="'+D+"?previousPage=type&tab="+u+'">'+u+"'s"+" "+G+"</a></li>");}}else{y=u;if(E.indexOf(y)<0){r=r+1;E=E+y+"|";q.append('<li class="dimResult"><a href="'+D+"?previousPage=type&tab="+u+'">'+u+"'s"+"</a></li>");}}}else{if(u.toLowerCase().indexOf("first ascent")>=0||u.toLowerCase().indexOf("sport shop")>=0||u.toLowerCase().indexOf("travex")>=0){if(h.ancestors!=null&&h.ancestors.length==0){y=u;if(E.indexOf(y)<0){r=r+1;E=E+y+"|";q.append('<li class="dimResult"><a href="'+D+"?previousPage=type&tab="+u+'">'+u+"</a></li>");}}if(h.ancestors!=null&&h.ancestors.length==1){y=G;if(E.indexOf(y)<0){r=r+1;E=E+y+"|";q.append('<li class="dimResult"><a href="'+D+"?previousPage=type&tab="+u+'">'+G+"</a></li>");}}if(h.ancestors!=null&&h.ancestors.length>1){if(h.ancestors[1].label.toLowerCase().indexOf("men")>=0||h.ancestors[1].label.toLowerCase().indexOf("women")>=0){y=h.ancestors[1].label+G;if(E.indexOf(y)<0){r=r+1;E=E+y+"|";q.append('<li class="dimResult"><a href="'+D+"?previousPage=type&tab="+u+'">'+h.ancestors[1].label+"'s"+" "+G+"</a></li>");}}else{if(h.ancestors[1].label.toLowerCase().indexOf("kids")>=0){if(h.ancestors!=null&&h.ancestors.length==2){y=G;if(E.indexOf(y)<0){r=r+1;E=E+y+"|";q.append('<li class="dimResult"><a href="'+D+"?previousPage=type&tab="+u+'">'+G+"</a></li>");}}else{if(h.ancestors!=null&&h.ancestors.length>2){if(h.ancestors[2].label.toLowerCase().indexOf("boys")||h.ancestors[2].label.toLowerCase().indexOf("girls")){y=h.ancestors[2].label+G;if(E.indexOf(y)<0){r=r+1;E=E+y+"|";q.append('<li class="dimResult"><a href="'+D+"?previousPage=type&tab="+u+'">'+h.ancestors[2].label+"'"+" "+G+"</a></li>");}}else{y=G;if(E.indexOf(y)<0){r=r+1;E=E+y+"|";q.append('<li class="dimResult"><a href="'+D+"?previousPage=type&tab="+u+'">'+G+"</a></li>");}}}}}else{y=G;if(E.indexOf(y)<0){r=r+1;E=E+y+"|";q.append('<li class="dimResult"><a href="'+D+"?previousPage=type&tab="+u+'">'+G+"</a></li>");}}}}}else{if(u.toLowerCase().indexOf("kids")>=0){if(h.ancestors!=null&&h.ancestors.length==0||h.ancestors!=null&&h.ancestors.length==1){y=G;if(E.indexOf(y)<0){r=r+1;E=E+y+"|";q.append('<li class="dimResult"><a href="'+D+"?previousPage=type&tab="+u+'">'+G+"</a></li>");}}else{y=h.ancestors[1].label+G;if(E.indexOf(y)<0){r=r+1;E=E+y+"|";q.append('<li class="dimResult"><a href="'+D+"?previousPage=type&tab="+u+'">'+h.ancestors[1].label+"'"+" "+G+"</a></li>");}}}else{y=G;if(E.indexOf(y)<0){r=r+1;E=E+y+"|";q.append('<li class="dimResult"><a href="'+D+"?previousPage=type&tab="+u+'">'+G+"</a></li>");}}}}if(r==3){break;}}}}}}}}var e=H;var m=-1;var f=0;for(var C in e){m=m+1;if(f<5){var w=e[m].prodId;var B=e[m].prodName;B;var g=B.indexOf(" |");B=B.substring(0,g);var F=e[m].prodName;B=B.replace(" ","-");B=B.replace(/[^a-zA-Z0-9]/g,"-");var d=e[m].recordSpec;var c=e[m].skuType;c=c.toLowerCase();if(c.indexOf("giftcard")<0&&c.indexOf("giftbox")<0&&c.indexOf("giftwrap")<0){f=f+1;q.append('<li class="dimResult"><a href="'+"/product/"+B+"/"+w+"/_/A-"+d+"?showProducts=111&previousPage=type"+'">'+F+"</a>"+"</li>");}}}}return q;};b.EndecaSearchSuggestor.prototype.highlightMatched=function(e){var c=b.trim(this._element.val()).toLowerCase();var f=e.toLowerCase();if(f.indexOf(c)!=-1){var d=f.indexOf(c);var g=e.substring(0,d);var h=e.substring(d+c.length);
c=e.substr(d,c.length);f=g+h;}return f;};b.EndecaSearchSuggestor.prototype.bindEventHandler=function(){var c=this;b("a",b(".dimResult",this._container)).mouseover(function(d){b(".dimResult",c._container).parent().each(function(e){b("a",b(".dimResult",this._container)).removeClass("acselected");});b(this).addClass("acselected");c._selectedIndex=b(".dimResult",c._container).index(b(this));});b("a",b(".dimResult",this._container)).mouseout(function(d){b(".dimResult",c._container).parent().each(function(e){b("a",b(".dimResult",this._container)).removeClass("acselected");});c._selectedIndex=-1;});b(".dimResult",this._container).click(function(d){c.selectItem();});b("a",b(".dimResult",this._container)).click(function(d){d.preventDefault();c.selectItem();});b(".dimRoots",this._container).click(function(){clearTimeout(c._hideTimeOutId);c._element.focus();});};b.EndecaSearchSuggestor.prototype.setPosition=function(){var c=this._element.offset();this._container.css({top:c.top+this._element.outerHeight(),left:c.left,width:this._element.width()});};b.fn.endecaSearchSuggest=function(c){var d=b.extend({},b.fn.endecaSearchSuggest.defaults,c);this.each(function(){var e=b(this);new b.EndecaSearchSuggestor(e,d);});};b.fn.endecaSearchSuggest.defaults={minAutoSuggestInputLength:3,displayImage:false,delay:250,autoSuggestServiceUrl:"",collection:"",searchUrl:"",containerClass:"dimSearchSuggContainer",defaultImage:"no_image.gif"};})(jQuery);