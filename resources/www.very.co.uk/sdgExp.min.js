(function(m){window.shopdirect=window.shopdirect||{};window.shopdirect.exps=window.shopdirect.exps||{};window.shopdirect.util=window.shopdirect.util||{};var p=window.location.href,n=window.sessionStorage?!0:!1,c=shopdirect.exps,d=shopdirect.util;d.addStyleSheet=function(a){var b,e;b=document.getElementsByTagName("head")[0];e=document.createElement("style");e.setAttribute("type","text/css");e.styleSheet?e.styleSheet.cssText=a:e.appendChild(document.createTextNode(a));b.appendChild(e);return e};d.cookie=
{set:function(a,b,e){var c=new Date;c.setTime(c.getTime()+864E5*e);e="expires="+c.toGMTString();document.cookie=a+"="+b+"; "+e+";path=/"},get:function(a){a+="=";var b=document.cookie.split(";"),e,c;for(e=0;e<b.length;e+=1){for(c=b[e];" "===c.charAt(0);)c=c.substring(1);if(0===c.indexOf(a))return c.substring(a.length,c.length)}return""},del:function(a){document.cookie=a+"=;expires=Thu, 01 Jan 1970 00:00:01 GMT;path=/"}};d.browserDetector={ua:window.navigator.userAgent,ie:function(){var a=d.browserDetector.ua,
b=a.indexOf("MSIE ");if(0<b)return parseInt(a.substring(b+5,a.indexOf(".",b)),10);if(0<a.indexOf("Trident/"))return b=a.indexOf("rv:"),parseInt(a.substring(b+3,a.indexOf(".",b)),10);b=a.indexOf("Edge/");return 0<b?parseInt(a.substring(b+5,a.indexOf(".",b)),10):!1},ios:function(){var a;return/iP(hone|od|ad)/.test(d.browserDetector.ua)&&(a=navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),null!==a)?parseInt(a[0].replace("OS ",""),10):!1},android:function(){var a=d.browserDetector.ua,a=a.toLowerCase();
return/android/.test(a)&&(a=a.match(/android\s([0-9\.]*)/),null!==a)?parseFloat(a[1],10):!1},safari:function(){var a=d.browserDetector.ua;return a.match(" Safari/")&&!a.match(" Chrom")&&a.match(" Version/")&&(a=a.match(/Version\/([0-9\.]*)/),null!==a)?parseInt(a[0].replace("Version/",""),10):!1},opera:function(){return"object"===typeof window.opera&&window.opera.buildNumber},windowsPhone:function(){var a=d.browserDetector.ua;return!!a.match(/iemobile/i)||!!a.match(/Windows Phone/i)},app:function(){var a=
window.location;return null!==a.search.match("aff=app")&&null!==a.search.match("&cm_mmc=YUDU")}};d.qbLoadCheck={previewMode:function(){return-1<window.location.href.indexOf("etcForceCreative")||-1<document.cookie.indexOf("etcForceCreative")},browserChecks:function(){var a=navigator.userAgent,b=-1<window.location.href.indexOf(".lsdg.com"),e=d.browserDetector.app,c=d.browserDetector.windowsPhone,g=d.browserDetector.opera,f=d.browserDetector.safari,h=d.browserDetector.ie,k=d.browserDetector.ios,l=d.browserDetector.android;
return n?(sessionStorage.getItem("userAgent")&&sessionStorage.getItem("userAgent")!==a&&(sessionStorage.removeItem("userAgent"),sessionStorage.removeItem("firstPageLoaded"),sessionStorage.removeItem("qbBrowserExclusions")),sessionStorage.getItem("qbBrowserExclusions")?b="true"===sessionStorage.getItem("qbBrowserExclusions")?!0:!1:(b=b||e()||g()||c()||h()&&9>=h()||f()&&5>=f()||k()&&6>=k()||l()&&3.9>=l(),sessionStorage.setItem("qbBrowserExclusions",b),sessionStorage.setItem("userAgent",a)),!b):!1},
pageChecks:function(){var a="home"===window.universal_variable.page.category,b=window.location,e=-1<b.href.indexOf(".end"),d=-1<b.href.indexOf(".prd"),g=-1<b.href.indexOf("basket"),b=-1<b.href.indexOf("https"),f;if(n){if(!sessionStorage.getItem("firstPageLoaded"))return sessionStorage.setItem("firstPageLoaded",!0),void 0===c.exInfo.loader&&(c.exInfo.loader={global:0,homepage:0,gallery:0,product:0,basket:0,secured:0,other:0},sessionStorage.setItem("qbPageCheck",JSON.stringify(c.exInfo.loader))),!0;
if(sessionStorage.getItem("qbPageCheck")){if(f=JSON.parse(sessionStorage.getItem("qbPageCheck")),f.global&&0<f.global||f.other&&0<f.other||a&&f.homepage&&0<f.homepage||e&&f.gallery&&0<f.gallery||d&&f.product&&0<f.product||g&&f.basket&&0<f.basket||b&&f.secured&&0<f.secured)return!0}else return!0}return!1},init:function(){var a=window.jQuery;return n&&a&&(d.qbLoadCheck.previewMode()||d.qbLoadCheck.browserChecks()&&d.qbLoadCheck.pageChecks())?!0:!1}};d.scriptsLoader={shelfs:[],addShelf:function(a){d.scriptsLoader.shelfs.push(a)},
loadAllFromShelf:function(a,b){var e=d.scriptsLoader.shelfs[a],c=e.length,g=0,f;for(f=0;f<c;f+=1)e[f].hasOwnProperty("text")?(g+=1,d.scriptsLoader.loadTxtScript(e[f])):e[f].hasOwnProperty("src")&&d.scriptsLoader.loadSrcScript(e[f],a,b);g===c&&d.scriptsLoader.areAllLoaded(a,b)},loadTxtScript:function(a){var b;b=document.createElement("script");b.text=a.text;a.hasOwnProperty("id")&&(b.id=a.id);b.type=a.hasOwnProperty("type")?a.type:"text/javascript";b.async=a.hasOwnProperty("async")?a.async:!0;document.getElementsByTagName("head")[0].appendChild(b);
a.loaded=!0},loadSrcScript:function(a,b,e){var c=a.src,g=!1,f;0===m('script[src*="'+c+'"]').length?(f=document.createElement("script"),f.src=c,a.hasOwnProperty("id")&&(f.id=a.id),f.type=a.hasOwnProperty("type")?a.type:"text/javascript",f.async=a.hasOwnProperty("async")?a.async:!0,c=document.getElementsByTagName("head")[0],c.appendChild(f),f.onload=f.onreadystatechange=function(){g||f.readyState&&"complete"!==f.readyState&&"loaded"!==f.readyState||(g=!0,a.loaded=!0,d.scriptsLoader.areAllLoaded(b,e))}):
(g=!0,a.loaded=!0,d.scriptsLoader.areAllLoaded(b,e))},areAllLoaded:function(a,b){var e=d.scriptsLoader.shelfs[a],c=e.length,g=0,f;for(f=0;f<c;f+=1)if(e[f].hasOwnProperty("loaded"))g+=1;else break;g===c&&setTimeout(function(){b()},100)},init:function(a,b){d.scriptsLoader.addShelf(a);d.scriptsLoader.loadAllFromShelf(d.scriptsLoader.shelfs.length-1,b)}};d.objectCheck=function(a,b,e,d){var g=0,f=Object.keys(e),h,k=function(a){for(var b in a)h=f.filter(function(f){if(b===f&&a[b]===e[f])return c.addExInfo(d,
"Object key-value matched. Key: "+f+", value: "+e[f]),!0}),g+=h.length,a[b]&&"object"===typeof a[b]&&k(a[b])};k(b);if("one"===a&&0<g||"all"===a&&g===f.length)return c.addExInfo(d,"Object key-values pairs matched - "+a),!0;c.addExInfo(d,"Object key-values pairs NOT matched - "+a);return!1};d.checkUnicaIDs=function(a,b,e){var d=window.universal_variable.user,g=0,f,h;if(d.hasOwnProperty("unicaSegment")&&""!==d.unicaSegment){d=d.unicaSegment;for(h=0;h<b.length;h+=1)if(f=b[h],d.match(f))if("all"===a)g+=
1,c.addExInfo(e,"unicaId value found "+f);else return c.addExInfo(e,'unicaId found - ONE "'+f),!0;if(b.length===g)return c.addExInfo(e,"unicaId all values FOUND"),!0}c.addExInfo(this.testId,"unicaId FAILED");return!1};d.checkURL=function(a,b,e){var d=window.location.href,g,f=0,h;if("one"===a)for(h=0;h<b.length;h+=1)if(g=b[h],-1!==d.indexOf(g))return c.addExInfo(e,"url found - ONE: "+g),!0;if("all"===a){for(a=0;a<b.length;a+=1)g=b[a],-1!==d.indexOf(g)&&(f+=1);if(f===b.length)return c.addExInfo(e,"url found - ALL: "+
b),!0}c.addExInfo(e,"url NOT found");return!1};d.pubSub=function(a,b,e,d){m(a).length?(c.addExInfo(d,"pubSub, elemExist: "+a),e()):"object"===typeof window.shopdirect.event?shopdirect.event.subscribe(b,function(){c.addExInfo(d,"pubSub, shopdirect subscriber fired: "+b);e()}):sdg.events.subscribe(b,function(){c.addExInfo(d,"pubSub, sdg subscriber fired: "+b);e()})};d.mutObs=function(a,b,e){var d=a.length,g=0,f,h;f={attributes:!0,childList:!0,subtree:!0};c.exInfo.observers[e]={};for(h=0;h<d;h+=1)m(a[h]).length?
(g+=1,c.addExInfo(e,"mutation - Element already exists: "+a[h]),d===g&&(c.addExInfo(e,"mutation (Elements exists) - Activate"),b())):function(a,h){c.exInfo.observers[e][a]={exist:!1,elem:h};c.exInfo.observers[e][a].fn=new MutationObserver(function(){m(h).length&&!1===c.exInfo.observers[e][a].exist&&(c.exInfo.observers[e][a].exist=!0,c.exInfo.observers[e][a].fn.disconnect(),g+=1,c.addExInfo(e,"mutation - element found: "+h),d===g&&(c.addExInfo(e,"mutation Activate"),b()))});c.exInfo.observers[e][a].fn.observe(document,
f)}(h,a[h])};d.poll=function(a,b,e,q,g,f){var h=a.length,k=0,l;for(l=0;l<a.length;l+=1)m(a[l]).length&&(k+=1);h===k?(c.addExInfo(f,"polling using timeouts - Activate"+b),g()):b<q?(c.addExInfo(f,"polling, "+b*e),setTimeout(function(){b*=e;d.poll(a,b,e,q,g,f)},b)):c.addExInfo(f,"polling timed out, "+b*e)};d.waitForEl=function(a,b,c){window.hasOwnProperty("MutationObserver")?d.mutObs(a,b,c):d.poll(a,10,2,6E3,b,c)};c.exInfo={tests:{},liveTests:{},observers:{}};c.timer=function(a){var b,e;void 0!==c.exInfo.tests[a]&&
(b=c.exInfo.tests[a].timers.start,e=c.exInfo.tests[a].timers.stop=(new Date).getTime(),c.exInfo.tests[a].timers.diff=e-b)};c.addExInfo=function(a,b){void 0!==a&&c.exInfo.tests[a].triggerInfo.push(b)};c.expConsole=function(a){d.scriptsLoader.init([{src:"http://content.very.co.uk/assets/static/js/expConsole.js"}],a)};c.expValidator=function(a){d.scriptsLoader.init([{src:"http://content.very.co.uk/assets/static/js/expValidator.min.js"}],a)};c.multiPreview=function(){var a=window.location.href;d.cookie.del("smartserve_preview");
d.cookie.del("etcForceCreative");a=a.match(/exp=[0-9]+((,[0-9]+)+)?/g);a=a[0].split("=");a=a[1];d.cookie.set("smartserve_preview","true",.5);d.cookie.set("etcForceCreative","["+a+"]",.5)};c.Trigger=function(a,b,e,d){var g=(new Date).getTime();this.testId=a;this.varId=b;this.shortDesc=e;this.area=d;this.initialTimer=g;n&&(void 0===c.exInfo.loader&&(c.exInfo.loader={global:0,homepage:0,gallery:0,product:0,basket:0,secured:0,other:0}),c.exInfo.loader[d]+=1,c.exInfo.tests[this.testId]={triggerInfo:[],
shortDesc:this.shortDesc,whichVariant:this.varId,area:this.area,timers:{start:this.initialTimer}},sessionStorage.setItem("qbPageCheck",JSON.stringify(c.exInfo.loader)))};c.Trigger.prototype.checkUnicaIDs=function(a,b){return d.checkUnicaIDs(a,b,this.testId)};c.Trigger.prototype.checkURL=function(a,b){return d.checkURL(a,b,this.testId)};c.Trigger.prototype.objectCheck=function(a,b,c){return d.objectCheck(a,b,c,this.testId)};c.Trigger.prototype.pubSub=function(a,b,c){return d.pubSub(a,b,c,this.testId)};
c.Trigger.prototype.waitForEl=function(a,b){d.waitForEl(a,b,this.testId)};c.Trigger.prototype.trafficThrottle=function(a){var b=window.location.href,e=-1!==b.indexOf("exp")||-1!==b.indexOf("smartserve_preview"),m=d.cookie.get("smartserve_preview"),b=!1;e&&m?(d.cookie.set(this.testId+"_throttle","include",.5),b=!0):(e=d.cookie.get(this.testId+"_throttle"))?"include"===e&&(b=!0):(e=100*Math.random(),e<=a?(d.cookie.set(this.testId+"_throttle","include",60),b=!0):d.cookie.set(this.testId+"_throttle",
"exclude",60));if(!0===b)return c.addExInfo(this.testId,"traffic throttle - include"),!0;c.addExInfo(this.testId,"traffic throttle - exclude");return!1};c.Trigger.prototype.activate=function(a){window.QUBITEXP=void 0===window.QUBITEXP?this.varId:QUBITEXP+"|"+this.varId;void 0!==window.uDash&&uDash.saveMeta("QUBITEXP",this.varId);void 0!==window.ADRUM&&ADRUM.command("addUserData","qbExp",this.varId);shopdirect.event.publish("experiment/Fired",{event:"Experiment executed",expId:this.testId,variantId:this.varId});
c.addExInfo(this.testId,"Trigger met - experiment will execute");c.exInfo.liveTests[this.testId]=!0;a()};-1<p.indexOf("exp=")&&c.multiPreview();-1<p.indexOf("expConsole")&&c.expConsole()})(jQuery);